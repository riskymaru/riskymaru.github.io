function easeOutBouncefunc(n){var t=0,i=1;return result=(n/=1)<1/2.75?i*7.5625*n*n+t:n<2/2.75?i*(7.5625*(n-=1.5/2.75)*n+.75)+t:n<2.5/2.75?i*(7.5625*(n-=2.25/2.75)*n+.9375)+t:i*(7.5625*(n-=2.625/2.75)*n+.984375)+t}function integerize(n,t){return Math.round(n/t*litetween_precision)}function easeFunc(n,t,i,r,u,f,e){var o=0,s,l;switch(n){case 0:o=r*t/u+i;break;case 1:o=r*(t/=u)*t+i;break;case 2:o=-r*(t/=u)*(t-2)+i;break;case 3:o=(t/=u/2)<1?r/2*t*t+i:-r/2*(--t*(t-2)-1)+i;break;case 4:o=r*(t/=u)*t*t+i;break;case 5:o=r*((t=t/u-1)*t*t+1)+i;break;case 6:o=(t/=u/2)<1?r/2*t*t*t+i:r/2*((t-=2)*t*t+2)+i;break;case 7:o=r*(t/=u)*t*t*t+i;break;case 8:o=-r*((t=t/u-1)*t*t*t-1)+i;break;case 9:o=(t/=u/2)<1?r/2*t*t*t*t+i:-r/2*((t-=2)*t*t*t-2)+i;break;case 10:o=r*(t/=u)*t*t*t*t+i;break;case 11:o=r*((t=t/u-1)*t*t*t*t+1)+i;break;case 12:o=(t/=u/2)<1?r/2*t*t*t*t*t+i:r/2*((t-=2)*t*t*t*t+2)+i;break;case 13:o=e.optimized?easeInCircle[integerize(t,u)]:-(Math.sqrt(1-t*t)-1);break;case 14:o=e.optimized?easeOutCircle[integerize(t,u)]:Math.sqrt(1-(t-1)*(t-1));break;case 15:o=e.optimized?easeInOutCircle[integerize(t,u)]:(t/=u/2)<1?-r/2*(Math.sqrt(1-t*t)-1)+i:r/2*(Math.sqrt(1-(t-=2)*t)+1)+i;break;case 16:e.optimized?o=easeInBack[integerize(t,u)]:(s=e.s,o=r*(t/=u)*t*((s+1)*t-s)+i);break;case 17:e.optimized?o=easeOutBack[integerize(t,u)]:(s=e.s,o=r*((t=t/u-1)*t*((s+1)*t+s)+1)+i);break;case 18:e.optimized?o=easeInOutBack[integerize(t,u)]:(s=e.s,o=(t/=u/2)<1?r/2*t*t*(((s*=1.525)+1)*t-s)+i:r/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)+i);break;case 19:if(e.optimized)o=easeInElasticArray[integerize(t,u)];else{var h=e.a,c=e.p,s=0;t==0&&(o=i);(t/=u)==1&&(o=i+r);c==0&&(c=u*.3);h==0||h<Math.abs(r)?(h=r,s=c/4):s=c/(2*Math.PI)*Math.asin(r/h);o=-(h*Math.pow(2,10*(t-=1))*Math.sin((t*u-s)*2*Math.PI/c))+i}break;case 20:if(e.optimized)o=easeOutElasticArray[integerize(t,u)];else{var h=e.a,c=e.p,s=0;t==0&&(o=i);(t/=u)==1&&(o=i+r);c==0&&(c=u*.3);h==0||h<Math.abs(r)?(h=r,s=c/4):s=c/(2*Math.PI)*Math.asin(r/h);o=h*Math.pow(2,-10*t)*Math.sin((t*u-s)*2*Math.PI/c)+r+i}break;case 21:if(e.optimized)o=easeInOutElasticArray[integerize(t,u)];else{var h=e.a,c=e.p,s=0;t==0&&(o=i);(t/=u/2)==2&&(o=i+r);c==0&&(c=u*.3*1.5);h==0||h<Math.abs(r)?(h=r,s=c/4):s=c/(2*Math.PI)*Math.asin(r/h);o=t<1?-.5*h*Math.pow(2,10*(t-=1))*Math.sin((t*u-s)*2*Math.PI/c)+i:h*Math.pow(2,-10*(t-=1))*Math.sin((t*u-s)*2*Math.PI/c)*.5+r+i}break;case 22:o=e.optimized?r-easeOutBounceArray[integerize(u-t,u)]+i:r-easeOutBouncefunc(u-t/u)+i;break;case 23:o=e.optimized?easeOutBounceArray[integerize(t,u)]:easeOutBouncefunc(t/u);break;case 24:o=e.optimized?t<u/2?(r-easeOutBounceArray[integerize(u-t*2,u)]+i)*.5+i:easeOutBounceArray[integerize(t*2-u,u)]*.5+r*.5+i:t<u/2?(r-easeOutBouncefunc(u-t*2)+i)*.5+i:easeOutBouncefunc((t*2-u)/u)*.5+r*.5+i;break;case 25:l=t/u/2;o=2*l*l*(3-2*l);break;case 26:l=(t/u+1)/2;o=2*l*l*(3-2*l)-1;break;case 27:l=t/u;o=l*l*(3-2*l)}return f?r-i-o:o}function trim(n){return n.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}var loaderChecker,cr,localForageInitFailed,jText,TweenObject;console.log("Plugin: loading-check");loaderChecker=0;cr={};cr.plugins_={};cr.behaviors={};typeof Object.getPrototypeOf!="function"&&(Object.getPrototypeOf=typeof"test".__proto__=="object"?function(n){return n.__proto__}:function(n){return n.constructor.prototype}),function(){function w(n,t){this.x=n;this.y=t;cr.seal(this)}function t(n,t,i,r){this.set(n,t,i,r);cr.seal(this)}function i(){this.tlx=0;this.tly=0;this.trx=0;this.try_=0;this.brx=0;this.bry=0;this.blx=0;this.bly=0;cr.seal(this)}function k(n,t,i,f){n<t?i<f?(r=n<i?n:i,u=t>f?t:f):(r=n<f?n:f,u=t>i?t:i):i<f?(r=t<i?t:i,u=n>f?n:f):(r=t<f?t:f,u=n>i?n:i)}function o(){this.s=null;this.items=null;this.item_count=0;e&&(this.s=new Set);this.values_cache=[];this.cache_valid=!0;cr.seal(this)}function et(n){v[y++]=n}function b(){this.c=0;this.y=0;this.t=0;this.sum=0;cr.seal(this)}function n(n){this.pts_cache=[];this.bboxLeft=0;this.bboxTop=0;this.bboxRight=0;this.bboxBottom=0;this.convexpolys=null;this.set_pts(n);cr.seal(this)}function s(n,t){this.cellwidth=n;this.cellheight=t;this.cells={}}function f(n,t){this.cellwidth=n;this.cellheight=t;this.cells={}}function rt(n,t,i){var r;return s.prototype.totalCellCount++,c.length?(r=c.pop(),r.grid=n,r.x=t,r.y=i,r):new cr.GridCell(n,t,i)}function ot(n){s.prototype.totalCellCount--;n.objects.clear();c.length<1e3&&c.push(n)}function l(n,t,i){this.grid=n;this.x=t;this.y=i;this.objects=new cr.ObjectSet}function ut(n,t,i){var r;return f.prototype.totalCellCount++,a.length?(r=a.pop(),r.grid=n,r.x=t,r.y=i,r):new cr.RenderCell(n,t,i)}function st(n){f.prototype.totalCellCount--;n.reset();a.length<1e3&&a.push(n)}function h(n,t,i){this.grid=n;this.x=t;this.y=i;this.objects=[];this.is_sorted=!0;this.pending_removal=new cr.ObjectSet;this.any_pending_removal=!1}function ht(n,t){return n.zindex-t.zindex}var r,u,d,e,v,y,p,c,a,ft;cr.logexport=function(n){window.console&&window.console.log&&window.console.log(n)};cr.logerror=function(n){window.console&&window.console.error&&window.console.error(n)};cr.seal=function(n){return n};cr.freeze=function(n){return n};cr.is_undefined=function(n){return typeof n=="undefined"};cr.is_number=function(n){return typeof n=="number"};cr.is_string=function(n){return typeof n=="string"};cr.isPOT=function(n){return n>0&&(n-1&n)==0};cr.nextHighestPowerOfTwo=function(n){--n;for(var t=1;t<32;t<<=1)n=n|n>>t;return n+1};cr.abs=function(n){return n<0?-n:n};cr.max=function(n,t){return n>t?n:t};cr.min=function(n,t){return n<t?n:t};cr.PI=Math.PI;cr.round=function(n){return n+.5|0};cr.floor=function(n){return n>=0?n|0:(n|0)-1};cr.ceil=function(n){var t=n|0;return t===n?t:t+1};w.prototype.offset=function(n,t){return this.x+=n,this.y+=t,this};w.prototype.mul=function(n,t){return this.x*=n,this.y*=t,this};cr.vector2=w;cr.segments_intersect=function(n,t,i,r,u,f,e,o){var s,h,c,l,a,v,y,p,it;if((n<i?(h=n,s=i):(h=i,s=n),u<e?(v=u,a=e):(v=e,a=u),s<v||h>a)||(t<r?(l=t,c=r):(l=r,c=t),f<o?(p=f,y=o):(p=o,y=f),c<p||l>y))return!1;var w=u-n+e-i,b=f-t+o-r,k=i-n,d=r-t,g=e-u,nt=o-f,tt=cr.abs(d*g-nt*k),rt=g*b-nt*w;return cr.abs(rt)>tt?!1:(it=k*b-d*w,cr.abs(it)<=tt)};t.prototype.set=function(n,t,i,r){this.left=n;this.top=t;this.right=i;this.bottom=r};t.prototype.copy=function(n){this.left=n.left;this.top=n.top;this.right=n.right;this.bottom=n.bottom};t.prototype.width=function(){return this.right-this.left};t.prototype.height=function(){return this.bottom-this.top};t.prototype.offset=function(n,t){return this.left+=n,this.top+=t,this.right+=n,this.bottom+=t,this};t.prototype.normalize=function(){var n=0;this.left>this.right&&(n=this.left,this.left=this.right,this.right=n);this.top>this.bottom&&(n=this.top,this.top=this.bottom,this.bottom=n)};t.prototype.intersects_rect=function(n){return!(n.right<this.left||n.bottom<this.top||n.left>this.right||n.top>this.bottom)};t.prototype.intersects_rect_off=function(n,t,i){return!(n.right+t<this.left||n.bottom+i<this.top||n.left+t>this.right||n.top+i>this.bottom)};t.prototype.contains_pt=function(n,t){return n>=this.left&&n<=this.right&&t>=this.top&&t<=this.bottom};t.prototype.equals=function(n){return this.left===n.left&&this.top===n.top&&this.right===n.right&&this.bottom===n.bottom};cr.rect=t;i.prototype.set_from_rect=function(n){this.tlx=n.left;this.tly=n.top;this.trx=n.right;this.try_=n.top;this.brx=n.right;this.bry=n.bottom;this.blx=n.left;this.bly=n.bottom};i.prototype.set_from_rotated_rect=function(n,t){if(t===0)this.set_from_rect(n);else{var i=Math.sin(t),r=Math.cos(t),u=n.left*i,f=n.top*i,e=n.right*i,o=n.bottom*i,s=n.left*r,h=n.top*r,c=n.right*r,l=n.bottom*r;this.tlx=s-f;this.tly=h+u;this.trx=c-f;this.try_=h+e;this.brx=c-o;this.bry=l+e;this.blx=s-o;this.bly=l+u}};i.prototype.offset=function(n,t){return this.tlx+=n,this.tly+=t,this.trx+=n,this.try_+=t,this.brx+=n,this.bry+=t,this.blx+=n,this.bly+=t,this};r=0;u=0;i.prototype.bounding_box=function(n){k(this.tlx,this.trx,this.brx,this.blx);n.left=r;n.right=u;k(this.tly,this.try_,this.bry,this.bly);n.top=r;n.bottom=u};i.prototype.contains_pt=function(n,t){var c=this.tlx,l=this.tly,i=this.trx-c,r=this.try_-l,f=this.brx-c,e=this.bry-l,w=n-c,b=t-l,a=i*i+r*r,u=i*f+r*e,v=i*w+r*b,y=f*f+e*e,p=f*w+e*b,o=1/(a*y-u*u),s=(y*v-u*p)*o,h=(a*p-u*v)*o;if(s>=0&&h>0&&s+h<1)return!0;i=this.blx-c;r=this.bly-l;var a=i*i+r*r,u=i*f+r*e,v=i*w+r*b;return o=1/(a*y-u*u),s=(y*v-u*p)*o,h=(a*p-u*v)*o,s>=0&&h>0&&s+h<1};i.prototype.at=function(n,t){if(t)switch(n){case 0:return this.tlx;case 1:return this.trx;case 2:return this.brx;case 3:return this.blx;case 4:return this.tlx;default:return this.tlx}else switch(n){case 0:return this.tly;case 1:return this.try_;case 2:return this.bry;case 3:return this.bly;case 4:return this.tly;default:return this.tly}};i.prototype.midX=function(){return(this.tlx+this.trx+this.brx+this.blx)/4};i.prototype.midY=function(){return(this.tly+this.try_+this.bry+this.bly)/4};i.prototype.intersects_segment=function(n,t,i,r){if(this.contains_pt(n,t)||this.contains_pt(i,r))return!0;for(var f,e,o,s,u=0;u<4;u++)if(f=this.at(u,!0),e=this.at(u,!1),o=this.at(u+1,!0),s=this.at(u+1,!1),cr.segments_intersect(n,t,i,r,f,e,o,s))return!0;return!1};i.prototype.intersects_quad=function(n){var r=n.midX(),u=n.midY(),f,e,o,s,h,c,l,a,t,i;if(this.contains_pt(r,u)||(r=this.midX(),u=this.midY(),n.contains_pt(r,u)))return!0;for(t=0;t<4;t++)for(i=0;i<4;i++)if(f=this.at(t,!0),e=this.at(t,!1),o=this.at(t+1,!0),s=this.at(t+1,!1),h=n.at(i,!0),c=n.at(i,!1),l=n.at(i+1,!0),a=n.at(i+1,!1),cr.segments_intersect(f,e,o,s,h,c,l,a))return!0;return!1};cr.quad=i;cr.RGB=function(n,t,i){return Math.max(Math.min(n,255),0)|Math.max(Math.min(t,255),0)<<8|Math.max(Math.min(i,255),0)<<16};cr.GetRValue=function(n){return n&255};cr.GetGValue=function(n){return(n&65280)>>8};cr.GetBValue=function(n){return(n&16711680)>>16};cr.shallowCopy=function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);return n};cr.arrayRemove=function(n,t){var i,r;if(t=cr.floor(t),!(t<0)&&!(t>=n.length)){for(i=t,r=n.length-1;i<r;i++)n[i]=n[i+1];cr.truncateArray(n,r)}};cr.truncateArray=function(n,t){n.length=t};cr.clearArray=function(n){cr.truncateArray(n,0)};cr.shallowAssignArray=function(n,t){cr.clearArray(n);for(var i=0,r=t.length;i<r;++i)n[i]=t[i]};cr.appendArray=function(n,t){n.push.apply(n,t)};cr.fastIndexOf=function(n,t){for(var i=0,r=n.length;i<r;++i)if(n[i]===t)return i;return-1};cr.arrayFindRemove=function(n,t){var i=cr.fastIndexOf(n,t);i!==-1&&cr.arrayRemove(n,i)};cr.clamp=function(n,t,i){return n<t?t:n>i?i:n};cr.to_radians=function(n){return n/(180/cr.PI)};cr.to_degrees=function(n){return n*(180/cr.PI)};cr.clamp_angle_degrees=function(n){return n%=360,n<0&&(n+=360),n};cr.clamp_angle=function(n){return n%=2*cr.PI,n<0&&(n+=2*cr.PI),n};cr.to_clamped_degrees=function(n){return cr.clamp_angle_degrees(cr.to_degrees(n))};cr.to_clamped_radians=function(n){return cr.clamp_angle(cr.to_radians(n))};cr.angleTo=function(n,t,i,r){var u=i-n,f=r-t;return Math.atan2(f,u)};cr.angleDiff=function(n,t){if(n===t)return 0;var r=Math.sin(n),u=Math.cos(n),f=Math.sin(t),e=Math.cos(t),i=r*f+u*e;return i>=1?0:i<=-1?cr.PI:Math.acos(i)};cr.angleRotate=function(n,t,i){var r=Math.sin(n),u=Math.cos(n),f=Math.sin(t),e=Math.cos(t);return Math.acos(r*f+u*e)>i?u*f-r*e>0?cr.clamp_angle(n+i):cr.clamp_angle(n-i):cr.clamp_angle(t)};cr.angleClockwise=function(n,t){var i=Math.sin(n),r=Math.cos(n),u=Math.sin(t),f=Math.cos(t);return r*u-i*f<=0};cr.rotatePtAround=function(n,t,i,r,u,f){var e,o;if(i===0)return f?n:t;e=Math.sin(i);o=Math.cos(i);n-=r;t-=u;var s=n*e,h=t*e,c=n*o,l=t*o;return n=c-h,t=l+s,n+=r,t+=u,f?n:t};cr.distanceTo=function(n,t,i,r){var u=i-n,f=r-t;return Math.sqrt(u*u+f*f)};cr.xor=function(n,t){return!n!=!t};cr.lerp=function(n,t,i){return n+(t-n)*i};cr.unlerp=function(n,t,i){return n===t?0:(i-n)/(t-n)};cr.anglelerp=function(n,t,i){var r=cr.angleDiff(n,t);return cr.angleClockwise(t,n)?n+r*i:n-r*i};cr.qarp=function(n,t,i,r){return cr.lerp(cr.lerp(n,t,r),cr.lerp(t,i,r),r)};cr.cubic=function(n,t,i,r,u){return cr.lerp(cr.qarp(n,t,i,u),cr.qarp(t,i,r,u),u)};cr.cosp=function(n,t,i){return(n+t+(n-t)*Math.cos(i*Math.PI))/2};cr.hasAnyOwnProperty=function(n){for(var t in n)if(n.hasOwnProperty(t))return!0;return!1};cr.wipe=function(n){for(var t in n)n.hasOwnProperty(t)&&delete n[t]};d=+new Date;cr.performance_now=function(){if(typeof performance!="undefined"){var n=window.performance;if(typeof n.now!="undefined")return n.now();if(typeof n.webkitNow!="undefined")return n.webkitNow();if(typeof n.mozNow!="undefined")return n.mozNow();if(typeof n.msNow!="undefined")return n.msNow()}return Date.now()-d};var g=!1,nt=!1,tt=!1,it=!1;typeof window!="undefined"&&(g=/chrome/i.test(navigator.userAgent)||/chromium/i.test(navigator.userAgent),nt=!g&&/safari/i.test(navigator.userAgent),tt=/(iphone|ipod|ipad)/i.test(navigator.userAgent),it=window.c2ejecta);e=!nt&&!it&&!tt&&typeof Set!="undefined"&&typeof Set.prototype.forEach!="undefined";o.prototype.contains=function(n){return this.isEmpty()?!1:e?this.s.has(n):this.items&&this.items.hasOwnProperty(n)};o.prototype.add=function(n){if(e)this.s.has(n)||(this.s.add(n),this.cache_valid=!1);else{var t=n.toString(),i=this.items;i?i.hasOwnProperty(t)||(i[t]=n,this.item_count++,this.cache_valid=!1):(this.items={},this.items[t]=n,this.item_count=1,this.cache_valid=!1)}};o.prototype.remove=function(n){if(!this.isEmpty())if(e)this.s.has(n)&&(this.s["delete"](n),this.cache_valid=!1);else if(this.items){var t=n.toString(),i=this.items;i.hasOwnProperty(t)&&(delete i[t],this.item_count--,this.cache_valid=!1)}};o.prototype.clear=function(){this.isEmpty()||(e?this.s.clear():(this.items=null,this.item_count=0),cr.clearArray(this.values_cache),this.cache_valid=!0)};o.prototype.isEmpty=function(){return this.count()===0};o.prototype.count=function(){return e?this.s.size:this.item_count};v=null;y=0;o.prototype.update_cache=function(){var t,i,r,n;if(!this.cache_valid){if(e)cr.clearArray(this.values_cache),v=this.values_cache,y=0,this.s.forEach(et),v=null,y=0;else if(t=this.values_cache,cr.clearArray(t),r=0,n=this.items,n)for(i in n)n.hasOwnProperty(i)&&(t[r++]=n[i]);this.cache_valid=!0}};o.prototype.valuesRef=function(){return this.update_cache(),this.values_cache};cr.ObjectSet=o;p=new cr.ObjectSet;cr.removeArrayDuplicates=function(n){for(var t=0,i=n.length;t<i;++t)p.add(n[t]);cr.shallowAssignArray(n,p.valuesRef());p.clear()};cr.arrayRemoveAllFromObjectSet=function(n,t){e?cr.arrayRemoveAll_set(n,t.s):cr.arrayRemoveAll_arr(n,t.valuesRef())};cr.arrayRemoveAll_set=function(n,t){var i,r,f,u;for(i=0,r=0,f=n.length;i<f;++i)u=n[i],t.has(u)||(n[r++]=u);cr.truncateArray(n,r)};cr.arrayRemoveAll_arr=function(n,t){var i,r,f,u;for(i=0,r=0,f=n.length;i<f;++i)u=n[i],cr.fastIndexOf(t,u)===-1&&(n[r++]=u);cr.truncateArray(n,r)};b.prototype.add=function(n){this.y=n-this.c;this.t=this.sum+this.y;this.c=this.t-this.sum-this.y;this.sum=this.t};b.prototype.reset=function(){this.c=0;this.y=0;this.t=0;this.sum=0};cr.KahanAdder=b;cr.regexp_escape=function(n){return n.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")};n.prototype.set_pts=function(n){this.pts_array=n;this.pts_count=n.length/2;this.pts_cache.length=n.length;this.cache_width=-1;this.cache_height=-1;this.cache_angle=0};n.prototype.is_empty=function(){return!this.pts_array.length};n.prototype.update_bbox=function(){for(var i=this.pts_cache,r=i[0],f=r,u=i[1],e=u,n,t,o=1,s,h=this.pts_count;o<h;++o)s=o*2,n=i[s],t=i[s+1],n<r&&(r=n),n>f&&(f=n),t<u&&(u=t),t>e&&(e=t);this.bboxLeft=r;this.bboxRight=f;this.bboxTop=u;this.bboxBottom=e};n.prototype.set_from_rect=function(n,t,i){this.pts_cache.length=8;this.pts_count=4;var r=this.pts_cache;r[0]=n.left-t;r[1]=n.top-i;r[2]=n.right-t;r[3]=n.top-i;r[4]=n.right-t;r[5]=n.bottom-i;r[6]=n.left-t;r[7]=n.bottom-i;this.cache_width=n.right-n.left;this.cache_height=n.bottom-n.top;this.update_bbox()};n.prototype.set_from_quad=function(n,t,i,r,u){this.pts_cache.length=8;this.pts_count=4;var f=this.pts_cache;f[0]=n.tlx-t;f[1]=n.tly-i;f[2]=n.trx-t;f[3]=n.try_-i;f[4]=n.brx-t;f[5]=n.bry-i;f[6]=n.blx-t;f[7]=n.bly-i;this.cache_width=r;this.cache_height=u;this.update_bbox()};n.prototype.set_from_poly=function(n){this.pts_count=n.pts_count;cr.shallowAssignArray(this.pts_cache,n.pts_cache);this.bboxLeft=n.bboxLeft;this.bboxTop-n.bboxTop;this.bboxRight=n.bboxRight;this.bboxBottom=n.bboxBottom};n.prototype.cache_poly=function(n,t,i){if(this.cache_width!==n||this.cache_height!==t||this.cache_angle!==i){this.cache_width=n;this.cache_height=t;this.cache_angle=i;var r,u,f,c,e,o,s=0,h=1,l=this.pts_array,a=this.pts_cache;for(i!==0&&(s=Math.sin(i),h=Math.cos(i)),r=0,c=this.pts_count;r<c;r++)u=r*2,f=u+1,e=l[u]*n,o=l[f]*t,a[u]=e*h-o*s,a[f]=o*h+e*s;this.update_bbox()}};n.prototype.contains_pt=function(n,t){var i=this.pts_cache;if(n===i[0]&&t===i[1])return!0;for(var u,f,c=this.pts_count,v=this.bboxLeft-110,y=this.bboxTop-101,p=this.bboxRight+131,w=this.bboxBottom+120,e,o,s,h,l=0,a=0,r=0;r<c;r++)u=r*2,f=(r+1)%c*2,e=i[u],o=i[u+1],s=i[f],h=i[f+1],cr.segments_intersect(v,y,n,t,e,o,s,h)&&l++,cr.segments_intersect(p,w,n,t,e,o,s,h)&&a++;return l%2==1||a%2==1};n.prototype.intersects_poly=function(n,t,i){var r=n.pts_cache,u=this.pts_cache,f,o,s,h,e,c,l,a,v,y,p,w,b,k,d,g;if(this.contains_pt(r[0]+t,r[1]+i)||n.contains_pt(u[0]-t,u[1]-i))return!0;for(f=0,h=this.pts_count;f<h;f++)for(o=f*2,s=(f+1)%h*2,v=u[o],y=u[o+1],p=u[s],w=u[s+1],e=0,a=n.pts_count;e<a;e++)if(c=e*2,l=(e+1)%a*2,b=r[c]+t,k=r[c+1]+i,d=r[l]+t,g=r[l+1]+i,cr.segments_intersect(v,y,p,w,b,k,d,g))return!0;return!1};n.prototype.intersects_segment=function(n,t,i,r,u,f){var o=this.pts_cache,e,s,h,c,l,a,v,y;if(this.contains_pt(i-n,r-t))return!0;for(e=0,s=this.pts_count;e<s;e++)if(h=e*2,c=(e+1)%s*2,l=o[h]+n,a=o[h+1]+t,v=o[c]+n,y=o[c+1]+t,cr.segments_intersect(i,r,u,f,l,a,v,y))return!0;return!1};n.prototype.mirror=function(n){for(var i,t=0,r=this.pts_count;t<r;++t)i=t*2,this.pts_cache[i]=n*2-this.pts_cache[i]};n.prototype.flip=function(n){for(var i,t=0,r=this.pts_count;t<r;++t)i=t*2+1,this.pts_cache[i]=n*2-this.pts_cache[i]};n.prototype.diag=function(){for(var t,i,u,n=0,r=this.pts_count;n<r;++n)t=n*2,i=t+1,u=this.pts_cache[t],this.pts_cache[t]=this.pts_cache[i],this.pts_cache[i]=u};cr.CollisionPoly=n;s.prototype.totalCellCount=0;s.prototype.getCell=function(n,t,i){var r,u=this.cells[n];return u?(r=u[t],r?r:i?(r=rt(this,n,t),this.cells[n][t]=r,r):null):i?(r=rt(this,n,t),this.cells[n]={},this.cells[n][t]=r,r):null};s.prototype.XToCell=function(n){return cr.floor(n/this.cellwidth)};s.prototype.YToCell=function(n){return cr.floor(n/this.cellheight)};s.prototype.update=function(n,t,i){var r,e,u,o,f;if(t)for(r=t.left,e=t.right;r<=e;++r)for(u=t.top,o=t.bottom;u<=o;++u)i&&i.contains_pt(r,u)||(f=this.getCell(r,u,!1),f)&&(f.remove(n),f.isEmpty()&&(ot(f),this.cells[r][u]=null));if(i)for(r=i.left,e=i.right;r<=e;++r)for(u=i.top,o=i.bottom;u<=o;++u)t&&t.contains_pt(r,u)||this.getCell(r,u,!0).insert(n)};s.prototype.queryRange=function(n,t){var i,f,e,r,o,u;for(i=this.XToCell(n.left),e=this.YToCell(n.top),f=this.XToCell(n.right),o=this.YToCell(n.bottom);i<=f;++i)for(r=e;r<=o;++r)(u=this.getCell(i,r,!1),u)&&u.dump(t)};cr.SparseGrid=s;f.prototype.totalCellCount=0;f.prototype.getCell=function(n,t,i){var r,u=this.cells[n];return u?(r=u[t],r?r:i?(r=ut(this,n,t),this.cells[n][t]=r,r):null):i?(r=ut(this,n,t),this.cells[n]={},this.cells[n][t]=r,r):null};f.prototype.XToCell=function(n){return cr.floor(n/this.cellwidth)};f.prototype.YToCell=function(n){return cr.floor(n/this.cellheight)};f.prototype.update=function(n,t,i){var r,e,u,o,f;if(t)for(r=t.left,e=t.right;r<=e;++r)for(u=t.top,o=t.bottom;u<=o;++u)i&&i.contains_pt(r,u)||(f=this.getCell(r,u,!1),f)&&(f.remove(n),f.isEmpty()&&(st(f),this.cells[r][u]=null));if(i)for(r=i.left,e=i.right;r<=e;++r)for(u=i.top,o=i.bottom;u<=o;++u)t&&t.contains_pt(r,u)||this.getCell(r,u,!0).insert(n)};f.prototype.queryRange=function(n,t,i,r,u){var f,s,h,e,c,o;for(f=this.XToCell(n),h=this.YToCell(t),s=this.XToCell(i),c=this.YToCell(r);f<=s;++f)for(e=h;e<=c;++e)(o=this.getCell(f,e,!1),o)&&o.dump(u)};f.prototype.markRangeChanged=function(n){var t,u,f,i,e,r;for(t=n.left,f=n.top,u=n.right,e=n.bottom;t<=u;++t)for(i=f;i<=e;++i)(r=this.getCell(t,i,!1),r)&&(r.is_sorted=!1)};cr.RenderGrid=f;c=[];l.prototype.isEmpty=function(){return this.objects.isEmpty()};l.prototype.insert=function(n){this.objects.add(n)};l.prototype.remove=function(n){this.objects.remove(n)};l.prototype.dump=function(n){cr.appendArray(n,this.objects.valuesRef())};cr.GridCell=l;a=[];h.prototype.isEmpty=function(){return this.objects.length?this.objects.length>this.pending_removal.count()?!1:(this.flush_pending(),!0):!0};h.prototype.insert=function(n){if(this.pending_removal.contains(n)){this.pending_removal.remove(n);this.pending_removal.isEmpty()&&(this.any_pending_removal=!1);return}if(this.objects.length){var t=this.objects[this.objects.length-1];t.get_zindex()>n.get_zindex()&&(this.is_sorted=!1);this.objects.push(n)}else this.objects.push(n),this.is_sorted=!0};h.prototype.remove=function(n){this.pending_removal.add(n);this.any_pending_removal=!0;this.pending_removal.count()>=30&&this.flush_pending()};h.prototype.flush_pending=function(){if(this.any_pending_removal){if(this.pending_removal.count()===this.objects.length){this.reset();return}cr.arrayRemoveAllFromObjectSet(this.objects,this.pending_removal);this.pending_removal.clear();this.any_pending_removal=!1}};h.prototype.ensure_sorted=function(){this.is_sorted||(this.objects.sort(ht),this.is_sorted=!0)};h.prototype.reset=function(){cr.clearArray(this.objects);this.is_sorted=!0;this.pending_removal.clear();this.any_pending_removal=!1};h.prototype.dump=function(n){this.flush_pending();this.ensure_sorted();this.objects.length&&n.push(this.objects)};cr.RenderCell=h;ft=["lighter","xor","copy","destination-over","source-in","destination-in","source-out","destination-out","source-atop","destination-atop"];cr.effectToCompositeOp=function(n){return n<=0||n>=11?"source-over":ft[n-1]};cr.setGLBlend=function(n,t,i){if(i){n.srcBlend=i.ONE;n.destBlend=i.ONE_MINUS_SRC_ALPHA;switch(t){case 1:n.srcBlend=i.ONE;n.destBlend=i.ONE;break;case 3:n.srcBlend=i.ONE;n.destBlend=i.ZERO;break;case 4:n.srcBlend=i.ONE_MINUS_DST_ALPHA;n.destBlend=i.ONE;break;case 5:n.srcBlend=i.DST_ALPHA;n.destBlend=i.ZERO;break;case 6:n.srcBlend=i.ZERO;n.destBlend=i.SRC_ALPHA;break;case 7:n.srcBlend=i.ONE_MINUS_DST_ALPHA;n.destBlend=i.ZERO;break;case 8:n.srcBlend=i.ZERO;n.destBlend=i.ONE_MINUS_SRC_ALPHA;break;case 9:n.srcBlend=i.DST_ALPHA;n.destBlend=i.ONE_MINUS_SRC_ALPHA;break;case 10:n.srcBlend=i.ONE_MINUS_DST_ALPHA;n.destBlend=i.SRC_ALPHA}}};cr.round6dp=function(n){return Math.round(n*1e6)/1e6};cr.equals_nocase=function(n,t){return typeof n!="string"||typeof t!="string"?!1:n.length!==t.length?!1:n===t?!0:n.toLowerCase()===t.toLowerCase()};cr.isCanvasInputEvent=function(n){var t=n.target;return t?t===document||t===window?!0:document&&document.body&&t===document.body?!0:cr.equals_nocase(t.tagName,"canvas")?!0:!1:!0}}();var MatrixArray=typeof Float32Array!="undefined"?Float32Array:Array,glMatrixArrayType=MatrixArray,vec3={},mat3={},mat4={},quat4={};vec3.create=function(n){var t=new MatrixArray(3);return n&&(t[0]=n[0],t[1]=n[1],t[2]=n[2]),t};vec3.set=function(n,t){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t};vec3.add=function(n,t,i){return!i||n===i?(n[0]+=t[0],n[1]+=t[1],n[2]+=t[2],n):(i[0]=n[0]+t[0],i[1]=n[1]+t[1],i[2]=n[2]+t[2],i)};vec3.subtract=function(n,t,i){return!i||n===i?(n[0]-=t[0],n[1]-=t[1],n[2]-=t[2],n):(i[0]=n[0]-t[0],i[1]=n[1]-t[1],i[2]=n[2]-t[2],i)};vec3.negate=function(n,t){return t||(t=n),t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t};vec3.scale=function(n,t,i){return!i||n===i?(n[0]*=t,n[1]*=t,n[2]*=t,n):(i[0]=n[0]*t,i[1]=n[1]*t,i[2]=n[2]*t,i)};vec3.normalize=function(n,t){t||(t=n);var r=n[0],u=n[1],f=n[2],i=Math.sqrt(r*r+u*u+f*f);if(i){if(i===1)return t[0]=r,t[1]=u,t[2]=f,t}else return t[0]=0,t[1]=0,t[2]=0,t;return i=1/i,t[0]=r*i,t[1]=u*i,t[2]=f*i,t};vec3.cross=function(n,t,i){i||(i=n);var r=n[0],u=n[1],n=n[2],f=t[0],e=t[1],t=t[2];return i[0]=u*t-n*e,i[1]=n*f-r*t,i[2]=r*e-u*f,i};vec3.length=function(n){var t=n[0],i=n[1],n=n[2];return Math.sqrt(t*t+i*i+n*n)};vec3.dot=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]};vec3.direction=function(n,t,i){i||(i=n);var r=n[0]-t[0],u=n[1]-t[1],n=n[2]-t[2],t=Math.sqrt(r*r+u*u+n*n);return t?(t=1/t,i[0]=r*t,i[1]=u*t,i[2]=n*t,i):(i[0]=0,i[1]=0,i[2]=0,i)};vec3.lerp=function(n,t,i,r){return r||(r=n),r[0]=n[0]+i*(t[0]-n[0]),r[1]=n[1]+i*(t[1]-n[1]),r[2]=n[2]+i*(t[2]-n[2]),r};vec3.str=function(n){return"["+n[0]+", "+n[1]+", "+n[2]+"]"};mat3.create=function(n){var t=new MatrixArray(9);return n&&(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8]),t};mat3.set=function(n,t){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t};mat3.identity=function(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=1,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n};mat3.transpose=function(n,t){if(!t||n===t){var i=n[1],r=n[2],u=n[5];return n[1]=n[3],n[2]=n[6],n[3]=i,n[5]=n[7],n[6]=r,n[7]=u,n}return t[0]=n[0],t[1]=n[3],t[2]=n[6],t[3]=n[1],t[4]=n[4],t[5]=n[7],t[6]=n[2],t[7]=n[5],t[8]=n[8],t};mat3.toMat4=function(n,t){return t||(t=mat4.create()),t[15]=1,t[14]=0,t[13]=0,t[12]=0,t[11]=0,t[10]=n[8],t[9]=n[7],t[8]=n[6],t[7]=0,t[6]=n[5],t[5]=n[4],t[4]=n[3],t[3]=0,t[2]=n[2],t[1]=n[1],t[0]=n[0],t};mat3.str=function(n){return"["+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+", "+n[4]+", "+n[5]+", "+n[6]+", "+n[7]+", "+n[8]+"]"};mat4.create=function(n){var t=new MatrixArray(16);return n&&(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t};mat4.set=function(n,t){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t};mat4.identity=function(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n};mat4.transpose=function(n,t){if(!t||n===t){var i=n[1],r=n[2],u=n[3],f=n[6],e=n[7],o=n[11];return n[1]=n[4],n[2]=n[8],n[3]=n[12],n[4]=i,n[6]=n[9],n[7]=n[13],n[8]=r,n[9]=f,n[11]=n[14],n[12]=u,n[13]=e,n[14]=o,n}return t[0]=n[0],t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=n[1],t[5]=n[5],t[6]=n[9],t[7]=n[13],t[8]=n[2],t[9]=n[6],t[10]=n[10],t[11]=n[14],t[12]=n[3],t[13]=n[7],t[14]=n[11],t[15]=n[15],t};mat4.determinant=function(n){var t=n[0],i=n[1],r=n[2],u=n[3],f=n[4],e=n[5],o=n[6],s=n[7],h=n[8],c=n[9],l=n[10],a=n[11],v=n[12],y=n[13],p=n[14],n=n[15];return v*c*o*u-h*y*o*u-v*e*l*u+f*y*l*u+h*e*p*u-f*c*p*u-v*c*r*s+h*y*r*s+v*i*l*s-t*y*l*s-h*i*p*s+t*c*p*s+v*e*r*a-f*y*r*a-v*i*o*a+t*y*o*a+f*i*p*a-t*e*p*a-h*e*r*n+f*c*r*n+h*i*o*n-t*c*o*n-f*i*l*n+t*e*l*n};mat4.inverse=function(n,t){t||(t=n);var r=n[0],u=n[1],f=n[2],e=n[3],o=n[4],s=n[5],h=n[6],c=n[7],l=n[8],a=n[9],v=n[10],y=n[11],p=n[12],w=n[13],b=n[14],k=n[15],d=r*s-u*o,g=r*h-f*o,nt=r*c-e*o,tt=u*h-f*s,it=u*c-e*s,rt=f*c-e*h,ut=l*w-a*p,ft=l*b-v*p,et=l*k-y*p,ot=a*b-v*w,st=a*k-y*w,ht=v*k-y*b,i=1/(d*ht-g*st+nt*ot+tt*et-it*ft+rt*ut);return t[0]=(s*ht-h*st+c*ot)*i,t[1]=(-u*ht+f*st-e*ot)*i,t[2]=(w*rt-b*it+k*tt)*i,t[3]=(-a*rt+v*it-y*tt)*i,t[4]=(-o*ht+h*et-c*ft)*i,t[5]=(r*ht-f*et+e*ft)*i,t[6]=(-p*rt+b*nt-k*g)*i,t[7]=(l*rt-v*nt+y*g)*i,t[8]=(o*st-s*et+c*ut)*i,t[9]=(-r*st+u*et-e*ut)*i,t[10]=(p*it-w*nt+k*d)*i,t[11]=(-l*it+a*nt-y*d)*i,t[12]=(-o*ot+s*ft-h*ut)*i,t[13]=(r*ot-u*ft+f*ut)*i,t[14]=(-p*tt+w*g-b*d)*i,t[15]=(l*tt-a*g+v*d)*i,t};mat4.toRotationMat=function(n,t){return t||(t=mat4.create()),t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=0,t[13]=0,t[14]=0,t[15]=1,t};mat4.toMat3=function(n,t){return t||(t=mat3.create()),t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[4],t[4]=n[5],t[5]=n[6],t[6]=n[8],t[7]=n[9],t[8]=n[10],t};mat4.toInverseMat3=function(n,t){var r=n[0],u=n[1],f=n[2],e=n[4],o=n[5],s=n[6],h=n[8],c=n[9],l=n[10],a=l*o-s*c,v=-l*e+s*h,y=c*e-o*h,i=r*a+u*v+f*y;return i?(i=1/i,t||(t=mat3.create()),t[0]=a*i,t[1]=(-l*u+f*c)*i,t[2]=(s*u-f*o)*i,t[3]=v*i,t[4]=(l*r-f*h)*i,t[5]=(-s*r+f*e)*i,t[6]=y*i,t[7]=(-c*r+u*h)*i,t[8]=(o*r-u*e)*i,t):null};mat4.multiply=function(n,t,i){i||(i=n);var r=n[0],u=n[1],f=n[2],e=n[3],o=n[4],s=n[5],h=n[6],c=n[7],l=n[8],a=n[9],v=n[10],y=n[11],p=n[12],w=n[13],b=n[14],n=n[15],k=t[0],d=t[1],g=t[2],nt=t[3],tt=t[4],it=t[5],rt=t[6],ut=t[7],ft=t[8],et=t[9],ot=t[10],st=t[11],ht=t[12],ct=t[13],lt=t[14],t=t[15];return i[0]=k*r+d*o+g*l+nt*p,i[1]=k*u+d*s+g*a+nt*w,i[2]=k*f+d*h+g*v+nt*b,i[3]=k*e+d*c+g*y+nt*n,i[4]=tt*r+it*o+rt*l+ut*p,i[5]=tt*u+it*s+rt*a+ut*w,i[6]=tt*f+it*h+rt*v+ut*b,i[7]=tt*e+it*c+rt*y+ut*n,i[8]=ft*r+et*o+ot*l+st*p,i[9]=ft*u+et*s+ot*a+st*w,i[10]=ft*f+et*h+ot*v+st*b,i[11]=ft*e+et*c+ot*y+st*n,i[12]=ht*r+ct*o+lt*l+t*p,i[13]=ht*u+ct*s+lt*a+t*w,i[14]=ht*f+ct*h+lt*v+t*b,i[15]=ht*e+ct*c+lt*y+t*n,i};mat4.multiplyVec3=function(n,t,i){i||(i=t);var r=t[0],u=t[1],t=t[2];return i[0]=n[0]*r+n[4]*u+n[8]*t+n[12],i[1]=n[1]*r+n[5]*u+n[9]*t+n[13],i[2]=n[2]*r+n[6]*u+n[10]*t+n[14],i};mat4.multiplyVec4=function(n,t,i){i||(i=t);var r=t[0],u=t[1],f=t[2],t=t[3];return i[0]=n[0]*r+n[4]*u+n[8]*f+n[12]*t,i[1]=n[1]*r+n[5]*u+n[9]*f+n[13]*t,i[2]=n[2]*r+n[6]*u+n[10]*f+n[14]*t,i[3]=n[3]*r+n[7]*u+n[11]*f+n[15]*t,i};mat4.translate=function(n,t,i){var r=t[0],u=t[1],t=t[2],f,e,o,s,h,c,l,a,v,y,p,w;return!i||n===i?(n[12]=n[0]*r+n[4]*u+n[8]*t+n[12],n[13]=n[1]*r+n[5]*u+n[9]*t+n[13],n[14]=n[2]*r+n[6]*u+n[10]*t+n[14],n[15]=n[3]*r+n[7]*u+n[11]*t+n[15],n):(f=n[0],e=n[1],o=n[2],s=n[3],h=n[4],c=n[5],l=n[6],a=n[7],v=n[8],y=n[9],p=n[10],w=n[11],i[0]=f,i[1]=e,i[2]=o,i[3]=s,i[4]=h,i[5]=c,i[6]=l,i[7]=a,i[8]=v,i[9]=y,i[10]=p,i[11]=w,i[12]=f*r+h*u+v*t+n[12],i[13]=e*r+c*u+y*t+n[13],i[14]=o*r+l*u+p*t+n[14],i[15]=s*r+a*u+w*t+n[15],i)};mat4.scale=function(n,t,i){var r=t[0],u=t[1],t=t[2];return!i||n===i?(n[0]*=r,n[1]*=r,n[2]*=r,n[3]*=r,n[4]*=u,n[5]*=u,n[6]*=u,n[7]*=u,n[8]*=t,n[9]*=t,n[10]*=t,n[11]*=t,n):(i[0]=n[0]*r,i[1]=n[1]*r,i[2]=n[2]*r,i[3]=n[3]*r,i[4]=n[4]*u,i[5]=n[5]*u,i[6]=n[6]*u,i[7]=n[7]*u,i[8]=n[8]*t,i[9]=n[9]*t,i[10]=n[10]*t,i[11]=n[11]*t,i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],i)};mat4.rotate=function(n,t,i,r){var u=i[0],f=i[1],i=i[2],e=Math.sqrt(u*u+f*f+i*i),s,h,o,b,k,d,g,nt,tt,it,rt,ut,ft,c,l,a,v,y,p,w;return e?(e!==1&&(e=1/e,u*=e,f*=e,i*=e),s=Math.sin(t),h=Math.cos(t),o=1-h,t=n[0],e=n[1],b=n[2],k=n[3],d=n[4],g=n[5],nt=n[6],tt=n[7],it=n[8],rt=n[9],ut=n[10],ft=n[11],c=u*u*o+h,l=f*u*o+i*s,a=i*u*o-f*s,v=u*f*o-i*s,y=f*f*o+h,p=i*f*o+u*s,w=u*i*o+f*s,u=f*i*o-u*s,f=i*i*o+h,r?n!==r&&(r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15]):r=n,r[0]=t*c+d*l+it*a,r[1]=e*c+g*l+rt*a,r[2]=b*c+nt*l+ut*a,r[3]=k*c+tt*l+ft*a,r[4]=t*v+d*y+it*p,r[5]=e*v+g*y+rt*p,r[6]=b*v+nt*y+ut*p,r[7]=k*v+tt*y+ft*p,r[8]=t*w+d*u+it*f,r[9]=e*w+g*u+rt*f,r[10]=b*w+nt*u+ut*f,r[11]=k*w+tt*u+ft*f,r):null};mat4.rotateX=function(n,t,i){var r=Math.sin(t),t=Math.cos(t),u=n[4],f=n[5],e=n[6],o=n[7],s=n[8],h=n[9],c=n[10],l=n[11];return i?n!==i&&(i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15]):i=n,i[4]=u*t+s*r,i[5]=f*t+h*r,i[6]=e*t+c*r,i[7]=o*t+l*r,i[8]=u*-r+s*t,i[9]=f*-r+h*t,i[10]=e*-r+c*t,i[11]=o*-r+l*t,i};mat4.rotateY=function(n,t,i){var r=Math.sin(t),t=Math.cos(t),u=n[0],f=n[1],e=n[2],o=n[3],s=n[8],h=n[9],c=n[10],l=n[11];return i?n!==i&&(i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15]):i=n,i[0]=u*t+s*-r,i[1]=f*t+h*-r,i[2]=e*t+c*-r,i[3]=o*t+l*-r,i[8]=u*r+s*t,i[9]=f*r+h*t,i[10]=e*r+c*t,i[11]=o*r+l*t,i};mat4.rotateZ=function(n,t,i){var r=Math.sin(t),t=Math.cos(t),u=n[0],f=n[1],e=n[2],o=n[3],s=n[4],h=n[5],c=n[6],l=n[7];return i?n!==i&&(i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15]):i=n,i[0]=u*t+s*r,i[1]=f*t+h*r,i[2]=e*t+c*r,i[3]=o*t+l*r,i[4]=u*-r+s*t,i[5]=f*-r+h*t,i[6]=e*-r+c*t,i[7]=o*-r+l*t,i};mat4.frustum=function(n,t,i,r,u,f,e){e||(e=mat4.create());var o=t-n,s=r-i,h=f-u;return e[0]=u*2/o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u*2/s,e[6]=0,e[7]=0,e[8]=(t+n)/o,e[9]=(r+i)/s,e[10]=-(f+u)/h,e[11]=-1,e[12]=0,e[13]=0,e[14]=-(f*u*2)/h,e[15]=0,e};mat4.perspective=function(n,t,i,r,u){return n=i*Math.tan(n*Math.PI/360),t*=n,mat4.frustum(-t,t,-n,n,i,r,u)};mat4.ortho=function(n,t,i,r,u,f,e){e||(e=mat4.create());var o=t-n,s=r-i,h=f-u;return e[0]=2/o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2/s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=-2/h,e[11]=0,e[12]=-(n+t)/o,e[13]=-(r+i)/s,e[14]=-(f+u)/h,e[15]=1,e};mat4.lookAt=function(n,t,i,r){r||(r=mat4.create());var f,e,s,c,l,o,h,u,a=n[0],v=n[1],n=n[2];return(e=i[0],s=i[1],f=i[2],i=t[1],o=t[2],a===t[0]&&v===i&&n===o)?mat4.identity(r):(i=a-t[0],o=v-t[1],h=n-t[2],u=1/Math.sqrt(i*i+o*o+h*h),i*=u,o*=u,h*=u,t=s*h-f*o,f=f*i-e*h,e=e*o-s*i,(u=Math.sqrt(t*t+f*f+e*e))?(u=1/u,t*=u,f*=u,e*=u):e=f=t=0,s=o*e-h*f,c=h*t-i*e,l=i*f-o*t,(u=Math.sqrt(s*s+c*c+l*l))?(u=1/u,s*=u,c*=u,l*=u):l=c=s=0,r[0]=t,r[1]=s,r[2]=i,r[3]=0,r[4]=f,r[5]=c,r[6]=o,r[7]=0,r[8]=e,r[9]=l,r[10]=h,r[11]=0,r[12]=-(t*a+f*v+e*n),r[13]=-(s*a+c*v+l*n),r[14]=-(i*a+o*v+h*n),r[15]=1,r)};mat4.fromRotationTranslation=function(n,t,i){var c;i||(i=mat4.create());var r=n[0],u=n[1],f=n[2],e=n[3],s=r+r,o=u+u,h=f+f,n=r*s,l=r*o;return r*=h,c=u*o,u*=h,f*=h,s*=e,o*=e,e*=h,i[0]=1-(c+f),i[1]=l+e,i[2]=r-o,i[3]=0,i[4]=l-e,i[5]=1-(n+f),i[6]=u+s,i[7]=0,i[8]=r+o,i[9]=u-s,i[10]=1-(n+c),i[11]=0,i[12]=t[0],i[13]=t[1],i[14]=t[2],i[15]=1,i};mat4.str=function(n){return"["+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+", "+n[4]+", "+n[5]+", "+n[6]+", "+n[7]+", "+n[8]+", "+n[9]+", "+n[10]+", "+n[11]+", "+n[12]+", "+n[13]+", "+n[14]+", "+n[15]+"]"};quat4.create=function(n){var t=new MatrixArray(4);return n&&(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3]),t};quat4.set=function(n,t){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t};quat4.calculateW=function(n,t){var i=n[0],r=n[1],u=n[2];return!t||n===t?(n[3]=-Math.sqrt(Math.abs(1-i*i-r*r-u*u)),n):(t[0]=i,t[1]=r,t[2]=u,t[3]=-Math.sqrt(Math.abs(1-i*i-r*r-u*u)),t)};quat4.inverse=function(n,t){return!t||n===t?(n[0]*=-1,n[1]*=-1,n[2]*=-1,n):(t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t[3]=n[3],t)};quat4.length=function(n){var t=n[0],i=n[1],r=n[2],n=n[3];return Math.sqrt(t*t+i*i+r*r+n*n)};quat4.normalize=function(n,t){t||(t=n);var r=n[0],u=n[1],f=n[2],e=n[3],i=Math.sqrt(r*r+u*u+f*f+e*e);return i===0?(t[0]=0,t[1]=0,t[2]=0,t[3]=0,t):(i=1/i,t[0]=r*i,t[1]=u*i,t[2]=f*i,t[3]=e*i,t)};quat4.multiply=function(n,t,i){i||(i=n);var r=n[0],u=n[1],f=n[2],n=n[3],e=t[0],o=t[1],s=t[2],t=t[3];return i[0]=r*t+n*e+u*s-f*o,i[1]=u*t+n*o+f*e-r*s,i[2]=f*t+n*s+r*o-u*e,i[3]=n*t-r*e-u*o-f*s,i};quat4.multiplyVec3=function(n,t,i){i||(i=t);var r=t[0],e=t[1],o=t[2],t=n[0],u=n[1],f=n[2],n=n[3],s=n*r+u*o-f*e,h=n*e+f*r-t*o,c=n*o+t*e-u*r,r=-t*r-u*e-f*o;return i[0]=s*n+r*-t+h*-f-c*-u,i[1]=h*n+r*-u+c*-t-s*-f,i[2]=c*n+r*-f+s*-u-h*-t,i};quat4.toMat3=function(n,t){var h;t||(t=mat3.create());var i=n[0],r=n[1],u=n[2],f=n[3],o=i+i,e=r+r,s=u+u,c=i*o,l=i*e;return i*=s,h=r*e,r*=s,u*=s,o*=f,e*=f,f*=s,t[0]=1-(h+u),t[1]=l+f,t[2]=i-e,t[3]=l-f,t[4]=1-(c+u),t[5]=r+o,t[6]=i+e,t[7]=r-o,t[8]=1-(c+h),t};quat4.toMat4=function(n,t){var h;t||(t=mat4.create());var i=n[0],r=n[1],u=n[2],f=n[3],o=i+i,e=r+r,s=u+u,c=i*o,l=i*e;return i*=s,h=r*e,r*=s,u*=s,o*=f,e*=f,f*=s,t[0]=1-(h+u),t[1]=l+f,t[2]=i-e,t[3]=0,t[4]=l-f,t[5]=1-(c+u),t[6]=r+o,t[7]=0,t[8]=i+e,t[9]=r-o,t[10]=1-(c+h),t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t};quat4.slerp=function(n,t,i,r){r||(r=n);var u=n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]*t[3],e,f;return Math.abs(u)>=1?(r!==n&&(r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3]),r):(e=Math.acos(u),f=Math.sqrt(1-u*u),Math.abs(f)<.001)?(r[0]=n[0]*.5+t[0]*.5,r[1]=n[1]*.5+t[1]*.5,r[2]=n[2]*.5+t[2]*.5,r[3]=n[3]*.5+t[3]*.5,r):(u=Math.sin((1-i)*e)/f,i=Math.sin(i*e)/f,r[0]=n[0]*u+t[0]*i,r[1]=n[1]*u+t[1]*i,r[2]=n[2]*u+t[2]*i,r[3]=n[3]*u+t[3]*i,r)};quat4.str=function(n){return"["+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+"]"},function(){function n(n,t,i){this.isIE=/msie/i.test(navigator.userAgent)||/trident/i.test(navigator.userAgent);this.width=0;this.height=0;this.enableFrontToBack=!!i;this.isEarlyZPass=!1;this.isBatchInEarlyZPass=!1;this.currentZ=0;this.zNear=1;this.zFar=1e3;this.zIncrement=(this.zFar-this.zNear)/32768;this.zA=this.zFar/(this.zFar-this.zNear);this.zB=this.zFar*this.zNear/(this.zNear-this.zFar);this.kzA=65536*this.zA;this.kzB=65536*this.zB;this.cam=vec3.create([0,0,100]);this.look=vec3.create([0,0,0]);this.up=vec3.create([0,1,0]);this.worldScale=vec3.create([1,1,1]);this.enable_mipmaps=!0;this.matP=mat4.create();this.matMV=mat4.create();this.lastMV=mat4.create();this.currentMV=mat4.create();this.gl=n;this.version=this.gl.getParameter(this.gl.VERSION).indexOf("WebGL 2")===0?2:1;this.initState()}function a(n,t,i){this.gl=n;this.shaderProgram=t;this.name=i;this.locAPos=n.getAttribLocation(t,"aPos");this.locATex=n.getAttribLocation(t,"aTex");this.locMatP=n.getUniformLocation(t,"matP");this.locMatMV=n.getUniformLocation(t,"matMV");this.locOpacity=n.getUniformLocation(t,"opacity");this.locColorFill=n.getUniformLocation(t,"colorFill");this.locSamplerFront=n.getUniformLocation(t,"samplerFront");this.locSamplerBack=n.getUniformLocation(t,"samplerBack");this.locDestStart=n.getUniformLocation(t,"destStart");this.locDestEnd=n.getUniformLocation(t,"destEnd");this.locSeconds=n.getUniformLocation(t,"seconds");this.locPixelWidth=n.getUniformLocation(t,"pixelWidth");this.locPixelHeight=n.getUniformLocation(t,"pixelHeight");this.locLayerScale=n.getUniformLocation(t,"layerScale");this.locLayerAngle=n.getUniformLocation(t,"layerAngle");this.locViewOrigin=n.getUniformLocation(t,"viewOrigin");this.locScrollPos=n.getUniformLocation(t,"scrollPos");this.hasAnyOptionalUniforms=!!(this.locPixelWidth||this.locPixelHeight||this.locSeconds||this.locSamplerBack||this.locDestStart||this.locDestEnd||this.locLayerScale||this.locLayerAngle||this.locViewOrigin||this.locScrollPos);this.lpPixelWidth=-999;this.lpPixelHeight=-999;this.lpOpacity=1;this.lpDestStartX=0;this.lpDestStartY=0;this.lpDestEndX=1;this.lpDestEndY=1;this.lpLayerScale=1;this.lpLayerAngle=0;this.lpViewOriginX=0;this.lpViewOriginY=0;this.lpScrollPosX=0;this.lpScrollPosY=0;this.lpSeconds=0;this.lastCustomParams=[];this.lpMatMV=mat4.create();this.locOpacity&&n.uniform1f(this.locOpacity,1);this.locColorFill&&n.uniform4f(this.locColorFill,1,1,1,1);this.locSamplerFront&&n.uniform1i(this.locSamplerFront,0);this.locSamplerBack&&n.uniform1i(this.locSamplerBack,1);this.locDestStart&&n.uniform2f(this.locDestStart,0,0);this.locDestEnd&&n.uniform2f(this.locDestEnd,1,1);this.locLayerScale&&n.uniform1f(this.locLayerScale,1);this.locLayerAngle&&n.uniform1f(this.locLayerAngle,0);this.locViewOrigin&&n.uniform2f(this.locViewOrigin,0,0);this.locScrollPos&&n.uniform2f(this.locScrollPos,0,0);this.locSeconds&&n.uniform1f(this.locSeconds,0);this.hasCurrentMatMV=!1}function v(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]&&n[4]===t[4]&&n[5]===t[5]&&n[6]===t[6]&&n[7]===t[7]&&n[8]===t[8]&&n[9]===t[9]&&n[10]===t[10]&&n[11]===t[11]&&n[12]===t[12]&&n[13]===t[13]&&n[14]===t[14]&&n[15]===t[15]}function t(n,t){this.type=n;this.glwrap=t;this.gl=t.gl;this.opacityParam=0;this.startIndex=0;this.indexCount=0;this.texParam=null;this.mat4param=null;this.shaderParams=[];cr.seal(this)}var u=8e3,h=u/2*3,c=8e3,f=4,p=0,o=1,w=2,b=3,k=4,d=5,g=6,s=7,nt=8,tt=9,it=10,rt=12,ut=13,ft=14,l=mat4.create(),e,y,i,r;n.prototype.initState=function(){var n=this.gl,t,v,i,r,e,s,y,o,l,a;for(this.lastOpacity=1,this.lastTexture0=null,this.lastTexture1=null,this.currentOpacity=1,n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),n.enable(n.BLEND),n.blendFunc(n.ONE,n.ONE_MINUS_SRC_ALPHA),n.disable(n.CULL_FACE),n.disable(n.STENCIL_TEST),n.disable(n.DITHER),this.enableFrontToBack?(n.enable(n.DEPTH_TEST),n.depthFunc(n.LEQUAL)):n.disable(n.DEPTH_TEST),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),this.lastSrcBlend=n.ONE,this.lastDestBlend=n.ONE_MINUS_SRC_ALPHA,this.vertexData=new Float32Array(u*(this.enableFrontToBack?3:2)),this.texcoordData=new Float32Array(u*2),this.pointData=new Float32Array(c*4),this.pointBuffer=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.pointBuffer),n.bufferData(n.ARRAY_BUFFER,this.pointData.byteLength,n.DYNAMIC_DRAW),this.vertexBuffers=new Array(f),this.texcoordBuffers=new Array(f),t=0;t<f;t++)this.vertexBuffers[t]=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffers[t]),n.bufferData(n.ARRAY_BUFFER,this.vertexData.byteLength,n.DYNAMIC_DRAW),this.texcoordBuffers[t]=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.texcoordBuffers[t]),n.bufferData(n.ARRAY_BUFFER,this.texcoordData.byteLength,n.DYNAMIC_DRAW);for(this.curBuffer=0,this.indexBuffer=n.createBuffer(),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer),i=new Uint16Array(h),t=0,v=h,r=0;t<v;)i[t++]=r,i[t++]=r+1,i[t++]=r+2,i[t++]=r,i[t++]=r+2,i[t++]=r+3,r+=4;n.bufferData(n.ELEMENT_ARRAY_BUFFER,i,n.STATIC_DRAW);this.vertexPtr=0;this.texPtr=0;this.pointPtr=0;this.shaderPrograms=[];e="varying mediump vec2 vTex;\nuniform lowp float opacity;\nuniform lowp sampler2D samplerFront;\nvoid main(void) {\n\tgl_FragColor = texture2D(samplerFront, vTex);\n\tgl_FragColor *= opacity;\n}";s=this.enableFrontToBack?"attribute highp vec3 aPos;\nattribute mediump vec2 aTex;\nvarying mediump vec2 vTex;\nuniform highp mat4 matP;\nuniform highp mat4 matMV;\nvoid main(void) {\n\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, aPos.z, 1.0);\n\tvTex = aTex;\n}":"attribute highp vec2 aPos;\nattribute mediump vec2 aTex;\nvarying mediump vec2 vTex;\nuniform highp mat4 matP;\nuniform highp mat4 matMV;\nvoid main(void) {\n\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, 0.0, 1.0);\n\tvTex = aTex;\n}";o=this.createShaderProgram({src:e},s,"<default>");this.shaderPrograms.push(o);e="uniform mediump sampler2D samplerFront;\nvarying lowp float opacity;\nvoid main(void) {\n\tgl_FragColor = texture2D(samplerFront, gl_PointCoord);\n\tgl_FragColor *= opacity;\n}";y="attribute vec4 aPos;\nvarying float opacity;\nuniform mat4 matP;\nuniform mat4 matMV;\nvoid main(void) {\n\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, 0.0, 1.0);\n\tgl_PointSize = aPos.z;\n\topacity = aPos.w;\n}";o=this.createShaderProgram({src:e},y,"<point>");this.shaderPrograms.push(o);e="varying mediump vec2 vTex;\nuniform lowp sampler2D samplerFront;\nvoid main(void) {\n\tif (texture2D(samplerFront, vTex).a < 1.0)\n\t\tdiscard;\n}";o=this.createShaderProgram({src:e},s,"<earlyz>");this.shaderPrograms.push(o);e="uniform lowp vec4 colorFill;\nvoid main(void) {\n\tgl_FragColor = colorFill;\n}";o=this.createShaderProgram({src:e},s,"<fill>");this.shaderPrograms.push(o);for(l in cr.shaders)cr.shaders.hasOwnProperty(l)&&this.shaderPrograms.push(this.createShaderProgram(cr.shaders[l],s,l));n.activeTexture(n.TEXTURE0);n.bindTexture(n.TEXTURE_2D,null);this.batch=[];this.batchPtr=0;this.hasQuadBatchTop=!1;this.hasPointBatchTop=!1;this.lastProgram=-1;this.currentProgram=-1;this.currentShader=null;this.fbo=n.createFramebuffer();this.renderToTex=null;this.depthBuffer=null;this.attachedDepthBuffer=!1;this.enableFrontToBack&&(this.depthBuffer=n.createRenderbuffer());this.tmpVec3=vec3.create([0,0,0]);a=n.getParameter(n.ALIASED_POINT_SIZE_RANGE);this.minPointSize=a[0];this.maxPointSize=a[1];this.maxPointSize>2048&&(this.maxPointSize=2048);this.switchProgram(0);cr.seal(this)};a.prototype.updateMatMV=function(n){v(this.lpMatMV,n)||(mat4.set(n,this.lpMatMV),this.gl.uniformMatrix4fv(this.locMatMV,!1,n))};n.prototype.createShaderProgram=function(n,t,i){var r=this.gl,e=r.createShader(r.FRAGMENT_SHADER),o,f,s,u,h,c;if(r.shaderSource(e,n.src),r.compileShader(e),!r.getShaderParameter(e,r.COMPILE_STATUS)){s=r.getShaderInfoLog(e);r.deleteShader(e);throw new Error("error compiling fragment shader: "+s);}if(o=r.createShader(r.VERTEX_SHADER),r.shaderSource(o,t),r.compileShader(o),!r.getShaderParameter(o,r.COMPILE_STATUS)){s=r.getShaderInfoLog(o);r.deleteShader(e);r.deleteShader(o);throw new Error("error compiling vertex shader: "+s);}if(f=r.createProgram(),r.attachShader(f,e),r.attachShader(f,o),r.linkProgram(f),!r.getProgramParameter(f,r.LINK_STATUS)){s=r.getProgramInfoLog(f);r.deleteShader(e);r.deleteShader(o);r.deleteProgram(f);throw new Error("error linking shader program: "+s);}for(r.useProgram(f),r.deleteShader(e),r.deleteShader(o),u=new a(r,f,i),u.extendBoxHorizontal=n.extendBoxHorizontal||0,u.extendBoxVertical=n.extendBoxVertical||0,u.crossSampling=!!n.crossSampling,u.preservesOpaqueness=!!n.preservesOpaqueness,u.animated=!!n.animated,u.parameters=n.parameters||[],h=0,c=u.parameters.length;h<c;h++)u.parameters[h][1]=r.getUniformLocation(f,u.parameters[h][0]),u.lastCustomParams.push(0),r.uniform1f(u.parameters[h][1],0);return cr.seal(u),u};n.prototype.getShaderIndex=function(n){for(var t=0,i=this.shaderPrograms.length;t<i;t++)if(this.shaderPrograms[t].name===n)return t;return-1};n.prototype.project=function(n,t,i){var u=this.matMV,f=this.matP,r=[0,0,0,0,0,0,0,0];(r[0]=u[0]*n+u[4]*t+u[12],r[1]=u[1]*n+u[5]*t+u[13],r[2]=u[2]*n+u[6]*t+u[14],r[3]=u[3]*n+u[7]*t+u[15],r[4]=f[0]*r[0]+f[4]*r[1]+f[8]*r[2]+f[12]*r[3],r[5]=f[1]*r[0]+f[5]*r[1]+f[9]*r[2]+f[13]*r[3],r[6]=f[2]*r[0]+f[6]*r[1]+f[10]*r[2]+f[14]*r[3],r[7]=-r[2],r[7]!==0)&&(r[7]=1/r[7],r[4]*=r[7],r[5]*=r[7],r[6]*=r[7],i[0]=(r[4]*.5+.5)*this.width,i[1]=(r[5]*.5+.5)*this.height)};n.prototype.setSize=function(n,t,i){var r,f,e,o,s,u;if(this.width!==n||this.height!==t||i){for(this.endBatch(),r=this.gl,this.width=n,this.height=t,r.viewport(0,0,n,t),mat4.lookAt(this.cam,this.look,this.up,this.matMV),this.enableFrontToBack?(mat4.ortho(-n/2,n/2,t/2,-t/2,this.zNear,this.zFar,this.matP),this.worldScale[0]=1,this.worldScale[1]=1):(mat4.perspective(45,n/t,this.zNear,this.zFar,this.matP),f=[0,0],e=[0,0],this.project(0,0,f),this.project(1,1,e),this.worldScale[0]=1/(e[0]-f[0]),this.worldScale[1]=-1/(e[1]-f[1])),o=0,s=this.shaderPrograms.length;o<s;o++)u=this.shaderPrograms[o],u.hasCurrentMatMV=!1,u.locMatP&&(r.useProgram(u.shaderProgram),r.uniformMatrix4fv(u.locMatP,!1,this.matP));r.useProgram(this.shaderPrograms[this.lastProgram].shaderProgram);r.bindTexture(r.TEXTURE_2D,null);r.activeTexture(r.TEXTURE1);r.bindTexture(r.TEXTURE_2D,null);r.activeTexture(r.TEXTURE0);this.lastTexture0=null;this.lastTexture1=null;this.depthBuffer&&(r.bindFramebuffer(r.FRAMEBUFFER,this.fbo),r.bindRenderbuffer(r.RENDERBUFFER,this.depthBuffer),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,this.width,this.height),this.attachedDepthBuffer||(r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,this.depthBuffer),this.attachedDepthBuffer=!0),r.bindRenderbuffer(r.RENDERBUFFER,null),r.bindFramebuffer(r.FRAMEBUFFER,null),this.renderToTex=null)}};n.prototype.resetModelView=function(){mat4.lookAt(this.cam,this.look,this.up,this.matMV);mat4.scale(this.matMV,this.worldScale)};n.prototype.translate=function(n,t){(n!==0||t!==0)&&(this.tmpVec3[0]=n,this.tmpVec3[1]=t,this.tmpVec3[2]=0,mat4.translate(this.matMV,this.tmpVec3))};n.prototype.scale=function(n,t){(n!==1||t!==1)&&(this.tmpVec3[0]=n,this.tmpVec3[1]=t,this.tmpVec3[2]=1,mat4.scale(this.matMV,this.tmpVec3))};n.prototype.rotateZ=function(n){n!==0&&mat4.rotateZ(this.matMV,n)};n.prototype.updateModelView=function(){if(!v(this.lastMV,this.matMV)){var n=this.pushBatch();n.type=d;n.mat4param?mat4.set(this.matMV,n.mat4param):n.mat4param=mat4.create(this.matMV);mat4.set(this.matMV,this.lastMV);this.hasQuadBatchTop=!1;this.hasPointBatchTop=!1}};n.prototype.setEarlyZIndex=function(n){this.enableFrontToBack&&(n>32760&&(n=32760),this.currentZ=this.cam[2]-this.zNear-n*this.zIncrement)};t.prototype.doSetEarlyZPass=function(){var n=this.gl,t=this.glwrap;this.startIndex!==0?(n.depthMask(!0),n.colorMask(!1,!1,!1,!1),n.disable(n.BLEND),n.bindFramebuffer(n.FRAMEBUFFER,t.fbo),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0),n.clear(n.DEPTH_BUFFER_BIT),n.bindFramebuffer(n.FRAMEBUFFER,null),t.isBatchInEarlyZPass=!0):(n.depthMask(!1),n.colorMask(!0,!0,!0,!0),n.enable(n.BLEND),t.isBatchInEarlyZPass=!1)};t.prototype.doSetTexture=function(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.texParam)};t.prototype.doSetTexture1=function(){var n=this.gl;n.activeTexture(n.TEXTURE1);n.bindTexture(n.TEXTURE_2D,this.texParam);n.activeTexture(n.TEXTURE0)};t.prototype.doSetOpacity=function(){var t=this.opacityParam,i=this.glwrap,n;i.currentOpacity=t;n=i.currentShader;n.locOpacity&&n.lpOpacity!==t&&(n.lpOpacity=t,this.gl.uniform1f(n.locOpacity,t))};t.prototype.doQuad=function(){this.gl.drawElements(this.gl.TRIANGLES,this.indexCount,this.gl.UNSIGNED_SHORT,this.startIndex)};t.prototype.doSetBlend=function(){this.gl.blendFunc(this.startIndex,this.indexCount)};t.prototype.doUpdateModelView=function(){for(var t,r=this.glwrap.shaderPrograms,u=this.glwrap.currentProgram,n=0,i=r.length;n<i;n++)t=r[n],n===u&&t.locMatMV?(t.updateMatMV(this.mat4param),t.hasCurrentMatMV=!0):t.hasCurrentMatMV=!1;mat4.set(this.mat4param,this.glwrap.currentMV)};t.prototype.doRenderToTexture=function(){var n=this.gl,t=this.glwrap;this.texParam?(t.lastTexture1===this.texParam&&(n.activeTexture(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,null),t.lastTexture1=null,n.activeTexture(n.TEXTURE0)),n.bindFramebuffer(n.FRAMEBUFFER,t.fbo),t.isBatchInEarlyZPass||n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,this.texParam,0)):(t.enableFrontToBack||n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0),n.bindFramebuffer(n.FRAMEBUFFER,null))};t.prototype.doClear=function(){var n=this.gl,t=this.startIndex;t===0?(n.clearColor(this.mat4param[0],this.mat4param[1],this.mat4param[2],this.mat4param[3]),n.clear(n.COLOR_BUFFER_BIT)):t===1?(n.enable(n.SCISSOR_TEST),n.scissor(this.mat4param[0],this.mat4param[1],this.mat4param[2],this.mat4param[3]),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),n.disable(n.SCISSOR_TEST)):n.clear(n.DEPTH_BUFFER_BIT)};t.prototype.doSetDepthTestEnabled=function(){var n=this.gl,t=this.startIndex;t!==0?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST)};t.prototype.doPoints=function(){var n=this.gl,i=this.glwrap,t;i.enableFrontToBack&&n.disable(n.DEPTH_TEST);t=i.shaderPrograms[1];n.useProgram(t.shaderProgram);!t.hasCurrentMatMV&&t.locMatMV&&(t.updateMatMV(i.currentMV),t.hasCurrentMatMV=!0);n.enableVertexAttribArray(t.locAPos);n.bindBuffer(n.ARRAY_BUFFER,i.pointBuffer);n.vertexAttribPointer(t.locAPos,4,n.FLOAT,!1,0,0);n.drawArrays(n.POINTS,this.startIndex/4,this.indexCount);t=i.currentShader;n.useProgram(t.shaderProgram);t.locAPos>=0&&(n.enableVertexAttribArray(t.locAPos),n.bindBuffer(n.ARRAY_BUFFER,i.vertexBuffers[i.curBuffer]),n.vertexAttribPointer(t.locAPos,i.enableFrontToBack?3:2,n.FLOAT,!1,0,0));t.locATex>=0&&(n.enableVertexAttribArray(t.locATex),n.bindBuffer(n.ARRAY_BUFFER,i.texcoordBuffers[i.curBuffer]),n.vertexAttribPointer(t.locATex,2,n.FLOAT,!1,0,0));i.enableFrontToBack&&n.enable(n.DEPTH_TEST)};t.prototype.doSetProgram=function(){var t=this.gl,i=this.glwrap,n=i.shaderPrograms[this.startIndex];i.currentProgram=this.startIndex;i.currentShader=n;t.useProgram(n.shaderProgram);!n.hasCurrentMatMV&&n.locMatMV&&(n.updateMatMV(i.currentMV),n.hasCurrentMatMV=!0);n.locOpacity&&n.lpOpacity!==i.currentOpacity&&(n.lpOpacity=i.currentOpacity,t.uniform1f(n.locOpacity,i.currentOpacity));n.locAPos>=0&&(t.enableVertexAttribArray(n.locAPos),t.bindBuffer(t.ARRAY_BUFFER,i.vertexBuffers[i.curBuffer]),t.vertexAttribPointer(n.locAPos,i.enableFrontToBack?3:2,t.FLOAT,!1,0,0));n.locATex>=0&&(t.enableVertexAttribArray(n.locATex),t.bindBuffer(t.ARRAY_BUFFER,i.texcoordBuffers[i.curBuffer]),t.vertexAttribPointer(n.locATex,2,t.FLOAT,!1,0,0))};t.prototype.doSetColor=function(){var t=this.glwrap.currentShader,n=this.mat4param;this.gl.uniform4f(t.locColorFill,n[0],n[1],n[2],n[3])};t.prototype.doSetProgramParameters=function(){var f,e,n=this.glwrap.currentShader,i=this.gl,u=this.mat4param,t,r;if(n.locSamplerBack&&this.glwrap.lastTexture1!==this.texParam&&(i.activeTexture(i.TEXTURE1),i.bindTexture(i.TEXTURE_2D,this.texParam),this.glwrap.lastTexture1=this.texParam,i.activeTexture(i.TEXTURE0)),t=u[0],n.locPixelWidth&&t!==n.lpPixelWidth&&(n.lpPixelWidth=t,i.uniform1f(n.locPixelWidth,t)),t=u[1],n.locPixelHeight&&t!==n.lpPixelHeight&&(n.lpPixelHeight=t,i.uniform1f(n.locPixelHeight,t)),t=u[2],r=u[3],n.locDestStart&&(t!==n.lpDestStartX||r!==n.lpDestStartY)&&(n.lpDestStartX=t,n.lpDestStartY=r,i.uniform2f(n.locDestStart,t,r)),t=u[4],r=u[5],n.locDestEnd&&(t!==n.lpDestEndX||r!==n.lpDestEndY)&&(n.lpDestEndX=t,n.lpDestEndY=r,i.uniform2f(n.locDestEnd,t,r)),t=u[6],n.locLayerScale&&t!==n.lpLayerScale&&(n.lpLayerScale=t,i.uniform1f(n.locLayerScale,t)),t=u[7],n.locLayerAngle&&t!==n.lpLayerAngle&&(n.lpLayerAngle=t,i.uniform1f(n.locLayerAngle,t)),t=u[8],r=u[9],n.locViewOrigin&&(t!==n.lpViewOriginX||r!==n.lpViewOriginY)&&(n.lpViewOriginX=t,n.lpViewOriginY=r,i.uniform2f(n.locViewOrigin,t,r)),t=u[10],r=u[11],n.locScrollPos&&(t!==n.lpScrollPosX||r!==n.lpScrollPosY)&&(n.lpScrollPosX=t,n.lpScrollPosY=r,i.uniform2f(n.locScrollPos,t,r)),t=u[12],n.locSeconds&&t!==n.lpSeconds&&(n.lpSeconds=t,i.uniform1f(n.locSeconds,t)),n.parameters.length)for(f=0,e=n.parameters.length;f<e;f++)t=this.shaderParams[f],t!==n.lastCustomParams[f]&&(n.lastCustomParams[f]=t,i.uniform1f(n.parameters[f][1],t))};n.prototype.pushBatch=function(){return this.batchPtr===this.batch.length&&this.batch.push(new t(p,this)),this.batch[this.batchPtr++]};n.prototype.endBatch=function(){var n,i,r,u,t;if(this.batchPtr!==0&&!this.gl.isContextLost()){for(n=this.gl,this.pointPtr>0&&(n.bindBuffer(n.ARRAY_BUFFER,this.pointBuffer),n.bufferSubData(n.ARRAY_BUFFER,0,this.pointData.subarray(0,this.pointPtr)),i&&i.locAPos>=0&&i.name==="<point>"&&n.vertexAttribPointer(i.locAPos,4,n.FLOAT,!1,0,0)),this.vertexPtr>0&&(i=this.currentShader,n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffers[this.curBuffer]),n.bufferSubData(n.ARRAY_BUFFER,0,this.vertexData.subarray(0,this.vertexPtr)),i&&i.locAPos>=0&&i.name!=="<point>"&&n.vertexAttribPointer(i.locAPos,this.enableFrontToBack?3:2,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,this.texcoordBuffers[this.curBuffer]),n.bufferSubData(n.ARRAY_BUFFER,0,this.texcoordData.subarray(0,this.texPtr)),i&&i.locATex>=0&&i.name!=="<point>"&&n.vertexAttribPointer(i.locATex,2,n.FLOAT,!1,0,0)),r=0,u=this.batchPtr;r<u;r++){t=this.batch[r];switch(t.type){case 1:t.doQuad();break;case 2:t.doSetTexture();break;case 3:t.doSetOpacity();break;case 4:t.doSetBlend();break;case 5:t.doUpdateModelView();break;case 6:t.doRenderToTexture();break;case 7:t.doClear();break;case 8:t.doPoints();break;case 9:t.doSetProgram();break;case 10:t.doSetProgramParameters();break;case 11:t.doSetTexture1();break;case 12:t.doSetColor();break;case 13:t.doSetDepthTestEnabled();break;case 14:t.doSetEarlyZPass()}}this.batchPtr=0;this.vertexPtr=0;this.texPtr=0;this.pointPtr=0;this.hasQuadBatchTop=!1;this.hasPointBatchTop=!1;this.isBatchInEarlyZPass=!1;this.curBuffer++;this.curBuffer>=f&&(this.curBuffer=0)}};n.prototype.setOpacity=function(n){if(n!==this.lastOpacity&&!this.isEarlyZPass){var t=this.pushBatch();t.type=b;t.opacityParam=n;this.lastOpacity=n;this.hasQuadBatchTop=!1;this.hasPointBatchTop=!1}};n.prototype.setTexture=function(n){if(n!==this.lastTexture0){var t=this.pushBatch();t.type=w;t.texParam=n;this.lastTexture0=n;this.hasQuadBatchTop=!1;this.hasPointBatchTop=!1}};n.prototype.setBlend=function(n,t){if((n!==this.lastSrcBlend||t!==this.lastDestBlend)&&!this.isEarlyZPass){var i=this.pushBatch();i.type=k;i.startIndex=n;i.indexCount=t;this.lastSrcBlend=n;this.lastDestBlend=t;this.hasQuadBatchTop=!1;this.hasPointBatchTop=!1}};n.prototype.isPremultipliedAlphaBlend=function(){return this.lastSrcBlend===this.gl.ONE&&this.lastDestBlend===this.gl.ONE_MINUS_SRC_ALPHA};n.prototype.setAlphaBlend=function(){this.setBlend(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA)};n.prototype.setNoPremultiplyAlphaBlend=function(){this.setBlend(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA)};e=u*2-8;n.prototype.quad=function(n,t,i,r,u,f,s,h){var p;this.vertexPtr>=e&&this.endBatch();var c=this.vertexPtr,a=this.texPtr,l=this.vertexData,v=this.texcoordData,y=this.currentZ;this.hasQuadBatchTop?this.batch[this.batchPtr-1].indexCount+=6:(p=this.pushBatch(),p.type=o,p.startIndex=this.enableFrontToBack?c:c/2*3,p.indexCount=6,this.hasQuadBatchTop=!0,this.hasPointBatchTop=!1);this.enableFrontToBack?(l[c++]=n,l[c++]=t,l[c++]=y,l[c++]=i,l[c++]=r,l[c++]=y,l[c++]=u,l[c++]=f,l[c++]=y,l[c++]=s,l[c++]=h,l[c++]=y):(l[c++]=n,l[c++]=t,l[c++]=i,l[c++]=r,l[c++]=u,l[c++]=f,l[c++]=s,l[c++]=h);v[a++]=0;v[a++]=0;v[a++]=1;v[a++]=0;v[a++]=1;v[a++]=1;v[a++]=0;v[a++]=1;this.vertexPtr=c;this.texPtr=a};n.prototype.quadTex=function(n,t,i,r,u,f,s,h,c){var w;this.vertexPtr>=e&&this.endBatch();var l=this.vertexPtr,v=this.texPtr,a=this.vertexData,y=this.texcoordData,p=this.currentZ;this.hasQuadBatchTop?this.batch[this.batchPtr-1].indexCount+=6:(w=this.pushBatch(),w.type=o,w.startIndex=this.enableFrontToBack?l:l/2*3,w.indexCount=6,this.hasQuadBatchTop=!0,this.hasPointBatchTop=!1);var b=c.left,k=c.top,d=c.right,g=c.bottom;this.enableFrontToBack?(a[l++]=n,a[l++]=t,a[l++]=p,a[l++]=i,a[l++]=r,a[l++]=p,a[l++]=u,a[l++]=f,a[l++]=p,a[l++]=s,a[l++]=h,a[l++]=p):(a[l++]=n,a[l++]=t,a[l++]=i,a[l++]=r,a[l++]=u,a[l++]=f,a[l++]=s,a[l++]=h);y[v++]=b;y[v++]=k;y[v++]=d;y[v++]=k;y[v++]=d;y[v++]=g;y[v++]=b;y[v++]=g;this.vertexPtr=l;this.texPtr=v};n.prototype.quadTexUV=function(n,t,i,r,u,f,s,h,c,l,a,v,y,p,w,b){var it;this.vertexPtr>=e&&this.endBatch();var k=this.vertexPtr,g=this.texPtr,d=this.vertexData,nt=this.texcoordData,tt=this.currentZ;this.hasQuadBatchTop?this.batch[this.batchPtr-1].indexCount+=6:(it=this.pushBatch(),it.type=o,it.startIndex=this.enableFrontToBack?k:k/2*3,it.indexCount=6,this.hasQuadBatchTop=!0,this.hasPointBatchTop=!1);this.enableFrontToBack?(d[k++]=n,d[k++]=t,d[k++]=tt,d[k++]=i,d[k++]=r,d[k++]=tt,d[k++]=u,d[k++]=f,d[k++]=tt,d[k++]=s,d[k++]=h,d[k++]=tt):(d[k++]=n,d[k++]=t,d[k++]=i,d[k++]=r,d[k++]=u,d[k++]=f,d[k++]=s,d[k++]=h);nt[g++]=c;nt[g++]=l;nt[g++]=a;nt[g++]=v;nt[g++]=y;nt[g++]=p;nt[g++]=w;nt[g++]=b;this.vertexPtr=k;this.texPtr=g};n.prototype.convexPoly=function(n){for(var a=n.length/2,o=a-2,v=o-1,s=n[0],h=n[1],t,f,e,r,u,c,l,i=0;i<o;i+=2)t=i*2,f=n[t+2],e=n[t+3],r=n[t+4],u=n[t+5],i===v?this.quad(s,h,f,e,r,u,r,u):(c=n[t+6],l=n[t+7],this.quad(s,h,f,e,r,u,c,l))};y=c-4;n.prototype.point=function(n,t,i,r){var u,f,e;this.pointPtr>=y&&this.endBatch();u=this.pointPtr;f=this.pointData;this.hasPointBatchTop?this.batch[this.batchPtr-1].indexCount++:(e=this.pushBatch(),e.type=nt,e.startIndex=u,e.indexCount=1,this.hasPointBatchTop=!0,this.hasQuadBatchTop=!1);f[u++]=n;f[u++]=t;f[u++]=i;f[u++]=r;this.pointPtr=u};n.prototype.switchProgram=function(n){var t,i;if(this.lastProgram!==n){if(t=this.shaderPrograms[n],!t){if(this.lastProgram===0)return;n=0;t=this.shaderPrograms[0]}i=this.pushBatch();i.type=tt;i.startIndex=n;this.lastProgram=n;this.hasQuadBatchTop=!1;this.hasPointBatchTop=!1}};n.prototype.programUsesDest=function(n){var t=this.shaderPrograms[n];return!!(t.locDestStart||t.locDestEnd)};n.prototype.programUsesCrossSampling=function(n){var t=this.shaderPrograms[n];return!!(t.locDestStart||t.locDestEnd||t.crossSampling)};n.prototype.programPreservesOpaqueness=function(n){return this.shaderPrograms[n].preservesOpaqueness};n.prototype.programExtendsBox=function(n){var t=this.shaderPrograms[n];return t.extendBoxHorizontal!==0||t.extendBoxVertical!==0};n.prototype.getProgramBoxExtendHorizontal=function(n){return this.shaderPrograms[n].extendBoxHorizontal};n.prototype.getProgramBoxExtendVertical=function(n){return this.shaderPrograms[n].extendBoxVertical};n.prototype.getProgramParameterType=function(n,t){return this.shaderPrograms[n].parameters[t][2]};n.prototype.programIsAnimated=function(n){return this.shaderPrograms[n].animated};n.prototype.setProgramParameters=function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y){var b,d,g=this.shaderPrograms[this.lastProgram],w,p,k;if(g.hasAnyOptionalUniforms||y.length){if(w=this.pushBatch(),w.type=it,w.mat4param?mat4.set(this.matMV,w.mat4param):w.mat4param=mat4.create(),p=w.mat4param,p[0]=t,p[1]=i,p[2]=r,p[3]=u,p[4]=f,p[5]=e,p[6]=o,p[7]=s,p[8]=h,p[9]=c,p[10]=l,p[11]=a,p[12]=v,w.texParam=g.locSamplerBack?n:null,y.length)for(k=w.shaderParams,k.length=y.length,b=0,d=y.length;b<d;b++)k[b]=y[b];this.hasQuadBatchTop=!1;this.hasPointBatchTop=!1}};n.prototype.clear=function(n,t,i,r){var u=this.pushBatch();u.type=s;u.startIndex=0;u.mat4param||(u.mat4param=mat4.create());u.mat4param[0]=n;u.mat4param[1]=t;u.mat4param[2]=i;u.mat4param[3]=r;this.hasQuadBatchTop=!1;this.hasPointBatchTop=!1};n.prototype.clearRect=function(n,t,i,r){if(!(i<0)&&!(r<0)){var u=this.pushBatch();u.type=s;u.startIndex=1;u.mat4param||(u.mat4param=mat4.create());u.mat4param[0]=n;u.mat4param[1]=t;u.mat4param[2]=i;u.mat4param[3]=r;this.hasQuadBatchTop=!1;this.hasPointBatchTop=!1}};n.prototype.clearDepth=function(){var n=this.pushBatch();n.type=s;n.startIndex=2;this.hasQuadBatchTop=!1;this.hasPointBatchTop=!1};n.prototype.setEarlyZPass=function(n){if(this.enableFrontToBack&&(n=!!n,this.isEarlyZPass!==n)){var t=this.pushBatch();t.type=ft;t.startIndex=n?1:0;this.hasQuadBatchTop=!1;this.hasPointBatchTop=!1;this.isEarlyZPass=n;this.renderToTex=null;this.isEarlyZPass?this.switchProgram(2):this.switchProgram(0)}};n.prototype.setDepthTestEnabled=function(n){if(this.enableFrontToBack){var t=this.pushBatch();t.type=ut;t.startIndex=n?1:0;this.hasQuadBatchTop=!1;this.hasPointBatchTop=!1}};n.prototype.fullscreenQuad=function(){mat4.set(this.lastMV,l);this.resetModelView();this.updateModelView();var n=this.width/2,t=this.height/2;this.quad(-n,t,n,t,n,-t,-n,-t);mat4.set(l,this.matMV);this.updateModelView()};n.prototype.setColorFillMode=function(n,t,i,r){this.switchProgram(3);var u=this.pushBatch();u.type=rt;u.mat4param||(u.mat4param=mat4.create());u.mat4param[0]=n;u.mat4param[1]=t;u.mat4param[2]=i;u.mat4param[3]=r;this.hasQuadBatchTop=!1;this.hasPointBatchTop=!1};n.prototype.setTextureFillMode=function(){this.switchProgram(0)};n.prototype.restoreEarlyZMode=function(){this.switchProgram(2)};n.prototype.present=function(){this.endBatch();this.gl.flush()};i=[];r={};n.prototype.contextLost=function(){cr.clearArray(i);r={}};var et=1,ot=2,st=3,ht=4;n.prototype.loadTexture=function(n,t,u,f,e,o){var a,h,s,w,c,l;if(t=!!t,u=!!u,a=n.src+","+t+","+u+(t?","+e:""),h=null,typeof n.src!="undefined"&&r.hasOwnProperty(a))return h=r[a],h.c2refcount++,h;this.endBatch();s=this.gl;w=cr.isPOT(n.width)&&cr.isPOT(n.height);h=s.createTexture();s.bindTexture(s.TEXTURE_2D,h);s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);var y=s.RGBA,p=s.RGBA,v=s.UNSIGNED_BYTE;if(f&&!this.isIE)switch(f){case et:y=s.RGB;p=s.RGB;break;case ot:v=s.UNSIGNED_SHORT_4_4_4_4;break;case st:v=s.UNSIGNED_SHORT_5_5_5_1;break;case ht:y=s.RGB;p=s.RGB;v=s.UNSIGNED_SHORT_5_6_5}return this.version===1&&!w&&t?(c=document.createElement("canvas"),c.width=cr.nextHighestPowerOfTwo(n.width),c.height=cr.nextHighestPowerOfTwo(n.height),l=c.getContext("2d"),typeof l.imageSmoothingEnabled!="undefined"?l.imageSmoothingEnabled=u:(l.webkitImageSmoothingEnabled=u,l.mozImageSmoothingEnabled=u,l.msImageSmoothingEnabled=u),l.drawImage(n,0,0,n.width,n.height,0,0,c.width,c.height),s.texImage2D(s.TEXTURE_2D,0,y,p,v,c)):s.texImage2D(s.TEXTURE_2D,0,y,p,v,n),t?e==="repeat-x"?(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE)):e==="repeat-y"?(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT)):(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT)):(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE)),u?(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),(w||this.version>=2)&&this.enable_mipmaps&&!o?(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR_MIPMAP_LINEAR),s.generateMipmap(s.TEXTURE_2D)):s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR)):(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST)),s.bindTexture(s.TEXTURE_2D,null),this.lastTexture0=null,h.c2width=n.width,h.c2height=n.height,h.c2refcount=1,h.c2texkey=a,i.push(h),r[a]=h,h};n.prototype.createEmptyTexture=function(n,t,r,u,f){var e,o;return this.endBatch(),e=this.gl,this.isIE&&(u=!1),o=e.createTexture(),e.bindTexture(e.TEXTURE_2D,o),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n,t,0,e.RGBA,u?e.UNSIGNED_SHORT_4_4_4_4:e.UNSIGNED_BYTE,null),f?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,r?e.LINEAR:e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,r?e.LINEAR:e.NEAREST),e.bindTexture(e.TEXTURE_2D,null),this.lastTexture0=null,o.c2width=n,o.c2height=t,i.push(o),o};n.prototype.videoToTexture=function(n,t,i){this.endBatch();var r=this.gl;this.isIE&&(i=!1);r.bindTexture(r.TEXTURE_2D,t);r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);try{r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,i?r.UNSIGNED_SHORT_4_4_4_4:r.UNSIGNED_BYTE,n)}catch(u){console&&console.error&&console.error("Error updating WebGL texture: ",u)}r.bindTexture(r.TEXTURE_2D,null);this.lastTexture0=null};n.prototype.deleteTexture=function(n){if(n){if(typeof n.c2refcount!="undefined"&&n.c2refcount>1){n.c2refcount--;return}this.endBatch();n===this.lastTexture0&&(this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.lastTexture0=null);n===this.lastTexture1&&(this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.activeTexture(this.gl.TEXTURE0),this.lastTexture1=null);cr.arrayFindRemove(i,n);typeof n.c2texkey!="undefined"&&delete r[n.c2texkey];this.gl.deleteTexture(n)}};n.prototype.estimateVRAM=function(){for(var r=this.width*this.height*8,t,n=0,u=i.length;n<u;n++)t=i[n],r+=t.c2width*t.c2height*4;return r};n.prototype.textureCount=function(){return i.length};n.prototype.setRenderingToTexture=function(n){if(n!==this.renderToTex){var t=this.pushBatch();t.type=g;t.texParam=n;this.renderToTex=n;this.hasQuadBatchTop=!1;this.hasPointBatchTop=!1}};cr.GLWrap=n}(),function(){function n(n){if(n&&(n.getContext||n.dc)&&!n.c2runtime){n.c2runtime=this;var t=this;this.isCrosswalk=/crosswalk/i.test(navigator.userAgent)||/xwalk/i.test(navigator.userAgent)||!!(typeof c2isCrosswalk!="undefined"&&window.c2isCrosswalk);this.isCordova=this.isCrosswalk||typeof device!="undefined"&&(typeof window.device.cordova!="undefined"||typeof window.device.phonegap!="undefined")||typeof c2iscordova!="undefined"&&window.c2iscordova;this.isPhoneGap=this.isCordova;this.isDirectCanvas=!!n.dc;this.isAppMobi=typeof AppMobi!="undefined"||this.isDirectCanvas;this.isCocoonJs=!!window.c2cocoonjs;this.isEjecta=!!window.c2ejecta;this.isCocoonJs&&(CocoonJS.App.onSuspended.addEventListener(function(){t.setSuspended(!0)}),CocoonJS.App.onActivated.addEventListener(function(){t.setSuspended(!1)}));this.isEjecta&&(document.addEventListener("pagehide",function(){t.setSuspended(!0)}),document.addEventListener("pageshow",function(){t.setSuspended(!1)}),document.addEventListener("resize",function(){t.setSize(window.innerWidth,window.innerHeight)}));this.isDomFree=this.isDirectCanvas||this.isCocoonJs||this.isEjecta;this.isMicrosoftEdge=/edge\//i.test(navigator.userAgent);this.isIE=(/msie/i.test(navigator.userAgent)||/trident/i.test(navigator.userAgent)||/iemobile/i.test(navigator.userAgent))&&!this.isMicrosoftEdge;this.isTizen=/tizen/i.test(navigator.userAgent);this.isAndroid=/android/i.test(navigator.userAgent)&&!this.isTizen&&!this.isIE&&!this.isMicrosoftEdge;this.isiPhone=(/iphone/i.test(navigator.userAgent)||/ipod/i.test(navigator.userAgent))&&!this.isIE&&!this.isMicrosoftEdge;this.isiPad=/ipad/i.test(navigator.userAgent);this.isiOS=this.isiPhone||this.isiPad||this.isEjecta;this.isiPhoneiOS6=this.isiPhone&&/os\s6/i.test(navigator.userAgent);this.isChrome=(/chrome/i.test(navigator.userAgent)||/chromium/i.test(navigator.userAgent))&&!this.isIE&&!this.isMicrosoftEdge;this.isAmazonWebApp=/amazonwebappplatform/i.test(navigator.userAgent);this.isFirefox=/firefox/i.test(navigator.userAgent);this.isSafari=/safari/i.test(navigator.userAgent)&&!this.isChrome&&!this.isIE&&!this.isMicrosoftEdge;this.isWindows=/windows/i.test(navigator.userAgent);this.isNWjs=typeof c2nodewebkit!="undefined"||typeof c2nwjs!="undefined"||/nodewebkit/i.test(navigator.userAgent)||/nwjs/i.test(navigator.userAgent);this.isNodeWebkit=this.isNWjs;this.isArcade=typeof is_scirra_arcade!="undefined";this.isWindows8App=!!(typeof c2isWindows8!="undefined"&&window.c2isWindows8);this.isWindows8Capable=!!(typeof c2isWindows8Capable!="undefined"&&window.c2isWindows8Capable);this.isWindowsPhone8=!!(typeof c2isWindowsPhone8!="undefined"&&window.c2isWindowsPhone8);this.isWindowsPhone81=!!(typeof c2isWindowsPhone81!="undefined"&&window.c2isWindowsPhone81);this.isWindows10=!!window.cr_windows10;this.isWinJS=this.isWindows8App||this.isWindows8Capable||this.isWindowsPhone81||this.isWindows10;this.isBlackberry10=!!(typeof c2isBlackberry10!="undefined"&&window.c2isBlackberry10);this.isAndroidStockBrowser=this.isAndroid&&!this.isChrome&&!this.isCrosswalk&&!this.isFirefox&&!this.isAmazonWebApp&&!this.isDomFree;this.devicePixelRatio=1;this.isMobile=this.isCordova||this.isCrosswalk||this.isAppMobi||this.isCocoonJs||this.isAndroid||this.isiOS||this.isWindowsPhone8||this.isWindowsPhone81||this.isBlackberry10||this.isTizen||this.isEjecta;this.isMobile||(this.isMobile=/(blackberry|bb10|playbook|palm|symbian|nokia|windows\s+ce|phone|mobile|tablet|kindle|silk)/i.test(navigator.userAgent));this.isWKWebView=!!(this.isiOS&&this.isCordova&&window.webkit);typeof cr_is_preview!="undefined"&&!this.isNWjs&&(window.location.search==="?nw"||/nodewebkit/i.test(navigator.userAgent)||/nwjs/i.test(navigator.userAgent))&&(this.isNWjs=!0);this.isDebug=typeof cr_is_preview!="undefined"&&window.location.search.indexOf("debug")>-1;this.canvas=n;this.canvasdiv=document.getElementById("c2canvasdiv");this.gl=null;this.glwrap=null;this.glUnmaskedRenderer="(unavailable)";this.enableFrontToBack=!1;this.earlyz_index=0;this.ctx=null;this.firstInFullscreen=!1;this.oldWidth=0;this.oldHeight=0;this.canvas.oncontextmenu=function(n){return n.preventDefault&&n.preventDefault(),!1};this.canvas.onselectstart=function(n){return n.preventDefault&&n.preventDefault(),!1};this.canvas.ontouchstart=function(n){return n.preventDefault&&n.preventDefault(),!1};this.isDirectCanvas&&(window.c2runtime=this);this.isNWjs&&(window.ondragover=function(n){return n.preventDefault(),!1},window.ondrop=function(n){return n.preventDefault(),!1},window.nwgui&&window.nwgui.App.clearCache&&window.nwgui.App.clearCache());this.isAndroidStockBrowser&&typeof jQuery!="undefined"&&jQuery("canvas").parents("*").css("overflow","visible");this.width=n.width;this.height=n.height;this.draw_width=this.width;this.draw_height=this.height;this.cssWidth=this.width;this.cssHeight=this.height;this.lastWindowWidth=window.innerWidth;this.lastWindowHeight=window.innerHeight;this.forceCanvasAlpha=!1;this.redraw=!0;this.isSuspended=!1;Date.now||(Date.now=function(){return+new Date});this.plugins=[];this.types={};this.types_by_index=[];this.behaviors=[];this.layouts={};this.layouts_by_index=[];this.eventsheets={};this.eventsheets_by_index=[];this.wait_for_textures=[];this.triggers_to_postinit=[];this.all_global_vars=[];this.all_local_vars=[];this.solidBehavior=null;this.jumpthruBehavior=null;this.shadowcasterBehavior=null;this.deathRow={};this.hasPendingInstances=!1;this.isInClearDeathRow=!1;this.isInOnDestroy=0;this.isRunningEvents=!1;this.isEndingLayout=!1;this.createRow=[];this.isLoadingState=!1;this.saveToSlot="";this.loadFromSlot="";this.loadFromJson=null;this.lastSaveJson="";this.signalledContinuousPreview=!1;this.suspendDrawing=!1;this.fireOnCreateAfterLoad=[];this.dt=0;this.dt1=0;this.minimumFramerate=30;this.logictime=0;this.cpuutilisation=0;this.timescale=1;this.kahanTime=new cr.KahanAdder;this.wallTime=new cr.KahanAdder;this.last_tick_time=0;this.fps=0;this.last_fps_time=0;this.tickcount=0;this.tickcount_nosave=0;this.execcount=0;this.framecount=0;this.objectcount=0;this.changelayout=null;this.destroycallbacks=[];this.event_stack=[];this.event_stack_index=-1;this.localvar_stack=[[]];this.localvar_stack_index=0;this.trigger_depth=0;this.pushEventStack(null);this.loop_stack=[];this.loop_stack_index=-1;this.next_uid=0;this.next_puid=0;this.layout_first_tick=!0;this.family_count=0;this.suspend_events=[];this.raf_id=-1;this.timeout_id=-1;this.isloading=!0;this.loadingprogress=0;this.isNodeFullscreen=!1;this.stackLocalCount=0;this.audioInstance=null;this.had_a_click=!1;this.isInUserInputEvent=!1;this.objects_to_pretick=new cr.ObjectSet;this.objects_to_tick=new cr.ObjectSet;this.objects_to_tick2=new cr.ObjectSet;this.registered_collisions=[];this.temp_poly=new cr.CollisionPoly([]);this.temp_poly2=new cr.CollisionPoly([]);this.allGroups=[];this.groups_by_name={};this.cndsBySid={};this.actsBySid={};this.varsBySid={};this.blocksBySid={};this.running_layout=null;this.layer_canvas=null;this.layer_ctx=null;this.layer_tex=null;this.layout_tex=null;this.layout_canvas=null;this.layout_ctx=null;this.is_WebGL_context_lost=!1;this.uses_background_blending=!1;this.fx_tex=[null,null];this.fullscreen_scaling=0;this.files_subfolder="";this.objectsByUid={};this.loaderlogos=null;this.snapshotCanvas=null;this.snapshotData="";this.objectRefTable=[];this.requestProjectData()}}function bt(n,t){f&&f.width===n&&f.height===t||(f=document.createElement("canvas"),f.width=n,f.height=t,ut=f.getContext("2d"))}function y(n,t){return t<=128?n[3]:t<=256?n[2]:t<=512?n[1]:n[0]}function kt(){return p.length?p.pop():new cr.ObjectSet}function dt(n){n.clear();p.push(n)}function lt(){try{return!!window.indexedDB}catch(n){return!1}}function at(n){var t=n.target.result;t.createObjectStore("saves",{keyPath:"slot"})}function gt(n,t,i,r){try{var u=indexedDB.open("_C2SaveStates");u.onupgradeneeded=at;u.onerror=r;u.onsuccess=function(u){var f=u.target.result;f.onerror=r;var e=f.transaction(["saves"],"readwrite"),o=e.objectStore("saves"),s=o.put({slot:n,data:t});s.onsuccess=i}}catch(f){r(f)}}function ni(n,t,i){try{var r=indexedDB.open("_C2SaveStates");r.onupgradeneeded=at;r.onerror=i;r.onsuccess=function(r){var f=r.target.result;f.onerror=i;var e=f.transaction(["saves"]),o=e.objectStore("saves"),u=o.get(n);u.onsuccess=function(){u.result?t(u.result.data):t(null)}}}catch(u){i(u)}}function ft(){cr.logexport("Reloading for continuous preview");window.c2cocoonjs?CocoonJS.App.reload():window.location.search.indexOf("continuous")>-1?window.location.reload(!0):window.location=window.location+"?continuous"}function k(n){var t,i={};for(t in n)if(n.hasOwnProperty(t)){if(n[t]instanceof cr.ObjectSet)continue;if(n[t]&&typeof n[t].c2userdata!="undefined")continue;if(t==="spriteCreatedDestroyCallback")continue;i[t]=n[t]}return i}var l=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame,vt,g,a,it,v,p,u,i,ct,b;n.prototype.requestProjectData=function(){var t=this,n,r,i;if(this.isWKWebView){this.fetchLocalFileViaCordovaAsText("data.js",function(n){t.loadProject(JSON.parse(n))},function(){alert("Error fetching data.js")});return}if(n=this.isWindowsPhone8?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest,r="data.js",(this.isWindows8App||this.isWindowsPhone8||this.isWindowsPhone81||this.isWindows10)&&(r="data.json"),n.open("GET",r,!0),i=!1,!this.isDomFree&&"response"in n&&"responseType"in n)try{n.responseType="json";i=n.responseType==="json"}catch(u){i=!1}if(!i&&"responseType"in n)try{n.responseType="text"}catch(u){}if("overrideMimeType"in n)try{n.overrideMimeType("application/json; charset=utf-8")}catch(u){}this.isWindowsPhone8?n.onreadystatechange=function(){n.readyState===4&&t.loadProject(JSON.parse(n.responseText))}:(n.onload=function(){if(i)t.loadProject(n.response);else if(t.isEjecta){var r=n.responseText;r=r.substr(r.indexOf("{"));t.loadProject(JSON.parse(r))}else t.loadProject(JSON.parse(n.responseText))},n.onerror=function(n){cr.logerror("Error requesting "+r+":");cr.logerror(n)});n.send()};n.prototype.initRendererAndLoader=function(){var t=this,r,s,i,f,h,v,a,n,e,c,u,w,l,y,p,o;this.isRetina=(!this.isDomFree||this.isEjecta||this.isCordova)&&this.useHighDpi&&!this.isAndroidStockBrowser;this.fullscreen_mode===0&&this.isiOS&&(this.isRetina=!1);this.devicePixelRatio=this.isRetina?window.devicePixelRatio||window.webkitDevicePixelRatio||window.mozDevicePixelRatio||window.msDevicePixelRatio||1:1;this.ClearDeathRow();this.fullscreen_mode>0&&this.setSize(window.innerWidth,window.innerHeight,!0);this.canvas.addEventListener("webglcontextlost",function(n){n.preventDefault();t.onContextLost();cr.logexport("[Construct 2] WebGL context lost");window.cr_setSuspended(!0)},!1);this.canvas.addEventListener("webglcontextrestored",function(){t.glwrap.initState();t.glwrap.setSize(t.glwrap.width,t.glwrap.height,!0);t.layer_tex=null;t.layout_tex=null;t.fx_tex[0]=null;t.fx_tex[1]=null;t.onContextRestored();t.redraw=!0;cr.logexport("[Construct 2] WebGL context restored");window.cr_setSuspended(!1)},!1);try{this.enableWebGL&&(this.isCocoonJs||this.isEjecta||!this.isDomFree)&&(u={alpha:!0,depth:!1,antialias:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!0},this.isAndroid||(this.gl=this.canvas.getContext("webgl2",u)),this.gl||(this.gl=this.canvas.getContext("webgl",u)||this.canvas.getContext("experimental-webgl",u)))}catch(b){}if(this.gl){for(w=this.gl.getParameter(this.gl.VERSION).indexOf("WebGL 2")===0,l=this.gl.getExtension("WEBGL_debug_renderer_info"),l&&(y=this.gl.getParameter(l.UNMASKED_VENDOR_WEBGL),p=this.gl.getParameter(l.UNMASKED_RENDERER_WEBGL),this.glUnmaskedRenderer=p+" ["+y+"]"),this.enableFrontToBack&&(this.glUnmaskedRenderer+=" [front-to-back enabled]"),this.isDomFree||(this.overlay_canvas=document.createElement("canvas"),jQuery(this.overlay_canvas).appendTo(this.canvas.parentNode),this.overlay_canvas.oncontextmenu=function(){return!1},this.overlay_canvas.onselectstart=function(){return!1},this.overlay_canvas.width=Math.round(this.cssWidth*this.devicePixelRatio),this.overlay_canvas.height=Math.round(this.cssHeight*this.devicePixelRatio),jQuery(this.overlay_canvas).css({width:this.cssWidth+"px",height:this.cssHeight+"px"}),this.positionOverlayCanvas(),this.overlay_ctx=this.overlay_canvas.getContext("2d")),this.glwrap=new cr.GLWrap(this.gl,this.isMobile,this.enableFrontToBack),this.glwrap.setSize(this.canvas.width,this.canvas.height),this.glwrap.enable_mipmaps=this.downscalingQuality!==0,this.ctx=null,r=0,s=this.types_by_index.length;r<s;r++)for(a=this.types_by_index[r],i=0,f=a.effect_types.length;i<f;i++)n=a.effect_types[i],n.shaderindex=this.glwrap.getShaderIndex(n.id),n.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(n.shaderindex),this.uses_background_blending=this.uses_background_blending||this.glwrap.programUsesDest(n.shaderindex);for(r=0,s=this.layouts_by_index.length;r<s;r++){for(e=this.layouts_by_index[r],i=0,f=e.effect_types.length;i<f;i++)n=e.effect_types[i],n.shaderindex=this.glwrap.getShaderIndex(n.id),n.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(n.shaderindex);for(e.updateActiveEffects(),i=0,f=e.layers.length;i<f;i++){for(c=e.layers[i],h=0,v=c.effect_types.length;h<v;h++)n=c.effect_types[h],n.shaderindex=this.glwrap.getShaderIndex(n.id),n.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(n.shaderindex),this.uses_background_blending=this.uses_background_blending||this.glwrap.programUsesDest(n.shaderindex);c.updateActiveEffects()}}}else{if(this.fullscreen_mode>0&&this.isDirectCanvas){this.canvas=null;document.oncontextmenu=function(){return!1};document.onselectstart=function(){return!1};this.ctx=AppMobi.canvas.getContext("2d");try{this.ctx.samplingMode=this.linearSampling?"smooth":"sharp";this.ctx.globalScale=1;this.ctx.HTML5CompatibilityMode=!0;this.ctx.imageSmoothingEnabled=this.linearSampling}catch(b){}this.width!==0&&this.height!==0&&(this.ctx.width=this.width,this.ctx.height=this.height)}this.ctx||(this.isCocoonJs?(u={antialias:!!this.linearSampling,alpha:!0},this.ctx=this.canvas.getContext("2d",u)):(u={alpha:!0},this.ctx=this.canvas.getContext("2d",u)),this.setCtxImageSmoothingEnabled(this.ctx,this.linearSampling));this.overlay_canvas=null;this.overlay_ctx=null}this.tickFunc=function(n){t.tick(!1,n)};window==window.top||this.isDomFree||this.isWinJS||this.isWindowsPhone8||(document.addEventListener("mousedown",function(){window.focus()},!0),document.addEventListener("touchstart",function(){window.focus()},!0));typeof cr_is_preview!="undefined"&&(this.isCocoonJs&&console.log("[Construct 2] In preview-over-wifi via CocoonJS mode"),window.location.search.indexOf("continuous")>-1&&(cr.logexport("Reloading for continuous preview"),this.loadFromSlot="__c2_continuouspreview",this.suspendDrawing=!0),this.pauseOnBlur&&!this.isMobile&&(jQuery(window).focus(function(){t.setSuspended(!1)}),jQuery(window).blur(function(){var n=window.parent;n&&n.document.hasFocus()||t.setSuspended(!0)})));window.addEventListener("blur",function(){t.onWindowBlur()});this.isDomFree||(o=function(n){if(cr.isCanvasInputEvent(n)&&document.activeElement&&document.activeElement!==document.getElementsByTagName("body")[0]&&document.activeElement.blur)try{document.activeElement.blur()}catch(n){}},typeof PointerEvent!="undefined"?document.addEventListener("pointerdown",o):window.navigator.msPointerEnabled?document.addEventListener("MSPointerDown",o):document.addEventListener("touchstart",o),document.addEventListener("mousedown",o));this.fullscreen_mode===0&&this.isRetina&&this.devicePixelRatio>1&&this.setSize(this.original_width,this.original_height,!0);this.tryLockOrientation();this.getready();this.go();this.extra={};cr.seal(this)};vt=!1;n.prototype.setSize=function(n,t,i){var c=0,l=0,o=0,s=0,r=0,e,h,f,a,u;(this.lastWindowWidth!==n||this.lastWindowHeight!==t||i)&&(this.lastWindowWidth=n,this.lastWindowHeight=t,e=this.fullscreen_mode,a=(document.mozFullScreen||document.webkitIsFullScreen||!!document.msFullscreenElement||document.fullScreen||this.isNodeFullscreen)&&!this.isCordova,a||this.fullscreen_mode!==0||i)&&(a&&(e=this.fullscreen_scaling),u=this.devicePixelRatio,e>=4?(e===5&&u!==1&&(n+=1,t+=1),h=this.original_width/this.original_height,f=n/t,f>h?(o=t*h,e===5?(r=o*u/this.original_width,r>1?r=Math.floor(r):r<1&&(r=1/Math.ceil(1/r)),o=this.original_width*r/u,s=this.original_height*r/u,c=(n-o)/2,l=(t-s)/2,n=o,t=s):(c=(n-o)/2,n=o)):(s=n/h,e===5?(r=s*u/this.original_height,r>1?r=Math.floor(r):r<1&&(r=1/Math.ceil(1/r)),o=this.original_width*r/u,s=this.original_height*r/u,c=(n-o)/2,l=(t-s)/2,n=o,t=s):(l=(t-s)/2,t=s))):a&&e===0&&(c=Math.floor((n-this.original_width)/2),l=Math.floor((t-this.original_height)/2),n=this.original_width,t=this.original_height),e<2&&(this.aspect_scale=u),this.cssWidth=Math.round(n),this.cssHeight=Math.round(t),this.width=Math.round(n*u),this.height=Math.round(t*u),this.redraw=!0,this.wantFullscreenScalingQuality?(this.draw_width=this.width,this.draw_height=this.height,this.fullscreenScalingQuality=!0):this.width<this.original_width&&this.height<this.original_height||e===1?(this.draw_width=this.width,this.draw_height=this.height,this.fullscreenScalingQuality=!0):(this.draw_width=this.original_width,this.draw_height=this.original_height,this.fullscreenScalingQuality=!1,e===2?(h=this.original_width/this.original_height,f=this.lastWindowWidth/this.lastWindowHeight,f<h?this.draw_width=this.draw_height*f:f>h&&(this.draw_height=this.draw_width/f)):e===3&&(h=this.original_width/this.original_height,f=this.lastWindowWidth/this.lastWindowHeight,f>h?this.draw_width=this.draw_height*f:f<h&&(this.draw_height=this.draw_width/f))),this.canvasdiv&&!this.isDomFree&&(jQuery(this.canvasdiv).css({width:Math.round(n)+"px",height:Math.round(t)+"px","margin-left":Math.floor(c)+"px","margin-top":Math.floor(l)+"px"}),typeof cr_is_preview!="undefined"&&jQuery("#borderwrap").css({width:Math.round(n)+"px",height:Math.round(t)+"px"})),this.canvas&&(this.canvas.width=Math.round(n*u),this.canvas.height=Math.round(t*u),this.isEjecta?(this.canvas.style.left=Math.floor(c)+"px",this.canvas.style.top=Math.floor(l)+"px",this.canvas.style.width=Math.round(n)+"px",this.canvas.style.height=Math.round(t)+"px"):this.isRetina&&!this.isDomFree&&(this.canvas.style.width=Math.round(n)+"px",this.canvas.style.height=Math.round(t)+"px")),this.overlay_canvas&&(this.overlay_canvas.width=Math.round(n*u),this.overlay_canvas.height=Math.round(t*u),this.overlay_canvas.style.width=this.cssWidth+"px",this.overlay_canvas.style.height=this.cssHeight+"px"),this.glwrap&&this.glwrap.setSize(Math.round(n*u),Math.round(t*u)),this.isDirectCanvas&&this.ctx&&(this.ctx.width=Math.round(n),this.ctx.height=Math.round(t)),this.ctx&&this.setCtxImageSmoothingEnabled(this.ctx,this.linearSampling),this.tryLockOrientation(),this.isiPhone&&!this.isCordova&&window.scrollTo(0,0))};n.prototype.tryLockOrientation=function(){if(this.autoLockOrientation&&this.orientations!==0){var n="portrait";this.orientations===2&&(n="landscape");try{screen.orientation&&screen.orientation.lock?screen.orientation.lock(n).catch(function(){}):screen.lockOrientation?screen.lockOrientation(n):screen.webkitLockOrientation?screen.webkitLockOrientation(n):screen.mozLockOrientation?screen.mozLockOrientation(n):screen.msLockOrientation&&screen.msLockOrientation(n)}catch(t){console&&console.warn&&console.warn("Failed to lock orientation: ",t)}}};n.prototype.onContextLost=function(){this.glwrap.contextLost();this.is_WebGL_context_lost=!0;for(var t,n=0,i=this.types_by_index.length;n<i;n++)t=this.types_by_index[n],t.onLostWebGLContext&&t.onLostWebGLContext()};n.prototype.onContextRestored=function(){this.is_WebGL_context_lost=!1;for(var t,n=0,i=this.types_by_index.length;n<i;n++)t=this.types_by_index[n],t.onRestoreWebGLContext&&t.onRestoreWebGLContext()};n.prototype.positionOverlayCanvas=function(){if(!this.isDomFree){var t=(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||!!document.msFullscreenElement||this.isNodeFullscreen)&&!this.isCordova,n=t?jQuery(this.canvas).offset():jQuery(this.canvas).position();n.position="absolute";jQuery(this.overlay_canvas).css(n)}};g=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame||window.oCancelAnimationFrame;n.prototype.setSuspended=function(n){var t,i,r=this;if(n&&!this.isSuspended)for(cr.logexport("[Construct 2] Suspending"),this.isSuspended=!0,this.raf_id!==-1&&g&&g(this.raf_id),this.timeout_id!==-1&&clearTimeout(this.timeout_id),t=0,i=this.suspend_events.length;t<i;t++)this.suspend_events[t](!0);else if(!n&&this.isSuspended){for(cr.logexport("[Construct 2] Resuming"),this.isSuspended=!1,this.last_tick_time=cr.performance_now(),this.last_fps_time=cr.performance_now(),this.framecount=0,this.logictime=0,t=0,i=this.suspend_events.length;t<i;t++)this.suspend_events[t](!1);this.tick(!1)}};n.prototype.addSuspendCallback=function(n){this.suspend_events.push(n)};n.prototype.GetObjectReference=function(n){return this.objectRefTable[n]};n.prototype.loadProject=function(n){var r,k,tt,it,rt,ut,ft,et,ot,st,ht,ct,lt,at,i,e,u,s,a,d,f,g,c,v,vt,h,kt,t,yt,o,y,l,nt,pt,wt,bt,p,w,b;for(n&&n.project||cr.logerror("Project model unavailable"),r=n.project,this.name=r[0],this.first_layout=r[1],this.fullscreen_mode=r[12],this.fullscreen_mode_set=r[12],this.original_width=r[10],this.original_height=r[11],this.parallax_x_origin=this.original_width/2,this.parallax_y_origin=this.original_height/2,this.isDomFree&&!this.isEjecta&&(r[12]>=4||r[12]===0)&&(cr.logexport("[Construct 2] Letterbox scale fullscreen modes are not supported on this platform - falling back to 'Scale outer'"),this.fullscreen_mode=3,this.fullscreen_mode_set=3),this.uses_loader_layout=r[18],this.loaderstyle=r[19],this.loaderstyle===0?(k=new Image,k.crossOrigin="anonymous",this.setImageSrc(k,"loading-logo.png"),this.loaderlogos={logo:k}):this.loaderstyle===4&&(tt=new Image,tt.src="",it=new Image,it.src="",rt=new Image,rt.src="",ut=new Image,ut.src="",ft=new Image,ft.src="",et=new Image,et.src="",ot=new Image,ot.src="",st=new Image,st.src="",ht=new Image,ht.src="",ct=new Image,ct.src="",lt=new Image,lt.src="",at=new Image,at.src="",this.loaderlogos={logo:[tt,it,rt,ut],powered:[ft,et,ot,st],website:[ht,ct,lt,at]}),this.next_uid=r[21],this.objectRefTable=cr.getObjectRefTable(),this.system=new cr.system_object(this),i=0,e=r[2].length;i<e;i++)f=r[2][i],vt=this.GetObjectReference(f[0]),cr.add_common_aces(f,vt.prototype),h=new vt(this),h.singleglobal=f[1],h.is_world=f[2],h.is_rotatable=f[5],h.must_predraw=f[9],h.onCreate&&h.onCreate(),cr.seal(h),this.plugins.push(h);for(this.objectRefTable=cr.getObjectRefTable(),i=0,e=r[3].length;i<e;i++){for(f=r[3][i],kt=this.GetObjectReference(f[1]),h=null,u=0,s=this.plugins.length;u<s;u++)if(this.plugins[u]instanceof kt){h=this.plugins[u];break}for(t=new h.Type(h),t.name=f[0],t.is_family=f[2],t.instvar_sids=f[3].slice(0),t.vars_count=f[3].length,t.behs_count=f[4],t.fx_count=f[5],t.sid=f[11],t.is_family?(t.members=[],t.family_index=this.family_count++,t.families=null):(t.members=null,t.family_index=-1,t.families=[]),t.family_var_map=null,t.family_beh_map=null,t.family_fx_map=null,t.is_contained=!1,t.container=null,f[6]?(t.texture_file=f[6][0],t.texture_filesize=f[6][1],t.texture_pixelformat=f[6][2]):(t.texture_file=null,t.texture_filesize=0,t.texture_pixelformat=0),t.animations=f[7]?f[7]:null,t.index=i,t.instances=[],t.deadCache=[],t.solstack=[new cr.selection(t)],t.cur_sol=0,t.default_instance=null,t.default_layerindex=0,t.stale_iids=!0,t.updateIIDs=cr.type_updateIIDs,t.getFirstPicked=cr.type_getFirstPicked,t.getPairedInstance=cr.type_getPairedInstance,t.getCurrentSol=cr.type_getCurrentSol,t.pushCleanSol=cr.type_pushCleanSol,t.pushCopySol=cr.type_pushCopySol,t.popSol=cr.type_popSol,t.getBehaviorByName=cr.type_getBehaviorByName,t.getBehaviorIndexByName=cr.type_getBehaviorIndexByName,t.getEffectIndexByName=cr.type_getEffectIndexByName,t.applySolToContainer=cr.type_applySolToContainer,t.getInstanceByIID=cr.type_getInstanceByIID,t.collision_grid=new cr.SparseGrid(this.original_width,this.original_height),t.any_cell_changed=!0,t.any_instance_parallaxed=!1,t.extra={},t.toString=cr.type_toString,t.behaviors=[],u=0,s=f[8].length;u<s;u++){for(g=f[8][u],yt=this.GetObjectReference(g[1]),o=null,a=0,d=this.behaviors.length;a<d;a++)if(this.behaviors[a]instanceof yt){o=this.behaviors[a];break}o||(o=new yt(this),o.my_types=[],o.my_instances=new cr.ObjectSet,o.onCreate&&o.onCreate(),cr.seal(o),this.behaviors.push(o),cr.behaviors.solid&&o instanceof cr.behaviors.solid&&(this.solidBehavior=o),cr.behaviors.jumpthru&&o instanceof cr.behaviors.jumpthru&&(this.jumpthruBehavior=o),cr.behaviors.shadowcaster&&o instanceof cr.behaviors.shadowcaster&&(this.shadowcasterBehavior=o));o.my_types.indexOf(t)===-1&&o.my_types.push(t);y=new o.Type(o,t);y.name=g[0];y.sid=g[2];y.onCreate();cr.seal(y);t.behaviors.push(y)}for(t.global=f[9],t.isOnLoaderLayout=f[10],t.effect_types=[],u=0,s=f[12].length;u<s;u++)t.effect_types.push({id:f[12][u][0],name:f[12][u][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:u});t.tile_poly_data=f[13];(!this.uses_loader_layout||t.is_family||t.isOnLoaderLayout||!h.is_world)&&(t.onCreate(),cr.seal(t));t.name&&(this.types[t.name]=t);this.types_by_index.push(t);h.singleglobal&&(l=new h.Instance(t),l.uid=this.next_uid++,l.puid=this.next_puid++,l.iid=0,l.get_iid=cr.inst_get_iid,l.toString=cr.inst_toString,l.properties=f[14],l.onCreate(),cr.seal(l),t.instances.push(l),this.objectsByUid[l.uid.toString()]=l)}for(i=0,e=r[4].length;i<e;i++)for(nt=r[4][i],pt=this.types_by_index[nt[0]],u=1,s=nt.length;u<s;u++)wt=this.types_by_index[nt[u]],wt.families.push(pt),pt.members.push(wt);for(i=0,e=r[28].length;i<e;i++){for(bt=r[28][i],p=[],u=0,s=bt.length;u<s;u++)p.push(this.types_by_index[bt[u]]);for(u=0,s=p.length;u<s;u++)p[u].is_contained=!0,p[u].container=p}if(this.family_count>0)for(i=0,e=this.types_by_index.length;i<e;i++)if(c=this.types_by_index[i],!c.is_family&&c.families.length){c.family_var_map=new Array(this.family_count);c.family_beh_map=new Array(this.family_count);c.family_fx_map=new Array(this.family_count);var dt=[],gt=0,ni=0,ti=0;for(u=0,s=c.families.length;u<s;u++)for(v=c.families[u],c.family_var_map[v.family_index]=gt,gt+=v.vars_count,c.family_beh_map[v.family_index]=ni,ni+=v.behs_count,c.family_fx_map[v.family_index]=ti,ti+=v.fx_count,a=0,d=v.effect_types.length;a<d;a++)dt.push(cr.shallowCopy({},v.effect_types[a]));for(c.effect_types=dt.concat(c.effect_types),u=0,s=c.effect_types.length;u<s;u++)c.effect_types[u].index=u}for(i=0,e=r[5].length;i<e;i++)f=r[5][i],w=new cr.layout(this,f),cr.seal(w),this.layouts[w.name]=w,this.layouts_by_index.push(w);for(i=0,e=r[6].length;i<e;i++)f=r[6][i],b=new cr.eventsheet(this,f),cr.seal(b),this.eventsheets[b.name]=b,this.eventsheets_by_index.push(b);for(i=0,e=this.eventsheets_by_index.length;i<e;i++)this.eventsheets_by_index[i].postInit();for(i=0,e=this.eventsheets_by_index.length;i<e;i++)this.eventsheets_by_index[i].updateDeepIncludes();for(i=0,e=this.triggers_to_postinit.length;i<e;i++)this.triggers_to_postinit[i].postInit();cr.clearArray(this.triggers_to_postinit);this.audio_to_preload=r[7];this.files_subfolder=r[8];this.pixel_rounding=r[9];this.aspect_scale=1;this.enableWebGL=r[13];this.linearSampling=r[14];this.clearBackground=r[15];this.versionstr=r[16];this.useHighDpi=r[17];this.orientations=r[20];this.autoLockOrientation=this.orientations>0;this.pauseOnBlur=r[22];this.wantFullscreenScalingQuality=r[23];this.fullscreenScalingQuality=this.wantFullscreenScalingQuality;this.downscalingQuality=r[24];this.preloadSounds=r[25];this.projectName=r[26];this.enableFrontToBack=r[27]&&!this.isIE;this.start_time=Date.now();cr.clearArray(this.objectRefTable);this.initRendererAndLoader()};var o=!1,yt=100,nt=0,tt=[];n.prototype.queueImageLoad=function(n,t){var r=this,i=function(){nt--;r.maybeLoadNextImages()};n.addEventListener("load",i);n.addEventListener("error",i);tt.push([n,t]);this.maybeLoadNextImages()};n.prototype.maybeLoadNextImages=function(){for(var n;tt.length&&nt<yt;)nt++,n=tt.shift(),this.setImageSrc(n[0],n[1])};n.prototype.waitForImageLoad=function(n,t){n.cocoonLazyLoad=!0;n.onerror=function(t){n.c2error=!0;o=!0;console&&console.error&&console.error("Error loading image '"+n.src+"': ",t)};this.isEjecta?n.src=t:n.src||(typeof XAPKReader!="undefined"?XAPKReader.get(t,function(t){n.src=t},function(i){n.c2error=!0;o=!0;console&&console.error&&console.error("Error extracting image '"+t+"' from expansion file: ",i)}):(n.crossOrigin="anonymous",this.queueImageLoad(n,t)));this.wait_for_textures.push(n)};n.prototype.findWaitingTexture=function(n){for(var t=0,i=this.wait_for_textures.length;t<i;t++)if(this.wait_for_textures[t].cr_src===n)return this.wait_for_textures[t];return null};a=0;it=!1;n.prototype.getready=function(){this.audioInstance&&(a=this.audioInstance.setPreloadList(this.audio_to_preload))};n.prototype.areAllTexturesAndSoundsLoaded=function(){for(var u=a,f=0,e=0,i=!0,n,t,s,r=0,o=this.wait_for_textures.length;r<o;r++)n=this.wait_for_textures[r],t=n.cr_filesize,(!t||t<=0)&&(t=5e4),u+=t,!n.src||!(n.complete||n.loaded)||n.c2error?i=!1:f+=t;return i&&this.preloadSounds&&this.audioInstance&&(it||(this.audioInstance.startPreloads(),it=!0),e=this.audioInstance.getPreloadedSize(),f+=e,e<a&&(i=!1)),this.progress=u==0?1:f/u,this.progress==1&&(loaderChecker+=1,loaderChecker>=2&&(s=document.getElementById("loader-btn"),s.style.display="none")),i};v=!1;n.prototype.go=function(){var n,s,h,f,p,e;if(this.ctx||this.glwrap)if(n=this.ctx||this.overlay_ctx,this.overlay_canvas&&this.positionOverlayCanvas(),s=window.innerWidth,h=window.innerHeight,(this.lastWindowWidth!==s||this.lastWindowHeight!==h)&&this.setSize(s,h),this.progress=0,this.last_progress=-1,f=this,this.areAllTexturesAndSoundsLoaded()&&(this.loaderstyle!==4||v))this.go_loading_finished();else{if(p=Date.now()-this.start_time,n){var w=this.width,b=this.height,t=this.devicePixelRatio;if(this.loaderstyle<3&&(this.isCocoonJs||p>=500&&this.last_progress!=this.progress)){n.clearRect(0,0,w,b);var i=w/2,r=b/2,k=this.loaderstyle===0&&this.loaderlogos.logo.complete,c=40*t,a=0,u=80*t,y;if(k&&(e=this.loaderlogos.logo,u=e.width*t,y=e.height*t,c=u/2,a=y/2,n.drawImage(e,cr.floor(i-c),cr.floor(r-a),u,y)),this.loaderstyle<=1)r+=a+(k?12*t:0),i-=c,i=cr.floor(i)+.5,r=cr.floor(r)+.5,n.fillStyle=o?"red":"DodgerBlue",n.fillRect(i,r,Math.floor(u*this.progress),6*t),n.strokeStyle="black",n.strokeRect(i,r,u,6*t),n.strokeStyle="white",n.strokeRect(i-1*t,r-1*t,u+2*t,8*t);else if(this.loaderstyle===2){n.font=this.isEjecta?"12pt ArialMT":"12pt Arial";n.fillStyle=o?"#f00":"#999";n.textBaseLine="middle";var d=Math.round(this.progress*100)+"%",g=n.measureText?n.measureText(d):null,nt=g?g.width:0;n.fillText(d,i-nt/2,r)}this.last_progress=this.progress}else if(this.loaderstyle===4){this.draw_c2_splash_loader(n);l?l(function(){f.go()}):setTimeout(function(){f.go()},16);return}}setTimeout(function(){f.go()},this.isCocoonJs?10:100)}};var h=-1,ot=300,st=300,pt=typeof cr_is_preview=="undefined"?200:0,e=!0,s=!1,ht=0,rt=0,wt=typeof cr_is_preview=="undefined"?3e3:0,f=null,ut=null,c=0;n.prototype.draw_c2_splash_loader=function(n){var p;if(!v){var u=Math.ceil(this.width),r=Math.ceil(this.height),g=this.devicePixelRatio,w=this.loaderlogos.logo,b=this.loaderlogos.powered,k=this.loaderlogos.website;for(p=0;p<4;++p)if(!w[p].complete||!b[p].complete||!k[p].complete)return;c===0&&(h=Date.now());var a=Date.now(),d=!1,l=n,t,i;e||s?(n.clearRect(0,0,u,r),bt(u,r),l=ut,d=!0,e&&c===1&&(h=Date.now())):n.globalAlpha=1;l.fillStyle="#333333";l.fillRect(0,0,u,r);this.cssHeight>256?(t=cr.clamp(r*.22,105,u*.6),i=t*.25,l.drawImage(y(b,t),u*.5-t/2,r*.2-i/2,t,i),t=Math.min(r*.395,u*.95),i=t,l.drawImage(y(w,t),u*.5-t/2,r*.485-i/2,t,i),t=cr.clamp(r*.22,105,u*.6),i=t*.25,l.drawImage(y(k,t),u*.5-t/2,r*.868-i/2,t,i),l.fillStyle="#3C3C3C",t=u,i=Math.max(r*.005,2),l.fillRect(0,r*.8-i/2,t,i),l.fillStyle=o?"red":"#E0FF65",t=u*this.progress,l.fillRect(u*.5-t/2,r*.8-i/2,t,i)):(t=r*.55,i=t,l.drawImage(y(w,t),u*.5-t/2,r*.45-i/2,t,i),l.fillStyle="#3C3C3C",t=u,i=Math.max(r*.005,2),l.fillRect(0,r*.85-i/2,t,i),l.fillStyle=o?"red":"#E0FF65",t=u*this.progress,l.fillRect(u*.5-t/2,r*.85-i/2,t,i));d&&(e?n.globalAlpha=c===0?0:Math.min((a-h)/ot,1):s&&(n.globalAlpha=Math.max(1-(a-rt)/st,0)),n.drawImage(f,0,0,u,r));e&&a-h>=ot&&c>=2&&(e=!1,ht=a);!e&&a-ht>=wt&&!s&&this.progress>=1&&(s=!0,rt=a);(s&&a-rt>=st+pt||typeof cr_is_preview!="undefined"&&this.progress>=1&&Date.now()-h<500)&&(v=!0,e=!1,s=!1,f=null,ut=null,this.loaderlogos=null);++c}};n.prototype.go_loading_finished=function(){var n,i,t,r,u;if(this.overlay_canvas&&(this.canvas.parentNode.removeChild(this.overlay_canvas),this.overlay_ctx=null,this.overlay_canvas=null),this.start_time=Date.now(),this.last_fps_time=cr.performance_now(),this.uses_loader_layout)for(n=0,i=this.types_by_index.length;n<i;n++)t=this.types_by_index[n],t.is_family||t.isOnLoaderLayout||!t.plugin.is_world||(t.onCreate(),cr.seal(t));else this.isloading=!1;for(n=0,i=this.layouts_by_index.length;n<i;n++)this.layouts_by_index[n].createGlobalNonWorlds();for(this.fullscreen_mode>=2&&(r=this.original_width/this.original_height,u=this.width/this.height,this.aspect_scale=this.fullscreen_mode!==2&&u>r||this.fullscreen_mode===2&&u<r?this.height/this.original_height:this.width/this.original_width),this.first_layout?this.layouts[this.first_layout].startRunning():this.layouts_by_index[0].startRunning(),this.uses_loader_layout||(this.loadingprogress=1,this.trigger(cr.system_object.prototype.cnds.OnLoadFinished,null),window.C2_RegisterSW&&window.C2_RegisterSW()),navigator.splashscreen&&navigator.splashscreen.hide&&navigator.splashscreen.hide(),n=0,i=this.types_by_index.length;n<i;n++)t=this.types_by_index[n],t.onAppBegin&&t.onAppBegin();document.hidden||document.webkitHidden||document.mozHidden||document.msHidden?window.cr_setSuspended(!0):this.tick(!1);this.isDirectCanvas&&AppMobi.webview.execute("onGameReady();")};n.prototype.tick=function(n,t,i){var r,e,u,f,h;if(this.running_layout&&(r=cr.performance_now(),e=r,i||!this.isSuspended||n)){n||(l?this.raf_id=l(this.tickFunc):this.timeout_id=setTimeout(this.tickFunc,this.isMobile?1:16));var c=t||r,o=this.fullscreen_mode,s=(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||!!document.msFullscreenElement)&&!this.isCordova;(s||this.isNodeFullscreen)&&this.fullscreen_scaling>0&&(o=this.fullscreen_scaling);o>0&&(u=window.innerWidth,f=window.innerHeight,(this.lastWindowWidth!==u||this.lastWindowHeight!==f)&&this.setSize(u,f));this.isDomFree||(s?this.firstInFullscreen||(this.firstInFullscreen=!0):this.firstInFullscreen?(this.firstInFullscreen=!1,this.fullscreen_mode===0&&this.setSize(Math.round(this.oldWidth/this.devicePixelRatio),Math.round(this.oldHeight/this.devicePixelRatio),!0)):(this.oldWidth=this.width,this.oldHeight=this.height));this.isloading&&(h=this.areAllTexturesAndSoundsLoaded(),this.loadingprogress=this.progress,h&&(this.isloading=!1,this.progress=1,this.trigger(cr.system_object.prototype.cnds.OnLoadFinished,null),window.C2_RegisterSW&&window.C2_RegisterSW()));this.logic(c);!(this.redraw||this.isCocoonJs)||this.is_WebGL_context_lost||this.suspendDrawing||n||(this.redraw=!1,this.glwrap?this.drawGL():this.draw(),this.snapshotCanvas&&(this.canvas&&this.canvas.toDataURL&&(this.snapshotData=this.canvas.toDataURL(this.snapshotCanvas[0],this.snapshotCanvas[1]),window.cr_onSnapshot&&window.cr_onSnapshot(this.snapshotData),this.trigger(cr.system_object.prototype.cnds.OnCanvasSnapshot,null)),this.snapshotCanvas=null));this.hit_breakpoint||(this.tickcount++,this.tickcount_nosave++,this.execcount++,this.framecount++);this.logictime+=cr.performance_now()-e}};n.prototype.logic=function(n){var t,r,u,s,f,h,i,c,l,a,v,o,e;if(n-this.last_fps_time>=1e3&&(this.last_fps_time+=1e3,n-this.last_fps_time>=1e3&&(this.last_fps_time=n),this.fps=this.framecount,this.framecount=0,this.cpuutilisation=this.logictime,this.logictime=0),l=0,this.last_tick_time!==0&&(a=n-this.last_tick_time,a<0&&(a=0),l=a/1e3,this.dt1=l,this.dt1>.5?this.dt1=0:this.dt1>1/this.minimumFramerate&&(this.dt1=1/this.minimumFramerate)),this.last_tick_time=n,this.dt=this.dt1*this.timescale,this.kahanTime.add(this.dt),this.wallTime.add(l),v=(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||!!document.msFullscreenElement||this.isNodeFullscreen)&&!this.isCordova,this.fullscreen_mode>=2||v&&this.fullscreen_scaling>0){var p=this.original_width/this.original_height,w=this.width/this.height,y=this.fullscreen_mode;v&&this.fullscreen_scaling>0&&(y=this.fullscreen_scaling);this.aspect_scale=y!==2&&w>p||y===2&&w<p?this.height/this.original_height:this.width/this.original_width;this.running_layout&&(this.running_layout.scrollToX(this.running_layout.scrollX),this.running_layout.scrollToY(this.running_layout.scrollY))}else this.aspect_scale=this.isRetina?this.devicePixelRatio:1;for(this.ClearDeathRow(),this.isInOnDestroy++,this.system.runWaits(),this.isInOnDestroy--,this.ClearDeathRow(),this.isInOnDestroy++,o=this.objects_to_pretick.valuesRef(),t=0,r=o.length;t<r;t++)o[t].pretick();for(t=0,r=this.types_by_index.length;t<r;t++)if(i=this.types_by_index[t],!i.is_family&&(i.behaviors.length||i.families.length))for(u=0,s=i.instances.length;u<s;u++)for(e=i.instances[u],f=0,h=e.behavior_insts.length;f<h;f++)e.behavior_insts[f].tick();for(t=0,r=this.types_by_index.length;t<r;t++)if(i=this.types_by_index[t],!i.is_family&&(i.behaviors.length||i.families.length))for(u=0,s=i.instances.length;u<s;u++)for(e=i.instances[u],f=0,h=e.behavior_insts.length;f<h;f++)c=e.behavior_insts[f],c.posttick&&c.posttick();for(o=this.objects_to_tick.valuesRef(),t=0,r=o.length;t<r;t++)o[t].tick();for(this.isInOnDestroy--,this.handleSaveLoad(),t=0;this.changelayout&&t++<10;)this.doChangeLayout(this.changelayout);for(t=0,r=this.eventsheets_by_index.length;t<r;t++)this.eventsheets_by_index[t].hasRun=!1;for(this.running_layout.event_sheet&&this.running_layout.event_sheet.run(),cr.clearArray(this.registered_collisions),this.layout_first_tick=!1,this.isInOnDestroy++,t=0,r=this.types_by_index.length;t<r;t++)if(i=this.types_by_index[t],!i.is_family&&(i.behaviors.length||i.families.length))for(u=0,s=i.instances.length;u<s;u++)for(e=i.instances[u],f=0,h=e.behavior_insts.length;f<h;f++)c=e.behavior_insts[f],c.tick2&&c.tick2();for(o=this.objects_to_tick2.valuesRef(),t=0,r=o.length;t<r;t++)o[t].tick2();this.isInOnDestroy--};n.prototype.onWindowBlur=function(){for(var i,o,r,s,u,n,f,t=0,e=this.types_by_index.length;t<e;t++)if(u=this.types_by_index[t],!u.is_family)for(i=0,o=u.instances.length;i<o;i++)if(n=u.instances[i],n.onWindowBlur&&n.onWindowBlur(),n.behavior_insts)for(r=0,s=n.behavior_insts.length;r<s;r++)f=n.behavior_insts[r],f.onWindowBlur&&f.onWindowBlur()};n.prototype.doChangeLayout=function(n){var u=this.running_layout,i,r,t;if(this.running_layout.stopRunning(),this.glwrap)for(i=0,r=this.types_by_index.length;i<r;i++)(t=this.types_by_index[i],t.is_family)||t.unloadTextures&&(!t.global||t.instances.length===0)&&n.initial_types.indexOf(t)===-1&&t.unloadTextures();u==n&&cr.clearArray(this.system.waits);cr.clearArray(this.registered_collisions);this.runLayoutChangeMethods(!0);n.startRunning();this.runLayoutChangeMethods(!1);this.redraw=!0;this.layout_first_tick=!0;this.ClearDeathRow()};n.prototype.runLayoutChangeMethods=function(n){for(var r,u,o,h,i,s,c,f,t=0,e=this.behaviors.length;t<e;t++)r=this.behaviors[t],n?r.onBeforeLayoutChange&&r.onBeforeLayoutChange():r.onLayoutChange&&r.onLayoutChange();for(t=0,e=this.types_by_index.length;t<e;t++)if(u=this.types_by_index[t],u.global||u.plugin.singleglobal)for(o=0,h=u.instances.length;o<h;o++)if(i=u.instances[o],n?i.onBeforeLayoutChange&&i.onBeforeLayoutChange():i.onLayoutChange&&i.onLayoutChange(),i.behavior_insts)for(s=0,c=i.behavior_insts.length;s<c;s++)f=i.behavior_insts[s],n?f.onBeforeLayoutChange&&f.onBeforeLayoutChange():f.onLayoutChange&&f.onLayoutChange()};n.prototype.pretickMe=function(n){this.objects_to_pretick.add(n)};n.prototype.unpretickMe=function(n){this.objects_to_pretick.remove(n)};n.prototype.tickMe=function(n){this.objects_to_tick.add(n)};n.prototype.untickMe=function(n){this.objects_to_tick.remove(n)};n.prototype.tick2Me=function(n){this.objects_to_tick2.add(n)};n.prototype.untick2Me=function(n){this.objects_to_tick2.remove(n)};n.prototype.getDt=function(n){return!n||n.my_timescale===-1?this.dt:this.dt1*n.my_timescale};n.prototype.draw=function(){this.running_layout.draw(this.ctx);this.isDirectCanvas&&this.ctx.present()};n.prototype.drawGL=function(){this.enableFrontToBack&&(this.earlyz_index=1,this.running_layout.drawGL_earlyZPass(this.glwrap));this.running_layout.drawGL(this.glwrap);this.glwrap.present()};n.prototype.addDestroyCallback=function(n){n&&this.destroycallbacks.push(n)};n.prototype.removeDestroyCallback=function(n){cr.arrayFindRemove(this.destroycallbacks,n)};n.prototype.getObjectByUID=function(n){var t=n.toString();return this.objectsByUid.hasOwnProperty(t)?this.objectsByUid[t]:null};p=[];n.prototype.DestroyInstance=function(n){var i,u,f=n.type,r=f.name,e=this.deathRow.hasOwnProperty(r),t=null;if(e){if(t=this.deathRow[r],t.contains(n))return}else t=kt(),this.deathRow[r]=t;if(t.add(n),this.hasPendingInstances=!0,n.is_contained)for(i=0,u=n.siblings.length;i<u;i++)this.DestroyInstance(n.siblings[i]);this.isInClearDeathRow&&t.values_cache.push(n);this.isEndingLayout||(this.isInOnDestroy++,this.trigger(Object.getPrototypeOf(n.type.plugin).cnds.OnDestroyed,n),this.isInOnDestroy--)};n.prototype.ClearDeathRow=function(){if(this.hasPendingInstances){var i,n,r,t,u,f;for(this.isInClearDeathRow=!0,r=0,u=this.createRow.length;r<u;++r)for(i=this.createRow[r],n=i.type,n.instances.push(i),t=0,f=n.families.length;t<f;++t)n.families[t].instances.push(i),n.families[t].stale_iids=!0;cr.clearArray(this.createRow);this.IterateDeathRow();cr.wipe(this.deathRow);this.isInClearDeathRow=!1;this.hasPendingInstances=!1}};n.prototype.IterateDeathRow=function(){for(var n in this.deathRow)this.deathRow.hasOwnProperty(n)&&this.ClearDeathRowForType(this.deathRow[n])};n.prototype.ClearDeathRowForType=function(n){var s=n.valuesRef(),i=s[0].type,t,u,h,l,o,f,c,e,r;for(cr.arrayRemoveAllFromObjectSet(i.instances,n),i.stale_iids=!0,i.instances.length===0&&(i.any_instance_parallaxed=!1),t=0,u=i.families.length;t<u;++t)f=i.families[t],cr.arrayRemoveAllFromObjectSet(f.instances,n),f.stale_iids=!0;for(t=0,u=this.system.waits.length;t<u;++t)if(o=this.system.waits[t],o.sols.hasOwnProperty(i.index)&&cr.arrayRemoveAllFromObjectSet(o.sols[i.index].insts,n),!i.is_family)for(h=0,l=i.families.length;h<l;++h)f=i.families[h],o.sols.hasOwnProperty(f.index)&&cr.arrayRemoveAllFromObjectSet(o.sols[f.index].insts,n);if(r=s[0].layer,r){if(r.useRenderCells)for(c=r.instances,t=0,u=c.length;t<u;++t)(e=c[t],n.contains(e))&&(e.update_bbox(),r.render_grid.update(e,e.rendercells,null),e.rendercells.set(0,0,-1,-1));cr.arrayRemoveAllFromObjectSet(r.instances,n);r.setZIndicesStaleFrom(0)}for(t=0;t<s.length;++t)this.ClearDeathRowForSingleInstance(s[t],i);dt(n);this.redraw=!0};n.prototype.ClearDeathRowForSingleInstance=function(n,t){for(var u,f,i=0,r=this.destroycallbacks.length;i<r;++i)this.destroycallbacks[i](n);if(n.collcells&&t.collision_grid.update(n,n.collcells,null),f=n.layer,f&&f.removeFromInstanceList(n,!0),n.behavior_insts)for(i=0,r=n.behavior_insts.length;i<r;++i)u=n.behavior_insts[i],u.onDestroy&&u.onDestroy(),u.behavior.my_instances.remove(n);this.objects_to_pretick.remove(n);this.objects_to_tick.remove(n);this.objects_to_tick2.remove(n);n.onDestroy&&n.onDestroy();this.objectsByUid.hasOwnProperty(n.uid.toString())&&delete this.objectsByUid[n.uid.toString()];this.objectcount--;t.deadCache.length<100&&t.deadCache.push(n)};n.prototype.createInstance=function(n,t,i,r){if(n.is_family){var u=cr.floor(Math.random()*n.members.length);return this.createInstance(n.members[u],t,i,r)}return n.default_instance?this.createInstanceFromInit(n.default_instance,t,!1,i,r,!1):null};u=[];n.prototype.createInstanceFromInit=function(n,t,i,r,f,e){var s,h,a,k,d,c,p,g,o,w,l,b,y,v;if(!n||(c=this.types_by_index[n[1]],p=c.plugin.is_world,this.isloading&&p&&!c.isOnLoaderLayout)||p&&!this.glwrap&&n[0][11]===11)return null;for(g=t,p||(t=null),c.deadCache.length?(o=c.deadCache.pop(),o.recycled=!0,c.plugin.Instance.call(o,c)):(o=new c.plugin.Instance(c),o.recycled=!1),o.uid=!i||e||this.objectsByUid.hasOwnProperty(n[2].toString())?this.next_uid++:n[2],this.objectsByUid[o.uid.toString()]=o,o.puid=this.next_puid++,o.iid=c.instances.length,s=0,h=this.createRow.length;s<h;++s)this.createRow[s].type===c&&o.iid++;if(o.get_iid=cr.inst_get_iid,o.toString=cr.inst_toString,w=n[3],o.recycled)cr.wipe(o.extra);else{if(o.extra={},typeof cr_is_preview!="undefined")for(o.instance_var_names=[],o.instance_var_names.length=w.length,s=0,h=w.length;s<h;s++)o.instance_var_names[s]=w[s][1];o.instance_vars=[];o.instance_vars.length=w.length}for(s=0,h=w.length;s<h;s++)o.instance_vars[s]=w[s][0];if(p){if(l=n[0],o.x=cr.is_undefined(r)?l[0]:r,o.y=cr.is_undefined(f)?l[1]:f,o.z=l[2],o.width=l[3],o.height=l[4],o.depth=l[5],o.angle=l[6],o.opacity=l[7],o.hotspotX=l[8],o.hotspotY=l[9],o.blend_mode=l[10],d=l[11],!this.glwrap&&c.effect_types.length&&(o.blend_mode=d),o.compositeOp=cr.effectToCompositeOp(o.blend_mode),this.gl&&cr.setGLBlend(o,o.blend_mode,this.gl),o.recycled){for(s=0,h=l[12].length;s<h;s++)for(a=0,k=l[12][s].length;a<k;a++)o.effect_params[s][a]=l[12][s][a];o.bbox.set(0,0,0,0);o.collcells.set(0,0,-1,-1);o.rendercells.set(0,0,-1,-1);o.bquad.set_from_rect(o.bbox);cr.clearArray(o.bbox_changed_callbacks)}else{for(o.effect_params=l[12].slice(0),s=0,h=o.effect_params.length;s<h;s++)o.effect_params[s]=l[12][s].slice(0);o.active_effect_types=[];o.active_effect_flags=[];o.active_effect_flags.length=c.effect_types.length;o.bbox=new cr.rect(0,0,0,0);o.collcells=new cr.rect(0,0,-1,-1);o.rendercells=new cr.rect(0,0,-1,-1);o.bquad=new cr.quad;o.bbox_changed_callbacks=[];o.set_bbox_changed=cr.set_bbox_changed;o.add_bbox_changed_callback=cr.add_bbox_changed_callback;o.contains_pt=cr.inst_contains_pt;o.update_bbox=cr.update_bbox;o.update_render_cell=cr.update_render_cell;o.update_collision_cell=cr.update_collision_cell;o.get_zindex=cr.inst_get_zindex}for(o.tilemap_exists=!1,o.tilemap_width=0,o.tilemap_height=0,o.tilemap_data=null,l.length===14&&(o.tilemap_exists=!0,o.tilemap_width=l[13][0],o.tilemap_height=l[13][1],o.tilemap_data=l[13][2]),s=0,h=c.effect_types.length;s<h;s++)o.active_effect_flags[s]=!0;o.shaders_preserve_opaqueness=!0;o.updateActiveEffects=cr.inst_updateActiveEffects;o.updateActiveEffects();o.uses_shaders=!!o.active_effect_types.length;o.bbox_changed=!0;o.cell_changed=!0;c.any_cell_changed=!0;o.visible=!0;o.my_timescale=-1;o.layer=t;o.zindex=t.instances.length;o.earlyz_index=0;typeof o.collision_poly=="undefined"&&(o.collision_poly=null);o.collisionsEnabled=!0;this.redraw=!0}for(cr.clearArray(u),s=0,h=c.families.length;s<h;s++)u.push.apply(u,c.families[s].behaviors);if(u.push.apply(u,c.behaviors),o.recycled)for(s=0,h=u.length;s<h;s++){for(y=u[s],v=o.behavior_insts[s],v.recycled=!0,y.behavior.Instance.call(v,y,o),b=n[4][s],a=0,k=b.length;a<k;a++)v.properties[a]=b[a];v.onCreate();y.behavior.my_instances.add(o)}else for(o.behavior_insts=[],s=0,h=u.length;s<h;s++)y=u[s],v=new y.behavior.Instance(y,o),v.recycled=!1,v.properties=n[4][s].slice(0),v.onCreate(),cr.seal(v),o.behavior_insts.push(v),y.behavior.my_instances.add(o);if(b=n[5],o.recycled)for(s=0,h=b.length;s<h;s++)o.properties[s]=b[s];else o.properties=b.slice(0);if(this.createRow.push(o),this.hasPendingInstances=!0,t&&(t.appendToInstanceList(o,!0),(t.parallaxX!==1||t.parallaxY!==1)&&(c.any_instance_parallaxed=!0)),this.objectcount++,c.is_contained){if(o.is_contained=!0,o.recycled?cr.clearArray(o.siblings):o.siblings=[],!i&&!e){for(s=0,h=c.container.length;s<h;s++)if(c.container[s]!==c){if(!c.container[s].default_instance)return null;o.siblings.push(this.createInstanceFromInit(c.container[s].default_instance,g,!1,p?o.x:r,p?o.y:f,!0))}for(s=0,h=o.siblings.length;s<h;s++)for(o.siblings[s].siblings.push(o),a=0;a<h;a++)s!==a&&o.siblings[s].siblings.push(o.siblings[a])}}else o.is_contained=!1,o.siblings=null;for(o.onCreate(),o.recycled||cr.seal(o),s=0,h=o.behavior_insts.length;s<h;s++)o.behavior_insts[s].postCreate&&o.behavior_insts[s].postCreate();return o};n.prototype.getLayerByName=function(n){for(var i,t=0,r=this.running_layout.layers.length;t<r;t++)if(i=this.running_layout.layers[t],cr.equals_nocase(i.name,n))return i;return null};n.prototype.getLayerByNumber=function(n){return n=cr.floor(n),n<0&&(n=0),n>=this.running_layout.layers.length&&(n=this.running_layout.layers.length-1),this.running_layout.layers[n]};n.prototype.getLayer=function(n){return cr.is_number(n)?this.getLayerByNumber(n):this.getLayerByName(n.toString())};n.prototype.clearSol=function(n){for(var t=0,i=n.length;t<i;t++)n[t].getCurrentSol().select_all=!0};n.prototype.pushCleanSol=function(n){for(var t=0,i=n.length;t<i;t++)n[t].pushCleanSol()};n.prototype.pushCopySol=function(n){for(var t=0,i=n.length;t<i;t++)n[t].pushCopySol()};n.prototype.popSol=function(n){for(var t=0,i=n.length;t<i;t++)n[t].popSol()};n.prototype.updateAllCells=function(n){var t,i,u,r;if(n.any_cell_changed){for(u=n.instances,t=0,i=u.length;t<i;++t)u[t].update_collision_cell();for(r=this.createRow,t=0,i=r.length;t<i;++t)r[t].type===n&&r[t].update_collision_cell();n.any_cell_changed=!1}};n.prototype.getCollisionCandidates=function(n,t,i,r){var f,e,u,o=n?n.parallaxX!==1||n.parallaxY!==1:!1;if(t.is_family)for(f=0,e=t.members.length;f<e;++f)u=t.members[f],o||u.any_instance_parallaxed?cr.appendArray(r,u.instances):(this.updateAllCells(u),u.collision_grid.queryRange(i,r));else o||t.any_instance_parallaxed?cr.appendArray(r,t.instances):(this.updateAllCells(t),t.collision_grid.queryRange(i,r))};n.prototype.getTypesCollisionCandidates=function(n,t,i,r){for(var u=0,f=t.length;u<f;++u)this.getCollisionCandidates(n,t[u],i,r)};n.prototype.getSolidCollisionCandidates=function(n,t,i){var r=this.getSolidBehavior();if(!r)return null;this.getTypesCollisionCandidates(n,r.my_types,t,i)};n.prototype.getJumpthruCollisionCandidates=function(n,t,i){var r=this.getJumpthruBehavior();if(!r)return null;this.getTypesCollisionCandidates(n,r.my_types,t,i)};n.prototype.testAndSelectCanvasPointOverlap=function(n,t,i,r){var f=n.getCurrentSol(),e,o,u,s,a=this.getCurrentEventStack().current_event.orblock,h,c,l;if(f.select_all)for(r||(f.select_all=!1,cr.clearArray(f.instances)),e=0,s=n.instances.length;e<s;e++)if(u=n.instances[e],u.update_bbox(),h=u.layer.canvasToLayer(t,i,!0),c=u.layer.canvasToLayer(t,i,!1),u.contains_pt(h,c)){if(r)return!1;f.instances.push(u)}else a&&f.else_instances.push(u);else{for(o=0,l=a?f.else_instances:f.instances,e=0,s=l.length;e<s;e++)if(u=l[e],u.update_bbox(),h=u.layer.canvasToLayer(t,i,!0),c=u.layer.canvasToLayer(t,i,!1),u.contains_pt(h,c)){if(r)return!1;a?f.instances.push(u):(f.instances[o]=f.instances[e],o++)}r||(l.length=o)}return n.applySolToContainer(),r?!0:f.hasObjects()};n.prototype.testOverlap=function(n,t){if(!n||!t||n===t||!n.collisionsEnabled||!t.collisionsEnabled)return!1;n.update_bbox();t.update_bbox();var o=n.layer,u=t.layer,y=o!==u&&(o.parallaxX!==u.parallaxX||u.parallaxY!==u.parallaxY||o.scale!==u.scale||o.angle!==u.angle||o.zoomRate!==u.zoomRate),f,v,e,s,h,c,l,a,i,r;if(y){for(l=n.collision_poly&&!n.collision_poly.is_empty(),a=t.collision_poly&&!t.collision_poly.is_empty(),l?(n.collision_poly.cache_poly(n.width,n.height,n.angle),this.temp_poly.set_from_poly(n.collision_poly)):this.temp_poly.set_from_quad(n.bquad,n.x,n.y,n.width,n.height),i=this.temp_poly,a?(t.collision_poly.cache_poly(t.width,t.height,t.angle),this.temp_poly2.set_from_poly(t.collision_poly)):this.temp_poly2.set_from_quad(t.bquad,t.x,t.y,t.width,t.height),r=this.temp_poly2,f=0,v=i.pts_count;f<v;f++)e=f*2,s=e+1,h=i.pts_cache[e],c=i.pts_cache[s],i.pts_cache[e]=o.layerToCanvas(h+n.x,c+n.y,!0),i.pts_cache[s]=o.layerToCanvas(h+n.x,c+n.y,!1);for(i.update_bbox(),f=0,v=r.pts_count;f<v;f++)e=f*2,s=e+1,h=r.pts_cache[e],c=r.pts_cache[s],r.pts_cache[e]=u.layerToCanvas(h+t.x,c+t.y,!0),r.pts_cache[s]=u.layerToCanvas(h+t.x,c+t.y,!1);return r.update_bbox(),i.intersects_poly(r,0,0)}return n.bbox.intersects_rect(t.bbox)?n.bquad.intersects_quad(t.bquad)?n.tilemap_exists&&t.tilemap_exists?!1:n.tilemap_exists?this.testTilemapOverlap(n,t):t.tilemap_exists?this.testTilemapOverlap(t,n):(l=n.collision_poly&&!n.collision_poly.is_empty(),a=t.collision_poly&&!t.collision_poly.is_empty(),!l&&!a)?!0:(l?(n.collision_poly.cache_poly(n.width,n.height,n.angle),i=n.collision_poly):(this.temp_poly.set_from_quad(n.bquad,n.x,n.y,n.width,n.height),i=this.temp_poly),a?(t.collision_poly.cache_poly(t.width,t.height,t.angle),r=t.collision_poly):(this.temp_poly.set_from_quad(t.bquad,t.x,t.y,t.width,t.height),r=this.temp_poly),i.intersects_poly(r,t.x-n.x,t.y-n.y)):!1:!1};var r=new cr.quad,w=new cr.rect(0,0,0,0),t=[];n.prototype.testTilemapOverlap=function(n,i){var e,c,f,u,l=i.bbox,o=n.x,s=n.y,h,a;for(n.getCollisionRectCandidates(l,t),h=t,a=i.collision_poly&&!i.collision_poly.is_empty(),e=0,c=h.length;e<c;++e)if(f=h[e],u=f.rc,l.intersects_rect_off(u,o,s)&&(r.set_from_rect(u),r.offset(o,s),r.intersects_quad(i.bquad)))if(a){if(i.collision_poly.cache_poly(i.width,i.height,i.angle),f.poly){if(f.poly.intersects_poly(i.collision_poly,i.x-(o+u.left),i.y-(s+u.top)))return cr.clearArray(t),!0}else if(this.temp_poly.set_from_quad(r,0,0,u.right-u.left,u.bottom-u.top),this.temp_poly.intersects_poly(i.collision_poly,i.x,i.y))return cr.clearArray(t),!0}else if(f.poly){if(this.temp_poly.set_from_quad(i.bquad,0,0,i.width,i.height),f.poly.intersects_poly(this.temp_poly,-(o+u.left),-(s+u.top)))return cr.clearArray(t),!0}else return cr.clearArray(t),!0;return cr.clearArray(t),!1};n.prototype.testRectOverlap=function(n,i){var a,o;if(!i||!i.collisionsEnabled||(i.update_bbox(),a=i.layer,!i.bbox.intersects_rect(n)))return!1;if(i.tilemap_exists){i.getCollisionRectCandidates(n,t);for(var s=t,f,e,c=i.x,l=i.y,u=0,h=s.length;u<h;++u)if(f=s[u],e=f.rc,n.intersects_rect_off(e,c,l))if(f.poly){if(this.temp_poly.set_from_rect(n,0,0),f.poly.intersects_poly(this.temp_poly,-(c+e.left),-(l+e.top)))return cr.clearArray(t),!0}else return cr.clearArray(t),!0;return cr.clearArray(t),!1}return(r.set_from_rect(n),!i.bquad.intersects_quad(r))?!1:(o=i.collision_poly&&!i.collision_poly.is_empty(),!o)?!0:(i.collision_poly.cache_poly(i.width,i.height,i.angle),r.offset(-n.left,-n.top),this.temp_poly.set_from_quad(r,0,0,1,1),i.collision_poly.intersects_poly(this.temp_poly,n.left-i.x,n.top-i.y))};n.prototype.testSegmentOverlap=function(n,i,u,f,e){var p,a;if(!e||!e.collisionsEnabled||(e.update_bbox(),p=e.layer,w.set(cr.min(n,u),cr.min(i,f),cr.max(n,u),cr.max(i,f)),!e.bbox.intersects_rect(w)))return!1;if(e.tilemap_exists){e.getCollisionRectCandidates(w,t);for(var v=t,h,o,c=e.x,l=e.y,s=0,y=v.length;s<y;++s)if(h=v[s],o=h.rc,w.intersects_rect_off(o,c,l)&&(r.set_from_rect(o),r.offset(c,l),r.intersects_segment(n,i,u,f)))if(h.poly){if(h.poly.intersects_segment(c+o.left,l+o.top,n,i,u,f))return cr.clearArray(t),!0}else return cr.clearArray(t),!0;return cr.clearArray(t),!1}return e.bquad.intersects_segment(n,i,u,f)?(a=e.collision_poly&&!e.collision_poly.is_empty(),!a)?!0:(e.collision_poly.cache_poly(e.width,e.height,e.angle),e.collision_poly.intersects_segment(e.x,e.y,n,i,u,f)):!1};n.prototype.typeHasBehavior=function(n,t){if(!t)return!1;for(var u,e,f,i=0,r=n.behaviors.length;i<r;i++)if(n.behaviors[i].behavior instanceof t)return!0;if(!n.is_family)for(i=0,r=n.families.length;i<r;i++)for(f=n.families[i],u=0,e=f.behaviors.length;u<e;u++)if(f.behaviors[u].behavior instanceof t)return!0;return!1};n.prototype.typeHasNoSaveBehavior=function(n){return this.typeHasBehavior(n,cr.behaviors.NoSave)};n.prototype.typeHasPersistBehavior=function(n){return this.typeHasBehavior(n,cr.behaviors.Persist)};n.prototype.getSolidBehavior=function(){return this.solidBehavior};n.prototype.getJumpthruBehavior=function(){return this.jumpthruBehavior};i=[];n.prototype.testOverlapSolid=function(n){var t,u,r;for(n.update_bbox(),this.getSolidCollisionCandidates(n.layer,n.bbox,i),t=0,u=i.length;t<u;++t)if((r=i[t],r.extra.solidEnabled)&&this.testOverlap(n,r))return cr.clearArray(i),r;return cr.clearArray(i),null};n.prototype.testRectOverlapSolid=function(n){var t,u,r;for(this.getSolidCollisionCandidates(null,n,i),t=0,u=i.length;t<u;++t)if((r=i[t],r.extra.solidEnabled)&&this.testRectOverlap(n,r))return cr.clearArray(i),r;return cr.clearArray(i),null};ct=[];n.prototype.testOverlapJumpThru=function(n,t){var u=null,f,e,r;for(t&&(u=ct,cr.clearArray(u)),n.update_bbox(),this.getJumpthruCollisionCandidates(n.layer,n.bbox,i),f=0,e=i.length;f<e;++f)if((r=i[f],r.extra.jumpthruEnabled)&&this.testOverlap(n,r))if(t)u.push(r);else return cr.clearArray(i),r;return cr.clearArray(i),u};n.prototype.pushOutSolid=function(n,t,i,r,u,f){for(var l=r||50,h=n.x,c=n.y,e=null,s=null,o=0;o<l;o++)if(n.x=h+t*o,n.y=c+i*o,n.set_bbox_changed(),!this.testOverlap(n,e)&&(e=this.testOverlapSolid(n),e&&(s=e),!e&&(u&&(e=f?this.testOverlap(n,f)?f:null:this.testOverlapJumpThru(n),e&&(s=e)),!e)))return s&&this.pushInFractional(n,t,i,s,16),!0;return n.x=h,n.y=c,n.set_bbox_changed(),!1};n.prototype.pushOutSolidAxis=function(n,t,i,r){r=r||50;for(var h=n.x,c=n.y,e=null,s=null,o,f,u=0;u<r;++u)for(o=0;o<2;++o)if(f=o*2-1,n.x=h+t*u*f,n.y=c+i*u*f,n.set_bbox_changed(),!this.testOverlap(n,e))if(e=this.testOverlapSolid(n),e)s=e;else return s&&this.pushInFractional(n,t*f,i*f,s,16),!0;return n.x=h,n.y=c,n.set_bbox_changed(),!1};n.prototype.pushOut=function(n,t,i,r,u){for(var s=r||50,e=n.x,o=n.y,f=0;f<s;f++)if(n.x=e+t*f,n.y=o+i*f,n.set_bbox_changed(),!this.testOverlap(n,u))return!0;return n.x=e,n.y=o,n.set_bbox_changed(),!1};n.prototype.pushInFractional=function(n,t,i,r,u){for(var e=2,o,f=!1,s=!1,h=n.x,c=n.y;e<=u;)o=1/e,e*=2,n.x+=t*o*(f?1:-1),n.y+=i*o*(f?1:-1),n.set_bbox_changed(),this.testOverlap(n,r)?(f=!0,s=!0):(f=!1,s=!1,h=n.x,c=n.y);s&&(n.x=h,n.y=c,n.set_bbox_changed())};n.prototype.pushOutSolidNearest=function(n,t){var h=cr.is_undefined(t)?100:t,u=0,o=n.x,s=n.y,e=0,i=0,r=0,f=this.testOverlapSolid(n);if(!f)return!0;while(u<=h){switch(e){case 0:i=0;r=-1;u++;break;case 1:i=1;r=-1;break;case 2:i=1;r=0;break;case 3:i=1;r=1;break;case 4:i=0;r=1;break;case 5:i=-1;r=1;break;case 6:i=-1;r=0;break;case 7:i=-1;r=-1}if(e=(e+1)%8,n.x=cr.floor(o+i*u),n.y=cr.floor(s+r*u),n.set_bbox_changed(),!this.testOverlap(n,f)&&(f=this.testOverlapSolid(n),!f))return!0}return n.x=o,n.y=s,n.set_bbox_changed(),!1};n.prototype.registerCollision=function(n,t){n.collisionsEnabled&&t.collisionsEnabled&&this.registered_collisions.push([n,t])};n.prototype.addRegisteredCollisionCandidates=function(n,t,i){for(var r,u,f=0,e=this.registered_collisions.length;f<e;++f){if(r=this.registered_collisions[f],r[0]===n)u=r[1];else if(r[1]===n)u=r[0];else continue;if(t.is_family){if(t.members.indexOf(t)===-1)continue}else if(u.type!==t)continue;i.indexOf(u)===-1&&i.push(u)}};n.prototype.checkRegisteredCollision=function(n,t){for(var i,r=0,u=this.registered_collisions.length;r<u;r++)if(i=this.registered_collisions[r],i[0]===n&&i[1]===t||i[0]===t&&i[1]===n)return!0;return!1};n.prototype.calculateSolidBounceAngle=function(n,t,i,r){var l=n.x,a=n.y,c=cr.max(10,cr.distanceTo(t,i,l,a)),o=cr.angleTo(t,i,l,a),v=r||this.testOverlapSolid(n),u,e,h,s,y,f,p,w;if(!v)return cr.clamp_angle(o+cr.PI);for(f=v,y=cr.to_radians(5),u=1;u<36;u++)if(e=o-u*y,n.x=t+Math.cos(e)*c,n.y=i+Math.sin(e)*c,n.set_bbox_changed(),!this.testOverlap(n,f)&&(f=r?null:this.testOverlapSolid(n),!f)){h=e;break}for(u===36&&(h=cr.clamp_angle(o+cr.PI)),f=v,u=1;u<36;u++)if(e=o+u*y,n.x=t+Math.cos(e)*c,n.y=i+Math.sin(e)*c,n.set_bbox_changed(),!this.testOverlap(n,f)&&(f=r?null:this.testOverlapSolid(n),!f)){s=e;break}if(u===36&&(s=cr.clamp_angle(o+cr.PI)),n.x=l,n.y=a,n.set_bbox_changed(),s===h)return s;p=cr.angleDiff(s,h)/2;w=cr.angleClockwise(s,h)?cr.clamp_angle(h+p+cr.PI):cr.clamp_angle(s+p);var b=Math.cos(o),k=Math.sin(o),d=Math.cos(w),g=Math.sin(w),nt=b*d+k*g,tt=b-2*nt*d,it=k-2*nt*g;return cr.angleTo(0,0,tt,it)};b=-1;n.prototype.trigger=function(n,t,i){var u,r,f,e,s,o;if(!this.running_layout||(u=this.running_layout.event_sheet,!u))return!1;for(r=!1,b++,o=u.deep_includes,e=0,s=o.length;e<s;++e)f=this.triggerOnSheet(n,t,o[e],i),r=r||f;return f=this.triggerOnSheet(n,t,u,i),r=r||f,b--,r};n.prototype.triggerOnSheet=function(n,t,i,r){var u=!1,e,s,f,o;if(t)for(f=this.triggerOnSheetForTypeName(n,t,t.type.name,i,r),u=u||f,o=t.type.families,e=0,s=o.length;e<s;++e)f=this.triggerOnSheetForTypeName(n,t,o[e].name,i,r),u=u||f;else f=this.triggerOnSheetForTypeName(n,t,"system",i,r),u=u||f;return u};n.prototype.triggerOnSheetForTypeName=function(n,t,i,r,u){var f,h,e=!1,l=!1,a,v,y=typeof u!="undefined",p=y?r.fasttriggers:r.triggers,c=p[i],o,s;if(!c)return e;for(o=null,f=0,h=c.length;f<h;++f)if(c[f].method==n){o=c[f].evs;break}if(!o)return e;if(s=y?o[u]:o,!s)return null;for(f=0,h=s.length;f<h;f++)a=s[f][0],v=s[f][1],l=this.executeSingleTrigger(t,i,a,v),e=e||l;return e};n.prototype.executeSingleTrigger=function(n,t,i,r){var o,v,c=!1,u,l,s,h,a,f,e;if(this.trigger_depth++,u=this.getCurrentEventStack().current_event,u&&this.pushCleanSol(u.solModifiersIncludingParents),l=this.trigger_depth>1,this.pushCleanSol(i.solModifiersIncludingParents),l&&this.pushLocalVarStack(),s=this.pushEventStack(i),s.current_event=i,n&&(h=this.types[t].getCurrentSol(),h.select_all=!1,cr.clearArray(h.instances),h.instances[0]=n,this.types[t].applySolToContainer()),a=!0,i.parent){for(f=s.temp_parents_arr,e=i.parent;e;)f.push(e),e=e.parent;for(f.reverse(),o=0,v=f.length;o<v;o++)if(!f[o].run_pretrigger()){a=!1;break}}return a&&(this.execcount++,i.orblock?i.run_orblocktrigger(r):i.run(),c=c||s.last_event_true),this.popEventStack(),l&&this.popLocalVarStack(),this.popSol(i.solModifiersIncludingParents),u&&this.popSol(u.solModifiersIncludingParents),this.hasPendingInstances&&this.isInOnDestroy===0&&b===0&&!this.isRunningEvents&&this.ClearDeathRow(),this.trigger_depth--,c};n.prototype.getCurrentCondition=function(){var n=this.getCurrentEventStack();return n.current_event.conditions[n.cndindex]};n.prototype.getCurrentConditionObjectType=function(){var n=this.getCurrentCondition();return n.type};n.prototype.isCurrentConditionFirst=function(){var n=this.getCurrentEventStack();return n.cndindex===0};n.prototype.getCurrentAction=function(){var n=this.getCurrentEventStack();return n.current_event.actions[n.actindex]};n.prototype.pushLocalVarStack=function(){this.localvar_stack_index++;this.localvar_stack_index>=this.localvar_stack.length&&this.localvar_stack.push([])};n.prototype.popLocalVarStack=function(){this.localvar_stack_index--};n.prototype.getCurrentLocalVarStack=function(){return this.localvar_stack[this.localvar_stack_index]};n.prototype.pushEventStack=function(n){this.event_stack_index++;this.event_stack_index>=this.event_stack.length&&this.event_stack.push(new cr.eventStackFrame);var t=this.getCurrentEventStack();return t.reset(n),t};n.prototype.popEventStack=function(){this.event_stack_index--};n.prototype.getCurrentEventStack=function(){return this.event_stack[this.event_stack_index]};n.prototype.pushLoopStack=function(n){this.loop_stack_index++;this.loop_stack_index>=this.loop_stack.length&&this.loop_stack.push(cr.seal({name:n,index:0,stopped:!1}));var t=this.getCurrentLoop();return t.name=n,t.index=0,t.stopped=!1,t};n.prototype.popLoopStack=function(){this.loop_stack_index--};n.prototype.getCurrentLoop=function(){return this.loop_stack[this.loop_stack_index]};n.prototype.getEventVariableByName=function(n,t){for(var i,u,f,o,e,r;t;){for(i=0,u=t.subevents.length;i<u;i++)if(r=t.subevents[i],r instanceof cr.eventvariable&&cr.equals_nocase(n,r.name))return r;t=t.parent}for(i=0,u=this.eventsheets_by_index.length;i<u;i++)for(e=this.eventsheets_by_index[i],f=0,o=e.events.length;f<o;f++)if(r=e.events[f],r instanceof cr.eventvariable&&cr.equals_nocase(n,r.name))return r;return null};n.prototype.getLayoutBySid=function(n){for(var t=0,i=this.layouts_by_index.length;t<i;t++)if(this.layouts_by_index[t].sid===n)return this.layouts_by_index[t];return null};n.prototype.getObjectTypeBySid=function(n){for(var t=0,i=this.types_by_index.length;t<i;t++)if(this.types_by_index[t].sid===n)return this.types_by_index[t];return null};n.prototype.getGroupBySid=function(n){for(var t=0,i=this.allGroups.length;t<i;t++)if(this.allGroups[t].sid===n)return this.allGroups[t];return null};n.prototype.doCanvasSnapshot=function(n,t){this.snapshotCanvas=[n,t];this.redraw=!0};n.prototype.signalContinuousPreview=function(){this.signalledContinuousPreview=!0};n.prototype.handleSaveLoad=function(){var n=this,i=this.saveToSlot,t=this.lastSaveJson,r=this.loadFromSlot,u=!1,f;if(this.signalledContinuousPreview&&(u=!0,i="__c2_continuouspreview",this.signalledContinuousPreview=!1),i.length){if(this.ClearDeathRow(),t=this.saveToJSONString(),lt()&&!this.isCocoonJs)gt(i,t,function(){cr.logexport("Saved state to IndexedDB storage ("+t.length+" bytes)");n.lastSaveJson=t;n.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null);n.lastSaveJson="";u&&ft()},function(r){try{localStorage.setItem("__c2save_"+i,t);cr.logexport("Saved state to WebStorage ("+t.length+" bytes)");n.lastSaveJson=t;n.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null);n.lastSaveJson="";u&&ft()}catch(f){cr.logexport("Failed to save game state: "+r+"; "+f);n.trigger(cr.system_object.prototype.cnds.OnSaveFailed,null)}});else try{localStorage.setItem("__c2save_"+i,t);cr.logexport("Saved state to WebStorage ("+t.length+" bytes)");n.lastSaveJson=t;this.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null);n.lastSaveJson="";u&&ft()}catch(e){cr.logexport("Error saving to WebStorage: "+e);n.trigger(cr.system_object.prototype.cnds.OnSaveFailed,null)}this.saveToSlot="";this.loadFromSlot="";this.loadFromJson=null}if(r.length){if(lt()&&!this.isCocoonJs)ni(r,function(t){t?(n.loadFromJson=t,cr.logexport("Loaded state from IndexedDB storage ("+n.loadFromJson.length+" bytes)")):(n.loadFromJson=localStorage.getItem("__c2save_"+r)||"",cr.logexport("Loaded state from WebStorage ("+n.loadFromJson.length+" bytes)"));n.suspendDrawing=!1;n.loadFromJson||(n.loadFromJson=null,n.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))},function(){n.loadFromJson=localStorage.getItem("__c2save_"+r)||"";cr.logexport("Loaded state from WebStorage ("+n.loadFromJson.length+" bytes)");n.suspendDrawing=!1;n.loadFromJson||(n.loadFromJson=null,n.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))});else{try{this.loadFromJson=localStorage.getItem("__c2save_"+r)||"";cr.logexport("Loaded state from WebStorage ("+this.loadFromJson.length+" bytes)")}catch(e){this.loadFromJson=null}this.suspendDrawing=!1;n.loadFromJson||(n.loadFromJson=null,n.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))}this.loadFromSlot="";this.saveToSlot=""}this.loadFromJson!==null&&(this.ClearDeathRow(),f=this.loadFromJSONString(this.loadFromJson),f?(this.lastSaveJson=this.loadFromJson,this.trigger(cr.system_object.prototype.cnds.OnLoadComplete,null),this.lastSaveJson=""):n.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null),this.loadFromJson=null)};n.prototype.saveToJSONString=function(){for(var e,a,i,s,o,h,c,l,f,t,r={c2save:!0,version:1,rt:{time:this.kahanTime.sum,walltime:this.wallTime.sum,timescale:this.timescale,tickcount:this.tickcount,execcount:this.execcount,next_uid:this.next_uid,running_layout:this.running_layout.sid,start_time_offset:Date.now()-this.start_time},types:{},layouts:{},events:{groups:{},cnds:{},acts:{},vars:{}}},v,y,p,w,n=0,u=this.types_by_index.length;n<u;n++)if(i=this.types_by_index[n],!i.is_family&&!this.typeHasNoSaveBehavior(i)){for(o={instances:[]},cr.hasAnyOwnProperty(i.extra)&&(o.ex=k(i.extra)),e=0,a=i.instances.length;e<a;e++)o.instances.push(this.saveInstanceToJSON(i.instances[e]));r.types[i.sid.toString()]=o}for(n=0,u=this.layouts_by_index.length;n<u;n++)s=this.layouts_by_index[n],r.layouts[s.sid.toString()]=s.saveToJSON();for(v=r.events.groups,n=0,u=this.allGroups.length;n<u;n++)h=this.allGroups[n],v[h.sid.toString()]=this.groups_by_name[h.group_name].group_active;y=r.events.cnds;for(t in this.cndsBySid)this.cndsBySid.hasOwnProperty(t)&&(c=this.cndsBySid[t],cr.hasAnyOwnProperty(c.extra)&&(y[t]={ex:k(c.extra)}));p=r.events.acts;for(t in this.actsBySid)this.actsBySid.hasOwnProperty(t)&&(l=this.actsBySid[t],cr.hasAnyOwnProperty(l.extra)&&(p[t]={ex:k(l.extra)}));w=r.events.vars;for(t in this.varsBySid)this.varsBySid.hasOwnProperty(t)&&(f=this.varsBySid[t],f.is_constant||f.parent&&!f.is_static||(w[t]=f.data));return r.system=this.system.saveToJSON(),JSON.stringify(r)};n.prototype.refreshUidMap=function(){var n,u,t,i,f,r;for(this.objectsByUid={},n=0,u=this.types_by_index.length;n<u;n++)if(t=this.types_by_index[n],!t.is_family)for(i=0,f=t.instances.length;i<f;i++)r=t.instances[i],this.objectsByUid[r.uid.toString()]=r};n.prototype.loadFromJSONString=function(n){var f,o,d,g,i,e,a,ft,s,v,t,r,c,h,u,nt,tt,y,p,et,it,l,w,b,rt,ut,k;try{f=JSON.parse(n)}catch(ot){return!1}if(!f.c2save||f.version>1)return!1;if(this.isLoadingState=!0,o=f.rt,this.kahanTime.reset(),this.kahanTime.sum=o.time,this.wallTime.reset(),this.wallTime.sum=o.walltime||0,this.timescale=o.timescale,this.tickcount=o.tickcount,this.execcount=o.execcount,this.start_time=Date.now()-o.start_time_offset,d=o.running_layout,d!==this.running_layout.sid)if(g=this.getLayoutBySid(d),g)this.doChangeLayout(g);else return;l=f.types;for(t in l)if(l.hasOwnProperty(t)){if(r=this.getObjectTypeBySid(parseInt(t,10)),!r||r.is_family||this.typeHasNoSaveBehavior(r))continue;for(l[t].ex?r.extra=l[t].ex:cr.wipe(r.extra),c=r.instances,h=l[t].instances,i=0,e=cr.min(c.length,h.length);i<e;i++)this.loadInstanceFromJSON(c[i],h[i]);for(i=h.length,e=c.length;i<e;i++)this.DestroyInstance(c[i]);for(i=c.length,e=h.length;i<e;i++)(y=null,!r.plugin.is_world||(y=this.running_layout.getLayerBySid(h[i].w.l),y))&&(u=this.createInstanceFromInit(r.default_instance,y,!1,0,0,!0),this.loadInstanceFromJSON(u,h[i]));r.stale_iids=!0}this.ClearDeathRow();this.refreshUidMap();w=f.layouts;for(t in w)if(w.hasOwnProperty(t)){if(tt=this.getLayoutBySid(parseInt(t,10)),!tt)continue;tt.loadFromJSON(w[t])}b=f.events.groups;for(t in b)b.hasOwnProperty(t)&&(p=this.getGroupBySid(parseInt(t,10)),p&&this.groups_by_name[p.group_name]&&this.groups_by_name[p.group_name].setGroupActive(b[t]));rt=f.events.cnds;for(t in this.cndsBySid)this.cndsBySid.hasOwnProperty(t)&&(this.cndsBySid[t].extra=rt.hasOwnProperty(t)?rt[t].ex:{});ut=f.events.acts;for(t in this.actsBySid)this.actsBySid.hasOwnProperty(t)&&(this.actsBySid[t].extra=ut.hasOwnProperty(t)?ut[t].ex:{});k=f.events.vars;for(t in k)k.hasOwnProperty(t)&&this.varsBySid.hasOwnProperty(t)&&(this.varsBySid[t].data=k[t]);for(this.next_uid=o.next_uid,this.isLoadingState=!1,i=0,e=this.fireOnCreateAfterLoad.length;i<e;++i)u=this.fireOnCreateAfterLoad[i],this.trigger(Object.getPrototypeOf(u.type.plugin).cnds.OnCreated,u);for(cr.clearArray(this.fireOnCreateAfterLoad),this.system.loadFromJSON(f.system),i=0,e=this.types_by_index.length;i<e;i++)if(r=this.types_by_index[i],!r.is_family&&!this.typeHasNoSaveBehavior(r))for(a=0,ft=r.instances.length;a<ft;a++){if(u=r.instances[a],r.is_contained)for(et=u.get_iid(),cr.clearArray(u.siblings),s=0,v=r.container.length;s<v;s++)(it=r.container[s],r!==it)&&u.siblings.push(it.instances[et]);if(u.afterLoad&&u.afterLoad(),u.behavior_insts)for(s=0,v=u.behavior_insts.length;s<v;s++)nt=u.behavior_insts[s],nt.afterLoad&&nt.afterLoad()}return this.redraw=!0,!0};n.prototype.saveInstanceToJSON=function(n,t){var i,f,r,e,o,s=n.type,h=s.plugin,u={};if(t?u.c2=!0:u.uid=n.uid,cr.hasAnyOwnProperty(n.extra)&&(u.ex=k(n.extra)),n.instance_vars&&n.instance_vars.length)for(u.ivs={},i=0,f=n.instance_vars.length;i<f;i++)u.ivs[n.type.instvar_sids[i].toString()]=n.instance_vars[i];if(h.is_world){if(r={x:n.x,y:n.y,w:n.width,h:n.height,l:n.layer.sid,zi:n.get_zindex()},n.angle!==0&&(r.a=n.angle),n.opacity!==1&&(r.o=n.opacity),n.hotspotX!==.5&&(r.hX=n.hotspotX),n.hotspotY!==.5&&(r.hY=n.hotspotY),n.blend_mode!==0&&(r.bm=n.blend_mode),n.visible||(r.v=n.visible),n.collisionsEnabled||(r.ce=n.collisionsEnabled),n.my_timescale!==-1&&(r.mts=n.my_timescale),s.effect_types.length)for(r.fx=[],i=0,f=s.effect_types.length;i<f;i++)o=s.effect_types[i],r.fx.push({name:o.name,active:n.active_effect_flags[o.index],params:n.effect_params[o.index]});u.w=r}if(n.behavior_insts&&n.behavior_insts.length)for(u.behs={},i=0,f=n.behavior_insts.length;i<f;i++)e=n.behavior_insts[i],e.saveToJSON&&(u.behs[e.type.sid.toString()]=e.saveToJSON());return n.saveToJSON&&(u.data=n.saveToJSON()),u};n.prototype.getInstanceVarIndexBySid=function(n,t){for(var i=0,r=n.instvar_sids.length;i<r;i++)if(n.instvar_sids[i]===t)return i;return-1};n.prototype.getBehaviorIndexBySid=function(n,t){for(var i=0,r=n.behavior_insts.length;i<r;i++)if(n.behavior_insts[i].type.sid===t)return i;return-1};n.prototype.loadInstanceFromJSON=function(n,t,i){var u,f,y,s,e,r,h,o,l,c,a,v=n.type,p=v.plugin;if(i){if(!t.c2)return}else n.uid=t.uid;if(t.ex?n.extra=t.ex:cr.wipe(n.extra),e=t.ivs,e)for(u in e)if(e.hasOwnProperty(u)){if(s=this.getInstanceVarIndexBySid(v,parseInt(u,10)),s<0||s>=n.instance_vars.length)continue;c=e[u];c===null&&(c=NaN);n.instance_vars[s]=c}if(p.is_world){if(r=t.w,n.layer.sid!==r.l&&(a=n.layer,n.layer=this.running_layout.getLayerBySid(r.l),n.layer?(a.removeFromInstanceList(n,!0),n.layer.appendToInstanceList(n,!0),n.set_bbox_changed(),n.layer.setZIndicesStaleFrom(0)):(n.layer=a,i||this.DestroyInstance(n))),n.x=r.x,n.y=r.y,n.width=r.w,n.height=r.h,n.zindex=r.zi,n.angle=r.hasOwnProperty("a")?r.a:0,n.opacity=r.hasOwnProperty("o")?r.o:1,n.hotspotX=r.hasOwnProperty("hX")?r.hX:.5,n.hotspotY=r.hasOwnProperty("hY")?r.hY:.5,n.visible=r.hasOwnProperty("v")?r.v:!0,n.collisionsEnabled=r.hasOwnProperty("ce")?r.ce:!0,n.my_timescale=r.hasOwnProperty("mts")?r.mts:-1,n.blend_mode=r.hasOwnProperty("bm")?r.bm:0,n.compositeOp=cr.effectToCompositeOp(n.blend_mode),this.gl&&cr.setGLBlend(n,n.blend_mode,this.gl),n.set_bbox_changed(),r.hasOwnProperty("fx"))for(f=0,y=r.fx.length;f<y;f++)(h=v.getEffectIndexByName(r.fx[f].name),h<0)||(n.active_effect_flags[h]=r.fx[f].active,n.effect_params[h]=r.fx[f].params);n.updateActiveEffects()}if(o=t.behs,o)for(u in o)if(o.hasOwnProperty(u)){if(l=this.getBehaviorIndexBySid(n,parseInt(u,10)),l<0)continue;n.behavior_insts[l].loadFromJSON(o[u])}t.data&&n.loadFromJSON(t.data)};n.prototype.fetchLocalFileViaCordova=function(n,t,i){var r=cordova.file.applicationDirectory+"www/"+n;window.resolveLocalFileSystemURL(r,function(n){n.file(t,i)},i)};n.prototype.fetchLocalFileViaCordovaAsText=function(n,t,i){this.fetchLocalFileViaCordova(n,function(n){var r=new FileReader;r.onload=function(n){t(n.target.result)};r.onerror=i;r.readAsText(n)},i)};var et=[],d=0,ti=8;n.prototype.maybeStartNextArrayBufferRead=function(){if(et.length&&!(d>=ti)){d++;var n=et.shift();this.doFetchLocalFileViaCordovaAsArrayBuffer(n.filename,n.successCallback,n.errorCallback)}};n.prototype.fetchLocalFileViaCordovaAsArrayBuffer=function(n,t,i){var r=this;et.push({filename:n,successCallback:function(n){d--;r.maybeStartNextArrayBufferRead();t(n)},errorCallback:function(n){d--;r.maybeStartNextArrayBufferRead();i(n)}});this.maybeStartNextArrayBufferRead()};n.prototype.doFetchLocalFileViaCordovaAsArrayBuffer=function(n,t,i){this.fetchLocalFileViaCordova(n,function(n){var i=new FileReader;i.onload=function(n){t(n.target.result)};i.readAsArrayBuffer(n)},i)};n.prototype.fetchLocalFileViaCordovaAsURL=function(n,t,i){var r="",u=n.toLowerCase(),f=u.substr(u.length-4),e=u.substr(u.length-5);f===".mp4"?r="video/mp4":e===".webm"?r="video/webm":f===".m4a"?r="audio/mp4":f===".mp3"&&(r="audio/mpeg");this.fetchLocalFileViaCordovaAsArrayBuffer(n,function(n){var i=new Blob([n],{type:r}),u=URL.createObjectURL(i);t(u)},i)};n.prototype.isAbsoluteUrl=function(n){return/^(?:[a-z]+:)?\/\//.test(n)||n.substr(0,5)==="data:"||n.substr(0,5)==="blob:"};n.prototype.setImageSrc=function(n,t){this.isWKWebView&&!this.isAbsoluteUrl(t)?this.fetchLocalFileViaCordovaAsURL(t,function(t){n.src=t},function(n){alert("Failed to load image: "+n)}):n.src=t};n.prototype.setCtxImageSmoothingEnabled=function(n,t){typeof n.imageSmoothingEnabled!="undefined"?n.imageSmoothingEnabled=t:(n.webkitImageSmoothingEnabled=t,n.mozImageSmoothingEnabled=t,n.msImageSmoothingEnabled=t)};cr.runtime=n;cr.createRuntime=function(t){return new n(document.getElementById(t))};cr.createDCRuntime=function(t,i){return new n({dc:!0,width:t,height:i})};window.cr_createRuntime=cr.createRuntime;window.cr_createDCRuntime=cr.createDCRuntime;window.createCocoonJSRuntime=function(){var t,i;return window.c2cocoonjs=!0,t=document.createElement("screencanvas")||document.createElement("canvas"),t.screencanvas=!0,document.body.appendChild(t),i=new n(t),window.c2runtime=i,window.addEventListener("orientationchange",function(){window.c2runtime.setSize(window.innerWidth,window.innerHeight)}),window.c2runtime.setSize(window.innerWidth,window.innerHeight),i};window.createEjectaRuntime=function(){var i=document.getElementById("canvas"),t=new n(i);return window.c2runtime=t,window.c2runtime.setSize(window.innerWidth,window.innerHeight),t}}();window.cr_getC2Runtime=function(){var n=document.getElementById("c2canvas");return n?n.c2runtime:window.c2runtime?window.c2runtime:null};window.cr_getSnapshot=function(n,t){var i=window.cr_getC2Runtime();i&&i.doCanvasSnapshot(n,t)};window.cr_sizeCanvas=function(n,t){if(n!==0&&t!==0){var i=window.cr_getC2Runtime();i&&i.setSize(n,t)}};window.cr_setSuspended=function(n){var t=window.cr_getC2Runtime();t&&t.setSuspended(n)},function(){function t(n,t){var o,i,r,f,s,e,u;for(this.runtime=n,this.event_sheet=null,this.scrollX=this.runtime.original_width/2,this.scrollY=this.runtime.original_height/2,this.scale=1,this.angle=0,this.first_visit=!0,this.name=t[0],this.originalWidth=t[1],this.originalHeight=t[2],this.width=t[1],this.height=t[2],this.unbounded_scrolling=t[3],this.sheetname=t[4],this.sid=t[5],o=t[6],this.layers=[],this.initial_types=[],i=0,r=o.length;i<r;i++)f=new cr.layer(this,o[i]),f.number=i,cr.seal(f),this.layers.push(f);for(s=t[7],this.initial_nonworld=[],i=0,r=s.length;i<r;i++)e=s[i],u=this.runtime.types_by_index[e[1]],u.default_instance||(u.default_instance=e),this.initial_nonworld.push(e),this.initial_types.indexOf(u)===-1&&this.initial_types.push(u);for(this.effect_types=[],this.active_effect_types=[],this.shaders_preserve_opaqueness=!0,this.effect_params=[],i=0,r=t[8].length;i<r;i++)this.effect_types.push({id:t[8][i][0],name:t[8][i][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:i}),this.effect_params.push(t[8][i][2].slice(0));this.updateActiveEffects();this.rcTex=new cr.rect(0,0,1,1);this.rcTex2=new cr.rect(0,0,1,1);this.persist_data={}}function s(n,t){return n.zindex-t.zindex}function n(n,t){var o,i,u,e,r;for(this.layout=n,this.runtime=n.runtime,this.instances=[],this.scale=1,this.angle=0,this.disableAngle=!1,this.tmprect=new cr.rect(0,0,0,0),this.tmpquad=new cr.quad,this.viewLeft=0,this.viewRight=0,this.viewTop=0,this.viewBottom=0,this.zindices_stale=!1,this.zindices_stale_from=-1,this.clear_earlyz_index=0,this.name=t[0],this.index=t[1],this.sid=t[2],this.visible=t[3],this.background_color=t[4],this.transparent=t[5],this.parallaxX=t[6],this.parallaxY=t[7],this.opacity=t[8],this.forceOwnTexture=t[9],this.useRenderCells=t[10],this.zoomRate=t[11],this.blend_mode=t[12],this.effect_fallback=t[13],this.compositeOp="source-over",this.srcBlend=0,this.destBlend=0,this.render_grid=null,this.last_render_list=f(),this.render_list_stale=!0,this.last_render_cells=new cr.rect(0,0,-1,-1),this.cur_render_cells=new cr.rect(0,0,-1,-1),this.useRenderCells&&(this.render_grid=new cr.RenderGrid(this.runtime.original_width,this.runtime.original_height)),this.render_offscreen=!1,o=t[14],this.startup_initial_instances=[],this.initial_instances=[],this.created_globals=[],i=0,u=o.length;i<u;i++)e=o[i],r=this.runtime.types_by_index[e[1]],r.default_instance||(r.default_instance=e,r.default_layerindex=this.index),this.initial_instances.push(e),this.layout.initial_types.indexOf(r)===-1&&this.layout.initial_types.push(r);for(cr.shallowAssignArray(this.startup_initial_instances,this.initial_instances),this.effect_types=[],this.active_effect_types=[],this.shaders_preserve_opaqueness=!0,this.effect_params=[],i=0,u=t[15].length;i<u;i++)this.effect_types.push({id:t[15][i][0],name:t[15][i][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:i}),this.effect_params.push(t[15][i][2].slice(0));this.updateActiveEffects();this.rcTex=new cr.rect(0,0,1,1);this.rcTex2=new cr.rect(0,0,1,1)}function f(){return o.length?o.pop():[]}function e(n){cr.clearArray(n);o.push(n)}function l(n,t,i){var u=0,f=0,r=0,e=n.length,o=t.length,s,h;for(i.length=e+o;u<e&&f<o;++r)s=n[u],h=t[f],s.zindex<h.zindex?(i[r]=s,++u):(i[r]=h,++f);for(;u<e;++u,++r)i[r]=n[u];for(;f<o;++f,++r)i[r]=t[f]}function a(n,t){for(var i,s,h,r=0,o=n.length;r<o-1;r+=2)i=n[r],s=n[r+1],h=f(),l(i,s,h),t||(e(i),e(s)),u.push(h);o%2==1&&(t?(i=f(),cr.shallowAssignArray(i,n[o-1]),u.push(i)):u.push(n[o-1]));cr.shallowAssignArray(n,u);cr.clearArray(u)}function v(n){for(var t=!0;n.length>1;)a(n,t),t=!1;return n[0]}var i,h,c,o,u,r;t.prototype.saveObjectToPersist=function(n){var t=n.type.sid.toString(),i;this.persist_data.hasOwnProperty(t)||(this.persist_data[t]=[]);i=this.persist_data[t];i.push(this.runtime.saveInstanceToJSON(n))};t.prototype.hasOpaqueBottomLayer=function(){var n=this.layers[0];return!n.transparent&&n.opacity===1&&!n.forceOwnTexture&&n.visible};t.prototype.updateActiveEffects=function(){cr.clearArray(this.active_effect_types);this.shaders_preserve_opaqueness=!0;for(var t,n=0,i=this.effect_types.length;n<i;n++)t=this.effect_types[n],t.active&&(this.active_effect_types.push(t),t.preservesOpaqueness||(this.shaders_preserve_opaqueness=!1))};t.prototype.getEffectByName=function(n){for(var i,t=0,r=this.effect_types.length;t<r;t++)if(i=this.effect_types[t],i.name===n)return i;return null};i=[];h=!0;t.prototype.startRunning=function(){var n,e,r,l,f,y,k,t,p,u,w,a,c,v,o,b;for(this.sheetname&&(this.event_sheet=this.runtime.eventsheets[this.sheetname],this.event_sheet.updateDeepIncludes()),this.runtime.running_layout=this,this.width=this.originalWidth,this.height=this.originalHeight,this.scrollX=this.runtime.original_width/2,this.scrollY=this.runtime.original_height/2,n=0,r=this.runtime.types_by_index.length;n<r;n++)if(f=this.runtime.types_by_index[n],!f.is_family)for(y=f.instances,e=0,l=y.length;e<l;e++)t=y[e],t.layer&&(v=t.layer.number,v>=this.layers.length&&(v=this.layers.length-1),t.layer=this.layers[v],t.layer.instances.indexOf(t)===-1&&t.layer.instances.push(t),t.layer.zindices_stale=!0);if(!h)for(n=0,r=this.layers.length;n<r;++n)this.layers[n].instances.sort(s);for(cr.clearArray(i),this.boundScrolling(),n=0,r=this.layers.length;n<r;n++)o=this.layers[n],o.createInitialInstances(),o.updateViewport(null);if(b=!1,!this.first_visit){for(a in this.persist_data)if(this.persist_data.hasOwnProperty(a)){if(f=this.runtime.getObjectTypeBySid(parseInt(a,10)),!f||f.is_family||!this.runtime.typeHasPersistBehavior(f))continue;for(c=this.persist_data[a],n=0,r=c.length;n<r;n++)(o=null,!f.plugin.is_world||(o=this.getLayerBySid(c[n].w.l),o))&&(t=this.runtime.createInstanceFromInit(f.default_instance,o,!1,0,0,!0),this.runtime.loadInstanceFromJSON(t,c[n]),b=!0,i.push(t));cr.clearArray(c)}for(n=0,r=this.layers.length;n<r;n++)this.layers[n].instances.sort(s),this.layers[n].zindices_stale=!0}for(b&&(this.runtime.ClearDeathRow(),this.runtime.refreshUidMap()),n=0;n<i.length;n++)if(t=i[n],t.type.is_contained)for(p=t.get_iid(),e=0,l=t.type.container.length;e<l;e++)(u=t.type.container[e],t.type!==u)&&(u.instances.length>p?t.siblings.push(u.instances[p]):u.default_instance&&(w=this.runtime.createInstanceFromInit(u.default_instance,t.layer,!0,t.x,t.y,!0),this.runtime.ClearDeathRow(),u.updateIIDs(),t.siblings.push(w),i.push(w)));for(n=0,r=this.initial_nonworld.length;n<r;n++)k=this.initial_nonworld[n],f=this.runtime.types_by_index[k[1]],f.is_contained||(t=this.runtime.createInstanceFromInit(this.initial_nonworld[n],null,!0));if(this.runtime.changelayout=null,this.runtime.ClearDeathRow(),this.runtime.ctx&&!this.runtime.isDomFree)for(n=0,r=this.runtime.types_by_index.length;n<r;n++)(u=this.runtime.types_by_index[n],!u.is_family&&u.instances.length&&u.preloadCanvas2D)&&u.preloadCanvas2D(this.runtime.ctx);if(this.runtime.isLoadingState)cr.shallowAssignArray(this.runtime.fireOnCreateAfterLoad,i);else for(n=0,r=i.length;n<r;n++)t=i[n],this.runtime.trigger(Object.getPrototypeOf(t.type.plugin).cnds.OnCreated,t);cr.clearArray(i);this.runtime.isLoadingState||this.runtime.trigger(cr.system_object.prototype.cnds.OnLayoutStart,null);this.first_visit=!1};t.prototype.createGlobalNonWorlds=function(){var n,t,u,i,f,r;for(n=0,t=0,u=this.initial_nonworld.length;n<u;n++)i=this.initial_nonworld[n],r=this.runtime.types_by_index[i[1]],r.global?r.is_contained||(f=this.runtime.createInstanceFromInit(i,null,!0)):(this.initial_nonworld[t]=i,t++);cr.truncateArray(this.initial_nonworld,t)};t.prototype.stopRunning=function(){this.runtime.isLoadingState||this.runtime.trigger(cr.system_object.prototype.cnds.OnLayoutEnd,null);this.runtime.isEndingLayout=!0;cr.clearArray(this.runtime.system.waits);var n,f,t,e,i,r,u;if(!this.first_visit)for(n=0,f=this.layers.length;n<f;n++)for(this.layers[n].updateZIndices(),i=this.layers[n].instances,t=0,e=i.length;t<e;t++)r=i[t],r.type.global||this.runtime.typeHasPersistBehavior(r.type)&&this.saveObjectToPersist(r);for(n=0,f=this.layers.length;n<f;n++){for(i=this.layers[n].instances,t=0,e=i.length;t<e;t++)r=i[t],r.type.global||this.runtime.DestroyInstance(r);this.runtime.ClearDeathRow();cr.clearArray(i);this.layers[n].zindices_stale=!0}for(n=0,f=this.runtime.types_by_index.length;n<f;n++)if(u=this.runtime.types_by_index[n],!u.global&&!u.plugin.is_world&&!u.plugin.singleglobal&&!u.is_family){for(t=0,e=u.instances.length;t<e;t++)this.runtime.DestroyInstance(u.instances[t]);this.runtime.ClearDeathRow()}h=!1;this.runtime.isEndingLayout=!1};c=new cr.rect(0,0,0,0);t.prototype.recreateInitialObjects=function(n,t,i,r,u){c.set(t,i,r,u);for(var f=0,e=this.layers.length;f<e;f++)this.layers[f].recreateInitialObjects(n,c)};t.prototype.draw=function(n){var t,r=n,u=!1,e=!this.runtime.fullscreenScalingQuality,f,o,i;for(e&&(this.runtime.layout_canvas||(this.runtime.layout_canvas=document.createElement("canvas"),t=this.runtime.layout_canvas,t.width=this.runtime.draw_width,t.height=this.runtime.draw_height,this.runtime.layout_ctx=t.getContext("2d"),u=!0),t=this.runtime.layout_canvas,r=this.runtime.layout_ctx,t.width!==this.runtime.draw_width&&(t.width=this.runtime.draw_width,u=!0),t.height!==this.runtime.draw_height&&(t.height=this.runtime.draw_height,u=!0),u&&this.runtime.setCtxImageSmoothingEnabled(r,this.runtime.linearSampling)),r.globalAlpha=1,r.globalCompositeOperation="source-over",this.runtime.clearBackground&&!this.hasOpaqueBottomLayer()&&r.clearRect(0,0,this.runtime.draw_width,this.runtime.draw_height),f=0,o=this.layers.length;f<o;f++)i=this.layers[f],i.visible&&i.opacity>0&&i.blend_mode!==11&&(i.instances.length||!i.transparent)?i.draw(r):i.updateViewport(null);e&&n.drawImage(t,0,0,this.runtime.width,this.runtime.height)};t.prototype.drawGL_earlyZPass=function(n){n.setEarlyZPass(!0);this.runtime.layout_tex||(this.runtime.layout_tex=n.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling));(this.runtime.layout_tex.c2width!==this.runtime.draw_width||this.runtime.layout_tex.c2height!==this.runtime.draw_height)&&(n.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=n.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling));n.setRenderingToTexture(this.runtime.layout_tex);this.runtime.fullscreenScalingQuality||n.setSize(this.runtime.draw_width,this.runtime.draw_height);for(var t,i=this.layers.length-1;i>=0;--i)t=this.layers[i],t.visible&&t.opacity===1&&t.shaders_preserve_opaqueness&&t.blend_mode===0&&(t.instances.length||!t.transparent)?t.drawGL_earlyZPass(n):t.updateViewport(null);n.setEarlyZPass(!1)};t.prototype.drawGL=function(n){var f=this.active_effect_types.length>0||this.runtime.uses_background_blending||!this.runtime.fullscreenScalingQuality||this.runtime.enableFrontToBack,u,e,t,o,i,r;for(f?(this.runtime.layout_tex||(this.runtime.layout_tex=n.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),(this.runtime.layout_tex.c2width!==this.runtime.draw_width||this.runtime.layout_tex.c2height!==this.runtime.draw_height)&&(n.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=n.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),n.setRenderingToTexture(this.runtime.layout_tex),this.runtime.fullscreenScalingQuality||n.setSize(this.runtime.draw_width,this.runtime.draw_height)):this.runtime.layout_tex&&(n.setRenderingToTexture(null),n.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=null),this.runtime.clearBackground&&!this.hasOpaqueBottomLayer()&&n.clear(0,0,0,0),u=0,e=this.layers.length;u<e;u++)t=this.layers[u],t.visible&&t.opacity>0&&(t.instances.length||!t.transparent)?t.drawGL(n):t.updateViewport(null);f&&(this.active_effect_types.length===0||this.active_effect_types.length===1&&this.runtime.fullscreenScalingQuality?(this.active_effect_types.length===1?(o=this.active_effect_types[0].index,n.switchProgram(this.active_effect_types[0].shaderindex),n.setProgramParameters(null,1/this.runtime.draw_width,1/this.runtime.draw_height,0,0,1,1,this.scale,this.angle,0,0,this.runtime.draw_width/2,this.runtime.draw_height/2,this.runtime.kahanTime.sum,this.effect_params[o]),n.programIsAnimated(this.active_effect_types[0].shaderindex)&&(this.runtime.redraw=!0)):n.switchProgram(0),this.runtime.fullscreenScalingQuality||n.setSize(this.runtime.width,this.runtime.height),n.setRenderingToTexture(null),n.setDepthTestEnabled(!1),n.setOpacity(1),n.setTexture(this.runtime.layout_tex),n.setAlphaBlend(),n.resetModelView(),n.updateModelView(),i=this.runtime.width/2,r=this.runtime.height/2,n.quad(-i,r,i,r,i,-r,-i,-r),n.setTexture(null),n.setDepthTestEnabled(!0)):this.renderEffectChain(n,null,null,null))};t.prototype.getRenderTarget=function(){return this.active_effect_types.length>0||this.runtime.uses_background_blending||!this.runtime.fullscreenScalingQuality||this.runtime.enableFrontToBack?this.runtime.layout_tex:null};t.prototype.getMinLayerScale=function(){for(var i=this.layers[0].getScale(),n,t=1,r=this.layers.length;t<r;t++)(n=this.layers[t],n.parallaxX!==0||n.parallaxY!==0)&&n.getScale()<i&&(i=n.getScale());return i};t.prototype.scrollToX=function(n){if(!this.unbounded_scrolling){var t=this.runtime.draw_width*(1/this.getMinLayerScale())/2;n>this.width-t&&(n=this.width-t);n<t&&(n=t)}this.scrollX!==n&&(this.scrollX=n,this.runtime.redraw=!0)};t.prototype.scrollToY=function(n){if(!this.unbounded_scrolling){var t=this.runtime.draw_height*(1/this.getMinLayerScale())/2;n>this.height-t&&(n=this.height-t);n<t&&(n=t)}this.scrollY!==n&&(this.scrollY=n,this.runtime.redraw=!0)};t.prototype.boundScrolling=function(){this.scrollToX(this.scrollX);this.scrollToY(this.scrollY)};t.prototype.renderEffectChain=function(n,t,i,r){var w=i?i.active_effect_types:t?t.active_effect_types:this.active_effect_types,st=1,ht=0,g=0,nt=0,ct=this.runtime.draw_width,lt=this.runtime.draw_height,y,wt,dt,gt,ni;i?(st=i.layer.getScale(),ht=i.layer.getAngle(),g=i.layer.viewLeft,nt=i.layer.viewTop,ct=i.layer.viewRight,lt=i.layer.viewBottom):t&&(st=t.getScale(),ht=t.getAngle(),g=t.viewLeft,nt=t.viewTop,ct=t.viewRight,lt=t.viewBottom);var a=this.runtime.fx_tex,p,yt,kt,tt,c=0,pt=1,ft,d,l=this.runtime.draw_width,o=this.runtime.draw_height,at=l/2,vt=o/2,v=t?t.rcTex:this.rcTex,u=t?t.rcTex2:this.rcTex2,s=0,b=0,f=0,k=0,h=l,it=l,e=o,rt=o,et=0,ot=0,fi=i?i.layer.getAngle():0;if(i){for(p=0,yt=w.length;p<yt;p++)et+=n.getProgramBoxExtendHorizontal(w[p].shaderindex),ot+=n.getProgramBoxExtendVertical(w[p].shaderindex);if(y=i.bbox,s=t.layerToCanvas(y.left,y.top,!0,!0),f=t.layerToCanvas(y.left,y.top,!1,!0),h=t.layerToCanvas(y.right,y.bottom,!0,!0),e=t.layerToCanvas(y.right,y.bottom,!1,!0),fi!==0){var ti=t.layerToCanvas(y.right,y.top,!0,!0),ii=t.layerToCanvas(y.right,y.top,!1,!0),ri=t.layerToCanvas(y.left,y.bottom,!0,!0),ui=t.layerToCanvas(y.left,y.bottom,!1,!0);tt=Math.min(s,h,ti,ri);h=Math.max(s,h,ti,ri);s=tt;tt=Math.min(f,e,ii,ui);e=Math.max(f,e,ii,ui);f=tt}s-=et;f-=ot;h+=et;e+=ot;u.left=s/l;u.top=1-f/o;u.right=h/l;u.bottom=1-e/o;b=s=cr.floor(s);k=f=cr.floor(f);it=h=cr.ceil(h);rt=e=cr.ceil(e);b-=et;k-=ot;it+=et;rt+=ot;s<0&&(s=0);f<0&&(f=0);h>l&&(h=l);e>o&&(e=o);b<0&&(b=0);k<0&&(k=0);it>l&&(it=l);rt>o&&(rt=o);v.left=s/l;v.top=1-f/o;v.right=h/l;v.bottom=1-e/o}else v.left=u.left=0,v.top=u.top=0,v.right=u.right=1,v.bottom=u.bottom=1;wt=i&&(n.programUsesDest(w[0].shaderindex)||et!==0||ot!==0||i.opacity!==1||i.type.plugin.must_predraw)||t&&!i&&t.opacity!==1;n.setAlphaBlend();wt&&(a[c]||(a[c]=n.createEmptyTexture(l,o,this.runtime.linearSampling)),(a[c].c2width!==l||a[c].c2height!==o)&&(n.deleteTexture(a[c]),a[c]=n.createEmptyTexture(l,o,this.runtime.linearSampling)),n.switchProgram(0),n.setRenderingToTexture(a[c]),d=rt-k,ft=o-k-d,n.clearRect(b,ft,it-b,d),i?i.drawGL(n):(n.setTexture(this.runtime.layer_tex),n.setOpacity(t.opacity),n.resetModelView(),n.translate(-at,-vt),n.updateModelView(),n.quadTex(s,e,h,e,h,f,s,f,v)),u.left=u.top=0,u.right=u.bottom=1,i&&(tt=v.top,v.top=v.bottom,v.bottom=tt),c=1,pt=0);n.setOpacity(1);var kt=w.length-1,bt=n.programUsesCrossSampling(w[kt].shaderindex)||!t&&!i&&!this.runtime.fullscreenScalingQuality,ut=0;for(p=0,yt=w.length;p<yt;p++)a[c]||(a[c]=n.createEmptyTexture(l,o,this.runtime.linearSampling)),(a[c].c2width!==l||a[c].c2height!==o)&&(n.deleteTexture(a[c]),a[c]=n.createEmptyTexture(l,o,this.runtime.linearSampling)),n.switchProgram(w[p].shaderindex),ut=w[p].index,n.programIsAnimated(w[p].shaderindex)&&(this.runtime.redraw=!0),p!=0||wt?(n.setProgramParameters(r,1/l,1/o,u.left,u.top,u.right,u.bottom,st,ht,g,nt,(g+ct)/2,(nt+lt)/2,this.runtime.kahanTime.sum,i?i.effect_params[ut]:t?t.effect_params[ut]:this.effect_params[ut]),n.setTexture(null),p!==kt||bt?(n.setRenderingToTexture(a[c]),d=rt-k,ft=o-k-d,n.clearRect(b,ft,it-b,d)):(i?n.setBlend(i.srcBlend,i.destBlend):t&&n.setBlend(t.srcBlend,t.destBlend),n.setRenderingToTexture(r)),n.setTexture(a[pt]),n.resetModelView(),n.translate(-at,-vt),n.updateModelView(),n.quadTex(s,e,h,e,h,f,s,f,v),p!==kt||bt||n.setTexture(null)):(n.setRenderingToTexture(a[c]),d=rt-k,ft=o-k-d,n.clearRect(b,ft,it-b,d),i?(i.curFrame&&i.curFrame.texture_img?(ni=i.curFrame.texture_img,dt=1/ni.width,gt=1/ni.height):(dt=1/i.width,gt=1/i.height),n.setProgramParameters(r,dt,gt,u.left,u.top,u.right,u.bottom,st,ht,g,nt,(g+ct)/2,(nt+lt)/2,this.runtime.kahanTime.sum,i.effect_params[ut]),i.drawGL(n)):(n.setProgramParameters(r,1/l,1/o,0,0,1,1,st,ht,g,nt,(g+ct)/2,(nt+lt)/2,this.runtime.kahanTime.sum,t?t.effect_params[ut]:this.effect_params[ut]),n.setTexture(t?this.runtime.layer_tex:this.runtime.layout_tex),n.resetModelView(),n.translate(-at,-vt),n.updateModelView(),n.quadTex(s,e,h,e,h,f,s,f,v)),u.left=u.top=0,u.right=u.bottom=1,i&&!bt&&(tt=e,e=f,f=tt)),c=c===0?1:0,pt=c===0?1:0;bt&&(n.switchProgram(0),i?n.setBlend(i.srcBlend,i.destBlend):t?n.setBlend(t.srcBlend,t.destBlend):this.runtime.fullscreenScalingQuality||(n.setSize(this.runtime.width,this.runtime.height),at=this.runtime.width/2,vt=this.runtime.height/2,s=0,f=0,h=this.runtime.width,e=this.runtime.height),n.setRenderingToTexture(r),n.setTexture(a[pt]),n.resetModelView(),n.translate(-at,-vt),n.updateModelView(),i&&w.length===1&&!wt?n.quadTex(s,f,h,f,h,e,s,e,v):n.quadTex(s,e,h,e,h,f,s,f,v),n.setTexture(null))};t.prototype.getLayerBySid=function(n){for(var t=0,i=this.layers.length;t<i;t++)if(this.layers[t].sid===n)return this.layers[t];return null};t.prototype.saveToJSON=function(){for(var r,i,u={sx:this.scrollX,sy:this.scrollY,s:this.scale,a:this.angle,w:this.width,h:this.height,fv:this.first_visit,persist:this.persist_data,fx:[],layers:{}},n=0,t=this.effect_types.length;n<t;n++)i=this.effect_types[n],u.fx.push({name:i.name,active:i.active,params:this.effect_params[i.index]});for(n=0,t=this.layers.length;n<t;n++)r=this.layers[n],u.layers[r.sid.toString()]=r.saveToJSON();return u};t.prototype.loadFromJSON=function(n){var t,o,r,u,e,i,f;for(this.scrollX=n.sx,this.scrollY=n.sy,this.scale=n.s,this.angle=n.a,this.width=n.w,this.height=n.h,this.persist_data=n.persist,typeof n.fv!="undefined"&&(this.first_visit=n.fv),i=n.fx,t=0,o=i.length;t<o;t++)(r=this.getEffectByName(i[t].name),r)&&(r.active=i[t].active,this.effect_params[r.index]=i[t].params);this.updateActiveEffects();f=n.layers;for(u in f)if(f.hasOwnProperty(u)){if(e=this.getLayerBySid(parseInt(u,10)),!e)continue;e.loadFromJSON(f[u])}};cr.layout=t;n.prototype.updateActiveEffects=function(){cr.clearArray(this.active_effect_types);this.shaders_preserve_opaqueness=!0;for(var t,n=0,i=this.effect_types.length;n<i;n++)t=this.effect_types[n],t.active&&(this.active_effect_types.push(t),t.preservesOpaqueness||(this.shaders_preserve_opaqueness=!1))};n.prototype.getEffectByName=function(n){for(var i,t=0,r=this.effect_types.length;t<r;t++)if(i=this.effect_types[t],i.name===n)return i;return null};n.prototype.createInitialInstances=function(){var n,r,e,t,u,o,f,s;for(n=0,r=0,e=this.initial_instances.length;n<e;n++){if(u=this.initial_instances[n],o=this.runtime.types_by_index[u[1]],s=this.runtime.typeHasPersistBehavior(o),f=!0,!s||this.layout.first_visit){if(t=this.runtime.createInstanceFromInit(u,this,!0),!t)continue;i.push(t);t.type.global&&(f=!1,this.created_globals.push(t.uid))}f&&(this.initial_instances[r]=this.initial_instances[n],r++)}this.initial_instances.length=r;this.runtime.ClearDeathRow();!this.runtime.glwrap&&this.effect_types.length&&(this.blend_mode=this.effect_fallback);this.compositeOp=cr.effectToCompositeOp(this.blend_mode);this.runtime.gl&&cr.setGLBlend(this,this.blend_mode,this.runtime.gl);this.render_list_stale=!0};n.prototype.recreateInitialObjects=function(n,t){for(var u,f,e,c,l,r,o,a,s,v=this.runtime.types_by_index,y=n.is_family,p=n.members,i=0,h=this.initial_instances.length;i<h;++i)if(u=this.initial_instances[i],e=u[0],c=e[0],l=e[1],t.contains_pt(c,l)){if(f=v[u[1]],f!==n)if(y){if(p.indexOf(f)<0)continue}else continue;if(r=this.runtime.createInstanceFromInit(u,this,!1),this.runtime.isInOnDestroy++,this.runtime.trigger(Object.getPrototypeOf(f.plugin).cnds.OnCreated,r),r.is_contained)for(o=0,a=r.siblings.length;o<a;o++)s=r.siblings[i],this.runtime.trigger(Object.getPrototypeOf(s.type.plugin).cnds.OnCreated,s);this.runtime.isInOnDestroy--}};n.prototype.removeFromInstanceList=function(n,t){var i=cr.fastIndexOf(this.instances,n);i<0||(t&&this.useRenderCells&&n.rendercells&&n.rendercells.right>=n.rendercells.left&&(n.update_bbox(),this.render_grid.update(n,n.rendercells,null),n.rendercells.set(0,0,-1,-1)),i===this.instances.length-1?this.instances.pop():(cr.arrayRemove(this.instances,i),this.setZIndicesStaleFrom(i)),this.render_list_stale=!0)};n.prototype.appendToInstanceList=function(n,t){n.zindex=this.instances.length;this.instances.push(n);t&&this.useRenderCells&&n.rendercells&&n.set_bbox_changed();this.render_list_stale=!0};n.prototype.prependToInstanceList=function(n,t){this.instances.unshift(n);this.setZIndicesStaleFrom(0);t&&this.useRenderCells&&n.rendercells&&n.set_bbox_changed()};n.prototype.moveInstanceAdjacent=function(n,t,i){var u=n.get_zindex(),r=t.get_zindex();cr.arrayRemove(this.instances,u);u<r&&r--;i&&r++;r===this.instances.length?this.instances.push(n):this.instances.splice(r,0,n);this.setZIndicesStaleFrom(u<r?u:r)};n.prototype.setZIndicesStaleFrom=function(n){this.zindices_stale_from===-1?this.zindices_stale_from=n:n<this.zindices_stale_from&&(this.zindices_stale_from=n);this.zindices_stale=!0;this.render_list_stale=!0};n.prototype.updateZIndices=function(){if(this.zindices_stale){this.zindices_stale_from===-1&&(this.zindices_stale_from=0);var n,t,i;if(this.useRenderCells)for(n=this.zindices_stale_from,t=this.instances.length;n<t;++n)i=this.instances[n],i.zindex=n,this.render_grid.markRangeChanged(i.rendercells);else for(n=this.zindices_stale_from,t=this.instances.length;n<t;++n)this.instances[n].zindex=n;this.zindices_stale=!1;this.zindices_stale_from=-1}};n.prototype.getScale=function(n){return this.getNormalScale()*(this.runtime.fullscreenScalingQuality||n?this.runtime.aspect_scale:1)};n.prototype.getNormalScale=function(){return(this.scale*this.layout.scale-1)*this.zoomRate+1};n.prototype.getAngle=function(){return this.disableAngle?0:cr.clamp_angle(this.layout.angle+this.angle)};o=[];u=[];r=[];n.prototype.getRenderCellInstancesToDraw=function(){var n,t;return(this.updateZIndices(),this.render_grid.queryRange(this.viewLeft,this.viewTop,this.viewRight,this.viewBottom,r),!r.length)?f():r.length===1?(n=f(),cr.shallowAssignArray(n,r[0]),cr.clearArray(r),n):(t=v(r),cr.clearArray(r),t)};n.prototype.draw=function(n){var u,f,c,r,s,a,h,l;this.render_offscreen=this.forceOwnTexture||this.opacity!==1||this.blend_mode!==0;var i=this.runtime.canvas,t=n,o=!1;for(this.render_offscreen&&(this.runtime.layer_canvas||(this.runtime.layer_canvas=document.createElement("canvas"),i=this.runtime.layer_canvas,i.width=this.runtime.draw_width,i.height=this.runtime.draw_height,this.runtime.layer_ctx=i.getContext("2d"),o=!0),i=this.runtime.layer_canvas,t=this.runtime.layer_ctx,i.width!==this.runtime.draw_width&&(i.width=this.runtime.draw_width,o=!0),i.height!==this.runtime.draw_height&&(i.height=this.runtime.draw_height,o=!0),o&&this.runtime.setCtxImageSmoothingEnabled(t,this.runtime.linearSampling),this.transparent&&t.clearRect(0,0,this.runtime.draw_width,this.runtime.draw_height)),t.globalAlpha=1,t.globalCompositeOperation="source-over",this.transparent||(t.fillStyle="rgb("+this.background_color[0]+","+this.background_color[1]+","+this.background_color[2]+")",t.fillRect(0,0,this.runtime.draw_width,this.runtime.draw_height)),t.save(),this.disableAngle=!0,u=this.canvasToLayer(0,0,!0,!0),f=this.canvasToLayer(0,0,!1,!0),this.disableAngle=!1,this.runtime.pixel_rounding&&(u=Math.round(u),f=Math.round(f)),this.rotateViewport(u,f,t),c=this.getScale(),t.scale(c,c),t.translate(-u,-f),this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?(e(this.last_render_list),r=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):r=this.last_render_list):r=this.instances,l=null,s=0,a=r.length;s<a;++s)(h=r[s],h!==l)&&(this.drawInstance(h,t),l=h);this.useRenderCells&&(this.last_render_list=r);t.restore();this.render_offscreen&&(n.globalCompositeOperation=this.compositeOp,n.globalAlpha=this.opacity,n.drawImage(i,0,0))};n.prototype.drawInstance=function(n,t){if(n.visible&&n.width!==0&&n.height!==0){n.update_bbox();var i=n.bbox;i.right<this.viewLeft||i.bottom<this.viewTop||i.left>this.viewRight||i.top>this.viewBottom||(t.globalCompositeOperation=n.compositeOp,n.draw(t))}};n.prototype.updateViewport=function(n){this.disableAngle=!0;var t=this.canvasToLayer(0,0,!0,!0),i=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1;this.runtime.pixel_rounding&&(t=Math.round(t),i=Math.round(i));this.rotateViewport(t,i,n)};n.prototype.rotateViewport=function(n,t,i){var f=this.getScale(),r,u;this.viewLeft=n;this.viewTop=t;this.viewRight=n+this.runtime.draw_width*(1/f);this.viewBottom=t+this.runtime.draw_height*(1/f);this.viewLeft>this.viewRight&&(r=this.viewLeft,this.viewLeft=this.viewRight,this.viewRight=r);this.viewTop>this.viewBottom&&(r=this.viewTop,this.viewTop=this.viewBottom,this.viewBottom=r);u=this.getAngle();u!==0&&(i&&(i.translate(this.runtime.draw_width/2,this.runtime.draw_height/2),i.rotate(-u),i.translate(this.runtime.draw_width/-2,this.runtime.draw_height/-2)),this.tmprect.set(this.viewLeft,this.viewTop,this.viewRight,this.viewBottom),this.tmprect.offset((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),this.tmpquad.set_from_rotated_rect(this.tmprect,u),this.tmpquad.bounding_box(this.tmprect),this.tmprect.offset((this.viewLeft+this.viewRight)/2,(this.viewTop+this.viewBottom)/2),this.viewLeft=this.tmprect.left,this.viewTop=this.tmprect.top,this.viewRight=this.tmprect.right,this.viewBottom=this.tmprect.bottom)};n.prototype.drawGL_earlyZPass=function(n){var h=this.runtime.draw_width,c=this.runtime.draw_height,r,u,f,t,i,o,s;for(this.render_offscreen=this.forceOwnTexture,this.render_offscreen&&(this.runtime.layer_tex||(this.runtime.layer_tex=n.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),(this.runtime.layer_tex.c2width!==this.runtime.draw_width||this.runtime.layer_tex.c2height!==this.runtime.draw_height)&&(n.deleteTexture(this.runtime.layer_tex),this.runtime.layer_tex=n.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),n.setRenderingToTexture(this.runtime.layer_tex)),this.disableAngle=!0,r=this.canvasToLayer(0,0,!0,!0),u=this.canvasToLayer(0,0,!1,!0),this.disableAngle=!1,this.runtime.pixel_rounding&&(r=Math.round(r),u=Math.round(u)),this.rotateViewport(r,u,null),f=this.getScale(),n.resetModelView(),n.scale(f,f),n.rotateZ(-this.getAngle()),n.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),n.updateModelView(),this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?(e(this.last_render_list),t=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):t=this.last_render_list):t=this.instances,s=null,i=t.length-1;i>=0;--i)(o=t[i],o!==s)&&(this.drawInstanceGL_earlyZPass(t[i],n),s=o);this.useRenderCells&&(this.last_render_list=t);this.transparent||(this.clear_earlyz_index=this.runtime.earlyz_index++,n.setEarlyZIndex(this.clear_earlyz_index),n.setColorFillMode(1,1,1,1),n.fullscreenQuad(),n.restoreEarlyZMode())};n.prototype.drawGL=function(n){var y=this.runtime.draw_width,p=this.runtime.draw_height,f=0,a=0,o,s,h,t,i,v,c,l,r,u;for(this.render_offscreen=this.forceOwnTexture||this.opacity!==1||this.active_effect_types.length>0||this.blend_mode!==0,this.render_offscreen&&(this.runtime.layer_tex||(this.runtime.layer_tex=n.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),(this.runtime.layer_tex.c2width!==this.runtime.draw_width||this.runtime.layer_tex.c2height!==this.runtime.draw_height)&&(n.deleteTexture(this.runtime.layer_tex),this.runtime.layer_tex=n.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),n.setRenderingToTexture(this.runtime.layer_tex),this.transparent&&n.clear(0,0,0,0)),this.transparent||(this.runtime.enableFrontToBack?(n.setEarlyZIndex(this.clear_earlyz_index),n.setColorFillMode(this.background_color[0]/255,this.background_color[1]/255,this.background_color[2]/255,1),n.fullscreenQuad(),n.setTextureFillMode()):n.clear(this.background_color[0]/255,this.background_color[1]/255,this.background_color[2]/255,1)),this.disableAngle=!0,o=this.canvasToLayer(0,0,!0,!0),s=this.canvasToLayer(0,0,!1,!0),this.disableAngle=!1,this.runtime.pixel_rounding&&(o=Math.round(o),s=Math.round(s)),this.rotateViewport(o,s,null),h=this.getScale(),n.resetModelView(),n.scale(h,h),n.rotateZ(-this.getAngle()),n.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),n.updateModelView(),this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?(e(this.last_render_list),t=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):t=this.last_render_list):t=this.instances,l=null,i=0,v=t.length;i<v;++i)(c=t[i],c!==l)&&(this.drawInstanceGL(t[i],n),l=c);this.useRenderCells&&(this.last_render_list=t);this.render_offscreen&&(f=this.active_effect_types.length?this.active_effect_types[0].shaderindex:0,a=this.active_effect_types.length?this.active_effect_types[0].index:0,this.active_effect_types.length!==0&&(this.active_effect_types.length!==1||n.programUsesCrossSampling(f)||this.opacity!==1)?this.layout.renderEffectChain(n,this,null,this.layout.getRenderTarget()):(this.active_effect_types.length===1?(n.switchProgram(f),n.setProgramParameters(this.layout.getRenderTarget(),1/this.runtime.draw_width,1/this.runtime.draw_height,0,0,1,1,h,this.getAngle(),this.viewLeft,this.viewTop,(this.viewLeft+this.viewRight)/2,(this.viewTop+this.viewBottom)/2,this.runtime.kahanTime.sum,this.effect_params[a]),n.programIsAnimated(f)&&(this.runtime.redraw=!0)):n.switchProgram(0),n.setRenderingToTexture(this.layout.getRenderTarget()),n.setOpacity(this.opacity),n.setTexture(this.runtime.layer_tex),n.setBlend(this.srcBlend,this.destBlend),n.resetModelView(),n.updateModelView(),r=this.runtime.draw_width/2,u=this.runtime.draw_height/2,n.quad(-r,u,r,u,r,-u,-r,-u),n.setTexture(null)))};n.prototype.drawInstanceGL=function(n,t){if(n.visible&&n.width!==0&&n.height!==0){n.update_bbox();var i=n.bbox;i.right<this.viewLeft||i.bottom<this.viewTop||i.left>this.viewRight||i.top>this.viewBottom||(t.setEarlyZIndex(n.earlyz_index),n.uses_shaders?this.drawInstanceWithShadersGL(n,t):(t.switchProgram(0),t.setBlend(n.srcBlend,n.destBlend),n.drawGL(t)))}};n.prototype.drawInstanceGL_earlyZPass=function(n,t){if(n.visible&&n.width!==0&&n.height!==0){n.update_bbox();var i=n.bbox;i.right<this.viewLeft||i.bottom<this.viewTop||i.left>this.viewRight||i.top>this.viewBottom||(n.earlyz_index=this.runtime.earlyz_index++,n.blend_mode===0&&n.opacity===1&&n.shaders_preserve_opaqueness&&n.drawGL_earlyZPass)&&(t.setEarlyZIndex(n.earlyz_index),n.drawGL_earlyZPass(t))}};n.prototype.drawInstanceWithShadersGL=function(n,t){var r=n.active_effect_types[0].shaderindex,a=n.active_effect_types[0].index,u=this.getScale(),f,e,o;if(n.active_effect_types.length!==1||t.programUsesCrossSampling(r)||t.programExtendsBox(r)||(n.angle||n.layer.getAngle())&&t.programUsesDest(r)||n.opacity!==1||n.type.plugin.must_predraw)this.layout.renderEffectChain(t,this,n,this.render_offscreen?this.runtime.layer_tex:this.layout.getRenderTarget()),t.resetModelView(),t.scale(u,u),t.rotateZ(-this.getAngle()),t.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),t.updateModelView();else{t.switchProgram(r);t.setBlend(n.srcBlend,n.destBlend);t.programIsAnimated(r)&&(this.runtime.redraw=!0);var s=0,h=0,c=0,l=0;if(t.programUsesDest(r)){var i=n.bbox,v=this.layerToCanvas(i.left,i.top,!0,!0),y=this.layerToCanvas(i.left,i.top,!1,!0),p=this.layerToCanvas(i.right,i.bottom,!0,!0),w=this.layerToCanvas(i.right,i.bottom,!1,!0);s=v/windowWidth;h=1-y/windowHeight;c=p/windowWidth;l=1-w/windowHeight}n.curFrame&&n.curFrame.texture_img?(o=n.curFrame.texture_img,f=1/o.width,e=1/o.height):(f=1/n.width,e=1/n.height);t.setProgramParameters(this.render_offscreen?this.runtime.layer_tex:this.layout.getRenderTarget(),f,e,s,h,c,l,u,this.getAngle(),this.viewLeft,this.viewTop,(this.viewLeft+this.viewRight)/2,(this.viewTop+this.viewBottom)/2,this.runtime.kahanTime.sum,n.effect_params[a]);n.drawGL(t)}};n.prototype.canvasToLayer=function(n,t,i,r){var c=this.runtime.devicePixelRatio,o;this.runtime.isRetina&&(n*=c,t*=c);var l=this.runtime.parallax_x_origin,a=this.runtime.parallax_y_origin,s=(this.layout.scrollX-l)*this.parallaxX+l,h=(this.layout.scrollY-a)*this.parallaxY+a,u=s,f=h,e=1/this.getScale(!r);if(r?(u-=this.runtime.draw_width*e/2,f-=this.runtime.draw_height*e/2):(u-=this.runtime.width*e/2,f-=this.runtime.height*e/2),u+=n*e,f+=t*e,o=this.getAngle(),o!==0){u-=s;f-=h;var v=Math.cos(o),y=Math.sin(o),p=u*v-f*y;f=f*v+u*y;u=p;u+=s;f+=h}return i?u:f};n.prototype.layerToCanvas=function(n,t,i,r){var l=this.runtime.parallax_x_origin,a=this.runtime.parallax_y_origin,o=(this.layout.scrollX-l)*this.parallaxX+l,s=(this.layout.scrollY-a)*this.parallaxY+a,f=o,e=s,h=this.getAngle(),u,c;if(h!==0){n-=o;t-=s;var v=Math.cos(-h),y=Math.sin(-h),p=n*v-t*y;t=t*v+n*y;n=p;n+=o;t+=s}return u=1/this.getScale(!r),r?(f-=this.runtime.draw_width*u/2,e-=this.runtime.draw_height*u/2):(f-=this.runtime.width*u/2,e-=this.runtime.height*u/2),f=(n-f)/u,e=(t-e)/u,c=this.runtime.devicePixelRatio,this.runtime.isRetina&&!r&&(f/=c,e/=c),i?f:e};n.prototype.rotatePt=function(n,t,i){var r,u,f,e;return this.getAngle()===0?i?n:t:(r=this.layerToCanvas(n,t,!0),u=this.layerToCanvas(n,t,!1),this.disableAngle=!0,f=this.canvasToLayer(r,u,!0),e=this.canvasToLayer(r,u,!0),this.disableAngle=!1,i?f:e)};n.prototype.saveToJSON=function(){for(var t,r={s:this.scale,a:this.angle,vl:this.viewLeft,vt:this.viewTop,vr:this.viewRight,vb:this.viewBottom,v:this.visible,bc:this.background_color,t:this.transparent,px:this.parallaxX,py:this.parallaxY,o:this.opacity,zr:this.zoomRate,fx:[],cg:this.created_globals,instances:[]},n=0,i=this.effect_types.length;n<i;n++)t=this.effect_types[n],r.fx.push({name:t.name,active:t.active,params:this.effect_params[t.index]});return r};n.prototype.loadFromJSON=function(n){var t,u,i,f,e,r;for(this.scale=n.s,this.angle=n.a,this.viewLeft=n.vl,this.viewTop=n.vt,this.viewRight=n.vr,this.viewBottom=n.vb,this.visible=n.v,this.background_color=n.bc,this.transparent=n.t,this.parallaxX=n.px,this.parallaxY=n.py,this.opacity=n.o,this.zoomRate=n.zr,this.created_globals=n.cg||[],cr.shallowAssignArray(this.initial_instances,this.startup_initial_instances),e=new cr.ObjectSet,t=0,i=this.created_globals.length;t<i;++t)e.add(this.created_globals[t]);for(t=0,u=0,i=this.initial_instances.length;t<i;++t)e.contains(this.initial_instances[t][2])||(this.initial_instances[u]=this.initial_instances[t],++u);for(cr.truncateArray(this.initial_instances,u),r=n.fx,t=0,i=r.length;t<i;t++)(f=this.getEffectByName(r[t].name),f)&&(f.active=r[t].active,this.effect_params[f.index]=r[t].params);this.updateActiveEffects();this.instances.sort(s);this.zindices_stale=!0};cr.layer=n}(),function(){function w(n,t){var i,r=n.length;switch(r){case 0:return!0;case 1:return n[0]===t[0];case 2:return n[0]===t[0]&&n[1]===t[1];default:for(i=0;i<r;i++)if(n[i]!==t[i])return!1;return!0}}function b(n,t){return n.index-t.index}function s(n){var t,u,r,e,i;for(n.length===2?n[0].index>n[1].index&&(e=n[0],n[0]=n[1],n[1]=e):n.length>2&&n.sort(b),n.length>=f.length&&(f.length=n.length+1),f[n.length]||(f[n.length]=[]),i=f[n.length],t=0,u=i.length;t<u;t++)if(r=i[t],w(n,r))return r;return i.push(n),n}function i(n,t){var r,i,u;for(this.runtime=n,this.triggers={},this.fasttriggers={},this.hasRun=!1,this.includes=new cr.ObjectSet,this.deep_includes=[],this.already_included_sheets=[],this.name=t[0],r=t[1],this.events=[],i=0,u=r.length;i<u;i++)this.init_event(r[i],null,this.events)}function k(n){return cr.plugins_.Sprite&&n===cr.plugins_.Sprite.prototype.cnds.OnFrameChanged?!0:!1}function h(n){this.type=n;this.instances=[];this.else_instances=[];this.select_all=!0}function n(n,t,i){var r,u,o,f,s,e,h;for(this.sheet=n,this.parent=t,this.runtime=n.runtime,this.solModifiers=[],this.solModifiersIncludingParents=[],this.solWriterAfterCnds=!1,this.group=!1,this.initially_activated=!1,this.toplevelevent=!1,this.toplevelgroup=!1,this.has_else_block=!1,this.conditions=[],this.actions=[],this.subevents=[],this.group_name="",this.group=!1,this.initially_activated=!1,this.group_active=!1,this.contained_includes=null,i[1]&&(this.group_name=i[1][1].toLowerCase(),this.group=!0,this.initially_activated=!!i[1][0],this.contained_includes=[],this.group_active=this.initially_activated,this.runtime.allGroups.push(this),this.runtime.groups_by_name[this.group_name]=this),this.orblock=i[2],this.sid=i[4],this.group||(this.runtime.blocksBySid[this.sid.toString()]=this),o=i[5],r=0,u=o.length;r<u;r++)f=new cr.condition(this,o[r]),f.index=r,cr.seal(f),this.conditions.push(f),this.addSolModifier(f.type);for(s=i[6],r=0,u=s.length;r<u;r++)e=new cr.action(this,s[r]),e.index=r,cr.seal(e),this.actions.push(e);if(i.length===8)for(h=i[7],r=0,u=h.length;r<u;r++)this.sheet.init_event(h[r],this,this.subevents);this.is_else_block=!1;this.conditions.length&&(this.is_else_block=this.conditions[0].type==null&&this.conditions[0].func==cr.system_object.prototype.cnds.Else)}function p(n,t){var i,u,r;if(n&&(t.indexOf(n)===-1&&t.push(n),n.is_contained))for(i=0,u=n.container.length;i<u;i++)(r=n.container[i],n!==r)&&t.indexOf(r)===-1&&t.push(r)}function r(n,t){var i,f,r,u;if(this.block=n,this.sheet=n.sheet,this.runtime=n.runtime,this.parameters=[],this.results=[],this.extra={},this.index=-1,this.anyParamVariesPerInstance=!1,this.func=this.runtime.GetObjectReference(t[1]),this.trigger=t[3]>0,this.fasttrigger=t[3]===2,this.looping=t[4],this.inverted=t[5],this.isstatic=t[6],this.sid=t[7],this.runtime.cndsBySid[this.sid.toString()]=this,t[0]===-1?(this.type=null,this.run=this.run_system,this.behaviortype=null,this.beh_index=-1):(this.type=this.runtime.types_by_index[t[0]],this.run=this.isstatic?this.run_static:this.run_object,t[2]?(this.behaviortype=this.type.getBehaviorByName(t[2]),this.beh_index=this.type.getBehaviorIndexByName(t[2])):(this.behaviortype=null,this.beh_index=-1),this.block.parent&&this.block.parent.setSolWriterAfterCnds()),this.fasttrigger&&(this.run=this.run_true),t.length===10){for(r=t[9],i=0,f=r.length;i<f;i++)u=new cr.parameter(this,r[i]),cr.seal(u),this.parameters.push(u);this.results.length=r.length}}function c(n,t){var i,f,r,u;if(this.block=n,this.sheet=n.sheet,this.runtime=n.runtime,this.parameters=[],this.results=[],this.extra={},this.index=-1,this.anyParamVariesPerInstance=!1,this.func=this.runtime.GetObjectReference(t[1]),t[0]===-1?(this.type=null,this.run=this.run_system,this.behaviortype=null,this.beh_index=-1):(this.type=this.runtime.types_by_index[t[0]],this.run=this.run_object,t[2]?(this.behaviortype=this.type.getBehaviorByName(t[2]),this.beh_index=this.type.getBehaviorIndexByName(t[2])):(this.behaviortype=null,this.beh_index=-1)),this.sid=t[3],this.runtime.actsBySid[this.sid.toString()]=this,t.length===6){for(r=t[5],i=0,f=r.length;i<f;i++)u=new cr.parameter(this,r[i]),cr.seal(u),this.parameters.push(u);this.results.length=r.length}}function a(){return e++,l.length===e&&l.push(new cr.expvalue),l[e]}function v(){e--}function t(n,t){this.owner=n;this.block=n.block;this.sheet=n.sheet;this.runtime=n.runtime;this.type=t[0];this.expression=null;this.solindex=0;this.get=null;this.combosel=0;this.layout=null;this.key=0;this.object=null;this.index=0;this.varname=null;this.eventvar=null;this.fileinfo=null;this.subparams=null;this.variadicret=null;this.subparams=null;this.variadicret=null;this.variesPerInstance=!1;var i,u,r;switch(t[0]){case 0:case 7:this.expression=new cr.expNode(this,t[1]);this.solindex=0;this.get=this.get_exp;break;case 1:this.expression=new cr.expNode(this,t[1]);this.solindex=0;this.get=this.get_exp_str;break;case 5:this.expression=new cr.expNode(this,t[1]);this.solindex=0;this.get=this.get_layer;break;case 3:case 8:this.combosel=t[1];this.get=this.get_combosel;break;case 6:this.layout=this.runtime.layouts[t[1]];this.get=this.get_layout;break;case 9:this.key=t[1];this.get=this.get_key;break;case 4:this.object=this.runtime.types_by_index[t[1]];this.get=this.get_object;this.block.addSolModifier(this.object);this.owner instanceof cr.action?this.block.setSolWriterAfterCnds():this.block.parent&&this.block.parent.setSolWriterAfterCnds();break;case 10:this.index=t[1];n.type&&n.type.is_family?(this.get=this.get_familyvar,this.variesPerInstance=!0):this.get=this.get_instvar;break;case 11:this.varname=t[1];this.eventvar=null;this.get=this.get_eventvar;break;case 2:case 12:this.fileinfo=t[1];this.get=this.get_audiofile;break;case 13:for(this.get=this.get_variadic,this.subparams=[],this.variadicret=[],i=1,u=t.length;i<u;i++)r=new cr.parameter(this.owner,t[i]),cr.seal(r),this.subparams.push(r),this.variadicret.push(0)}}function o(n,t,i){this.sheet=n;this.parent=t;this.runtime=n.runtime;this.solModifiers=[];this.name=i[1];this.vartype=i[2];this.initial=i[3];this.is_static=!!i[4];this.is_constant=!!i[5];this.sid=i[6];this.runtime.varsBySid[this.sid.toString()]=this;this.data=this.initial;this.parent?(this.localIndex=this.is_static||this.is_constant?-1:this.runtime.stackLocalCount++,this.runtime.all_local_vars.push(this)):(this.localIndex=-1,this.runtime.all_global_vars.push(this))}function u(n,t,i){this.sheet=n;this.parent=t;this.runtime=n.runtime;this.solModifiers=[];this.include_sheet=null;this.include_sheet_name=i[1];this.active=!0}function y(){this.temp_parents_arr=[];this.reset(null);cr.seal(this)}var f=[],l,e;i.prototype.toString=function(){return this.name};i.prototype.init_event=function(n,t,i){var r,u,o,f,e;switch(n[0]){case 0:if(r=new cr.eventblock(this,t,n),cr.seal(r),r.orblock)for(i.push(r),u=0,o=r.conditions.length;u<o;u++)r.conditions[u].trigger&&this.init_trigger(r,u);else r.is_trigger()?this.init_trigger(r,0):i.push(r);break;case 1:f=new cr.eventvariable(this,t,n);cr.seal(f);i.push(f);break;case 2:e=new cr.eventinclude(this,t,n);cr.seal(e);i.push(e)}};i.prototype.postInit=function(){for(var n=0,t=this.events.length;n<t;n++)this.events[n].postInit(n<t-1&&this.events[n+1].is_else_block)};i.prototype.updateDeepIncludes=function(){cr.clearArray(this.deep_includes);cr.clearArray(this.already_included_sheets);this.addDeepIncludes(this);cr.clearArray(this.already_included_sheets)};i.prototype.addDeepIncludes=function(n){for(var r,t,o=n.deep_includes,f=n.already_included_sheets,e=this.includes.valuesRef(),i=0,u=e.length;i<u;++i)(r=e[i],t=r.include_sheet,!r.isActive()||n===t||f.indexOf(t)>-1)||(f.push(t),t.addDeepIncludes(n),o.push(t))};i.prototype.run=function(n){var t,r,i;for(this.runtime.resuming_breakpoint||(this.hasRun=!0,n||(this.runtime.isRunningEvents=!0)),t=0,r=this.events.length;t<r;t++)i=this.events[t],i.run(),this.runtime.clearSol(i.solModifiers),this.runtime.hasPendingInstances&&this.runtime.ClearDeathRow();n||(this.runtime.isRunningEvents=!1)};i.prototype.init_trigger=function(n,t){var u,h,a,c,r,f,l,e,o,i,s;if(n.orblock||this.runtime.triggers_to_postinit.push(n),u=n.conditions[t],h=u.type?u.type.name:"system",a=u.fasttrigger,c=a?this.fasttriggers:this.triggers,c[h]||(c[h]=[]),r=c[h],f=u.func,a){if(!u.parameters.length)return;if(l=u.parameters[0],l.type!==1||l.expression.type!==2)return;for(o=l.expression.value.toLowerCase(),i=0,s=r.length;i<s;i++)if(r[i].method==f){e=r[i].evs;e[o]?e[o].push([n,t]):e[o]=[[n,t]];return}e={};e[o]=[[n,t]];r.push({method:f,evs:e})}else{for(i=0,s=r.length;i<s;i++)if(r[i].method==f){r[i].evs.push([n,t]);return}k(f)?r.unshift({method:f,evs:[[n,t]]}):r.push({method:f,evs:[[n,t]]})}};cr.eventsheet=i;h.prototype.hasObjects=function(){return this.select_all?this.type.instances.length:this.instances.length};h.prototype.getObjects=function(){return this.select_all?this.type.instances:this.instances};h.prototype.pick_one=function(n){if(n)if(n.runtime.getCurrentEventStack().current_event.orblock){this.select_all&&(cr.clearArray(this.instances),cr.shallowAssignArray(this.else_instances,n.type.instances),this.select_all=!1);var t=this.else_instances.indexOf(n);t!==-1&&(this.instances.push(this.else_instances[t]),this.else_instances.splice(t,1))}else this.select_all=!1,cr.clearArray(this.instances),this.instances[0]=n};cr.selection=h;window._c2hh_="DE239334C48DAB94C32CB8CBD790EBFCDB31D26F";n.prototype.postInit=function(n){var i=this.parent,t,r;if(this.group)for(this.toplevelgroup=!0;i;){if(!i.group){this.toplevelgroup=!1;break}i=i.parent}for(this.toplevelevent=!this.is_trigger()&&(!this.parent||this.parent.group&&this.parent.toplevelgroup),this.has_else_block=!!n,this.solModifiersIncludingParents=this.solModifiers.slice(0),i=this.parent;i;){for(t=0,r=i.solModifiers.length;t<r;t++)this.addParentSolModifier(i.solModifiers[t]);i=i.parent}for(this.solModifiers=s(this.solModifiers),this.solModifiersIncludingParents=s(this.solModifiersIncludingParents),t=0,r=this.conditions.length;t<r;t++)this.conditions[t].postInit();for(t=0,r=this.actions.length;t<r;t++)this.actions[t].postInit();for(t=0,r=this.subevents.length;t<r;t++)this.subevents[t].postInit(t<r-1&&this.subevents[t+1].is_else_block)};n.prototype.setGroupActive=function(n){if(this.group_active!==!!n){this.group_active=!!n;for(var t=0,i=this.contained_includes.length;t<i;++t)this.contained_includes[t].updateActive();i>0&&this.runtime.running_layout.event_sheet&&this.runtime.running_layout.event_sheet.updateDeepIncludes()}};n.prototype.addSolModifier=function(n){p(n,this.solModifiers)};n.prototype.addParentSolModifier=function(n){p(n,this.solModifiersIncludingParents)};n.prototype.setSolWriterAfterCnds=function(){this.solWriterAfterCnds=!0;this.parent&&this.parent.setSolWriterAfterCnds()};n.prototype.is_trigger=function(){return this.conditions.length?this.conditions[0].trigger:!1};n.prototype.run=function(){var i,f,r=!1,u,e=this.runtime,n=this.runtime.getCurrentEventStack(),t;if(n.current_event=this,t=this.conditions,this.is_else_block||(n.else_branch_ran=!1),this.orblock){for(t.length===0&&(r=!0),n.cndindex=0,i=t.length;n.cndindex<i;n.cndindex++)(f=t[n.cndindex],f.trigger)||(u=f.run(),u&&(r=!0));n.last_event_true=r;r&&this.run_actions_and_subevents()}else{for(n.cndindex=0,i=t.length;n.cndindex<i;n.cndindex++)if(u=t[n.cndindex].run(),!u){n.last_event_true=!1;this.toplevelevent&&e.hasPendingInstances&&e.ClearDeathRow();return}n.last_event_true=!0;this.run_actions_and_subevents()}this.end_run(n)};n.prototype.end_run=function(n){n.last_event_true&&this.has_else_block&&(n.else_branch_ran=!0);this.toplevelevent&&this.runtime.hasPendingInstances&&this.runtime.ClearDeathRow()};n.prototype.run_orblocktrigger=function(n){var t=this.runtime.getCurrentEventStack();t.current_event=this;this.conditions[n].run()&&(this.run_actions_and_subevents(),this.runtime.getCurrentEventStack().last_event_true=!0)};n.prototype.run_actions_and_subevents=function(){var n=this.runtime.getCurrentEventStack(),t;for(n.actindex=0,t=this.actions.length;n.actindex<t;n.actindex++)if(this.actions[n.actindex].run())return;this.run_subevents()};n.prototype.resume_actions_and_subevents=function(){for(var n=this.runtime.getCurrentEventStack(),t=this.actions.length;n.actindex<t;n.actindex++)if(this.actions[n.actindex].run())return;this.run_subevents()};n.prototype.run_subevents=function(){if(this.subevents.length){var n,i,t,r,u=this.subevents.length-1;if(this.runtime.pushEventStack(this),this.solWriterAfterCnds)for(n=0,i=this.subevents.length;n<i;n++)t=this.subevents[n],r=!this.toplevelgroup||!this.group&&n<u,r&&this.runtime.pushCopySol(t.solModifiers),t.run(),r?this.runtime.popSol(t.solModifiers):this.runtime.clearSol(t.solModifiers);else for(n=0,i=this.subevents.length;n<i;n++)this.subevents[n].run();this.runtime.popEventStack()}};n.prototype.run_pretrigger=function(){var n=this.runtime.getCurrentEventStack(),t,i;for(n.current_event=this,t=!1,n.cndindex=0,i=this.conditions.length;n.cndindex<i;n.cndindex++)if(this.conditions[n.cndindex].run())t=!0;else if(!this.orblock)return!1;return this.orblock?t:!0};n.prototype.retrigger=function(){this.runtime.execcount++;var i=this.runtime.getCurrentEventStack().cndindex,t,n=this.runtime.pushEventStack(this);if(!this.orblock)for(n.cndindex=i+1,t=this.conditions.length;n.cndindex<t;n.cndindex++)if(!this.conditions[n.cndindex].run())return this.runtime.popEventStack(),!1;return this.run_actions_and_subevents(),this.runtime.popEventStack(),!0};n.prototype.isFirstConditionOfType=function(n){var t=n.index;if(t===0)return!0;for(--t;t>=0;--t)if(this.conditions[t].type===n.type)return!1;return!0};cr.eventblock=n;r.prototype.postInit=function(){for(var t,n=0,i=this.parameters.length;n<i;n++)t=this.parameters[n],t.postInit(),t.variesPerInstance&&(this.anyParamVariesPerInstance=!0)};r.prototype.run_true=function(){return!0};r.prototype.run_system=function(){for(var n=0,t=this.parameters.length;n<t;n++)this.results[n]=this.parameters[n].get();return cr.xor(this.func.apply(this.runtime.system,this.results),this.inverted)};r.prototype.run_static=function(){for(var i,n=0,t=this.parameters.length;n<t;n++)this.results[n]=this.parameters[n].get();return i=this.func.apply(this.behaviortype?this.behaviortype:this.type,this.results),this.type.applySolToContainer(),i};r.prototype.run_object=function(){var i,n,h,a,r,f,v,ft,t,e,tt,o=this.type,u=o.getCurrentSol(),k=this.block.orblock&&!this.trigger,y=0,d=o.is_contained,et=o.is_family,ot=o.family_index,g=this.beh_index,it=g>-1,nt=this.anyParamVariesPerInstance,c=this.parameters,s=this.results,rt=this.inverted,p=this.func,l,ut,w,b,st;if(nt)for(n=0,r=c.length;n<r;++n)f=c[n],f.variesPerInstance||(s[n]=f.get(0));else for(n=0,r=c.length;n<r;++n)s[n]=c[n].get(0);if(u.select_all){for(cr.clearArray(u.instances),cr.clearArray(u.else_instances),l=o.instances,i=0,a=l.length;i<a;++i){if(t=l[i],nt)for(n=0,r=c.length;n<r;++n)f=c[n],f.variesPerInstance&&(s[n]=f.get(i));it?(y=0,et&&(y=t.type.family_beh_map[ot]),v=p.apply(t.behavior_insts[g+y],s)):v=p.apply(t,s);ft=cr.xor(v,rt);ft?u.instances.push(t):k&&u.else_instances.push(t)}return o.finish&&o.finish(!0),u.select_all=!1,o.applySolToContainer(),u.hasObjects()}for(h=0,w=k&&!this.block.isFirstConditionOfType(this),l=w?u.else_instances:u.instances,b=!1,i=0,a=l.length;i<a;++i){if(t=l[i],nt)for(n=0,r=c.length;n<r;++n)f=c[n],f.variesPerInstance&&(s[n]=f.get(i));if(it?(y=0,et&&(y=t.type.family_beh_map[ot]),v=p.apply(t.behavior_insts[g+y],s)):v=p.apply(t,s),cr.xor(v,rt))if(b=!0,w){if(u.instances.push(t),d)for(n=0,r=t.siblings.length;n<r;n++)e=t.siblings[n],e.type.getCurrentSol().instances.push(e)}else{if(l[h]=t,d)for(n=0,r=t.siblings.length;n<r;n++)e=t.siblings[n],e.type.getCurrentSol().instances[h]=e;h++}else if(w){if(l[h]=t,d)for(n=0,r=t.siblings.length;n<r;n++)e=t.siblings[n],e.type.getCurrentSol().else_instances[h]=e;h++}else if(k&&(u.else_instances.push(t),d))for(n=0,r=t.siblings.length;n<r;n++)e=t.siblings[n],e.type.getCurrentSol().else_instances.push(e)}if(cr.truncateArray(l,h),d)for(ut=o.container,i=0,a=ut.length;i<a;i++)tt=ut[i].getCurrentSol(),w?cr.truncateArray(tt.else_instances,h):cr.truncateArray(tt.instances,h);if(st=b,w&&!b)for(i=0,a=u.instances.length;i<a;i++){if(t=u.instances[i],nt)for(n=0,r=c.length;n<r;n++)f=c[n],f.variesPerInstance&&(s[n]=f.get(i));if(v=it?p.apply(t.behavior_insts[g],s):p.apply(t,s),cr.xor(v,rt)){b=!0;break}}return o.finish&&o.finish(st||k),k?b:u.hasObjects()};cr.condition=r;c.prototype.postInit=function(){for(var t,n=0,i=this.parameters.length;n<i;n++)t=this.parameters[n],t.postInit(),t.variesPerInstance&&(this.anyParamVariesPerInstance=!0)};c.prototype.run_system=function(){for(var u=this.runtime,i=this.parameters,r=this.results,n=0,t=i.length;n<t;++n)r[n]=i[n].get();return this.func.apply(u.system,r)};c.prototype.run_object=function(){var o=this.type,h=this.beh_index,y=o.family_index,c=this.anyParamVariesPerInstance,t=this.parameters,u=this.results,l=this.func,a=o.getCurrentSol().getObjects(),p=o.is_family,w=h>-1,f,n,v,i,r,e,s;if(c)for(n=0,i=t.length;n<i;++n)r=t[n],r.variesPerInstance||(u[n]=r.get(0));else for(n=0,i=t.length;n<i;++n)u[n]=t[n].get(0);for(f=0,v=a.length;f<v;++f){if(e=a[f],c)for(n=0,i=t.length;n<i;++n)r=t[n],r.variesPerInstance&&(u[n]=r.get(f));w?(s=0,p&&(s=e.type.family_beh_map[y]),l.apply(e.behavior_insts[h+s],u)):l.apply(e,u)}return!1};cr.action=c;l=[];e=-1;t.prototype.postInit=function(){var n,t;if(this.type===11)this.eventvar=this.runtime.getEventVariableByName(this.varname,this.block.parent);else if(this.type===13)for(n=0,t=this.subparams.length;n<t;n++)this.subparams[n].postInit();this.expression&&this.expression.postInit()};t.prototype.maybeVaryForType=function(n){if(!this.variesPerInstance&&n&&!n.plugin.singleglobal){this.variesPerInstance=!0;return}};t.prototype.setVaries=function(){this.variesPerInstance=!0};t.prototype.get_exp=function(n){this.solindex=n||0;var t=a();return this.expression.get(t),v(),t.data};t.prototype.get_exp_str=function(n){this.solindex=n||0;var t=a();return this.expression.get(t),v(),cr.is_string(t.data)?t.data:""};t.prototype.get_object=function(){return this.object};t.prototype.get_combosel=function(){return this.combosel};t.prototype.get_layer=function(n){this.solindex=n||0;var t=a();return this.expression.get(t),v(),t.is_number()?this.runtime.getLayerByNumber(t.data):this.runtime.getLayerByName(t.data)};t.prototype.get_layout=function(){return this.layout};t.prototype.get_key=function(){return this.key};t.prototype.get_instvar=function(){return this.index};t.prototype.get_familyvar=function(n){var u=n||0,t=this.owner.type,i=null,r=t.getCurrentSol(),f=r.getObjects();if(f.length)i=f[u%f.length].type;else if(r.else_instances.length)i=r.else_instances[u%r.else_instances.length].type;else if(t.instances.length)i=t.instances[u%t.instances.length].type;else return 0;return this.index+i.family_var_map[t.family_index]};t.prototype.get_eventvar=function(){return this.eventvar};t.prototype.get_audiofile=function(){return this.fileinfo};t.prototype.get_variadic=function(){for(var n=0,t=this.subparams.length;n<t;n++)this.variadicret[n]=this.subparams[n].get();return this.variadicret};cr.parameter=t;o.prototype.postInit=function(){this.solModifiers=s(this.solModifiers)};o.prototype.setValue=function(n){var t=this.runtime.getCurrentLocalVarStack();this.parent&&!this.is_static&&t?(this.localIndex>=t.length&&(t.length=this.localIndex+1),t[this.localIndex]=n):this.data=n};o.prototype.getValue=function(){var n=this.runtime.getCurrentLocalVarStack();return!this.parent||this.is_static||!n||this.is_constant?this.data:this.localIndex>=n.length?this.initial:typeof n[this.localIndex]=="undefined"?this.initial:n[this.localIndex]};o.prototype.run=function(){!this.parent||this.is_static||this.is_constant||this.setValue(this.initial)};cr.eventvariable=o;u.prototype.toString=function(){return"include:"+this.include_sheet.toString()};u.prototype.postInit=function(){this.include_sheet=this.runtime.eventsheets[this.include_sheet_name];this.sheet.includes.add(this);this.solModifiers=s(this.solModifiers);for(var n=this.parent;n;)n.group&&n.contained_includes.push(this),n=n.parent;this.updateActive()};u.prototype.run=function(){this.parent&&this.runtime.pushCleanSol(this.runtime.types_by_index);this.include_sheet.hasRun||this.include_sheet.run(!0);this.parent&&this.runtime.popSol(this.runtime.types_by_index)};u.prototype.updateActive=function(){for(var n=this.parent;n;){if(n.group&&!n.group_active){this.active=!1;return}n=n.parent}this.active=!0};u.prototype.isActive=function(){return this.active};cr.eventinclude=u;y.prototype.reset=function(n){this.current_event=n;this.cndindex=0;this.actindex=0;cr.clearArray(this.temp_parents_arr);this.last_event_true=!1;this.else_branch_ran=!1;this.any_true_state=!1};y.prototype.isModifierAfterCnds=function(){return this.current_event.solWriterAfterCnds?!0:this.cndindex<this.current_event.conditions.length-1?!!this.current_event.solModifiers.length:!1};cr.eventStackFrame=y}(),function(){function n(n,t){var i,r,u;this.owner=n;this.runtime=n.runtime;this.type=t[0];this.get=[this.eval_int,this.eval_float,this.eval_string,this.eval_unaryminus,this.eval_add,this.eval_subtract,this.eval_multiply,this.eval_divide,this.eval_mod,this.eval_power,this.eval_and,this.eval_or,this.eval_equal,this.eval_notequal,this.eval_less,this.eval_lessequal,this.eval_greater,this.eval_greaterequal,this.eval_conditional,this.eval_system_exp,this.eval_object_exp,this.eval_instvar_exp,this.eval_behavior_exp,this.eval_eventvar_exp][this.type];i=null;this.value=null;this.first=null;this.second=null;this.third=null;this.func=null;this.results=null;this.parameters=null;this.object_type=null;this.beh_index=-1;this.instance_expr=null;this.varindex=-1;this.behavior_type=null;this.varname=null;this.eventvar=null;this.return_string=!1;switch(this.type){case 0:case 1:case 2:this.value=t[1];break;case 3:this.first=new cr.expNode(n,t[1]);break;case 18:this.first=new cr.expNode(n,t[1]);this.second=new cr.expNode(n,t[2]);this.third=new cr.expNode(n,t[3]);break;case 19:this.func=this.runtime.GetObjectReference(t[1]);(this.func===cr.system_object.prototype.exps.random||this.func===cr.system_object.prototype.exps.choose)&&this.owner.setVaries();this.results=[];this.parameters=[];t.length===3?(i=t[2],this.results.length=i.length+1):this.results.length=1;break;case 20:this.object_type=this.runtime.types_by_index[t[1]];this.beh_index=-1;this.func=this.runtime.GetObjectReference(t[2]);this.return_string=t[3];cr.plugins_.Function&&this.func===cr.plugins_.Function.prototype.exps.Call&&this.owner.setVaries();this.instance_expr=t[4]?new cr.expNode(n,t[4]):null;this.results=[];this.parameters=[];t.length===6?(i=t[5],this.results.length=i.length+1):this.results.length=1;break;case 21:this.object_type=this.runtime.types_by_index[t[1]];this.return_string=t[2];this.instance_expr=t[3]?new cr.expNode(n,t[3]):null;this.varindex=t[4];break;case 22:this.object_type=this.runtime.types_by_index[t[1]];this.behavior_type=this.object_type.getBehaviorByName(t[2]);this.beh_index=this.object_type.getBehaviorIndexByName(t[2]);this.func=this.runtime.GetObjectReference(t[3]);this.return_string=t[4];this.instance_expr=t[5]?new cr.expNode(n,t[5]):null;this.results=[];this.parameters=[];t.length===7?(i=t[6],this.results.length=i.length+1):this.results.length=1;break;case 23:this.varname=t[1];this.eventvar=null}if(this.owner.maybeVaryForType(this.object_type),this.type>=4&&this.type<=17&&(this.first=new cr.expNode(n,t[1]),this.second=new cr.expNode(n,t[2])),i)for(r=0,u=i.length;r<u;r++)this.parameters.push(new cr.expNode(n,i[r]));cr.seal(this)}function i(){return++u,f.length===u&&f.push(new cr.expvalue),f[u]}function t(){--u}function e(n,t,i){for(var r=0,u=n.length;r<u;++r)n[r].get(i),t[r+1]=i.data}function r(n,t){this.type=n||cr.exptype.Integer;this.data=t||0;this.object_class=null;this.type==cr.exptype.Integer&&(this.data=Math.floor(this.data));cr.seal(this)}n.prototype.postInit=function(){if(this.type===23&&(this.eventvar=this.owner.runtime.getEventVariableByName(this.varname,this.owner.block.parent)),this.first&&this.first.postInit(),this.second&&this.second.postInit(),this.third&&this.third.postInit(),this.instance_expr&&this.instance_expr.postInit(),this.parameters)for(var n=0,t=this.parameters.length;n<t;n++)this.parameters[n].postInit()};var f=[],u=-1;n.prototype.eval_system_exp=function(n){var f=this.parameters,r=this.results,u;r[0]=n;u=i();e(f,r,u);t();this.func.apply(this.runtime.system,r)};n.prototype.eval_object_exp=function(n){var s=this.object_type,h=this.results,a=this.parameters,l=this.instance_expr,v=this.func,r=this.owner.solindex,c=s.getCurrentSol(),u=c.getObjects(),f,o,y;if(!u.length)if(c.else_instances.length)u=c.else_instances;else{this.return_string?n.set_string(""):n.set_int(0);return}h[0]=n;n.object_class=s;f=i();e(a,h,f);l&&(l.get(f),f.is_number()&&(r=f.data,u=s.instances));t();o=u.length;(r>=o||r<=-o)&&(r%=o);r<0&&(r+=o);y=v.apply(u[r],h)};n.prototype.eval_behavior_exp=function(n){var u=this.object_type,h=this.results,y=this.parameters,v=this.instance_expr,p=this.beh_index,w=this.func,r=this.owner.solindex,c=u.getCurrentSol(),f=c.getObjects(),o,s,l,a,b;if(!f.length)if(c.else_instances.length)f=c.else_instances;else{this.return_string?n.set_string(""):n.set_int(0);return}h[0]=n;n.object_class=u;o=i();e(y,h,o);v&&(v.get(o),o.is_number()&&(r=o.data,f=u.instances));t();s=f.length;(r>=s||r<=-s)&&(r%=s);r<0&&(r+=s);l=f[r];a=0;u.is_family&&(a=l.type.family_beh_map[u.family_index]);b=w.apply(l.behavior_insts[p+a],h)};n.prototype.eval_instvar_exp=function(n){var v=this.instance_expr,f=this.object_type,y=this.varindex,r=this.owner.solindex,l=f.getCurrentSol(),s=l.getObjects(),e,h,c,o,a,u;if(!s.length)if(l.else_instances.length)s=l.else_instances;else{this.return_string?n.set_string(""):n.set_int(0);return}if(v){if(h=i(),v.get(h),h.is_number()){r=h.data;c=f.instances;c.length!==0&&(r%=c.length,r<0&&(r+=c.length));e=f.getInstanceByIID(r);u=e.instance_vars[y];cr.is_string(u)?n.set_string(u):n.set_float(u);t();return}t()}o=s.length;(r>=o||r<=-o)&&(r%=o);r<0&&(r+=o);e=s[r];a=0;f.is_family&&(a=e.type.family_var_map[f.family_index]);u=e.instance_vars[y+a];cr.is_string(u)?n.set_string(u):n.set_float(u)};n.prototype.eval_int=function(n){n.type=cr.exptype.Integer;n.data=this.value};n.prototype.eval_float=function(n){n.type=cr.exptype.Float;n.data=this.value};n.prototype.eval_string=function(n){n.type=cr.exptype.String;n.data=this.value};n.prototype.eval_unaryminus=function(n){this.first.get(n);n.is_number()&&(n.data=-n.data)};n.prototype.eval_add=function(n){this.first.get(n);var r=i();this.second.get(r);n.is_number()&&r.is_number()&&(n.data+=r.data,r.is_float()&&n.make_float());t()};n.prototype.eval_subtract=function(n){this.first.get(n);var r=i();this.second.get(r);n.is_number()&&r.is_number()&&(n.data-=r.data,r.is_float()&&n.make_float());t()};n.prototype.eval_multiply=function(n){this.first.get(n);var r=i();this.second.get(r);n.is_number()&&r.is_number()&&(n.data*=r.data,r.is_float()&&n.make_float());t()};n.prototype.eval_divide=function(n){this.first.get(n);var r=i();this.second.get(r);n.is_number()&&r.is_number()&&(n.data/=r.data,n.make_float());t()};n.prototype.eval_mod=function(n){this.first.get(n);var r=i();this.second.get(r);n.is_number()&&r.is_number()&&(n.data%=r.data,r.is_float()&&n.make_float());t()};n.prototype.eval_power=function(n){this.first.get(n);var r=i();this.second.get(r);n.is_number()&&r.is_number()&&(n.data=Math.pow(n.data,r.data),r.is_float()&&n.make_float());t()};n.prototype.eval_and=function(n){this.first.get(n);var r=i();this.second.get(r);r.is_string()||n.is_string()?this.eval_and_stringconcat(n,r):this.eval_and_logical(n,r);t()};n.prototype.eval_and_stringconcat=function(n,t){n.is_string()&&t.is_string()?this.eval_and_stringconcat_str_str(n,t):this.eval_and_stringconcat_num(n,t)};n.prototype.eval_and_stringconcat_str_str=function(n,t){n.data+=t.data};n.prototype.eval_and_stringconcat_num=function(n,t){n.is_string()?n.data+=(Math.round(t.data*1e10)/1e10).toString():n.set_string(n.data.toString()+t.data)};n.prototype.eval_and_logical=function(n,t){n.set_int(n.data&&t.data?1:0)};n.prototype.eval_or=function(n){this.first.get(n);var r=i();this.second.get(r);n.is_number()&&r.is_number()&&(n.data||r.data?n.set_int(1):n.set_int(0));t()};n.prototype.eval_conditional=function(n){this.first.get(n);n.data?this.second.get(n):this.third.get(n)};n.prototype.eval_equal=function(n){this.first.get(n);var r=i();this.second.get(r);n.set_int(n.data===r.data?1:0);t()};n.prototype.eval_notequal=function(n){this.first.get(n);var r=i();this.second.get(r);n.set_int(n.data!==r.data?1:0);t()};n.prototype.eval_less=function(n){this.first.get(n);var r=i();this.second.get(r);n.set_int(n.data<r.data?1:0);t()};n.prototype.eval_lessequal=function(n){this.first.get(n);var r=i();this.second.get(r);n.set_int(n.data<=r.data?1:0);t()};n.prototype.eval_greater=function(n){this.first.get(n);var r=i();this.second.get(r);n.set_int(n.data>r.data?1:0);t()};n.prototype.eval_greaterequal=function(n){this.first.get(n);var r=i();this.second.get(r);n.set_int(n.data>=r.data?1:0);t()};n.prototype.eval_eventvar_exp=function(n){var t=this.eventvar.getValue();cr.is_number(t)?n.set_float(t):n.set_string(t)};cr.expNode=n;r.prototype.is_int=function(){return this.type===cr.exptype.Integer};r.prototype.is_float=function(){return this.type===cr.exptype.Float};r.prototype.is_number=function(){return this.type===cr.exptype.Integer||this.type===cr.exptype.Float};r.prototype.is_string=function(){return this.type===cr.exptype.String};r.prototype.make_int=function(){this.is_int()||(this.is_float()?this.data=Math.floor(this.data):this.is_string()&&(this.data=parseInt(this.data,10)),this.type=cr.exptype.Integer)};r.prototype.make_float=function(){this.is_float()||(this.is_string()&&(this.data=parseFloat(this.data)),this.type=cr.exptype.Float)};r.prototype.make_string=function(){this.is_string()||(this.data=this.data.toString(),this.type=cr.exptype.String)};r.prototype.set_int=function(n){this.type=cr.exptype.Integer;this.data=Math.floor(n)};r.prototype.set_float=function(n){this.type=cr.exptype.Float;this.data=n};r.prototype.set_string=function(n){this.type=cr.exptype.String;this.data=n};r.prototype.set_any=function(n){cr.is_number(n)?(this.type=cr.exptype.Float,this.data=n):cr.is_string(n)?(this.type=cr.exptype.String,this.data=n.toString()):(this.type=cr.exptype.Integer,this.data=0)};cr.expvalue=r;cr.exptype={Integer:0,Float:1,String:2}}();cr.system_object=function(n){this.runtime=n;this.waits=[]};cr.system_object.prototype.saveToJSON=function(){var e={},u,s,t,f,i,n,h,o,c,r;for(e.waits=[],c=e.waits,u=0,s=this.waits.length;u<s;u++){for(n=this.waits[u],r={t:n.time,st:n.signaltag,s:n.signalled,ev:n.ev.sid,sm:[],sols:{}},n.ev.actions[n.actindex]&&(r.act=n.ev.actions[n.actindex].sid),t=0,f=n.solModifiers.length;t<f;t++)r.sm.push(n.solModifiers[t].sid);for(i in n.sols)if(n.sols.hasOwnProperty(i)){for(h=this.runtime.types_by_index[parseInt(i,10)],o={sa:n.sols[i].sa,insts:[]},t=0,f=n.sols[i].insts.length;t<f;t++)o.insts.push(n.sols[i].insts[t].uid);r.sols[h.sid.toString()]=o}c.push(r)}return e};cr.system_object.prototype.loadFromJSON=function(n){var v=n.waits,o,y,t,u,s,r,i,e,h,f,c,l,a;for(cr.clearArray(this.waits),o=0,y=v.length;o<y;o++)if(r=v[o],e=this.runtime.blocksBySid[r.ev.toString()],e){for(h=-1,t=0,u=e.actions.length;t<u;t++)if(e.actions[t].sid===r.act){h=t;break}if(h!==-1){for(i={},i.sols={},i.solModifiers=[],i.deleteme=!1,i.time=r.t,i.signaltag=r.st||"",i.signalled=!!r.s,i.ev=e,i.actindex=h,t=0,u=r.sm.length;t<u;t++)f=this.runtime.getObjectTypeBySid(r.sm[t]),f&&i.solModifiers.push(f);for(s in r.sols)if(r.sols.hasOwnProperty(s)){if(f=this.runtime.getObjectTypeBySid(parseInt(s,10)),!f)continue;for(c=r.sols[s],l={sa:c.sa,insts:[]},t=0,u=c.insts.length;t<u;t++)a=this.runtime.getObjectByUID(c.insts[t]),a&&l.insts.push(a);i.sols[f.index.toString()]=l}this.waits.push(i)}}},function(){function i(){}function g(n,t){var i=n.extra.c2_feo_val,r=t.extra.c2_feo_val;return cr.is_number(i)&&cr.is_number(r)?i-r:(i=""+i,r=""+r,i<r?-1:i>r?1:0)}function f(n,t){return h&&n===a&&t===v||(h=new RegExp(n,t),a=n,v=t),h.lastIndex=0,h}function t(){}function y(){var n;return c.length?n=c.pop():(n={},n.sols={},n.solModifiers=[]),n.deleteme=!1,n}function nt(n){cr.wipe(n.sols);cr.clearArray(n.solModifiers);c.push(n)}function p(){var n;return l.length?n=l.pop():(n={},n.insts=[]),n.sa=!1,n}function tt(n){cr.clearArray(n.insts);l.push(n)}function it(n,t){var f=n[0],e=t[0],i=f-e,r,u;return i!==0?i:(r=n[1],u=t[1],r-u)}function rt(n,t){return n[1]-t[1]}function n(){}function d(n,t,i){if(n!==w||t!==b||i!==k){var r=f(t,i);o=n.match(r);w=n;b=t;k=i}}var s=cr.system_object.prototype,u,r,e,c,l;i.prototype.EveryTick=function(){return!0};i.prototype.OnLayoutStart=function(){return!0};i.prototype.OnLayoutEnd=function(){return!0};i.prototype.Compare=function(n,t,i){return cr.do_cmp(n,t,i)};i.prototype.CompareTime=function(n,t){var r=this.runtime.kahanTime.sum,i;return n===0?(i=this.runtime.getCurrentCondition(),!i.extra.CompareTime_executed&&r>=t)?(i.extra.CompareTime_executed=!0,!0):!1:cr.do_cmp(r,n,t)};i.prototype.LayerVisible=function(n){return n?n.visible:!1};i.prototype.LayerEmpty=function(n){return n?!n.instances.length:!1};i.prototype.LayerCmpOpacity=function(n,t,i){return n?cr.do_cmp(n.opacity*100,t,i):!1};i.prototype.Repeat=function(n){var u=this.runtime.getCurrentEventStack(),i=u.current_event,f=u.isModifierAfterCnds(),r=this.runtime.pushLoopStack(),t;if(f)for(t=0;t<n&&!r.stopped;t++)this.runtime.pushCopySol(i.solModifiers),r.index=t,i.retrigger(),this.runtime.popSol(i.solModifiers);else for(t=0;t<n&&!r.stopped;t++)r.index=t,i.retrigger();return this.runtime.popLoopStack(),!1};i.prototype.While=function(){var r=this.runtime.getCurrentEventStack(),i=r.current_event,u=r.isModifierAfterCnds(),n=this.runtime.pushLoopStack(),t;if(u)for(t=0;!n.stopped;t++)this.runtime.pushCopySol(i.solModifiers),n.index=t,i.retrigger()||(n.stopped=!0),this.runtime.popSol(i.solModifiers);else for(t=0;!n.stopped;t++)n.index=t,i.retrigger()||(n.stopped=!0);return this.runtime.popLoopStack(),!1};i.prototype.For=function(n,t,i){var e=this.runtime.getCurrentEventStack(),u=e.current_event,o=e.isModifierAfterCnds(),f=this.runtime.pushLoopStack(n),r;if(i<t)if(o)for(r=t;r>=i&&!f.stopped;--r)this.runtime.pushCopySol(u.solModifiers),f.index=r,u.retrigger(),this.runtime.popSol(u.solModifiers);else for(r=t;r>=i&&!f.stopped;--r)f.index=r,u.retrigger();else if(o)for(r=t;r<=i&&!f.stopped;++r)this.runtime.pushCopySol(u.solModifiers),f.index=r,u.retrigger(),this.runtime.popSol(u.solModifiers);else for(r=t;r<=i&&!f.stopped;++r)f.index=r,u.retrigger();return this.runtime.popLoopStack(),!1};u=[];r=-1;i.prototype.ForEach=function(n){var i=n.getCurrentSol(),s;r++;u.length===r&&u.push([]);s=u[r];cr.shallowAssignArray(s,i.getObjects());var y=this.runtime.getCurrentEventStack(),c=y.current_event,w=y.isModifierAfterCnds(),l=this.runtime.pushLoopStack(),t,a,f,v,e,h,o,p=n.is_contained;if(w)for(t=0,a=s.length;t<a&&!l.stopped;t++){if(this.runtime.pushCopySol(c.solModifiers),e=s[t],i=n.getCurrentSol(),i.select_all=!1,cr.clearArray(i.instances),i.instances[0]=e,p)for(f=0,v=e.siblings.length;f<v;f++)h=e.siblings[f],o=h.type.getCurrentSol(),o.select_all=!1,cr.clearArray(o.instances),o.instances[0]=h;l.index=t;c.retrigger();this.runtime.popSol(c.solModifiers)}else for(i.select_all=!1,cr.clearArray(i.instances),t=0,a=s.length;t<a&&!l.stopped;t++){if(e=s[t],i.instances[0]=e,p)for(f=0,v=e.siblings.length;f<v;f++)h=e.siblings[f],o=h.type.getCurrentSol(),o.select_all=!1,cr.clearArray(o.instances),o.instances[0]=h;l.index=t;c.retrigger()}return cr.clearArray(s),this.runtime.popLoopStack(),r--,!1};i.prototype.ForEachOrdered=function(n,t,i){var o=n.getCurrentSol(),e,w;r++;u.length===r&&u.push([]);e=u[r];cr.shallowAssignArray(e,o.getObjects());for(var b=this.runtime.getCurrentEventStack(),v=b.current_event,k=this.runtime.getCurrentCondition(),d=b.isModifierAfterCnds(),y=this.runtime.pushLoopStack(),s,p,h,a,c,f=0,l=e.length;f<l;f++)e[f].extra.c2_feo_val=k.parameters[1].get(f);if(e.sort(g),i===1&&e.reverse(),w=n.is_contained,d)for(f=0,l=e.length;f<l&&!y.stopped;f++){if(this.runtime.pushCopySol(v.solModifiers),h=e[f],o=n.getCurrentSol(),o.select_all=!1,cr.clearArray(o.instances),o.instances[0]=h,w)for(s=0,p=h.siblings.length;s<p;s++)a=h.siblings[s],c=a.type.getCurrentSol(),c.select_all=!1,cr.clearArray(c.instances),c.instances[0]=a;y.index=f;v.retrigger();this.runtime.popSol(v.solModifiers)}else for(o.select_all=!1,cr.clearArray(o.instances),f=0,l=e.length;f<l&&!y.stopped;f++){if(h=e[f],o.instances[0]=h,w)for(s=0,p=h.siblings.length;s<p;s++)a=h.siblings[s],c=a.type.getCurrentSol(),c.select_all=!1,cr.clearArray(c.instances),c.instances[0]=a;y.index=f;v.retrigger()}return cr.clearArray(e),this.runtime.popLoopStack(),r--,!1};i.prototype.PickByComparison=function(n,t,i,f){var s,a,h,c,e,o,l;if(n){for(r++,u.length===r&&u.push([]),e=u[r],o=n.getCurrentSol(),cr.shallowAssignArray(e,o.getObjects()),o.select_all&&cr.clearArray(o.else_instances),l=this.runtime.getCurrentCondition(),s=0,h=0,a=e.length;s<a;s++)c=e[s],e[h]=c,t=l.parameters[1].get(s),f=l.parameters[3].get(s),cr.do_cmp(t,i,f)?h++:o.else_instances.push(c);return cr.truncateArray(e,h),o.select_all=!1,cr.shallowAssignArray(o.instances,e),cr.clearArray(e),r--,n.applySolToContainer(),!!o.instances.length}};i.prototype.PickByEvaluate=function(n,t){var e,h,o,s,i,f,c;if(n){for(r++,u.length===r&&u.push([]),i=u[r],f=n.getCurrentSol(),cr.shallowAssignArray(i,f.getObjects()),f.select_all&&cr.clearArray(f.else_instances),c=this.runtime.getCurrentCondition(),e=0,o=0,h=i.length;e<h;e++)s=i[e],i[o]=s,t=c.parameters[1].get(e),t?o++:f.else_instances.push(s);return cr.truncateArray(i,o),f.select_all=!1,cr.shallowAssignArray(f.instances,i),cr.clearArray(i),r--,n.applySolToContainer(),!!f.instances.length}};i.prototype.TriggerOnce=function(){var n=this.runtime.getCurrentCondition().extra,i,t;return typeof n.TriggerOnce_lastTick=="undefined"&&(n.TriggerOnce_lastTick=-1),i=n.TriggerOnce_lastTick,t=this.runtime.tickcount,n.TriggerOnce_lastTick=t,this.runtime.layout_first_tick||i!==t-1};i.prototype.Every=function(n){var t=this.runtime.getCurrentCondition(),r=t.extra.Every_lastTime||0,i=this.runtime.kahanTime.sum,u;return(typeof t.extra.Every_seconds=="undefined"&&(t.extra.Every_seconds=n),u=t.extra.Every_seconds,i>=r+u)?(t.extra.Every_lastTime=r+u,i>=t.extra.Every_lastTime+.04&&(t.extra.Every_lastTime=i),t.extra.Every_seconds=n,!0):(i<r-.1&&(t.extra.Every_lastTime=i),!1)};i.prototype.PickNth=function(n,t){var i,r,u;return n?(i=n.getCurrentSol(),r=i.getObjects(),t=cr.floor(t),t<0||t>=r.length)?!1:(u=r[t],i.pick_one(u),n.applySolToContainer(),!0):!1};i.prototype.PickRandom=function(n){var u;if(!n)return!1;var i=n.getCurrentSol(),t=i.getObjects(),r=cr.floor(Math.random()*t.length);return r>=t.length?!1:(u=t[r],i.pick_one(u),n.applySolToContainer(),!0)};i.prototype.CompareVar=function(n,t,i){return cr.do_cmp(n.getValue(),t,i)};i.prototype.IsGroupActive=function(n){var t=this.runtime.groups_by_name[n.toLowerCase()];return t&&t.group_active};i.prototype.IsPreview=function(){return typeof cr_is_preview!="undefined"};i.prototype.PickAll=function(n){if(!n||!n.instances.length)return!1;var t=n.getCurrentSol();return t.select_all=!0,n.applySolToContainer(),!0};i.prototype.IsMobile=function(){return this.runtime.isMobile};i.prototype.CompareBetween=function(n,t,i){return n>=t&&n<=i};i.prototype.Else=function(){var n=this.runtime.getCurrentEventStack();return n.else_branch_ran?!1:!n.last_event_true};i.prototype.OnLoadFinished=function(){return!0};i.prototype.OnCanvasSnapshot=function(){return!0};i.prototype.EffectsSupported=function(){return!!this.runtime.glwrap};i.prototype.OnSaveComplete=function(){return!0};i.prototype.OnSaveFailed=function(){return!0};i.prototype.OnLoadComplete=function(){return!0};i.prototype.OnLoadFailed=function(){return!0};i.prototype.ObjectUIDExists=function(n){return!!this.runtime.getObjectByUID(n)};i.prototype.IsOnPlatform=function(n){var t=this.runtime;switch(n){case 0:return!t.isDomFree&&!t.isNodeWebkit&&!t.isCordova&&!t.isWinJS&&!t.isWindowsPhone8&&!t.isBlackberry10&&!t.isAmazonWebApp;case 1:return t.isiOS;case 2:return t.isAndroid;case 3:return t.isWindows8App;case 4:return t.isWindowsPhone8;case 5:return t.isBlackberry10;case 6:return t.isTizen;case 7:return t.isCocoonJs;case 8:return t.isCordova;case 9:return t.isArcade;case 10:return t.isNodeWebkit;case 11:return t.isCrosswalk;case 12:return t.isAmazonWebApp;case 13:return t.isWindows10;default:return!1}};var h=null,a="",v="";i.prototype.RegexTest=function(n,t,i){var r=f(t,i);return r.test(n)};e=[];i.prototype.PickOverlappingPoint=function(n,t,i){if(!n)return!1;var r=n.getCurrentSol(),o=r.getObjects(),l=this.runtime.getCurrentEventStack().current_event,a=l.orblock,s=this.runtime.getCurrentCondition(),f,h,u,c;for(r.select_all?(cr.shallowAssignArray(e,o),cr.clearArray(r.else_instances),r.select_all=!1,cr.clearArray(r.instances)):a?(cr.shallowAssignArray(e,r.else_instances),cr.clearArray(r.else_instances)):(cr.shallowAssignArray(e,o),cr.clearArray(r.instances)),f=0,h=e.length;f<h;++f)u=e[f],u.update_bbox(),c=cr.xor(u.contains_pt(t,i),s.inverted),c?r.instances.push(u):r.else_instances.push(u);return n.applySolToContainer(),cr.xor(!!r.instances.length,s.inverted)};i.prototype.IsNaN=function(n){return!!isNaN(n)};i.prototype.AngleWithin=function(n,t,i){return cr.angleDiff(cr.to_radians(n),cr.to_radians(i))<=cr.to_radians(t)};i.prototype.IsClockwiseFrom=function(n,t){return cr.angleClockwise(cr.to_radians(n),cr.to_radians(t))};i.prototype.IsBetweenAngles=function(n,t,i){var r=cr.to_clamped_radians(n),u=cr.to_clamped_radians(t),f=cr.to_clamped_radians(i),e=!cr.angleClockwise(f,u);return e?!(!cr.angleClockwise(r,u)&&cr.angleClockwise(r,f)):cr.angleClockwise(r,u)&&!cr.angleClockwise(r,f)};i.prototype.IsValueType=function(n,t){return typeof n=="number"?t===0:t===1};s.cnds=new i;t.prototype.GoToLayout=function(n){this.runtime.isloading||this.runtime.changelayout||(this.runtime.changelayout=n)};t.prototype.NextPrevLayout=function(n){var t,i;this.runtime.isloading||this.runtime.changelayout||(t=this.runtime.layouts_by_index.indexOf(this.runtime.running_layout),n&&t===0)||(n||t!==this.runtime.layouts_by_index.length-1)&&(i=this.runtime.layouts_by_index[t+(n?-1:1)],this.runtime.changelayout=i)};t.prototype.CreateObject=function(n,t,i,r){var u,f,s,o,e;if(t&&n&&(u=this.runtime.createInstance(n,t,i,r),u)){if(this.runtime.isInOnDestroy++,this.runtime.trigger(Object.getPrototypeOf(n.plugin).cnds.OnCreated,u),u.is_contained)for(f=0,s=u.siblings.length;f<s;f++)o=u.siblings[f],this.runtime.trigger(Object.getPrototypeOf(o.type.plugin).cnds.OnCreated,o);if(this.runtime.isInOnDestroy--,e=n.getCurrentSol(),e.select_all=!1,cr.clearArray(e.instances),e.instances[0]=u,u.is_contained)for(f=0,s=u.siblings.length;f<s;f++)o=u.siblings[f],e=o.type.getCurrentSol(),e.select_all=!1,cr.clearArray(e.instances),e.instances[0]=o}};t.prototype.SetLayerVisible=function(n,t){n&&n.visible!==t&&(n.visible=t,this.runtime.redraw=!0)};t.prototype.SetLayerOpacity=function(n,t){n&&(t=cr.clamp(t/100,0,1),n.opacity!==t&&(n.opacity=t,this.runtime.redraw=!0))};t.prototype.SetLayerScaleRate=function(n,t){n&&n.zoomRate!==t&&(n.zoomRate=t,this.runtime.redraw=!0)};t.prototype.SetLayerForceOwnTexture=function(n,t){n&&(t=!!t,n.forceOwnTexture!==t&&(n.forceOwnTexture=t,this.runtime.redraw=!0))};t.prototype.SetLayoutScale=function(n){this.runtime.running_layout&&this.runtime.running_layout.scale!==n&&(this.runtime.running_layout.scale=n,this.runtime.running_layout.boundScrolling(),this.runtime.redraw=!0)};t.prototype.ScrollX=function(n){this.runtime.running_layout.scrollToX(n)};t.prototype.ScrollY=function(n){this.runtime.running_layout.scrollToY(n)};t.prototype.Scroll=function(n,t){this.runtime.running_layout.scrollToX(n);this.runtime.running_layout.scrollToY(t)};t.prototype.ScrollToObject=function(n){var t=n.getFirstPicked();t&&(this.runtime.running_layout.scrollToX(t.x),this.runtime.running_layout.scrollToY(t.y))};t.prototype.SetVar=function(n,t){n.vartype===0?cr.is_number(t)?n.setValue(t):n.setValue(parseFloat(t)):n.vartype===1&&n.setValue(t.toString())};t.prototype.AddVar=function(n,t){n.vartype===0?cr.is_number(t)?n.setValue(n.getValue()+t):n.setValue(n.getValue()+parseFloat(t)):n.vartype===1&&n.setValue(n.getValue()+t.toString())};t.prototype.SubVar=function(n,t){n.vartype===0&&(cr.is_number(t)?n.setValue(n.getValue()-t):n.setValue(n.getValue()-parseFloat(t)))};t.prototype.SetGroupActive=function(n,t){var i=this.runtime.groups_by_name[n.toLowerCase()];if(i)switch(t){case 0:i.setGroupActive(!1);break;case 1:i.setGroupActive(!0);break;case 2:i.setGroupActive(!i.group_active)}};t.prototype.SetTimescale=function(n){var t=n;t<0&&(t=0);this.runtime.timescale=t};t.prototype.SetObjectTimescale=function(n,t){var r=t,f,u,i,e;if(r<0&&(r=0),n)for(f=n.getCurrentSol(),u=f.getObjects(),i=0,e=u.length;i<e;i++)u[i].my_timescale=r};t.prototype.RestoreObjectTimescale=function(n){if(!n)return!1;for(var u=n.getCurrentSol(),i=u.getObjects(),t=0,r=i.length;t<r;t++)i[t].my_timescale=-1};c=[];l=[];t.prototype.Wait=function(n){if(!(n<0)){var i,o,r,u,f,e=this.runtime.getCurrentEventStack(),t=y();for(t.time=this.runtime.kahanTime.sum+n,t.signaltag="",t.signalled=!1,t.ev=e.current_event,t.actindex=e.actindex+1,i=0,o=this.runtime.types_by_index.length;i<o;i++)(u=this.runtime.types_by_index[i],r=u.getCurrentSol(),r.select_all&&e.current_event.solModifiers.indexOf(u)===-1)||(t.solModifiers.push(u),f=p(),f.sa=r.select_all,cr.shallowAssignArray(f.insts,r.instances),t.sols[i.toString()]=f);return this.waits.push(t),!0}};t.prototype.WaitForSignal=function(n){var i,o,r,u,f,e=this.runtime.getCurrentEventStack(),t=y();for(t.time=-1,t.signaltag=n.toLowerCase(),t.signalled=!1,t.ev=e.current_event,t.actindex=e.actindex+1,i=0,o=this.runtime.types_by_index.length;i<o;i++)(u=this.runtime.types_by_index[i],r=u.getCurrentSol(),r.select_all&&e.current_event.solModifiers.indexOf(u)===-1)||(t.solModifiers.push(u),f=p(),f.sa=r.select_all,cr.shallowAssignArray(f.insts,r.instances),t.sols[i.toString()]=f);return this.waits.push(t),!0};t.prototype.Signal=function(n){for(var u=n.toLowerCase(),i,t=0,r=this.waits.length;t<r;++t)(i=this.waits[t],i.time===-1)&&i.signaltag===u&&(i.signalled=!0)};t.prototype.SetLayerScale=function(n,t){n&&n.scale!==t&&(n.scale=t,this.runtime.redraw=!0)};t.prototype.ResetGlobals=function(){for(var t,n=0,i=this.runtime.all_global_vars.length;n<i;n++)t=this.runtime.all_global_vars[n],t.data=t.initial};t.prototype.SetLayoutAngle=function(n){n=cr.to_radians(n);n=cr.clamp_angle(n);this.runtime.running_layout&&this.runtime.running_layout.angle!==n&&(this.runtime.running_layout.angle=n,this.runtime.redraw=!0)};t.prototype.SetLayerAngle=function(n,t){n&&(t=cr.to_radians(t),t=cr.clamp_angle(t),n.angle!==t)&&(n.angle=t,this.runtime.redraw=!0)};t.prototype.SetLayerParallax=function(n,t,i){if(n&&(n.parallaxX!==t/100||n.parallaxY!==i/100)){if(n.parallaxX=t/100,n.parallaxY=i/100,n.parallaxX!==1||n.parallaxY!==1)for(var f=n.instances,r=0,u=f.length;r<u;++r)f[r].type.any_instance_parallaxed=!0;this.runtime.redraw=!0}};t.prototype.SetLayerBackground=function(n,t){if(n){var i=cr.GetRValue(t),r=cr.GetGValue(t),u=cr.GetBValue(t);(n.background_color[0]!==i||n.background_color[1]!==r||n.background_color[2]!==u)&&(n.background_color[0]=i,n.background_color[1]=r,n.background_color[2]=u,this.runtime.redraw=!0)}};t.prototype.SetLayerTransparent=function(n,t){n&&!!t!=!!n.transparent&&(n.transparent=!!t,this.runtime.redraw=!0)};t.prototype.SetLayerBlendMode=function(n,t){n&&n.blend_mode!==t&&(n.blend_mode=t,n.compositeOp=cr.effectToCompositeOp(n.blend_mode),this.runtime.gl&&cr.setGLBlend(n,n.blend_mode,this.runtime.gl),this.runtime.redraw=!0)};t.prototype.StopLoop=function(){this.runtime.loop_stack_index<0||(this.runtime.getCurrentLoop().stopped=!0)};t.prototype.GoToLayoutByName=function(n){if(!this.runtime.isloading&&!this.runtime.changelayout)for(var t in this.runtime.layouts)if(this.runtime.layouts.hasOwnProperty(t)&&cr.equals_nocase(t,n)){this.runtime.changelayout=this.runtime.layouts[t];return}};t.prototype.RestartLayout=function(){if(!this.runtime.isloading&&!this.runtime.changelayout&&this.runtime.running_layout){this.runtime.changelayout=this.runtime.running_layout;for(var t,n=0,i=this.runtime.allGroups.length;n<i;n++)t=this.runtime.allGroups[n],t.setGroupActive(t.initially_activated)}};t.prototype.SnapshotCanvas=function(n,t){this.runtime.doCanvasSnapshot(n===0?"image/png":"image/jpeg",t/100)};t.prototype.SetCanvasSize=function(n,t){if(!(n<=0)&&!(t<=0)){var i=this.runtime.fullscreen_mode,r=document.mozFullScreen||document.webkitIsFullScreen||!!document.msFullscreenElement||document.fullScreen||this.runtime.isNodeFullscreen;r&&this.runtime.fullscreen_scaling>0&&(i=this.runtime.fullscreen_scaling);i===0?this.runtime.setSize(n,t,!0):(this.runtime.original_width=n,this.runtime.original_height=t,this.runtime.setSize(this.runtime.lastWindowWidth,this.runtime.lastWindowHeight,!0))}};t.prototype.SetLayoutEffectEnabled=function(n,t){var i,r;this.runtime.running_layout&&this.runtime.glwrap&&(i=this.runtime.running_layout.getEffectByName(t),i)&&(r=n===1,i.active!=r)&&(i.active=r,this.runtime.running_layout.updateActiveEffects(),this.runtime.redraw=!0)};t.prototype.SetLayerEffectEnabled=function(n,t,i){var r,u;n&&this.runtime.glwrap&&(r=n.getEffectByName(i),r)&&(u=t===1,r.active!=u)&&(r.active=u,n.updateActiveEffects(),this.runtime.redraw=!0)};t.prototype.SetLayoutEffectParam=function(n,t,i){var r,u;this.runtime.running_layout&&this.runtime.glwrap&&(r=this.runtime.running_layout.getEffectByName(n),r)&&((u=this.runtime.running_layout.effect_params[r.index],t=Math.floor(t),t<0||t>=u.length)||(this.runtime.glwrap.getProgramParameterType(r.shaderindex,t)===1&&(i/=100),u[t]!==i)&&(u[t]=i,r.active&&(this.runtime.redraw=!0)))};t.prototype.SetLayerEffectParam=function(n,t,i,r){var u,f;n&&this.runtime.glwrap&&(u=n.getEffectByName(t),u)&&((f=n.effect_params[u.index],i=Math.floor(i),i<0||i>=f.length)||(this.runtime.glwrap.getProgramParameterType(u.shaderindex,i)===1&&(r/=100),f[i]!==r)&&(f[i]=r,u.active&&(this.runtime.redraw=!0)))};t.prototype.SaveState=function(n){this.runtime.saveToSlot=n};t.prototype.LoadState=function(n){this.runtime.loadFromSlot=n};t.prototype.LoadStateJSON=function(n){this.runtime.loadFromJson=n};t.prototype.SetHalfFramerateMode=function(n){this.runtime.halfFramerateMode=n!==0};t.prototype.SetFullscreenQuality=function(n){var t=document.mozFullScreen||document.webkitIsFullScreen||!!document.msFullscreenElement||document.fullScreen||this.isNodeFullscreen;(t||this.runtime.fullscreen_mode!==0)&&(this.runtime.wantFullscreenScalingQuality=n!==0,this.runtime.setSize(this.runtime.lastWindowWidth,this.runtime.lastWindowHeight,!0))};t.prototype.ResetPersisted=function(){for(var n=0,t=this.runtime.layouts_by_index.length;n<t;++n)this.runtime.layouts_by_index[n].persist_data={},this.runtime.layouts_by_index[n].first_visit=!0};t.prototype.RecreateInitialObjects=function(n,t,i,r,u){n&&this.runtime.running_layout.recreateInitialObjects(n,t,i,r,u)};t.prototype.SetPixelRounding=function(n){this.runtime.pixel_rounding=n!==0;this.runtime.redraw=!0};t.prototype.SetMinimumFramerate=function(n){n<1&&(n=1);n>120&&(n=120);this.runtime.minimumFramerate=n};t.prototype.SortZOrderByInstVar=function(n,t){if(n){for(var i,h,f,o,l=n.getCurrentSol(),c=l.getObjects(),u=[],s=[],a=this.runtime.running_layout,v=n.is_family,y=n.family_index,r=0,e=c.length;r<e;++r)(i=c[r],i.layer)&&(h=v?i.instance_vars[t+i.type.family_var_map[y]]:i.instance_vars[t],u.push([i.layer.index,i.get_zindex()]),s.push([i,h]));if(u.length)for(u.sort(it),s.sort(rt),r=0,e=u.length;r<e;++r)i=s[r][0],f=a.layers[u[r][0]],o=u[r][1],f.instances[o]!==i&&(f.instances[o]=i,i.layer=f,f.setZIndicesStaleFrom(o))}};s.acts=new t;n.prototype.int=function(n,t){cr.is_string(t)?(n.set_int(parseInt(t,10)),isNaN(n.data)&&(n.data=0)):n.set_int(t)};n.prototype.float=function(n,t){cr.is_string(t)?(n.set_float(parseFloat(t)),isNaN(n.data)&&(n.data=0)):n.set_float(t)};n.prototype.str=function(n,t){cr.is_string(t)?n.set_string(t):n.set_string(t.toString())};n.prototype.len=function(n,t){n.set_int(t.length||0)};n.prototype.random=function(n,t,i){i===undefined?n.set_float(Math.random()*t):n.set_float(Math.random()*(i-t)+t)};n.prototype.sqrt=function(n,t){n.set_float(Math.sqrt(t))};n.prototype.abs=function(n,t){n.set_float(Math.abs(t))};n.prototype.round=function(n,t){n.set_int(Math.round(t))};n.prototype.floor=function(n,t){n.set_int(Math.floor(t))};n.prototype.ceil=function(n,t){n.set_int(Math.ceil(t))};n.prototype.sin=function(n,t){n.set_float(Math.sin(cr.to_radians(t)))};n.prototype.cos=function(n,t){n.set_float(Math.cos(cr.to_radians(t)))};n.prototype.tan=function(n,t){n.set_float(Math.tan(cr.to_radians(t)))};n.prototype.asin=function(n,t){n.set_float(cr.to_degrees(Math.asin(t)))};n.prototype.acos=function(n,t){n.set_float(cr.to_degrees(Math.acos(t)))};n.prototype.atan=function(n,t){n.set_float(cr.to_degrees(Math.atan(t)))};n.prototype.exp=function(n,t){n.set_float(Math.exp(t))};n.prototype.ln=function(n,t){n.set_float(Math.log(t))};n.prototype.log10=function(n,t){n.set_float(Math.log(t)/Math.LN10)};n.prototype.max=function(n){var t=arguments[1],i,u,r;for(typeof t!="number"&&(t=0),i=2,u=arguments.length;i<u;i++)(r=arguments[i],typeof r=="number")&&t<r&&(t=r);n.set_float(t)};n.prototype.min=function(n){var t=arguments[1],i,u,r;for(typeof t!="number"&&(t=0),i=2,u=arguments.length;i<u;i++)(r=arguments[i],typeof r=="number")&&t>r&&(t=r);n.set_float(t)};n.prototype.dt=function(n){n.set_float(this.runtime.dt)};n.prototype.timescale=function(n){n.set_float(this.runtime.timescale)};n.prototype.wallclocktime=function(n){n.set_float((Date.now()-this.runtime.start_time)/1e3)};n.prototype.time=function(n){n.set_float(this.runtime.kahanTime.sum)};n.prototype.tickcount=function(n){n.set_int(this.runtime.tickcount)};n.prototype.objectcount=function(n){n.set_int(this.runtime.objectcount)};n.prototype.fps=function(n){n.set_int(this.runtime.fps)};n.prototype.loopindex=function(n,t){var i,r;if(!this.runtime.loop_stack.length){n.set_int(0);return}if(t){for(r=this.runtime.loop_stack_index;r>=0;--r)if(i=this.runtime.loop_stack[r],i.name===t){n.set_int(i.index);return}n.set_int(0)}else i=this.runtime.getCurrentLoop(),n.set_int(i?i.index:-1)};n.prototype.distance=function(n,t,i,r,u){n.set_float(cr.distanceTo(t,i,r,u))};n.prototype.angle=function(n,t,i,r,u){n.set_float(cr.to_degrees(cr.angleTo(t,i,r,u)))};n.prototype.scrollx=function(n){n.set_float(this.runtime.running_layout.scrollX)};n.prototype.scrolly=function(n){n.set_float(this.runtime.running_layout.scrollY)};n.prototype.newline=function(n){n.set_string("\n")};n.prototype.lerp=function(n,t,i,r){n.set_float(cr.lerp(t,i,r))};n.prototype.qarp=function(n,t,i,r,u){n.set_float(cr.qarp(t,i,r,u))};n.prototype.cubic=function(n,t,i,r,u,f){n.set_float(cr.cubic(t,i,r,u,f))};n.prototype.cosp=function(n,t,i,r){n.set_float(cr.cosp(t,i,r))};n.prototype.windowwidth=function(n){n.set_int(this.runtime.width)};n.prototype.windowheight=function(n){n.set_int(this.runtime.height)};n.prototype.uppercase=function(n,t){n.set_string(cr.is_string(t)?t.toUpperCase():"")};n.prototype.lowercase=function(n,t){n.set_string(cr.is_string(t)?t.toLowerCase():"")};n.prototype.clamp=function(n,t,i,r){t<i?n.set_float(i):t>r?n.set_float(r):n.set_float(t)};n.prototype.layerscale=function(n,t){var i=this.runtime.getLayer(t);i?n.set_float(i.scale):n.set_float(0)};n.prototype.layeropacity=function(n,t){var i=this.runtime.getLayer(t);i?n.set_float(i.opacity*100):n.set_float(0)};n.prototype.layerscalerate=function(n,t){var i=this.runtime.getLayer(t);i?n.set_float(i.zoomRate):n.set_float(0)};n.prototype.layerparallaxx=function(n,t){var i=this.runtime.getLayer(t);i?n.set_float(i.parallaxX*100):n.set_float(0)};n.prototype.layerparallaxy=function(n,t){var i=this.runtime.getLayer(t);i?n.set_float(i.parallaxY*100):n.set_float(0)};n.prototype.layerindex=function(n,t){var i=this.runtime.getLayer(t);i?n.set_int(i.index):n.set_int(-1)};n.prototype.layoutscale=function(n){this.runtime.running_layout?n.set_float(this.runtime.running_layout.scale):n.set_float(0)};n.prototype.layoutangle=function(n){n.set_float(cr.to_degrees(this.runtime.running_layout.angle))};n.prototype.layerangle=function(n,t){var i=this.runtime.getLayer(t);i?n.set_float(cr.to_degrees(i.angle)):n.set_float(0)};n.prototype.layoutwidth=function(n){n.set_int(this.runtime.running_layout.width)};n.prototype.layoutheight=function(n){n.set_int(this.runtime.running_layout.height)};n.prototype.find=function(n,t,i){cr.is_string(t)&&cr.is_string(i)?n.set_int(t.search(new RegExp(cr.regexp_escape(i),"i"))):n.set_int(-1)};n.prototype.findcase=function(n,t,i){cr.is_string(t)&&cr.is_string(i)?n.set_int(t.search(new RegExp(cr.regexp_escape(i),""))):n.set_int(-1)};n.prototype.left=function(n,t,i){n.set_string(cr.is_string(t)?t.substr(0,i):"")};n.prototype.right=function(n,t,i){n.set_string(cr.is_string(t)?t.substr(t.length-i):"")};n.prototype.mid=function(n,t,i,r){n.set_string(cr.is_string(t)?t.substr(i,r):"")};n.prototype.tokenat=function(n,t,i,r){if(cr.is_string(t)&&cr.is_string(r)){var f=t.split(r),u=cr.floor(i);u<0||u>=f.length?n.set_string(""):n.set_string(f[u])}else n.set_string("")};n.prototype.tokencount=function(n,t,i){cr.is_string(t)&&t.length?n.set_int(t.split(i).length):n.set_int(0)};n.prototype.replace=function(n,t,i,r){cr.is_string(t)&&cr.is_string(i)&&cr.is_string(r)?n.set_string(t.replace(new RegExp(cr.regexp_escape(i),"gi"),r)):n.set_string(cr.is_string(t)?t:"")};n.prototype.trim=function(n,t){n.set_string(cr.is_string(t)?t.trim():"")};n.prototype.pi=function(n){n.set_float(cr.PI)};n.prototype.layoutname=function(n){this.runtime.running_layout?n.set_string(this.runtime.running_layout.name):n.set_string("")};n.prototype.renderer=function(n){n.set_string(this.runtime.gl?"webgl":"canvas2d")};n.prototype.rendererdetail=function(n){n.set_string(this.runtime.glUnmaskedRenderer)};n.prototype.anglediff=function(n,t,i){n.set_float(cr.to_degrees(cr.angleDiff(cr.to_radians(t),cr.to_radians(i))))};n.prototype.choose=function(n){var t=cr.floor(Math.random()*(arguments.length-1));n.set_any(arguments[t+1])};n.prototype.rgb=function(n,t,i,r){n.set_int(cr.RGB(t,i,r))};n.prototype.projectversion=function(n){n.set_string(this.runtime.versionstr)};n.prototype.projectname=function(n){n.set_string(this.runtime.projectName)};n.prototype.anglelerp=function(n,t,i,r){t=cr.to_radians(t);i=cr.to_radians(i);var u=cr.angleDiff(t,i);cr.angleClockwise(i,t)?n.set_float(cr.to_clamped_degrees(t+u*r)):n.set_float(cr.to_clamped_degrees(t-u*r))};n.prototype.anglerotate=function(n,t,i,r){t=cr.to_radians(t);i=cr.to_radians(i);r=cr.to_radians(r);n.set_float(cr.to_clamped_degrees(cr.angleRotate(t,i,r)))};n.prototype.zeropad=function(n,t,i){var u=t<0?"-":"",f,r;for(t<0&&(t=-t),f=i-t.toString().length,r=0;r<f;r++)u+="0";n.set_string(u+t.toString())};n.prototype.cpuutilisation=function(n){n.set_float(this.runtime.cpuutilisation/1e3)};n.prototype.viewportleft=function(n,t){var i=this.runtime.getLayer(t);n.set_float(i?i.viewLeft:0)};n.prototype.viewporttop=function(n,t){var i=this.runtime.getLayer(t);n.set_float(i?i.viewTop:0)};n.prototype.viewportright=function(n,t){var i=this.runtime.getLayer(t);n.set_float(i?i.viewRight:0)};n.prototype.viewportbottom=function(n,t){var i=this.runtime.getLayer(t);n.set_float(i?i.viewBottom:0)};n.prototype.loadingprogress=function(n){n.set_float(this.runtime.loadingprogress)};n.prototype.unlerp=function(n,t,i,r){n.set_float(cr.unlerp(t,i,r))};n.prototype.canvassnapshot=function(n){n.set_string(this.runtime.snapshotData)};n.prototype.urlencode=function(n,t){n.set_string(encodeURIComponent(t))};n.prototype.urldecode=function(n,t){n.set_string(decodeURIComponent(t))};n.prototype.canvastolayerx=function(n,t,i,r){var u=this.runtime.getLayer(t);n.set_float(u?u.canvasToLayer(i,r,!0):0)};n.prototype.canvastolayery=function(n,t,i,r){var u=this.runtime.getLayer(t);n.set_float(u?u.canvasToLayer(i,r,!1):0)};n.prototype.layertocanvasx=function(n,t,i,r){var u=this.runtime.getLayer(t);n.set_float(u?u.layerToCanvas(i,r,!0):0)};n.prototype.layertocanvasy=function(n,t,i,r){var u=this.runtime.getLayer(t);n.set_float(u?u.layerToCanvas(i,r,!1):0)};n.prototype.savestatejson=function(n){n.set_string(this.runtime.lastSaveJson)};n.prototype.imagememoryusage=function(n){this.runtime.glwrap?n.set_float(Math.round(100*this.runtime.glwrap.estimateVRAM()/1048576)/100):n.set_float(0)};n.prototype.regexsearch=function(n,t,i,r){var u=f(i,r);n.set_int(t?t.search(u):-1)};n.prototype.regexreplace=function(n,t,i,r,u){var e=f(i,r);n.set_string(t?t.replace(e,u):"")};var o=[],w="",b="",k="";n.prototype.regexmatchcount=function(n,t,i,r){var u=f(i,r);d(t.toString(),i,r);n.set_int(o?o.length:0)};n.prototype.regexmatchat=function(n,t,i,r,u){u=Math.floor(u);var e=f(i,r);d(t.toString(),i,r);!o||u<0||u>=o.length?n.set_string(""):n.set_string(o[u])};n.prototype.infinity=function(n){n.set_float(Infinity)};n.prototype.setbit=function(n,t,i,r){t=t|0;i=i|0;r=r!==0?1:0;n.set_int(t&~(1<<i)|r<<i)};n.prototype.togglebit=function(n,t,i){t=t|0;i=i|0;n.set_int(t^1<<i)};n.prototype.getbit=function(n,t,i){t=t|0;i=i|0;n.set_int(t&1<<i?1:0)};n.prototype.originalwindowwidth=function(n){n.set_int(this.runtime.original_width)};n.prototype.originalwindowheight=function(n){n.set_int(this.runtime.original_height)};s.exps=new n;s.runWaits=function(){for(var i,n,u,e,f,o=this.runtime.getCurrentEventStack(),t=0,r=this.waits.length;t<r;t++){if(n=this.waits[t],n.time===-1){if(!n.signalled)continue}else if(n.time>this.runtime.kahanTime.sum)continue;o.current_event=n.ev;o.actindex=n.actindex;o.cndindex=0;for(u in n.sols)n.sols.hasOwnProperty(u)&&(e=this.runtime.types_by_index[parseInt(u,10)].getCurrentSol(),f=n.sols[u],e.select_all=f.sa,cr.shallowAssignArray(e.instances,f.insts),tt(f));n.ev.resume_actions_and_subevents();this.runtime.clearSol(n.solModifiers);n.deleteme=!0}for(t=0,i=0,r=this.waits.length;t<r;t++)n=this.waits[t],this.waits[i]=n,n.deleteme?nt(n):i++;cr.truncateArray(this.waits,i)}}(),function(){cr.add_common_aces=function(n,t){var f=n[1],e=n[3],o=n[4],s=n[5],h=n[6],c=n[7],l=n[8];t.cnds||(t.cnds={});t.acts||(t.acts={});t.exps||(t.exps={});var r=t.cnds,i=t.acts,u=t.exps;e&&(r.CompareX=function(n,t){return cr.do_cmp(this.x,n,t)},r.CompareY=function(n,t){return cr.do_cmp(this.y,n,t)},r.IsOnScreen=function(){var t=this.layer,n;return this.update_bbox(),n=this.bbox,!(n.right<t.viewLeft||n.bottom<t.viewTop||n.left>t.viewRight||n.top>t.viewBottom)},r.IsOutsideLayout=function(){this.update_bbox();var n=this.bbox,t=this.runtime.running_layout;return n.right<0||n.bottom<0||n.left>t.width||n.top>t.height},r.PickDistance=function(n,t,i){var s=this.getCurrentSol(),u=s.getObjects();if(!u.length)return!1;for(var r=u[0],h=r,o=cr.distanceTo(r.x,r.y,t,i),e,f=1,c=u.length;f<c;f++)r=u[f],e=cr.distanceTo(r.x,r.y,t,i),(n===0&&e<o||n===1&&e>o)&&(o=e,h=r);return s.pick_one(h),!0},i.SetX=function(n){this.x!==n&&(this.x=n,this.set_bbox_changed())},i.SetY=function(n){this.y!==n&&(this.y=n,this.set_bbox_changed())},i.SetPos=function(n,t){(this.x!==n||this.y!==t)&&(this.x=n,this.y=t,this.set_bbox_changed())},i.SetPosToObject=function(n,t){var i=n.getPairedInstance(this),r,u;i&&(i.getImagePoint?(r=i.getImagePoint(t,!0),u=i.getImagePoint(t,!1)):(r=i.x,u=i.y),(this.x!==r||this.y!==u)&&(this.x=r,this.y=u,this.set_bbox_changed()))},i.MoveForward=function(n){n!==0&&(this.x+=Math.cos(this.angle)*n,this.y+=Math.sin(this.angle)*n,this.set_bbox_changed())},i.MoveAtAngle=function(n,t){t!==0&&(this.x+=Math.cos(cr.to_radians(n))*t,this.y+=Math.sin(cr.to_radians(n))*t,this.set_bbox_changed())},u.X=function(n){n.set_float(this.x)},u.Y=function(n){n.set_float(this.y)},u.dt=function(n){n.set_float(this.runtime.getDt(this))});o&&(r.CompareWidth=function(n,t){return cr.do_cmp(this.width,n,t)},r.CompareHeight=function(n,t){return cr.do_cmp(this.height,n,t)},i.SetWidth=function(n){this.width!==n&&(this.width=n,this.set_bbox_changed())},i.SetHeight=function(n){this.height!==n&&(this.height=n,this.set_bbox_changed())},i.SetSize=function(n,t){(this.width!==n||this.height!==t)&&(this.width=n,this.height=t,this.set_bbox_changed())},u.Width=function(n){n.set_float(this.width)},u.Height=function(n){n.set_float(this.height)},u.BBoxLeft=function(n){this.update_bbox();n.set_float(this.bbox.left)},u.BBoxTop=function(n){this.update_bbox();n.set_float(this.bbox.top)},u.BBoxRight=function(n){this.update_bbox();n.set_float(this.bbox.right)},u.BBoxBottom=function(n){this.update_bbox();n.set_float(this.bbox.bottom)});s&&(r.AngleWithin=function(n,t){return cr.angleDiff(this.angle,cr.to_radians(t))<=cr.to_radians(n)},r.IsClockwiseFrom=function(n){return cr.angleClockwise(this.angle,cr.to_radians(n))},r.IsBetweenAngles=function(n,t){var r=cr.to_clamped_radians(n),u=cr.to_clamped_radians(t),i=cr.clamp_angle(this.angle),f=!cr.angleClockwise(u,r);return f?!(!cr.angleClockwise(i,r)&&cr.angleClockwise(i,u)):cr.angleClockwise(i,r)&&!cr.angleClockwise(i,u)},i.SetAngle=function(n){var t=cr.to_radians(cr.clamp_angle_degrees(n));isNaN(t)||this.angle!==t&&(this.angle=t,this.set_bbox_changed())},i.RotateClockwise=function(n){n===0||isNaN(n)||(this.angle+=cr.to_radians(n),this.angle=cr.clamp_angle(this.angle),this.set_bbox_changed())},i.RotateCounterclockwise=function(n){n===0||isNaN(n)||(this.angle-=cr.to_radians(n),this.angle=cr.clamp_angle(this.angle),this.set_bbox_changed())},i.RotateTowardAngle=function(n,t){var i=cr.angleRotate(this.angle,cr.to_radians(t),cr.to_radians(n));isNaN(i)||this.angle!==i&&(this.angle=i,this.set_bbox_changed())},i.RotateTowardPosition=function(n,t,i){var u=t-this.x,f=i-this.y,e=Math.atan2(f,u),r=cr.angleRotate(this.angle,e,cr.to_radians(n));isNaN(r)||this.angle!==r&&(this.angle=r,this.set_bbox_changed())},i.SetTowardPosition=function(n,t){var r=n-this.x,u=t-this.y,i=Math.atan2(u,r);isNaN(i)||this.angle!==i&&(this.angle=i,this.set_bbox_changed())},u.Angle=function(n){n.set_float(cr.to_clamped_degrees(this.angle))});f||(r.CompareInstanceVar=function(n,t,i){return cr.do_cmp(this.instance_vars[n],t,i)},r.IsBoolInstanceVarSet=function(n){return this.instance_vars[n]},r.PickInstVarHiLow=function(n,t){var o=this.getCurrentSol(),r=o.getObjects();if(!r.length)return!1;for(var i=r[0],s=i,e=i.instance_vars[t],f,u=1,h=r.length;u<h;u++)i=r[u],f=i.instance_vars[t],(n===0&&f<e||n===1&&f>e)&&(e=f,s=i);return o.pick_one(s),!0},r.PickByUID=function(n){var r,u,f,i,e,o,t,s=this.runtime.getCurrentCondition();if(s.inverted){if(t=this.getCurrentSol(),t.select_all){for(t.select_all=!1,cr.clearArray(t.instances),cr.clearArray(t.else_instances),o=this.instances,r=0,u=o.length;r<u;r++)i=o[r],i.uid===n?t.else_instances.push(i):t.instances.push(i);return this.applySolToContainer(),!!t.instances.length}for(r=0,f=0,u=t.instances.length;r<u;r++)i=t.instances[r],t.instances[f]=i,i.uid===n?t.else_instances.push(i):f++;return cr.truncateArray(t.instances,f),this.applySolToContainer(),!!t.instances.length}if((i=this.runtime.getObjectByUID(n),!i)||(t=this.getCurrentSol(),!t.select_all&&t.instances.indexOf(i)===-1))return!1;if(this.is_family){for(e=i.type.families,r=0,u=e.length;r<u;r++)if(e[r]===this)return t.pick_one(i),this.applySolToContainer(),!0}else if(i.type===this)return t.pick_one(i),this.applySolToContainer(),!0;return!1},r.OnCreated=function(){return!0},r.OnDestroyed=function(){return!0},i.SetInstanceVar=function(n,t){var i=this.instance_vars;cr.is_number(i[n])?i[n]=cr.is_number(t)?t:parseFloat(t):cr.is_string(i[n])&&(i[n]=cr.is_string(t)?t:t.toString())},i.AddInstanceVar=function(n,t){var i=this.instance_vars;cr.is_number(i[n])?i[n]+=cr.is_number(t)?t:parseFloat(t):cr.is_string(i[n])&&(i[n]+=cr.is_string(t)?t:t.toString())},i.SubInstanceVar=function(n,t){var i=this.instance_vars;cr.is_number(i[n])&&(i[n]-=cr.is_number(t)?t:parseFloat(t))},i.SetBoolInstanceVar=function(n,t){this.instance_vars[n]=t?1:0},i.ToggleBoolInstanceVar=function(n){this.instance_vars[n]=1-this.instance_vars[n]},i.Destroy=function(){this.runtime.DestroyInstance(this)},i.LoadFromJsonString||(i.LoadFromJsonString=function(n){var r,t,u,i;try{r=JSON.parse(n)}catch(f){return}if(this.runtime.loadInstanceFromJSON(this,r,!0),this.afterLoad&&this.afterLoad(),this.behavior_insts)for(t=0,u=this.behavior_insts.length;t<u;++t)i=this.behavior_insts[t],i.afterLoad&&i.afterLoad()}),u.Count=function(n){for(var i=n.object_class.instances.length,r,t=0,u=this.runtime.createRow.length;t<u;t++)r=this.runtime.createRow[t],n.object_class.is_family?r.type.families.indexOf(n.object_class)>=0&&i++:r.type===n.object_class&&i++;n.set_int(i)},u.PickedCount=function(n){n.set_int(n.object_class.getCurrentSol().getObjects().length)},u.UID=function(n){n.set_int(this.uid)},u.IID=function(n){n.set_int(this.get_iid())},u.AsJSON||(u.AsJSON=function(n){n.set_string(JSON.stringify(this.runtime.saveInstanceToJSON(this,!0)))}));h&&(r.IsVisible=function(){return this.visible},i.SetVisible=function(n){!n!=!this.visible&&(this.visible=!!n,this.runtime.redraw=!0)},r.CompareOpacity=function(n,t){return cr.do_cmp(cr.round6dp(this.opacity*100),n,t)},i.SetOpacity=function(n){var t=n/100;t<0?t=0:t>1&&(t=1);t!==this.opacity&&(this.opacity=t,this.runtime.redraw=!0)},u.Opacity=function(n){n.set_float(cr.round6dp(this.opacity*100))});c&&(r.IsOnLayer=function(n){return n?this.layer===n:!1},r.PickTopBottom=function(n){var f=this.getCurrentSol(),r=f.getObjects(),t,i,u,e;if(!r.length)return!1;for(t=r[0],i=t,u=1,e=r.length;u<e;u++)t=r[u],n===0?(t.layer.index>i.layer.index||t.layer.index===i.layer.index&&t.get_zindex()>i.get_zindex())&&(i=t):(t.layer.index<i.layer.index||t.layer.index===i.layer.index&&t.get_zindex()<i.get_zindex())&&(i=t);return f.pick_one(i),!0},i.MoveToTop=function(){var n=this.layer,t=n.instances;t.length&&t[t.length-1]===this||(n.removeFromInstanceList(this,!1),n.appendToInstanceList(this,!1),this.runtime.redraw=!0)},i.MoveToBottom=function(){var n=this.layer,t=n.instances;t.length&&t[0]===this||(n.removeFromInstanceList(this,!1),n.prependToInstanceList(this,!1),this.runtime.redraw=!0)},i.MoveToLayer=function(n){n&&n!=this.layer&&(this.layer.removeFromInstanceList(this,!0),this.layer=n,n.appendToInstanceList(this,!0),this.runtime.redraw=!0)},i.ZMoveToObject=function(n,t){var r=n===0,i;t&&(i=t.getFirstPicked(this),i&&i.uid!==this.uid)&&(this.layer.index!==i.layer.index&&(this.layer.removeFromInstanceList(this,!0),this.layer=i.layer,i.layer.appendToInstanceList(this,!0)),this.layer.moveInstanceAdjacent(this,i,r),this.runtime.redraw=!0)},u.LayerNumber=function(n){n.set_int(this.layer.number)},u.LayerName=function(n){n.set_string(this.layer.name)},u.ZIndex=function(n){n.set_int(this.get_zindex())});l&&(i.SetEffectEnabled=function(n,t){var i,r;this.runtime.glwrap&&((i=this.type.getEffectIndexByName(t),i<0)||(r=n===1,this.active_effect_flags[i]!==r)&&(this.active_effect_flags[i]=r,this.updateActiveEffects(),this.runtime.redraw=!0))},i.SetEffectParam=function(n,t,i){var r,f,u;this.runtime.glwrap&&((r=this.type.getEffectIndexByName(n),r<0)||(f=this.type.effect_types[r],u=this.effect_params[r],t=Math.floor(t),t<0||t>=u.length)||(this.runtime.glwrap.getProgramParameterType(f.shaderindex,t)===1&&(i/=100),u[t]!==i)&&(u[t]=i,f.active&&(this.runtime.redraw=!0)))})};cr.set_bbox_changed=function(){this.bbox_changed=!0;this.cell_changed=!0;this.type.any_cell_changed=!0;this.runtime.redraw=!0;for(var i=this.bbox_changed_callbacks,n=0,t=i.length;n<t;++n)i[n](this);this.layer.useRenderCells&&this.update_bbox()};cr.add_bbox_changed_callback=function(n){n&&this.bbox_changed_callbacks.push(n)};cr.update_bbox=function(){if(this.bbox_changed){var n=this.bbox,t=this.bquad;n.set(this.x,this.y,this.x+this.width,this.y+this.height);n.offset(-this.hotspotX*this.width,-this.hotspotY*this.height);this.angle?(n.offset(-this.x,-this.y),t.set_from_rotated_rect(n,this.angle),t.offset(this.x,this.y),t.bounding_box(n)):t.set_from_rect(n);n.normalize();this.bbox_changed=!1;this.update_render_cell()}};var n=new cr.rect(0,0,0,0);cr.update_render_cell=function(){if(this.layer.useRenderCells){var t=this.layer.render_grid,i=this.bbox;(n.set(t.XToCell(i.left),t.YToCell(i.top),t.XToCell(i.right),t.YToCell(i.bottom)),this.rendercells.equals(n))||(this.rendercells.right<this.rendercells.left?t.update(this,null,n):t.update(this,this.rendercells,n),this.rendercells.copy(n),this.layer.render_list_stale=!0)}};cr.update_collision_cell=function(){if(this.cell_changed&&this.collisionsEnabled){this.update_bbox();var t=this.type.collision_grid,i=this.bbox;(n.set(t.XToCell(i.left),t.YToCell(i.top),t.XToCell(i.right),t.YToCell(i.bottom)),this.collcells.equals(n))||(this.collcells.right<this.collcells.left?t.update(this,null,n):t.update(this,this.collcells,n),this.collcells.copy(n),this.cell_changed=!1)}};cr.inst_contains_pt=function(n,t){return this.bbox.contains_pt(n,t)?this.bquad.contains_pt(n,t)?this.tilemap_exists?this.testPointOverlapTile(n,t):this.collision_poly&&!this.collision_poly.is_empty()?(this.collision_poly.cache_poly(this.width,this.height,this.angle),this.collision_poly.contains_pt(n-this.x,t-this.y)):!0:!1:!1};cr.inst_get_iid=function(){return this.type.updateIIDs(),this.iid};cr.inst_get_zindex=function(){return this.layer.updateZIndices(),this.zindex};cr.inst_updateActiveEffects=function(){cr.clearArray(this.active_effect_types);for(var t,r=!0,n=0,i=this.active_effect_flags.length;n<i;n++)this.active_effect_flags[n]&&(t=this.type.effect_types[n],this.active_effect_types.push(t),t.preservesOpaqueness||(r=!1));this.uses_shaders=!!this.active_effect_types.length;this.shaders_preserve_opaqueness=r};cr.inst_toString=function(){return"Inst"+this.puid};cr.type_getFirstPicked=function(n){var t,u,i,r;if(n&&n.is_contained&&n.type!=this)for(t=0,u=n.siblings.length;t<u;t++)if(i=n.siblings[t],i.type==this)return i;return r=this.getCurrentSol().getObjects(),r.length?r[0]:null};cr.type_getPairedInstance=function(n){var t=this.getCurrentSol().getObjects();return t.length?t[n.get_iid()%t.length]:null};cr.type_updateIIDs=function(){var n,t,r,i;if(this.stale_iids&&!this.is_family){for(n=0,t=this.instances.length;n<t;n++)this.instances[n].iid=n;for(r=n,i=this.runtime.createRow,n=0,t=i.length;n<t;++n)i[n].type===this&&(i[n].iid=r++);this.stale_iids=!1}};cr.type_getInstanceByIID=function(n){if(n<this.instances.length)return this.instances[n];n-=this.instances.length;for(var i=this.runtime.createRow,t=0,r=i.length;t<r;++t)if(i[t].type===this){if(n===0)return i[t];--n}return null};cr.type_getCurrentSol=function(){return this.solstack[this.cur_sol]};cr.type_pushCleanSol=function(){this.cur_sol++;this.cur_sol===this.solstack.length?this.solstack.push(new cr.selection(this)):(this.solstack[this.cur_sol].select_all=!0,cr.clearArray(this.solstack[this.cur_sol].else_instances))};cr.type_pushCopySol=function(){this.cur_sol++;this.cur_sol===this.solstack.length&&this.solstack.push(new cr.selection(this));var n=this.solstack[this.cur_sol],t=this.solstack[this.cur_sol-1];t.select_all?n.select_all=!0:(n.select_all=!1,cr.shallowAssignArray(n.instances,t.instances));cr.clearArray(n.else_instances)};cr.type_popSol=function(){this.cur_sol--};cr.type_getBehaviorByName=function(n){var t,r,i,e,u,f=0;if(!this.is_family)for(t=0,r=this.families.length;t<r;t++)for(u=this.families[t],i=0,e=u.behaviors.length;i<e;i++){if(n===u.behaviors[i].name)return this.extra.lastBehIndex=f,u.behaviors[i];f++}for(t=0,r=this.behaviors.length;t<r;t++){if(n===this.behaviors[t].name)return this.extra.lastBehIndex=f,this.behaviors[t];f++}return null};cr.type_getBehaviorIndexByName=function(n){var t=this.getBehaviorByName(n);return t?this.extra.lastBehIndex:-1};cr.type_getEffectIndexByName=function(n){for(var t=0,i=this.effect_types.length;t<i;t++)if(this.effect_types[t].name===n)return t;return-1};cr.type_applySolToContainer=function(){var u,o,n,f,t,i,r;if(this.is_contained&&!this.is_family){this.updateIIDs();i=this.getCurrentSol();var s=i.select_all,e=this.runtime.getCurrentEventStack(),h=e&&e.current_event&&e.current_event.orblock;for(u=0,o=this.container.length;u<o;u++)if((t=this.container[u],t!==this)&&(t.updateIIDs(),r=t.getCurrentSol(),r.select_all=s,!s)){for(cr.clearArray(r.instances),n=0,f=i.instances.length;n<f;++n)r.instances[n]=t.getInstanceByIID(i.instances[n].iid);if(h)for(cr.clearArray(r.else_instances),n=0,f=i.else_instances.length;n<f;++n)r.else_instances[n]=t.getInstanceByIID(i.else_instances[n].iid)}}};cr.type_toString=function(){return"Type"+this.sid};cr.do_cmp=function(n,t,i){if(typeof n=="undefined"||typeof i=="undefined")return!1;switch(t){case 0:return n===i;case 1:return n!==i;case 2:return n<i;case 3:return n<=i;case 4:return n>i;case 5:return n>=i;default:return!1}}}();cr.shaders={};cr.plugins_.AJAX=function(n){this.runtime=n},function(){function u(){}function r(){}function s(){}var f=!1,c=null,h=null,l="",t=cr.plugins_.AJAX.prototype,a,e,n,i,o;t.Type=function(n){this.plugin=n;this.runtime=n.runtime};a=t.Type.prototype;a.onCreate=function(){};t.Instance=function(n){if(this.type=n,this.runtime=n.runtime,this.lastData="",this.curTag="",this.progress=0,this.timeout=-1,f=this.runtime.isNWjs,f){c=require("path");h=require("fs");var t=window.process||nw.process;l=c.dirname(t.execPath)+"\\"}};e=t.Instance.prototype;n=null;window.C2_AJAX_DCSide=function(t,i,r){n&&(t==="success"?(n.curTag=i,n.lastData=r,n.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyComplete,n),n.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnComplete,n)):t==="error"?(n.curTag=i,n.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyError,n),n.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnError,n)):t==="progress"&&(n.progress=r,n.curTag=i,n.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnProgress,n)))};e.onCreate=function(){n=this};e.saveToJSON=function(){return{lastData:this.lastData}};e.loadFromJSON=function(n){this.lastData=n.lastData;this.curTag="";this.progress=0};i={};o="";e.doRequest=function(n,t,r,u){var a;if(this.runtime.isDirectCanvas){AppMobi.webview.execute('C2_AJAX_WebSide("'+n+'", "'+t+'", "'+r+'", '+(u?'"'+u+'"':"null")+");");return}var e=this,s=null,v=function(){e.curTag=n;e.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyError,e);e.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnError,e)},c=function(){if(f){var i=l+t;h.existsSync(i)?h.readFile(i,{encoding:"utf8"},function(t,i){if(t){v();return}e.curTag=n;e.lastData=i.replace(/\r\n/g,"\n");e.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyComplete,e);e.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnComplete,e)}):v()}else v()},y=function(t){t.lengthComputable&&(e.progress=t.loaded/t.total,e.curTag=n,e.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnProgress,e))};try{s=this.runtime.isWindowsPhone8?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest;s.onreadystatechange=function(){s.readyState===4&&(e.curTag=n,e.lastData=s.responseText?s.responseText.replace(/\r\n/g,"\n"):"",s.status>=400?(e.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyError,e),e.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnError,e)):f&&!e.lastData.length||!f&&s.status===0&&!e.lastData.length||(e.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyComplete,e),e.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnComplete,e)))};this.runtime.isWindowsPhone8||(s.onerror=c,s.ontimeout=c,s.onabort=c,s.onprogress=y);s.open(r,t);this.runtime.isWindowsPhone8||this.timeout>=0&&typeof s.timeout!="undefined"&&(s.timeout=this.timeout);try{s.responseType="text"}catch(p){}if(u&&s.setRequestHeader&&!i.hasOwnProperty("Content-Type")&&s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.setRequestHeader){for(a in i)if(i.hasOwnProperty(a))try{s.setRequestHeader(a,i[a])}catch(p){}i={}}if(o&&s.overrideMimeType){try{s.overrideMimeType(o)}catch(p){}o=""}u?s.send(u):s.send()}catch(p){c()}};u.prototype.OnComplete=function(n){return cr.equals_nocase(n,this.curTag)};u.prototype.OnAnyComplete=function(){return!0};u.prototype.OnError=function(n){return cr.equals_nocase(n,this.curTag)};u.prototype.OnAnyError=function(){return!0};u.prototype.OnProgress=function(n){return cr.equals_nocase(n,this.curTag)};t.cnds=new u;r.prototype.Request=function(n,t){var i=this;this.runtime.isWKWebView&&!this.runtime.isAbsoluteUrl(t)?this.runtime.fetchLocalFileViaCordovaAsText(t,function(t){i.curTag=n;i.lastData=t.replace(/\r\n/g,"\n");i.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyComplete,i);i.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnComplete,i)},function(){i.curTag=n;i.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyError,i);i.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnError,i)}):this.doRequest(n,t,"GET")};r.prototype.RequestFile=function(n,t){var i=this;this.runtime.isWKWebView?this.runtime.fetchLocalFileViaCordovaAsText(t,function(t){i.curTag=n;i.lastData=t.replace(/\r\n/g,"\n");i.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyComplete,i);i.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnComplete,i)},function(){i.curTag=n;i.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnAnyError,i);i.runtime.trigger(cr.plugins_.AJAX.prototype.cnds.OnError,i)}):this.doRequest(n,t,"GET")};r.prototype.Post=function(n,t,i,r){this.doRequest(n,t,r,i)};r.prototype.SetTimeout=function(n){this.timeout=n*1e3};r.prototype.SetHeader=function(n,t){i[n]=t};r.prototype.OverrideMIMEType=function(n){o=n};t.acts=new r;s.prototype.LastData=function(n){n.set_string(this.lastData)};s.prototype.Progress=function(n){n.set_float(this.progress)};s.prototype.Tag=function(n){n.set_string(this.curTag)};t.exps=new s}();cr.plugins_.Arr=function(n){this.runtime=n},function(){function r(){return o.length?o.pop():[]}function f(n){for(var t=0,i=n.length;t<i;t++)Array.isArray(n[t])&&f(n[t]);cr.clearArray(n);o.push(n)}function u(){}function n(){}function s(n,t){if(cr.is_number(n)&&cr.is_number(t))return n-t;var i=""+n,r=""+t;return i<r?-1:i>r?1:0}function t(){}var e=cr.plugins_.Arr.prototype,h,i,o;e.Type=function(n){this.plugin=n;this.runtime=n.runtime};h=e.Type.prototype;h.onCreate=function(){};e.Instance=function(n){this.type=n;this.runtime=n.runtime};i=e.Instance.prototype;o=[];Array.isArray||(Array.isArray=function(n){return Object.prototype.toString.call(n)==="[object Array]"});i.onCreate=function(){var t,n,i,u;for(this.cx=this.properties[0],this.cy=this.properties[1],this.cz=this.properties[2],this.recycled||(this.arr=r()),t=this.arr,t.length=this.cx,n=0;n<this.cx;n++)for(t[n]||(t[n]=r()),t[n].length=this.cy,i=0;i<this.cy;i++)for(t[n][i]||(t[n][i]=r()),t[n][i].length=this.cz,u=0;u<this.cz;u++)t[n][i][u]=0;this.forX=[];this.forY=[];this.forZ=[];this.forDepth=-1};i.onDestroy=function(){for(var n=0;n<this.cx;n++)f(this.arr[n]);cr.clearArray(this.arr)};i.at=function(n,t,i){return(n=Math.floor(n),t=Math.floor(t),i=Math.floor(i),isNaN(n)||n<0||n>this.cx-1)?0:isNaN(t)||t<0||t>this.cy-1?0:isNaN(i)||i<0||i>this.cz-1?0:this.arr[n][t][i]};i.set=function(n,t,i,r){(n=Math.floor(n),t=Math.floor(t),i=Math.floor(i),isNaN(n)||n<0||n>this.cx-1)||isNaN(t)||t<0||t>this.cy-1||isNaN(i)||i<0||i>this.cz-1||(this.arr[n][t][i]=r)};i.getAsJSON=function(){return JSON.stringify({c2array:!0,size:[this.cx,this.cy,this.cz],data:this.arr})};i.saveToJSON=function(){return{size:[this.cx,this.cy,this.cz],data:this.arr}};i.loadFromJSON=function(n){var t=n.size;this.cx=t[0];this.cy=t[1];this.cz=t[2];this.arr=n.data};i.setSize=function(n,t,i){if(n<0&&(n=0),t<0&&(t=0),i<0&&(i=0),this.cx!==n||this.cy!==t||this.cz!==i){this.cx=n;this.cy=t;this.cz=i;var u,e,o,f=this.arr;for(f.length=n,u=0;u<this.cx;u++)for(cr.is_undefined(f[u])&&(f[u]=r()),f[u].length=t,e=0;e<this.cy;e++)for(cr.is_undefined(f[u][e])&&(f[u][e]=r()),f[u][e].length=i,o=0;o<this.cz;o++)cr.is_undefined(f[u][e][o])&&(f[u][e][o]=0)}};i.getForX=function(){return this.forDepth>=0&&this.forDepth<this.forX.length?this.forX[this.forDepth]:0};i.getForY=function(){return this.forDepth>=0&&this.forDepth<this.forY.length?this.forY[this.forDepth]:0};i.getForZ=function(){return this.forDepth>=0&&this.forDepth<this.forZ.length?this.forZ[this.forDepth]:0};u.prototype.CompareX=function(n,t,i){return cr.do_cmp(this.at(n,0,0),t,i)};u.prototype.CompareXY=function(n,t,i,r){return cr.do_cmp(this.at(n,t,0),i,r)};u.prototype.CompareXYZ=function(n,t,i,r,u){return cr.do_cmp(this.at(n,t,i),r,u)};i.doForEachTrigger=function(n){this.runtime.pushCopySol(n.solModifiers);n.retrigger();this.runtime.popSol(n.solModifiers)};u.prototype.ArrForEach=function(n){var i=this.runtime.getCurrentEventStack().current_event,t;this.forDepth++;t=this.forDepth;t===this.forX.length?(this.forX.push(0),this.forY.push(0),this.forZ.push(0)):(this.forX[t]=0,this.forY[t]=0,this.forZ[t]=0);switch(n){case 0:for(this.forX[t]=0;this.forX[t]<this.cx;this.forX[t]++)for(this.forY[t]=0;this.forY[t]<this.cy;this.forY[t]++)for(this.forZ[t]=0;this.forZ[t]<this.cz;this.forZ[t]++)this.doForEachTrigger(i);break;case 1:for(this.forX[t]=0;this.forX[t]<this.cx;this.forX[t]++)for(this.forY[t]=0;this.forY[t]<this.cy;this.forY[t]++)this.doForEachTrigger(i);break;case 2:for(this.forX[t]=0;this.forX[t]<this.cx;this.forX[t]++)this.doForEachTrigger(i)}return this.forDepth--,!1};u.prototype.CompareCurrent=function(n,t){return cr.do_cmp(this.at(this.getForX(),this.getForY(),this.getForZ()),n,t)};u.prototype.Contains=function(n){for(var i,r,t=0;t<this.cx;t++)for(i=0;i<this.cy;i++)for(r=0;r<this.cz;r++)if(this.arr[t][i][r]===n)return!0;return!1};u.prototype.IsEmpty=function(){return this.cx===0||this.cy===0||this.cz===0};u.prototype.CompareSize=function(n,t,i){var r=0;switch(n){case 0:r=this.cx;break;case 1:r=this.cy;break;case 2:r=this.cz}return cr.do_cmp(r,t,i)};e.cnds=new u;n.prototype.Clear=function(){for(var t,i,n=0;n<this.cx;n++)for(t=0;t<this.cy;t++)for(i=0;i<this.cz;i++)this.arr[n][t][i]=0};n.prototype.SetSize=function(n,t,i){this.setSize(n,t,i)};n.prototype.SetX=function(n,t){this.set(n,0,0,t)};n.prototype.SetXY=function(n,t,i){this.set(n,t,0,i)};n.prototype.SetXYZ=function(n,t,i,r){this.set(n,t,i,r)};n.prototype.Push=function(n,t,i){var u=0,f=0,o=0,e=this.arr;switch(i){case 0:for(n===0?(u=e.length,e.push(r())):(u=0,e.unshift(r())),e[u].length=this.cy;f<this.cy;f++)for(e[u][f]=r(),e[u][f].length=this.cz,o=0;o<this.cz;o++)e[u][f][o]=t;this.cx++;break;case 1:for(;u<this.cx;u++)for(n===0?(f=e[u].length,e[u].push(r())):(f=0,e[u].unshift(r())),e[u][f].length=this.cz,o=0;o<this.cz;o++)e[u][f][o]=t;this.cy++;break;case 2:for(;u<this.cx;u++)for(f=0;f<this.cy;f++)n===0?e[u][f].push(t):e[u][f].unshift(t);this.cz++}};n.prototype.Pop=function(n,t){var i=0,u=0,r=this.arr;switch(t){case 0:if(this.cx===0)break;n===0?f(r.pop()):f(r.shift());this.cx--;break;case 1:if(this.cy===0)break;for(;i<this.cx;i++)n===0?f(r[i].pop()):f(r[i].shift());this.cy--;break;case 2:if(this.cz===0)break;for(;i<this.cx;i++)for(u=0;u<this.cy;u++)n===0?r[i][u].pop():r[i][u].shift();this.cz--}};n.prototype.Reverse=function(n){var t=0,i=0,r=this.arr;if(this.cx!==0&&this.cy!==0&&this.cz!==0)switch(n){case 0:r.reverse();break;case 1:for(;t<this.cx;t++)r[t].reverse();break;case 2:for(;t<this.cx;t++)for(i=0;i<this.cy;i++)r[t][i].reverse()}};n.prototype.Sort=function(n){var t=0,i=0,r=this.arr;if(this.cx!==0&&this.cy!==0&&this.cz!==0)switch(n){case 0:r.sort(function(n,t){return s(n[0][0],t[0][0])});break;case 1:for(;t<this.cx;t++)r[t].sort(function(n,t){return s(n[0],t[0])});break;case 2:for(;t<this.cx;t++)for(i=0;i<this.cy;i++)r[t][i].sort(s)}};n.prototype.Delete=function(n,t){var i=0,u=0,r;if(n=Math.floor(n),r=this.arr,!(n<0))switch(t){case 0:if(n>=this.cx)break;f(r[n]);r.splice(n,1);this.cx--;break;case 1:if(n>=this.cy)break;for(;i<this.cx;i++)f(r[i][n]),r[i].splice(n,1);this.cy--;break;case 2:if(n>=this.cz)break;for(;i<this.cx;i++)for(u=0;u<this.cy;u++)r[i][u].splice(n,1);this.cz--}};n.prototype.Insert=function(n,t,i){var u=0,f=0,o=0,e;if(t=Math.floor(t),e=this.arr,!(t<0))switch(i){case 0:if(t>this.cx)return;for(u=t,e.splice(u,0,r()),e[u].length=this.cy;f<this.cy;f++)for(e[u][f]=r(),e[u][f].length=this.cz,o=0;o<this.cz;o++)e[u][f][o]=n;this.cx++;break;case 1:if(t>this.cy)return;for(;u<this.cx;u++)for(f=t,e[u].splice(f,0,r()),e[u][f].length=this.cz,o=0;o<this.cz;o++)e[u][f][o]=n;this.cy++;break;case 2:if(t>this.cz)return;for(;u<this.cx;u++)for(f=0;f<this.cy;f++)e[u][f].splice(t,0,n);this.cz++}};n.prototype.JSONLoad=function(n){var t,i;try{t=JSON.parse(n)}catch(r){return}t.c2array&&(i=t.size,this.cx=i[0],this.cy=i[1],this.cz=i[2],this.arr=t.data)};n.prototype.JSONDownload=function(n){var t=document.createElement("a"),u,i,r;typeof t.download=="undefined"?(u="data:text/html,"+encodeURIComponent("<p><a download='"+n+"' href=\"data:application/json,"+encodeURIComponent(this.getAsJSON())+'">Download link<\/a><\/p>'),window.open(u)):(i=document.getElementsByTagName("body")[0],t.textContent=n,t.href="data:application/json,"+encodeURIComponent(this.getAsJSON()),t.download=n,i.appendChild(t),r=document.createEvent("MouseEvent"),r.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),t.dispatchEvent(r),i.removeChild(t))};e.acts=new n;t.prototype.At=function(n,t,i,r){var u=i||0,f=r||0;n.set_any(this.at(t,u,f))};t.prototype.Width=function(n){n.set_int(this.cx)};t.prototype.Height=function(n){n.set_int(this.cy)};t.prototype.Depth=function(n){n.set_int(this.cz)};t.prototype.CurX=function(n){n.set_int(this.getForX())};t.prototype.CurY=function(n){n.set_int(this.getForY())};t.prototype.CurZ=function(n){n.set_int(this.getForZ())};t.prototype.CurValue=function(n){n.set_any(this.at(this.getForX(),this.getForY(),this.getForZ()))};t.prototype.Front=function(n){n.set_any(this.at(0,0,0))};t.prototype.Back=function(n){n.set_any(this.at(this.cx-1,0,0))};t.prototype.IndexOf=function(n,t){for(var i=0;i<this.cx;i++)if(this.arr[i][0][0]===t){n.set_int(i);return}n.set_int(-1)};t.prototype.LastIndexOf=function(n,t){for(var i=this.cx-1;i>=0;i--)if(this.arr[i][0][0]===t){n.set_int(i);return}n.set_int(-1)};t.prototype.AsJSON=function(n){n.set_string(this.getAsJSON())};e.exps=new t}();cr.plugins_.Audio=function(n){this.runtime=n},function(){function ci(n){var t=si.indexOf(n);t===-1&&si.push(n)}function li(n){var i=n.instanceObject,t;try{t=i.play()}catch(r){ci(n);return}t?t.catch(function(){ci(n)}):er&&!l.isInUserInputEvent&&ci(n)}function ei(){var i,f,t,r,u;if(or||wi||!n||(lr(),n.state==="running"&&(or=!0)),u=si.slice(0),cr.clearArray(si),!p)for(i=0,f=u.length;i<f;++i)t=u[i],t.stopped||t.is_paused||(r=t.instanceObject.play(),r&&r.catch(function(){ci(t)}))}function lr(){if(n.state==="suspended"&&n.resume&&n.resume(),n.createBuffer){var i=n.createBuffer(1,220,22050),t=n.createBufferSource();t.buffer=i;t.connect(n.destination);yt(t)}}function w(n){var t=vi(n);return isFinite(t)||(t=0),t<0&&(t=0),t>1&&(t=1),t}function ai(n){return n<0&&(n=0),n>1&&(n=1),ar(n)}function vi(n){return Math.pow(10,n/20)}function ar(n){return Math.log(n)/Math.log(10)*20}function yi(t){return(t=t.toLowerCase(),h.hasOwnProperty(t)&&h[t].length)?h[t][0].getInputNode():n.destination}function f(){return n.createGain?n.createGain():n.createGainNode()}function sr(t){return n.createDelay?n.createDelay(t):n.createDelayNode(t)}function yt(n,t){n.start?n.start(t||0):n.noteOn(t||0)}function gi(n,t,i,r){n.start?n.start(r||0,t):n.noteGrainOn(r||0,t,i-t)}function nr(n){try{n.stop?n.stop(0):n.noteOff(0)}catch(t){}}function o(t,i,r,u){if(t){if(t.cancelScheduledValues(0),u===0){t.value=i;return}var f=n.currentTime;u+=f;switch(r){case 0:t.setValueAtTime(i,u);break;case 1:t.setValueAtTime(t.value,f);t.linearRampToValueAtTime(i,u);break;case 2:t.setValueAtTime(t.value,f);t.exponentialRampToValueAtTime(i,u)}}}function pt(t,i,r,u,e,o){this.type="filter";this.params=[t,i,r,u,e,o];this.inputNode=f();this.wetNode=f();this.wetNode.gain.value=o;this.dryNode=f();this.dryNode.gain.value=1-o;this.filterNode=n.createBiquadFilter();this.filterNode.type=typeof this.filterNode.type=="number"?t:tr[t];this.filterNode.frequency.value=i;this.filterNode.detune&&(this.filterNode.detune.value=r);this.filterNode.Q.value=u;this.filterNode.gain.value=e;this.inputNode.connect(this.filterNode);this.inputNode.connect(this.dryNode);this.filterNode.connect(this.wetNode)}function wt(n,t,i){this.type="delay";this.params=[n,t,i];this.inputNode=f();this.wetNode=f();this.wetNode.gain.value=i;this.dryNode=f();this.dryNode.gain.value=1-i;this.mainNode=f();this.delayNode=sr(n);this.delayNode.delayTime.value=n;this.delayGainNode=f();this.delayGainNode.gain.value=t;this.inputNode.connect(this.mainNode);this.inputNode.connect(this.dryNode);this.mainNode.connect(this.wetNode);this.mainNode.connect(this.delayNode);this.delayNode.connect(this.delayGainNode);this.delayGainNode.connect(this.mainNode)}function et(t,i,r,u){this.type="convolve";this.params=[i,r,u];this.inputNode=f();this.wetNode=f();this.wetNode.gain.value=r;this.dryNode=f();this.dryNode.gain.value=1-r;this.convolveNode=n.createConvolver();t&&(this.convolveNode.normalize=i,this.convolveNode.buffer=t);this.inputNode.connect(this.convolveNode);this.inputNode.connect(this.dryNode);this.convolveNode.connect(this.wetNode)}function bt(t,i,r,u,e){this.type="flanger";this.params=[t,i,r,u,e];this.inputNode=f();this.dryNode=f();this.dryNode.gain.value=1-e/2;this.wetNode=f();this.wetNode.gain.value=e/2;this.feedbackNode=f();this.feedbackNode.gain.value=u;this.delayNode=sr(t+i);this.delayNode.delayTime.value=t;this.oscNode=n.createOscillator();this.oscNode.frequency.value=r;this.oscGainNode=f();this.oscGainNode.gain.value=i;this.inputNode.connect(this.delayNode);this.inputNode.connect(this.dryNode);this.delayNode.connect(this.wetNode);this.delayNode.connect(this.feedbackNode);this.feedbackNode.connect(this.delayNode);this.oscNode.connect(this.oscGainNode);this.oscGainNode.connect(this.delayNode.delayTime);yt(this.oscNode)}function kt(t,i,r,u,e,o){this.type="phaser";this.params=[t,i,r,u,e,o];this.inputNode=f();this.dryNode=f();this.dryNode.gain.value=1-o/2;this.wetNode=f();this.wetNode.gain.value=o/2;this.filterNode=n.createBiquadFilter();this.filterNode.type=typeof this.filterNode.type=="number"?7:"allpass";this.filterNode.frequency.value=t;this.filterNode.detune&&(this.filterNode.detune.value=i);this.filterNode.Q.value=r;this.oscNode=n.createOscillator();this.oscNode.frequency.value=e;this.oscGainNode=f();this.oscGainNode.gain.value=u;this.inputNode.connect(this.filterNode);this.inputNode.connect(this.dryNode);this.filterNode.connect(this.wetNode);this.oscNode.connect(this.oscGainNode);this.oscGainNode.connect(this.filterNode.frequency);yt(this.oscNode)}function ct(n){this.type="gain";this.params=[n];this.node=f();this.node.gain.value=n}function dt(t,i){this.type="tremolo";this.params=[t,i];this.node=f();this.node.gain.value=1-i/2;this.oscNode=n.createOscillator();this.oscNode.frequency.value=t;this.oscGainNode=f();this.oscGainNode.gain.value=i/2;this.oscNode.connect(this.oscGainNode);this.oscGainNode.connect(this.node.gain);yt(this.oscNode)}function gt(t,i){this.type="ringmod";this.params=[t,i];this.inputNode=f();this.wetNode=f();this.wetNode.gain.value=i;this.dryNode=f();this.dryNode.gain.value=1-i;this.ringNode=f();this.ringNode.gain.value=0;this.oscNode=n.createOscillator();this.oscNode.frequency.value=t;this.oscNode.connect(this.ringNode.gain);yt(this.oscNode);this.inputNode.connect(this.ringNode);this.inputNode.connect(this.dryNode);this.ringNode.connect(this.wetNode)}function ft(t,i,r,u,e){this.type="distortion";this.params=[t,i,r,u,e];this.inputNode=f();this.preGain=f();this.postGain=f();this.setDrive(r,vi(u));this.wetNode=f();this.wetNode.gain.value=e;this.dryNode=f();this.dryNode.gain.value=1-e;this.waveShaper=n.createWaveShaper();this.curve=new Float32Array(65536);this.generateColortouchCurve(t,i);this.waveShaper.curve=this.curve;this.inputNode.connect(this.preGain);this.inputNode.connect(this.dryNode);this.preGain.connect(this.waveShaper);this.waveShaper.connect(this.postGain);this.postGain.connect(this.wetNode)}function vr(n,t){return 1-Math.exp(-t*n)}function ni(t,i,r,u,f){this.type="compressor";this.params=[t,i,r,u,f];this.node=n.createDynamicsCompressor();try{this.node.threshold.value=t;this.node.knee.value=i;this.node.ratio.value=r;this.node.attack.value=u;this.node.release.value=f}catch(e){}}function lt(t,i){this.type="analyser";this.params=[t,i];this.node=n.createAnalyser();this.node.fftSize=t;this.node.smoothingTimeConstant=i;this.freqBins=new Float32Array(this.node.frequencyBinCount);this.signal=new Uint8Array(t);this.peak=0;this.rms=0}function ti(){this.obj=null;this.loadUid=0}function ii(i,u){var e,o;this.src=i;this.myapi=r;this.is_music=u;this.added_end_listener=!1;e=this;this.outNode=null;this.mediaSourceNode=null;this.panWhenReady=[];this.seekWhenReady=0;this.pauseWhenReady=!1;this.supportWebAudioAPI=!1;this.failedToLoad=!1;this.wasEverReady=!1;r===t&&u&&!hi&&(this.myapi=a,this.outNode=f());this.bufferObject=null;this.audioData=null;switch(this.myapi){case a:this.bufferObject=new Audio;this.bufferObject.crossOrigin="anonymous";this.bufferObject.addEventListener("canplaythrough",function(){e.wasEverReady=!0});r===t&&n.createMediaElementSource&&!/wiiu/i.test(navigator.userAgent)&&(this.supportWebAudioAPI=!0,this.bufferObject.addEventListener("canplay",function(){!e.mediaSourceNode&&e.bufferObject&&(e.mediaSourceNode=n.createMediaElementSource(e.bufferObject),e.mediaSourceNode.connect(e.outNode))}));this.bufferObject.autoplay=!1;this.bufferObject.preload="auto";this.bufferObject.src=i;break;case t:l.isWKWebView?l.fetchLocalFileViaCordovaAsArrayBuffer(i,function(n){e.audioData=n;e.decodeAudioBuffer()},function(){e.failedToLoad=!0}):(o=new XMLHttpRequest,o.open("GET",i,!0),o.responseType="arraybuffer",o.onload=function(){e.audioData=o.response;e.decodeAudioBuffer()},o.onerror=function(){e.failedToLoad=!0},o.send());break;case y:this.bufferObject=!0;break;case b:this.bufferObject=!0}}function c(i,u){var e=this,o;this.tag=u;this.fresh=!0;this.stopped=!0;this.src=i.src;this.buffer=i;this.myapi=r;this.is_music=i.is_music;this.playbackRate=1;this.hasPlaybackEnded=!0;this.resume_me=!1;this.is_paused=!1;this.resume_position=0;this.looping=!1;this.is_muted=!1;this.is_silent=!1;this.volume=1;this.onended_handler=function(n){if(!e.is_paused&&!e.resume_me){var t=this;(t||(t=n.target),t===e.active_buffer)&&(e.hasPlaybackEnded=!0,e.stopped=!0,fi=e.tag,l.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,vt))}};this.active_buffer=null;this.isTimescaled=oi===1&&!this.is_music||oi===2;this.mutevol=1;this.startTime=this.isTimescaled?l.kahanTime.sum:l.wallTime.sum;this.gainNode=null;this.pannerNode=null;this.pannerEnabled=!1;this.objectTracker=null;this.panX=0;this.panY=0;this.panAngle=0;this.panConeInner=0;this.panConeOuter=0;this.panConeOuterGain=0;this.instanceObject=null;o=!1;this.myapi!==t||this.buffer.myapi!==a||this.buffer.supportWebAudioAPI||(this.myapi=a);switch(this.myapi){case a:this.is_music?(this.instanceObject=i.bufferObject,o=!i.added_end_listener,i.added_end_listener=!0):(this.instanceObject=new Audio,this.instanceObject.crossOrigin="anonymous",this.instanceObject.autoplay=!1,this.instanceObject.src=i.bufferObject.src,o=!0);o&&this.instanceObject.addEventListener("ended",function(){fi=e.tag;e.stopped=!0;l.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,vt)});break;case t:this.gainNode=f();this.gainNode.connect(yi(u));this.buffer.myapi===t?i.bufferObject&&(this.instanceObject=n.createBufferSource(),this.instanceObject.buffer=i.bufferObject,this.instanceObject.connect(this.gainNode)):(this.instanceObject=this.buffer.bufferObject,this.buffer.outNode.connect(this.gainNode),this.buffer.added_end_listener||(this.buffer.added_end_listener=!0,this.buffer.bufferObject.addEventListener("ended",function(){fi=e.tag;e.stopped=!0;l.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,vt)})));break;case y:this.instanceObject=new window.Media(st+this.src,null,null,function(n){n===window.Media.MEDIA_STOPPED&&(e.hasPlaybackEnded=!0,e.stopped=!0,fi=e.tag,l.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,vt))});break;case b:this.instanceObject=!0}}function yr(n,t){var i=n.isPlaying()?1:0,r=t.isPlaying()?1:0;return i===r?0:i<r?1:-1}function tt(n,t){if(cr.clearArray(s),!n.length){if(!e||e.hasEnded())return;cr.clearArray(s);s[0]=e;return}for(var r,i=0,f=u.length;i<f;i++)r=u[i],cr.equals_nocase(n,r.tag)&&s.push(r);t&&s.sort(yr)}function hr(t){var i,u,r,f,e=n.destination;if(h.hasOwnProperty(t)&&(r=h[t],r.length))for(e=r[0].getInputNode(),i=0,u=r.length;i<u;i++)f=r[i],i+1===u?f.connectTo(n.destination):f.connectTo(r[i+1].getInputNode());for(tt(t),i=0,u=s.length;i<u;i++)s[i].reconnect(e);ht&&di===t&&(ht.disconnect(),ht.connect(e))}function v(n,t){h.hasOwnProperty(n)?h[n].push(t):h[n]=[t];hr(n)}function at(){}function i(){}function it(){}function pi(n,t){var i=null;return h.hasOwnProperty(n)&&(i=h[n]),i&&t>=0&&t<i.length&&i[t].freqBins?i[t]:null}var ot=cr.plugins_.Audio.prototype,ir,h,tr,g,ri,ui,s;ot.Type=function(n){this.plugin=n;this.runtime=n.runtime};ir=ot.Type.prototype;ir.onCreate=function(){};var l=null,vt=null,fi="",st="",a=0,t=1,y=2,b=3,r=a,n=null,d=[],u=[],e=null,k=!1,oi=0,p=!1,nt=1,rt=0,ut=0,wi=!1,bi=1,ki=1,rr=10,ur=1e4,fr=1,ht=null,di="",er=!1,si=[],hi=!1,or=!1;document.addEventListener("pointerup",ei,!0);document.addEventListener("touchend",ei,!0);document.addEventListener("click",ei,!0);document.addEventListener("keydown",ei,!0);document.addEventListener("gamepadconnected",ei,!0);h={};tr=["lowpass","highpass","bandpass","lowshelf","highshelf","peaking","notch","allpass"];pt.prototype.connectTo=function(n){this.wetNode.disconnect();this.wetNode.connect(n);this.dryNode.disconnect();this.dryNode.connect(n)};pt.prototype.remove=function(){this.inputNode.disconnect();this.filterNode.disconnect();this.wetNode.disconnect();this.dryNode.disconnect()};pt.prototype.getInputNode=function(){return this.inputNode};pt.prototype.setParam=function(n,t,i,r){switch(n){case 0:t=t/100;t<0&&(t=0);t>1&&(t=1);this.params[5]=t;o(this.wetNode.gain,t,i,r);o(this.dryNode.gain,1-t,i,r);break;case 1:this.params[1]=t;o(this.filterNode.frequency,t,i,r);break;case 2:this.params[2]=t;o(this.filterNode.detune,t,i,r);break;case 3:this.params[3]=t;o(this.filterNode.Q,t,i,r);break;case 4:this.params[4]=t;o(this.filterNode.gain,t,i,r)}};wt.prototype.connectTo=function(n){this.wetNode.disconnect();this.wetNode.connect(n);this.dryNode.disconnect();this.dryNode.connect(n)};wt.prototype.remove=function(){this.inputNode.disconnect();this.mainNode.disconnect();this.delayNode.disconnect();this.delayGainNode.disconnect();this.wetNode.disconnect();this.dryNode.disconnect()};wt.prototype.getInputNode=function(){return this.inputNode};wt.prototype.setParam=function(n,t,i,r){switch(n){case 0:t=t/100;t<0&&(t=0);t>1&&(t=1);this.params[2]=t;o(this.wetNode.gain,t,i,r);o(this.dryNode.gain,1-t,i,r);break;case 4:this.params[1]=w(t);o(this.delayGainNode.gain,w(t),i,r);break;case 5:this.params[0]=t;o(this.delayNode.delayTime,t,i,r)}};et.prototype.connectTo=function(n){this.wetNode.disconnect();this.wetNode.connect(n);this.dryNode.disconnect();this.dryNode.connect(n)};et.prototype.remove=function(){this.inputNode.disconnect();this.convolveNode.disconnect();this.wetNode.disconnect();this.dryNode.disconnect()};et.prototype.getInputNode=function(){return this.inputNode};et.prototype.setParam=function(n,t,i,r){switch(n){case 0:t=t/100;t<0&&(t=0);t>1&&(t=1);this.params[1]=t;o(this.wetNode.gain,t,i,r);o(this.dryNode.gain,1-t,i,r)}};bt.prototype.connectTo=function(n){this.dryNode.disconnect();this.dryNode.connect(n);this.wetNode.disconnect();this.wetNode.connect(n)};bt.prototype.remove=function(){this.inputNode.disconnect();this.delayNode.disconnect();this.oscNode.disconnect();this.oscGainNode.disconnect();this.dryNode.disconnect();this.wetNode.disconnect();this.feedbackNode.disconnect()};bt.prototype.getInputNode=function(){return this.inputNode};bt.prototype.setParam=function(n,t,i,r){switch(n){case 0:t=t/100;t<0&&(t=0);t>1&&(t=1);this.params[4]=t;o(this.wetNode.gain,t/2,i,r);o(this.dryNode.gain,1-t/2,i,r);break;case 6:this.params[1]=t/1e3;o(this.oscGainNode.gain,t/1e3,i,r);break;case 7:this.params[2]=t;o(this.oscNode.frequency,t,i,r);break;case 8:this.params[3]=t/100;o(this.feedbackNode.gain,t/100,i,r)}};kt.prototype.connectTo=function(n){this.dryNode.disconnect();this.dryNode.connect(n);this.wetNode.disconnect();this.wetNode.connect(n)};kt.prototype.remove=function(){this.inputNode.disconnect();this.filterNode.disconnect();this.oscNode.disconnect();this.oscGainNode.disconnect();this.dryNode.disconnect();this.wetNode.disconnect()};kt.prototype.getInputNode=function(){return this.inputNode};kt.prototype.setParam=function(n,t,i,r){switch(n){case 0:t=t/100;t<0&&(t=0);t>1&&(t=1);this.params[5]=t;o(this.wetNode.gain,t/2,i,r);o(this.dryNode.gain,1-t/2,i,r);break;case 1:this.params[0]=t;o(this.filterNode.frequency,t,i,r);break;case 2:this.params[1]=t;o(this.filterNode.detune,t,i,r);break;case 3:this.params[2]=t;o(this.filterNode.Q,t,i,r);break;case 6:this.params[3]=t;o(this.oscGainNode.gain,t,i,r);break;case 7:this.params[4]=t;o(this.oscNode.frequency,t,i,r)}};ct.prototype.connectTo=function(n){this.node.disconnect();this.node.connect(n)};ct.prototype.remove=function(){this.node.disconnect()};ct.prototype.getInputNode=function(){return this.node};ct.prototype.setParam=function(n,t,i,r){switch(n){case 4:this.params[0]=w(t);o(this.node.gain,w(t),i,r)}};dt.prototype.connectTo=function(n){this.node.disconnect();this.node.connect(n)};dt.prototype.remove=function(){this.oscNode.disconnect();this.oscGainNode.disconnect();this.node.disconnect()};dt.prototype.getInputNode=function(){return this.node};dt.prototype.setParam=function(n,t,i,r){switch(n){case 0:t=t/100;t<0&&(t=0);t>1&&(t=1);this.params[1]=t;o(this.node.gain.value,1-t/2,i,r);o(this.oscGainNode.gain.value,t/2,i,r);break;case 7:this.params[0]=t;o(this.oscNode.frequency,t,i,r)}};gt.prototype.connectTo=function(n){this.wetNode.disconnect();this.wetNode.connect(n);this.dryNode.disconnect();this.dryNode.connect(n)};gt.prototype.remove=function(){this.oscNode.disconnect();this.ringNode.disconnect();this.inputNode.disconnect();this.wetNode.disconnect();this.dryNode.disconnect()};gt.prototype.getInputNode=function(){return this.inputNode};gt.prototype.setParam=function(n,t,i,r){switch(n){case 0:t=t/100;t<0&&(t=0);t>1&&(t=1);this.params[1]=t;o(this.wetNode.gain,t,i,r);o(this.dryNode.gain,1-t,i,r);break;case 7:this.params[0]=t;o(this.oscNode.frequency,t,i,r)}};ft.prototype.setDrive=function(n,t){n<.01&&(n=.01);this.preGain.gain.value=n;this.postGain.gain.value=Math.pow(1/n,.6)*t};ft.prototype.shape=function(n,t,i){var f=1.05*i*t,u=f-t,e=n<0?-1:1,r=n<0?-n:n,o=r<t?r:t+u*vr(r-t,1/u);return o*e};ft.prototype.generateColortouchCurve=function(n,t){for(var f=vi(n),e=vi(t),u=32768,i=0,r=0;r<u;++r)i=r/u,i=this.shape(i,f,e),this.curve[u+r]=i,this.curve[u-r-1]=-i};ft.prototype.connectTo=function(n){this.wetNode.disconnect();this.wetNode.connect(n);this.dryNode.disconnect();this.dryNode.connect(n)};ft.prototype.remove=function(){this.inputNode.disconnect();this.preGain.disconnect();this.waveShaper.disconnect();this.postGain.disconnect();this.wetNode.disconnect();this.dryNode.disconnect()};ft.prototype.getInputNode=function(){return this.inputNode};ft.prototype.setParam=function(n,t,i,r){switch(n){case 0:t=t/100;t<0&&(t=0);t>1&&(t=1);this.params[4]=t;o(this.wetNode.gain,t,i,r);o(this.dryNode.gain,1-t,i,r)}};ni.prototype.connectTo=function(n){this.node.disconnect();this.node.connect(n)};ni.prototype.remove=function(){this.node.disconnect()};ni.prototype.getInputNode=function(){return this.node};ni.prototype.setParam=function(){};lt.prototype.tick=function(){var i,t,r,n;for(this.node.getFloatFrequencyData(this.freqBins),this.node.getByteTimeDomainData(this.signal),i=this.node.fftSize,t=0,this.peak=0,r=0,n=0;t<i;t++)n=(this.signal[t]-128)/128,n<0&&(n=-n),this.peak<n&&(this.peak=n),r+=n*n;this.peak=ai(this.peak);this.rms=ai(Math.sqrt(r/i))};lt.prototype.connectTo=function(n){this.node.disconnect();this.node.connect(n)};lt.prototype.remove=function(){this.node.disconnect()};lt.prototype.getInputNode=function(){return this.node};lt.prototype.setParam=function(){};ti.prototype.setObject=function(n){this.obj=n};ti.prototype.hasObject=function(){return!!this.obj};ti.prototype.tick=function(){};ii.prototype.release=function(){var n,r,t,i;for(n=0,t=0,r=u.length;n<r;++n)i=u[n],u[t]=i,i.buffer===this?i.stop():++t;u.length=t;this.mediaSourceNode&&(this.mediaSourceNode.disconnect(),this.mediaSourceNode=null);this.outNode&&(this.outNode.disconnect(),this.outNode=null);this.bufferObject=null;this.audioData=null};ii.prototype.decodeAudioBuffer=function(){var t,i,r;!this.bufferObject&&this.audioData&&(t=this,n.decodeAudioData?n.decodeAudioData(this.audioData,function(n){var i,f,o,r,s,h,e;if(t.bufferObject=n,t.audioData=null,cr.is_undefined(t.playTagWhenReady)||p)cr.is_undefined(t.convolveWhenReady)||(e=t.convolveWhenReady.convolveNode,e.normalize=t.normalizeWhenReady,e.buffer=n);else if(t.panWhenReady.length){for(f=0,o=t.panWhenReady.length;f<o;f++)(i=t.panWhenReady[f],r=new c(t,i.thistag),r.setPannerEnabled(!0),typeof i.objUid=="undefined"||(i.obj=l.getObjectByUID(i.objUid),i.obj))&&(i.obj?(s=cr.rotatePtAround(i.obj.x,i.obj.y,-i.obj.layer.getAngle(),rt,ut,!0),h=cr.rotatePtAround(i.obj.x,i.obj.y,-i.obj.layer.getAngle(),rt,ut,!1),r.setPan(s,h,cr.to_degrees(i.obj.angle-i.obj.layer.getAngle()),i.ia,i.oa,i.og),r.setObject(i.obj)):r.setPan(i.x,i.y,i.a,i.ia,i.oa,i.og),r.play(t.loopWhenReady,t.volumeWhenReady,t.seekWhenReady),t.pauseWhenReady&&r.pause(),u.push(r));cr.clearArray(t.panWhenReady)}else r=new c(t,t.playTagWhenReady||""),r.play(t.loopWhenReady,t.volumeWhenReady,t.seekWhenReady),t.pauseWhenReady&&r.pause(),u.push(r)},function(){t.failedToLoad=!0}):(this.bufferObject=n.createBuffer(this.audioData,!1),this.audioData=null,cr.is_undefined(this.playTagWhenReady)||p?cr.is_undefined(this.convolveWhenReady)||(r=this.convolveWhenReady.convolveNode,r.normalize=this.normalizeWhenReady,r.buffer=this.bufferObject):(i=new c(this,this.playTagWhenReady),i.play(this.loopWhenReady,this.volumeWhenReady,this.seekWhenReady),this.pauseWhenReady&&i.pause(),u.push(i))))};ii.prototype.isLoaded=function(){switch(this.myapi){case a:var n=this.bufferObject.readyState>=4;return n&&(this.wasEverReady=!0),n||this.wasEverReady;case t:return!!this.audioData||!!this.bufferObject;case y:return!0;case b:return!0}return!1};ii.prototype.isLoadedAndDecoded=function(){switch(this.myapi){case a:return this.isLoaded();case t:return!!this.bufferObject;case y:return!0;case b:return!0}return!1};ii.prototype.hasFailedToLoad=function(){switch(this.myapi){case a:return!!this.bufferObject.error;case t:return this.failedToLoad}return!1};c.prototype.hasEnded=function(){switch(this.myapi){case a:return this.instanceObject.ended;case t:return this.buffer.myapi===t?!this.fresh&&!this.stopped&&this.instanceObject.loop?!1:this.is_paused?!1:this.hasPlaybackEnded:this.instanceObject.ended;case y:return this.hasPlaybackEnded;case b:!0}return!0};c.prototype.canBeRecycled=function(){return this.fresh||this.stopped?!0:this.hasEnded()};c.prototype.setPannerEnabled=function(i){if(r===t)if(!this.pannerEnabled&&i){if(!this.gainNode)return;this.pannerNode||(this.pannerNode=n.createPanner(),this.pannerNode.panningModel=typeof this.pannerNode.panningModel=="number"?bi:["equalpower","HRTF","soundfield"][bi],this.pannerNode.distanceModel=typeof this.pannerNode.distanceModel=="number"?ki:["linear","inverse","exponential"][ki],this.pannerNode.refDistance=rr,this.pannerNode.maxDistance=ur,this.pannerNode.rolloffFactor=fr);this.gainNode.disconnect();this.gainNode.connect(this.pannerNode);this.pannerNode.connect(yi(this.tag));this.pannerEnabled=!0}else if(this.pannerEnabled&&!i){if(!this.gainNode)return;this.pannerNode.disconnect();this.gainNode.disconnect();this.gainNode.connect(yi(this.tag));this.pannerEnabled=!1}};c.prototype.setPan=function(n,i,u,f,e,o){this.pannerEnabled&&r===t&&(this.pannerNode.setPosition(n,i,0),this.pannerNode.setOrientation(Math.cos(cr.to_radians(u)),Math.sin(cr.to_radians(u)),0),this.pannerNode.coneInnerAngle=f,this.pannerNode.coneOuterAngle=e,this.pannerNode.coneOuterGain=o,this.panX=n,this.panY=i,this.panAngle=u,this.panConeInner=f,this.panConeOuter=e,this.panConeOuterGain=o)};c.prototype.setObject=function(n){this.pannerEnabled&&r===t&&(this.objectTracker||(this.objectTracker=new ti),this.objectTracker.setObject(n))};c.prototype.tick=function(n){var u;if(this.pannerEnabled&&r===t&&this.objectTracker&&this.objectTracker.hasObject()&&this.isPlaying()){this.objectTracker.tick(n);var i=this.objectTracker.obj,f=cr.rotatePtAround(i.x,i.y,-i.layer.getAngle(),rt,ut,!0),e=cr.rotatePtAround(i.x,i.y,-i.layer.getAngle(),rt,ut,!1);this.pannerNode.setPosition(f,e,0);u=0;typeof this.objectTracker.obj.angle!="undefined"&&(u=i.angle-i.layer.getAngle(),this.pannerNode.setOrientation(Math.cos(u),Math.sin(u),0))}};c.prototype.play=function(i,r,u,f){var e=this.instanceObject,o;this.looping=i;this.volume=r;o=u||0;f=f||0;switch(this.myapi){case a:if(e.playbackRate!==1&&(e.playbackRate=1),e.volume!==r*nt&&(e.volume=r*nt),e.loop!==i&&(e.loop=i),e.muted&&(e.muted=!1),e.currentTime!==o)try{e.currentTime=o}catch(s){}li(this);break;case t:if(this.muted=!1,this.mutevol=1,this.buffer.myapi===t)this.gainNode.gain.value=r*nt,this.fresh||(this.instanceObject=n.createBufferSource(),this.instanceObject.buffer=this.buffer.bufferObject,this.instanceObject.connect(this.gainNode)),this.instanceObject.onended=this.onended_handler,this.active_buffer=this.instanceObject,this.instanceObject.loop=i,this.hasPlaybackEnded=!1,o===0?yt(this.instanceObject,f):gi(this.instanceObject,o,this.getDuration(),f);else{if(e.playbackRate!==1&&(e.playbackRate=1),e.loop!==i&&(e.loop=i),e.volume=r*nt,e.currentTime!==o)try{e.currentTime=o}catch(s){}li(this)}break;case y:(!this.fresh&&this.stopped||o!==0)&&e.seekTo(o);e.play();this.hasPlaybackEnded=!1;break;case b:l.isDirectCanvas?AppMobi.context.playSound(this.src,i):AppMobi.player.playSound(this.src,i)}this.playbackRate=1;this.startTime=(this.isTimescaled?l.kahanTime.sum:l.wallTime.sum)-o;this.fresh=!1;this.stopped=!1;this.is_paused=!1};c.prototype.stop=function(){switch(this.myapi){case a:this.instanceObject.paused||this.instanceObject.pause();break;case t:this.buffer.myapi===t?nr(this.instanceObject):this.instanceObject.paused||this.instanceObject.pause();break;case y:this.instanceObject.stop();break;case b:l.isDirectCanvas&&AppMobi.context.stopSound(this.src)}this.stopped=!0;this.is_paused=!1};c.prototype.pause=function(){if(!this.fresh&&!this.stopped&&!this.hasEnded()&&!this.is_paused){switch(this.myapi){case a:this.instanceObject.paused||this.instanceObject.pause();break;case t:this.buffer.myapi===t?(this.resume_position=this.getPlaybackTime(!0),this.looping&&(this.resume_position=this.resume_position%this.getDuration()),this.is_paused=!0,nr(this.instanceObject)):this.instanceObject.paused||this.instanceObject.pause();break;case y:this.instanceObject.pause();break;case b:l.isDirectCanvas&&AppMobi.context.stopSound(this.src)}this.is_paused=!0}};c.prototype.resume=function(){if(!this.fresh&&!this.stopped&&!this.hasEnded()&&this.is_paused){switch(this.myapi){case a:li(this);break;case t:this.buffer.myapi===t?(this.instanceObject=n.createBufferSource(),this.instanceObject.buffer=this.buffer.bufferObject,this.instanceObject.connect(this.gainNode),this.instanceObject.onended=this.onended_handler,this.active_buffer=this.instanceObject,this.instanceObject.loop=this.looping,this.gainNode.gain.value=nt*this.volume*this.mutevol,this.updatePlaybackRate(),this.startTime=(this.isTimescaled?l.kahanTime.sum:l.wallTime.sum)-this.resume_position/(this.playbackRate||.001),gi(this.instanceObject,this.resume_position,this.getDuration())):li(this);break;case y:this.instanceObject.play();break;case b:l.isDirectCanvas&&AppMobi.context.resumeSound(this.src)}this.is_paused=!1}};c.prototype.seek=function(n){if(!this.fresh&&!this.stopped&&!this.hasEnded())switch(this.myapi){case a:try{this.instanceObject.currentTime=n}catch(i){}break;case t:if(this.buffer.myapi===t)this.is_paused?this.resume_position=n:(this.pause(),this.resume_position=n,this.resume());else try{this.instanceObject.currentTime=n}catch(i){}break;case b:l.isDirectCanvas&&AppMobi.context.seekSound(this.src,n)}};c.prototype.reconnect=function(n){this.myapi===t&&(this.pannerEnabled?(this.pannerNode.disconnect(),this.pannerNode.connect(n)):(this.gainNode.disconnect(),this.gainNode.connect(n)))};c.prototype.getDuration=function(n){var i=0;switch(this.myapi){case a:typeof this.instanceObject.duration!="undefined"&&(i=this.instanceObject.duration);break;case t:i=this.buffer.bufferObject.duration;break;case y:i=this.instanceObject.getDuration();break;case b:l.isDirectCanvas&&(i=AppMobi.context.getDurationSound(this.src))}return n&&(i/=this.playbackRate||.001),i};c.prototype.getPlaybackTime=function(n){var r=this.getDuration(),i=0;switch(this.myapi){case a:typeof this.instanceObject.currentTime!="undefined"&&(i=this.instanceObject.currentTime);break;case t:if(this.buffer.myapi===t){if(this.is_paused)return this.resume_position;i=(this.isTimescaled?l.kahanTime.sum:l.wallTime.sum)-this.startTime}else typeof this.instanceObject.currentTime!="undefined"&&(i=this.instanceObject.currentTime);break;case b:l.isDirectCanvas&&(i=AppMobi.context.getPlaybackTimeSound(this.src))}return n&&(i*=this.playbackRate),!this.looping&&i>r&&(i=r),i};c.prototype.isPlaying=function(){return!this.is_paused&&!this.fresh&&!this.stopped&&!this.hasEnded()};c.prototype.shouldSave=function(){return!this.fresh&&!this.stopped&&!this.hasEnded()};c.prototype.setVolume=function(n){this.volume=n;this.updateVolume()};c.prototype.updateVolume=function(){var n=this.volume*nt;isFinite(n)||(n=0);switch(this.myapi){case a:typeof this.instanceObject.volume!="undefined"&&this.instanceObject.volume!==n&&(this.instanceObject.volume=n);break;case t:this.buffer.myapi===t?this.gainNode.gain.value=n*this.mutevol:typeof this.instanceObject.volume!="undefined"&&this.instanceObject.volume!==n&&(this.instanceObject.volume=n)}};c.prototype.getVolume=function(){return this.volume};c.prototype.doSetMuted=function(n){switch(this.myapi){case a:this.instanceObject.muted!==!!n&&(this.instanceObject.muted=!!n);break;case t:this.buffer.myapi===t?(this.mutevol=n?0:1,this.gainNode.gain.value=nt*this.volume*this.mutevol):this.instanceObject.muted!==!!n&&(this.instanceObject.muted=!!n)}};c.prototype.setMuted=function(n){this.is_muted=!!n;this.doSetMuted(this.is_muted||this.is_silent)};c.prototype.setSilent=function(n){this.is_silent=!!n;this.doSetMuted(this.is_muted||this.is_silent)};c.prototype.setLooping=function(n){this.looping=n;switch(this.myapi){case a:this.instanceObject.loop!==!!n&&(this.instanceObject.loop=!!n);break;case t:this.instanceObject.loop!==!!n&&(this.instanceObject.loop=!!n);break;case b:l.isDirectCanvas&&AppMobi.context.setLoopingSound(this.src,n)}};c.prototype.setPlaybackRate=function(n){this.playbackRate=n;this.updatePlaybackRate()};c.prototype.updatePlaybackRate=function(){var n=this.playbackRate;this.isTimescaled&&(n*=l.timescale);switch(this.myapi){case a:this.instanceObject.playbackRate!==n&&(this.instanceObject.playbackRate=n);break;case t:this.buffer.myapi===t?this.instanceObject.playbackRate.value!==n&&(this.instanceObject.playbackRate.value=n):this.instanceObject.playbackRate!==n&&(this.instanceObject.playbackRate=n)}};c.prototype.setSuspended=function(i){switch(this.myapi){case a:i?this.isPlaying()?(this.resume_me=!0,this.instanceObject.pause()):this.resume_me=!1:this.resume_me&&(this.instanceObject.play(),this.resume_me=!1);break;case t:i?this.isPlaying()?(this.resume_me=!0,this.buffer.myapi===t?(this.resume_position=this.getPlaybackTime(!0),this.looping&&(this.resume_position=this.resume_position%this.getDuration()),nr(this.instanceObject)):this.instanceObject.pause()):this.resume_me=!1:this.resume_me&&(this.buffer.myapi===t?(this.instanceObject=n.createBufferSource(),this.instanceObject.buffer=this.buffer.bufferObject,this.instanceObject.connect(this.gainNode),this.instanceObject.onended=this.onended_handler,this.active_buffer=this.instanceObject,this.instanceObject.loop=this.looping,this.gainNode.gain.value=nt*this.volume*this.mutevol,this.updatePlaybackRate(),this.startTime=(this.isTimescaled?l.kahanTime.sum:l.wallTime.sum)-this.resume_position/(this.playbackRate||.001),gi(this.instanceObject,this.resume_position,this.getDuration())):this.instanceObject.play(),this.resume_me=!1);break;case y:i?this.isPlaying()?(this.instanceObject.pause(),this.resume_me=!0):this.resume_me=!1:this.resume_me&&(this.resume_me=!1,this.instanceObject.play())}};ot.Instance=function(i){if(this.type=i,this.runtime=i.runtime,l=this.runtime,vt=this,this.listenerTracker=null,this.listenerZ=-600,this.runtime.isWKWebView&&(hi=!0),!(this.runtime.isiOS||this.runtime.isAndroid&&(this.runtime.isChrome||this.runtime.isAndroidStockBrowser))||this.runtime.isCrosswalk||this.runtime.isDomFree||this.runtime.isAmazonWebApp||hi||(er=!0),n=null,typeof AudioContext!="undefined"?(r=t,n=new AudioContext):typeof webkitAudioContext!="undefined"&&(r=t,n=new webkitAudioContext),this.runtime.isiOS&&n&&(n.close&&n.close(),typeof AudioContext!="undefined"?n=new AudioContext:typeof webkitAudioContext!="undefined"&&(n=new webkitAudioContext)),r!==t&&(this.runtime.isCordova&&typeof Media!="undefined"?r=y:this.runtime.isAppMobi&&(r=b)),r===y){st=location.href;var u=st.lastIndexOf("/");u>-1&&(st=st.substr(0,u+1));st=st.replace("file://","")}if(this.runtime.isSafari&&this.runtime.isWindows&&typeof Audio=="undefined")alert("It looks like you're using Safari for Windows without Quicktime.  Audio cannot be played until Quicktime is installed."),this.runtime.DestroyInstance(this);else{if(this.runtime.isDirectCanvas)k=this.runtime.isAndroid;else try{k=!!(new Audio).canPlayType('audio/ogg; codecs="vorbis"')&&!this.runtime.isWindows10}catch(f){k=!1}switch(r){}this.runtime.tickMe(this)}};g=ot.Instance.prototype;g.onCreate=function(){var i,u,f;this.runtime.audioInstance=this;oi=this.properties[0];this.saveload=this.properties[1];this.playinbackground=this.properties[2]!==0;this.nextPlayTime=0;bi=this.properties[3];ki=this.properties[4];this.listenerZ=-this.properties[5];rr=this.properties[6];ur=this.properties[7];fr=this.properties[8];this.listenerTracker=new ti;i=this.runtime.draw_width||this.runtime.width;u=this.runtime.draw_height||this.runtime.height;r===t&&(n.listener.setPosition(i/2,u/2,this.listenerZ),n.listener.setOrientation(0,0,1,0,-1,0),window.c2OnAudioMicStream=function(t,i){ht&&ht.disconnect();di=i.toLowerCase();ht=n.createMediaStreamSource(t);ht.connect(yi(di))});this.runtime.addSuspendCallback(function(n){vt.onSuspend(n)});f=this;this.runtime.addDestroyCallback(function(n){f.onInstanceDestroyed(n)})};g.onInstanceDestroyed=function(n){for(var t,i=0,r=u.length;i<r;i++)t=u[i],t.objectTracker&&t.objectTracker.obj===n&&(t.objectTracker.obj=null,t.pannerEnabled&&t.isPlaying()&&t.looping&&t.stop());this.listenerTracker.obj===n&&(this.listenerTracker.obj=null)};g.saveToJSON=function(){for(var s={silent:p,masterVolume:nt,listenerZ:this.listenerZ,listenerUid:this.listenerTracker.hasObject()?this.listenerTracker.obj.uid:-1,playing:[],effects:{}},a=s.playing,n,e,r,i,o,l,c,t=0,f=u.length;t<f;t++)(n=u[t],n.shouldSave())&&this.saveload!==3&&(n.is_music&&this.saveload===1||(n.is_music||this.saveload!==2)&&(o=n.getPlaybackTime(),n.looping&&(o=o%n.getDuration()),e={tag:n.tag,buffersrc:n.buffer.src,is_music:n.is_music,playbackTime:o,volume:n.volume,looping:n.looping,muted:n.is_muted,playbackRate:n.playbackRate,paused:n.is_paused,resume_position:n.resume_position},n.pannerEnabled&&(e.pan={},i=e.pan,n.objectTracker&&n.objectTracker.hasObject()?i.objUid=n.objectTracker.obj.uid:(i.x=n.panX,i.y=n.panY,i.a=n.panAngle),i.ia=n.panConeInner,i.oa=n.panConeOuter,i.og=n.panConeOuterGain),a.push(e)));l=s.effects;for(r in h)if(h.hasOwnProperty(r)){for(c=[],t=0,f=h[r].length;t<f;t++)c.push({type:h[r][t].type,params:h[r][t].params});l[r]=c}return s};ri=[];g.loadFromJSON=function(n){var ut=n.silent,d,g,i,o,s,l,a,w,tt,it,rt,c,r,e,f,y,b,ot,t,k;if(nt=n.masterVolume,this.listenerZ=n.listenerZ,this.listenerTracker.setObject(null),d=n.listenerUid,d!==-1&&(this.listenerTracker.loadUid=d,ri.push(this.listenerTracker)),g=n.playing,this.saveload!==3)for(i=0,o=u.length;i<o;i++)(r=u[i],r.is_music&&this.saveload===1)||(r.is_music||this.saveload!==2)&&r.stop();for(e in h)if(h.hasOwnProperty(e))for(i=0,o=h[e].length;i<o;i++)h[e][i].remove();cr.wipe(h);for(e in n.effects)if(n.effects.hasOwnProperty(e))for(b=n.effects[e],i=0,o=b.length;i<o;i++){ot=b[i].type;t=b[i].params;switch(ot){case"filter":v(e,new pt(t[0],t[1],t[2],t[3],t[4],t[5]));break;case"delay":v(e,new wt(t[0],t[1],t[2]));break;case"convolve":l=t[2];c=this.getAudioBuffer(l,!1);c.bufferObject?k=new et(c.bufferObject,t[0],t[1],l):(k=new et(null,t[0],t[1],l),c.normalizeWhenReady=t[0],c.convolveWhenReady=k);v(e,k);break;case"flanger":v(e,new bt(t[0],t[1],t[2],t[3],t[4]));break;case"phaser":v(e,new kt(t[0],t[1],t[2],t[3],t[4],t[5]));break;case"gain":v(e,new ct(t[0]));break;case"tremolo":v(e,new dt(t[0],t[1]));break;case"ringmod":v(e,new gt(t[0],t[1]));break;case"distortion":v(e,new ft(t[0],t[1],t[2],t[3],t[4]));break;case"compressor":v(e,new ni(t[0],t[1],t[2],t[3],t[4]));break;case"analyser":v(e,new lt(t[0],t[1]))}}for(i=0,o=g.length;i<o;i++)if(this.saveload!==3&&(s=g[i],l=s.buffersrc,a=s.is_music,w=s.tag,tt=s.playbackTime,it=s.looping,rt=s.volume,f=s.pan,y=f&&f.hasOwnProperty("objUid")?f.objUid:-1,!a||this.saveload!==1)&&(a||this.saveload!==2)){if(r=this.getAudioInstance(l,w,a,it,rt),!r){c=this.getAudioBuffer(l,a);c.seekWhenReady=tt;c.pauseWhenReady=s.paused;f&&(y!==-1?c.panWhenReady.push({objUid:y,ia:f.ia,oa:f.oa,og:f.og,thistag:w}):c.panWhenReady.push({x:f.x,y:f.y,a:f.a,ia:f.ia,oa:f.oa,og:f.og,thistag:w}));continue}r.resume_position=s.resume_position;r.setPannerEnabled(!!f);r.play(it,rt,tt);r.updatePlaybackRate();r.updateVolume();r.doSetMuted(r.is_muted||r.is_silent);s.paused&&r.pause();s.muted&&r.setMuted(!0);r.doSetMuted(r.is_muted||r.is_silent);f&&(y!==-1?(r.objectTracker=r.objectTracker||new ti,r.objectTracker.loadUid=y,ri.push(r.objectTracker)):r.setPan(f.x,f.y,f.a,f.ia,f.oa,f.og))}if(ut&&!p){for(i=0,o=u.length;i<o;i++)u[i].setSilent(!0);p=!0}else if(!ut&&p){for(i=0,o=u.length;i<o;i++)u[i].setSilent(!1);p=!1}};g.afterLoad=function(){for(var i,n,t=0,r=ri.length;t<r;t++)i=ri[t],n=this.runtime.getObjectByUID(i.loadUid),i.setObject(n),i.loadUid=-1,n&&(rt=n.x,ut=n.y);cr.clearArray(ri)};g.onSuspend=function(t){if(!this.playinbackground){!t&&n&&n.resume&&(n.resume(),wi=!1);for(var i=0,r=u.length;i<r;i++)u[i].setSuspended(t);t&&n&&n.suspend&&(n.suspend(),wi=!0)}};g.tick=function(){for(var l=this.runtime.dt,e,o,s,c,i=0,f=u.length;i<f;i++)e=u[i],e.tick(l),oi!==0&&e.updatePlaybackRate();for(o in h)if(h.hasOwnProperty(o))for(s=h[o],i=0,f=s.length;i<f;i++)c=s[i],c.tick&&c.tick();r===t&&this.listenerTracker.hasObject()&&(this.listenerTracker.tick(l),rt=this.listenerTracker.obj.x,ut=this.listenerTracker.obj.y,n.listener.setPosition(this.listenerTracker.obj.x,this.listenerTracker.obj.y,this.listenerZ))};ui=[];g.setPreloadList=function(n){for(var r,t,u,f,o=0,i=0,e=n.length;i<e;++i)r=n[i],t=r[0],u=r[1]*2,f=t.length>4&&t.substr(t.length-4)===".ogg",(f&&k||!f&&!k)&&(ui.push({filename:t,size:u,obj:null}),o+=u);return o};g.startPreloads=function(){for(var t,r,n=0,i=ui.length;n<i;++n)t=ui[n],r=this.runtime.files_subfolder+t.filename,t.obj=this.getAudioBuffer(r,!1)};g.getPreloadedSize=function(){for(var i=0,n,t=0,r=ui.length;t<r;++t)n=ui[t],n.obj.isLoadedAndDecoded()||n.obj.hasFailedToLoad()||this.runtime.isDomFree||this.runtime.isAndroidStockBrowser?i+=n.size:n.obj.isLoaded()&&(i+=Math.floor(n.size/2));return i};g.releaseAllMusicBuffers=function(){var n,r,t,i;for(n=0,t=0,r=d.length;n<r;++n)i=d[n],d[t]=i,i.is_music?i.release():++t;d.length=t};g.getAudioBuffer=function(n,t,i){for(var f,r=null,u=0,e=d.length;u<e;u++)if(f=d[u],f.src===n){r=f;break}return r||i||(hi&&t&&this.releaseAllMusicBuffers(),r=new ii(n,t),d.push(r)),r};g.getAudioInstance=function(n,t,i,r,f){for(var e,o,s=0,h=u.length;s<h;s++)if(e=u[s],e.src===n&&(e.canBeRecycled()||i))return e.tag=t,e;return(o=this.getAudioBuffer(n,i),!o.bufferObject)?(t!=="<preload>"&&(o.playTagWhenReady=t,o.loopWhenReady=r,o.volumeWhenReady=f),null):(e=new c(o,t),u.push(e),e)};s=[];at.prototype.OnEnded=function(n){return cr.equals_nocase(fi,n)};at.prototype.PreloadsComplete=function(){for(var n=0,t=d.length;n<t;n++)if(!d[n].isLoadedAndDecoded()&&!d[n].hasFailedToLoad())return!1;return!0};at.prototype.AdvancedAudioSupported=function(){return r===t};at.prototype.IsSilent=function(){return p};at.prototype.IsAnyPlaying=function(){for(var n=0,t=u.length;n<t;n++)if(u[n].isPlaying())return!0;return!1};at.prototype.IsTagPlaying=function(n){tt(n);for(var t=0,i=s.length;t<i;t++)if(s[t].isPlaying())return!0;return!1};ot.cnds=new at;i.prototype.Play=function(n,t,i,r){if(!p){var u=w(i),f=n[1],o=this.runtime.files_subfolder+n[0]+(k?".ogg":".m4a");(e=this.getAudioInstance(o,r,f,t!==0,u),e)&&(e.setPannerEnabled(!1),e.play(t!==0,u,0,this.nextPlayTime),this.nextPlayTime=0)}};i.prototype.PlayAtPosition=function(n,t,i,r,u,f,o,s,h,c){var y;if(!p){var l=w(i),a=n[1],v=this.runtime.files_subfolder+n[0]+(k?".ogg":".m4a");if(e=this.getAudioInstance(v,c,a,t!==0,l),!e){y=this.getAudioBuffer(v,a);y.panWhenReady.push({x:r,y:u,a:f,ia:o,oa:s,og:w(h),thistag:c});return}e.setPannerEnabled(!0);e.setPan(r,u,f,o,s,w(h));e.play(t!==0,l,0,this.nextPlayTime);this.nextPlayTime=0}};i.prototype.PlayAtObject=function(n,t,i,r,u,f,o,s){var h,v,y,b;if(!p&&r&&(h=r.getFirstPicked(),h)){var c=w(i),l=n[1],a=this.runtime.files_subfolder+n[0]+(k?".ogg":".m4a");if(e=this.getAudioInstance(a,s,l,t!==0,c),!e){v=this.getAudioBuffer(a,l);v.panWhenReady.push({obj:h,ia:u,oa:f,og:w(o),thistag:s});return}e.setPannerEnabled(!0);y=cr.rotatePtAround(h.x,h.y,-h.layer.getAngle(),rt,ut,!0);b=cr.rotatePtAround(h.x,h.y,-h.layer.getAngle(),rt,ut,!1);e.setPan(y,b,cr.to_degrees(h.angle-h.layer.getAngle()),u,f,w(o));e.setObject(h);e.play(t!==0,c,0,this.nextPlayTime);this.nextPlayTime=0}};i.prototype.PlayByName=function(n,t,i,r,u){if(!p){var f=w(r),o=n===1,s=this.runtime.files_subfolder+t.toLowerCase()+(k?".ogg":".m4a");(e=this.getAudioInstance(s,u,o,i!==0,f),e)&&(e.setPannerEnabled(!1),e.play(i!==0,f,0,this.nextPlayTime),this.nextPlayTime=0)}};i.prototype.PlayAtPositionByName=function(n,t,i,r,u,f,o,s,h,c,l){var b;if(!p){var a=w(r),v=n===1,y=this.runtime.files_subfolder+t.toLowerCase()+(k?".ogg":".m4a");if(e=this.getAudioInstance(y,l,v,i!==0,a),!e){b=this.getAudioBuffer(y,v);b.panWhenReady.push({x:u,y:f,a:o,ia:s,oa:h,og:w(c),thistag:l});return}e.setPannerEnabled(!0);e.setPan(u,f,o,s,h,w(c));e.play(i!==0,a,0,this.nextPlayTime);this.nextPlayTime=0}};i.prototype.PlayAtObjectByName=function(n,t,i,r,u,f,o,s,h){var c,y,b,d;if(!p&&u&&(c=u.getFirstPicked(),c)){var l=w(r),a=n===1,v=this.runtime.files_subfolder+t.toLowerCase()+(k?".ogg":".m4a");if(e=this.getAudioInstance(v,h,a,i!==0,l),!e){y=this.getAudioBuffer(v,a);y.panWhenReady.push({obj:c,ia:f,oa:o,og:w(s),thistag:h});return}e.setPannerEnabled(!0);b=cr.rotatePtAround(c.x,c.y,-c.layer.getAngle(),rt,ut,!0);d=cr.rotatePtAround(c.x,c.y,-c.layer.getAngle(),rt,ut,!1);e.setPan(b,d,cr.to_degrees(c.angle-c.layer.getAngle()),f,o,w(s));e.setObject(c);e.play(i!==0,l,0,this.nextPlayTime);this.nextPlayTime=0}};i.prototype.SetLooping=function(n,t){tt(n);for(var i=0,r=s.length;i<r;i++)s[i].setLooping(t===0)};i.prototype.SetMuted=function(n,t){tt(n);for(var i=0,r=s.length;i<r;i++)s[i].setMuted(t===0)};i.prototype.SetVolume=function(n,t){tt(n);for(var u=w(t),i=0,r=s.length;i<r;i++)s[i].setVolume(u)};i.prototype.Preload=function(n){if(!p){var i=n[1],t=this.runtime.files_subfolder+n[0]+(k?".ogg":".m4a");if(r===b){this.runtime.isDirectCanvas?AppMobi.context.loadSound(t):AppMobi.player.loadSound(t);return}r!==y&&this.getAudioInstance(t,"<preload>",i,!1)}};i.prototype.PreloadByName=function(n,t){if(!p){var u=n===1,i=this.runtime.files_subfolder+t.toLowerCase()+(k?".ogg":".m4a");if(r===b){this.runtime.isDirectCanvas?AppMobi.context.loadSound(i):AppMobi.player.loadSound(i);return}r!==y&&this.getAudioInstance(i,"<preload>",u,!1)}};i.prototype.SetPlaybackRate=function(n,t){tt(n);t<0&&(t=0);for(var i=0,r=s.length;i<r;i++)s[i].setPlaybackRate(t)};i.prototype.Stop=function(n){tt(n);for(var t=0,i=s.length;t<i;t++)s[t].stop()};i.prototype.StopAll=function(){for(var n=0,t=u.length;n<t;n++)u[n].stop()};i.prototype.SetPaused=function(n,t){tt(n);for(var i=0,r=s.length;i<r;i++)t===0?s[i].pause():s[i].resume()};i.prototype.Seek=function(n,t){tt(n);for(var i=0,r=s.length;i<r;i++)s[i].seek(t)};i.prototype.SetSilent=function(n){var t,i;if(n===2&&(n=p?1:0),n!==0||p){if(n===1&&p){for(t=0,i=u.length;t<i;t++)u[t].setSilent(!1);p=!1}}else{for(t=0,i=u.length;t<i;t++)u[t].setSilent(!0);p=!0}};i.prototype.SetMasterVolume=function(n){nt=w(n);for(var t=0,i=u.length;t<i;t++)u[t].updateVolume()};i.prototype.AddFilterEffect=function(i,u,f,e,o,s,h){r!==t||u<0||u>=tr.length||!n.createBiquadFilter||(i=i.toLowerCase(),h=h/100,h<0&&(h=0),h>1&&(h=1),v(i,new pt(u,f,e,o,s,h)))};i.prototype.AddDelayEffect=function(n,i,u,f){r===t&&(n=n.toLowerCase(),f=f/100,f<0&&(f=0),f>1&&(f=1),v(n,new wt(i,w(u),f)))};i.prototype.AddFlangerEffect=function(i,u,f,e,o,s){r===t&&n.createOscillator&&(i=i.toLowerCase(),s=s/100,s<0&&(s=0),s>1&&(s=1),v(i,new bt(u/1e3,f/1e3,e,o/100,s)))};i.prototype.AddPhaserEffect=function(i,u,f,e,o,s,h){r===t&&n.createOscillator&&(i=i.toLowerCase(),h=h/100,h<0&&(h=0),h>1&&(h=1),v(i,new kt(u,f,e,o,s,h)))};i.prototype.AddConvolutionEffect=function(i,u,f,e){var s;if(r===t&&n.createConvolver){var h=f===0,c=this.runtime.files_subfolder+u[0]+(k?".ogg":".m4a"),o=this.getAudioBuffer(c,!1);i=i.toLowerCase();e=e/100;e<0&&(e=0);e>1&&(e=1);o.bufferObject?s=new et(o.bufferObject,h,e,c):(s=new et(null,h,e,c),o.normalizeWhenReady=h,o.convolveWhenReady=s);v(i,s)}};i.prototype.AddGainEffect=function(n,i){r===t&&(n=n.toLowerCase(),v(n,new ct(w(i))))};i.prototype.AddMuteEffect=function(n){r===t&&(n=n.toLowerCase(),v(n,new ct(0)))};i.prototype.AddTremoloEffect=function(i,u,f){r===t&&n.createOscillator&&(i=i.toLowerCase(),f=f/100,f<0&&(f=0),f>1&&(f=1),v(i,new dt(u,f)))};i.prototype.AddRingModEffect=function(i,u,f){r===t&&n.createOscillator&&(i=i.toLowerCase(),f=f/100,f<0&&(f=0),f>1&&(f=1),v(i,new gt(u,f)))};i.prototype.AddDistortionEffect=function(i,u,f,e,o,s){r===t&&n.createWaveShaper&&(i=i.toLowerCase(),s=s/100,s<0&&(s=0),s>1&&(s=1),v(i,new ft(u,f,e,o,s)))};i.prototype.AddCompressorEffect=function(i,u,f,e,o,s){r===t&&n.createDynamicsCompressor&&(i=i.toLowerCase(),v(i,new ni(u,f,e,o/1e3,s/1e3)))};i.prototype.AddAnalyserEffect=function(n,i,u){r===t&&(n=n.toLowerCase(),v(n,new lt(i,u)))};i.prototype.RemoveEffects=function(n){if(r===t){n=n.toLowerCase();var u,f,i;if(h.hasOwnProperty(n)&&(i=h[n],i.length)){for(u=0,f=i.length;u<f;u++)i[u].remove();cr.clearArray(i);hr(n)}}};i.prototype.SetEffectParameter=function(n,i,u,f,e,o){if(r===t){n=n.toLowerCase();i=Math.floor(i);var s;h.hasOwnProperty(n)&&((s=h[n],i<0||i>=s.length)||s[i].setParam(u,f,e,o))}};i.prototype.SetListenerObject=function(n){if(n&&r===t){var i=n.getFirstPicked();i&&(this.listenerTracker.setObject(i),rt=i.x,ut=i.y)}};i.prototype.SetListenerZ=function(n){this.listenerZ=n};i.prototype.ScheduleNextPlay=function(t){n&&(this.nextPlayTime=t)};i.prototype.UnloadAudio=function(n){var i=n[1],r=this.runtime.files_subfolder+n[0]+(k?".ogg":".m4a"),t=this.getAudioBuffer(r,i,!0);t&&(t.release(),cr.arrayFindRemove(d,t))};i.prototype.UnloadAudioByName=function(n,t){var r=n===1,u=this.runtime.files_subfolder+t.toLowerCase()+(k?".ogg":".m4a"),i=this.getAudioBuffer(u,r,!0);i&&(i.release(),cr.arrayFindRemove(d,i))};i.prototype.UnloadAll=function(){for(var n=0,t=d.length;n<t;++n)d[n].release();cr.clearArray(d)};ot.acts=new i;it.prototype.Duration=function(n,t){tt(t,!0);s.length?n.set_float(s[0].getDuration()):n.set_float(0)};it.prototype.PlaybackTime=function(n,t){tt(t,!0);s.length?n.set_float(s[0].getPlaybackTime(!0)):n.set_float(0)};it.prototype.Volume=function(n,t){if(tt(t,!0),s.length){var i=s[0].getVolume();n.set_float(ai(i))}else n.set_float(0)};it.prototype.MasterVolume=function(n){n.set_float(ai(nt))};it.prototype.EffectCount=function(n,t){t=t.toLowerCase();var i=null;h.hasOwnProperty(t)&&(i=h[t]);n.set_int(i?i.length:0)};it.prototype.AnalyserFreqBinCount=function(n,t,i){t=t.toLowerCase();i=Math.floor(i);var r=pi(t,i);n.set_int(r?r.node.frequencyBinCount:0)};it.prototype.AnalyserFreqBinAt=function(n,t,i,r){t=t.toLowerCase();i=Math.floor(i);r=Math.floor(r);var u=pi(t,i);u?r<0||r>=u.node.frequencyBinCount?n.set_float(0):n.set_float(u.freqBins[r]):n.set_float(0)};it.prototype.AnalyserPeakLevel=function(n,t,i){t=t.toLowerCase();i=Math.floor(i);var r=pi(t,i);r?n.set_float(r.peak):n.set_float(0)};it.prototype.AnalyserRMSLevel=function(n,t,i){t=t.toLowerCase();i=Math.floor(i);var r=pi(t,i);r?n.set_float(r.rms):n.set_float(0)};it.prototype.SampleRate=function(t){t.set_int(n?n.sampleRate:0)};it.prototype.CurrentTime=function(t){t.set_float(n?n.currentTime:cr.performance_now())};ot.exps=new it}();cr.plugins_.BTG_Audio_IOS=function(n){this.runtime=n},function(){function f(){}function r(){}function e(){}var t=cr.plugins_.BTG_Audio_IOS.prototype,u,n,i;t.Type=function(n){this.plugin=n;this.runtime=n.runtime};u=t.Type.prototype;u.onCreate=function(){};n=new Map;t.Instance=function(n){this.type=n;this.runtime=n.runtime};i=t.Instance.prototype;i.onCreate=function(){};i.onDestroy=function(){};i.saveToJSON=function(){return{}};i.loadFromJSON=function(){};i.draw=function(){};i.drawGL=function(){};t.cnds=new f;r.prototype.Play=function(t,i,r){var u=null,e,f;n.has(t[0])?u=n.get(t[0]):(e=t[1],f=this.runtime.files_subfolder+t[0]+".m4a",n.set(t[0],new Audio(f)),u=n.get(t[0]));u!=null&&(u.loop=i==1?!0:!1,u.volume=r,u.pause(),u.currentTime=0,u.play().then(function(){console.log("Gra muzyka")},function(){console.log("Nie, gra muzyka")}))};r.prototype.Stop=function(t){var i=null;n.has(t[0])&&(i=n.get(t[0]));i!=null&&(i.loop=!1,i.pause(),i.currentTime=0)};r.prototype.Pause=function(t){var i=null;n.has(t[0])&&(i=n.get(t[0]));i!=null&&i.pause()};r.prototype.Resume=function(t){var i=null;n.has(t[0])&&(i=n.get(t[0]));i!=null&&i.play()};r.prototype.Load=function(t){if(!n.has(t[0])){var r=t[1],i=this.runtime.files_subfolder+t[0]+".m4a";n.set(t[0],new Audio(i))}};r.prototype.SetMuted=function(t){t==1?n.forEach(function(n){n.muted=!1}):n.forEach(function(n){n.muted=!0})};t.acts=new r;t.exps=new e}();cr.plugins_.Browser=function(n){this.runtime=n},function(){function w(){o&&s&&window.OfflineClientInfo&&window.OfflineClientInfo.SetMessageCallback(function(n){h.onSWMessage(n)})}function a(){if(!l&&navigator.getBattery){var n=navigator.getBattery();l=!0;n&&n.then(function(n){r=n})}}function t(){}function i(){}function f(n){console&&console.warn&&console.warn("Fullscreen request failed: ",n);y.setSize(window.innerWidth,window.innerHeight)}function n(){}var u=cr.plugins_.Browser.prototype,e,o,s,h,c,r,l,v,y,p;u.Type=function(n){this.plugin=n;this.runtime=n.runtime};e=u.Type.prototype;e.onCreate=function(){};o=!1;s=!1;document.addEventListener("DOMContentLoaded",function(){if(window.C2_RegisterSW&&navigator.serviceWorker){var n=document.createElement("script");n.onload=function(){o=!0;w()};n.src="offlineClient.js";document.head.appendChild(n)}});h=null;e.onAppBegin=function(){s=!0;w()};u.Instance=function(n){this.type=n;this.runtime=n.runtime};c=u.Instance.prototype;c.onCreate=function(){var n=this;window.addEventListener("resize",function(){n.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnResize,n)});h=this;typeof navigator.onLine!="undefined"&&(window.addEventListener("online",function(){n.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnOnline,n)}),window.addEventListener("offline",function(){n.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnOffline,n)}));this.runtime.isDirectCanvas||(document.addEventListener("appMobi.device.update.available",function(){n.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnUpdateReady,n)}),document.addEventListener("backbutton",function(){n.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,n)}),document.addEventListener("menubutton",function(){n.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnMenuButton,n)}),document.addEventListener("searchbutton",function(){n.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnSearchButton,n)}),document.addEventListener("tizenhwkey",function(t){var i;switch(t.keyName){case"back":i=n.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,n);i||window.tizen&&window.tizen.application.getCurrentApplication().exit();break;case"menu":i=n.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnMenuButton,n);i||t.preventDefault()}}));this.runtime.isWindows10&&typeof Windows!="undefined"?Windows.UI.Core.SystemNavigationManager.getForCurrentView().addEventListener("backrequested",function(t){var i=n.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,n);i&&(t.handled=!0)}):this.runtime.isWinJS&&WinJS.Application&&(WinJS.Application.onbackclick=function(){return!!n.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,n)});this.runtime.addSuspendCallback(function(t){t?n.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnPageHidden,n):n.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnPageVisible,n)});this.is_arcade=typeof is_scirra_arcade!="undefined"};c.onSWMessage=function(n){var t=n.data.type;t==="downloading-update"?this.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnUpdateFound,this):t==="update-ready"||t==="update-pending"?this.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnUpdateReady,this):t==="offline-ready"&&this.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnOfflineReady,this)};r=null;l=!1;t.prototype.CookiesEnabled=function(){return navigator?navigator.cookieEnabled:!1};t.prototype.IsOnline=function(){return navigator?navigator.onLine:!1};t.prototype.HasJava=function(){return navigator?navigator.javaEnabled():!1};t.prototype.OnOnline=function(){return!0};t.prototype.OnOffline=function(){return!0};t.prototype.IsDownloadingUpdate=function(){return!1};t.prototype.OnUpdateReady=function(){return!0};t.prototype.PageVisible=function(){return!this.runtime.isSuspended};t.prototype.OnPageVisible=function(){return!0};t.prototype.OnPageHidden=function(){return!0};t.prototype.OnResize=function(){return!0};t.prototype.IsFullscreen=function(){return!!(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||this.runtime.isNodeFullscreen)};t.prototype.OnBackButton=function(){return!0};t.prototype.OnMenuButton=function(){return!0};t.prototype.OnSearchButton=function(){return!0};t.prototype.IsMetered=function(){var n=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return n?!!n.metered:!1};t.prototype.IsCharging=function(){var n=navigator.battery||navigator.mozBattery||navigator.webkitBattery;return n?!!n.charging:(a(),r?!!r.charging:!0)};t.prototype.IsPortraitLandscape=function(n){var t=window.innerWidth<=window.innerHeight?0:1;return t===n};t.prototype.SupportsFullscreen=function(){if(this.runtime.isNodeWebkit)return!0;var n=this.runtime.canvasdiv||this.runtime.canvas;return!!(n.requestFullscreen||n.mozRequestFullScreen||n.msRequestFullscreen||n.webkitRequestFullScreen)};t.prototype.OnUpdateFound=function(){return!0};t.prototype.OnUpdateReady=function(){return!0};t.prototype.OnOfflineReady=function(){return!0};u.cnds=new t;i.prototype.Alert=function(n){this.runtime.isDomFree||alert(n.toString())};i.prototype.Close=function(){this.runtime.isCocoonJs?CocoonJS.App.forceToFinish():window.tizen?window.tizen.application.getCurrentApplication().exit():navigator.app&&navigator.app.exitApp?navigator.app.exitApp():navigator.device&&navigator.device.exitApp?navigator.device.exitApp():this.is_arcade||this.runtime.isDomFree||window.close()};i.prototype.Focus=function(){if(this.runtime.isNodeWebkit){var n=window.nwgui.Window.get();n.focus()}else this.is_arcade||this.runtime.isDomFree||window.focus()};i.prototype.Blur=function(){if(this.runtime.isNodeWebkit){var n=window.nwgui.Window.get();n.blur()}else this.is_arcade||this.runtime.isDomFree||window.blur()};i.prototype.GoBack=function(){navigator.app&&navigator.app.backHistory?navigator.app.backHistory():this.is_arcade||this.runtime.isDomFree||!window.back||window.back()};i.prototype.GoForward=function(){this.is_arcade||this.runtime.isDomFree||!window.forward||window.forward()};i.prototype.GoHome=function(){this.is_arcade||this.runtime.isDomFree||!window.home||window.home()};i.prototype.GoToURL=function(n,t){this.runtime.isCocoonJs?CocoonJS.App.openURL(n):this.runtime.isEjecta?ejecta.openURL(n):this.runtime.isWinJS?Windows.System.Launcher.launchUriAsync(new Windows.Foundation.Uri(n)):navigator.app&&navigator.app.loadUrl?navigator.app.loadUrl(n,{openExternal:!0}):this.runtime.isCordova?window.open(n,"_system"):this.is_arcade||this.runtime.isDomFree||(t!==2||this.is_arcade?t!==1||this.is_arcade?window.location=n:window.parent.location=n:window.top.location=n)};i.prototype.GoToURLWindow=function(n,t){this.runtime.isCocoonJs?CocoonJS.App.openURL(n):this.runtime.isEjecta?ejecta.openURL(n):this.runtime.isWinJS?Windows.System.Launcher.launchUriAsync(new Windows.Foundation.Uri(n)):navigator.app&&navigator.app.loadUrl?navigator.app.loadUrl(n,{openExternal:!0}):this.runtime.isCordova?window.open(n,"_system"):this.is_arcade||this.runtime.isDomFree||window.open(n,t)};i.prototype.Reload=function(){this.is_arcade||this.runtime.isDomFree||window.location.reload()};v=!0;y=null;i.prototype.RequestFullScreen=function(n){if(this.runtime.isDomFree){cr.logexport("[Construct 2] Requesting fullscreen is not supported on this platform - the request has been ignored");return}if(n>=2&&(n+=1),n===6&&(n=2),this.runtime.isNodeWebkit)this.runtime.isDebug?debuggerFullscreen(!0):!this.runtime.isNodeFullscreen&&window.nwgui&&(window.nwgui.Window.get().enterFullscreen(),this.runtime.isNodeFullscreen=!0,this.runtime.fullscreen_scaling=n>=2?n:0);else{if(document.mozFullScreen||document.webkitIsFullScreen||!!document.msFullscreenElement||document.fullScreen||document.fullScreenElement)return;this.runtime.fullscreen_scaling=n>=2?n:0;var t=document.documentElement;v&&(v=!1,y=this.runtime,t.addEventListener("mozfullscreenerror",f),t.addEventListener("webkitfullscreenerror",f),t.addEventListener("MSFullscreenError",f),t.addEventListener("fullscreenerror",f));t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.msRequestFullscreen?t.msRequestFullscreen():t.webkitRequestFullScreen&&(typeof Element!="undefined"&&typeof Element.ALLOW_KEYBOARD_INPUT!="undefined"?t.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):t.webkitRequestFullScreen())}};i.prototype.CancelFullScreen=function(){if(this.runtime.isDomFree){cr.logexport("[Construct 2] Exiting fullscreen is not supported on this platform - the request has been ignored");return}this.runtime.isNodeWebkit?this.runtime.isDebug?debuggerFullscreen(!1):this.runtime.isNodeFullscreen&&window.nwgui&&(window.nwgui.Window.get().leaveFullscreen(),this.runtime.isNodeFullscreen=!1):document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()};i.prototype.Vibrate=function(n){try{for(var t=n.split(","),i=0,r=t.length;i<r;i++)t[i]=parseInt(t[i],10);navigator.vibrate?navigator.vibrate(t):navigator.mozVibrate?navigator.mozVibrate(t):navigator.webkitVibrate?navigator.webkitVibrate(t):navigator.msVibrate&&navigator.msVibrate(t)}catch(u){}};i.prototype.InvokeDownload=function(n,t){var i=document.createElement("a"),r,u;typeof i.download=="undefined"?window.open(n):(r=document.getElementsByTagName("body")[0],i.textContent=t,i.href=n,i.download=t,r.appendChild(i),u=new MouseEvent("click"),i.dispatchEvent(u),r.removeChild(i))};i.prototype.InvokeDownloadString=function(n,t,i){var f="data:"+t+","+encodeURIComponent(n),r=document.createElement("a"),u,e;typeof r.download=="undefined"?window.open(f):(u=document.getElementsByTagName("body")[0],r.textContent=i,r.href=f,r.download=i,u.appendChild(r),e=new MouseEvent("click"),r.dispatchEvent(e),u.removeChild(r))};i.prototype.ConsoleLog=function(n,t){typeof console!="undefined"&&(n===0&&console.log&&console.log(t.toString()),n===1&&console.warn&&console.warn(t.toString()),n===2&&console.error&&console.error(t.toString()))};i.prototype.ConsoleGroup=function(n){console&&console.group&&console.group(n)};i.prototype.ConsoleGroupEnd=function(){console&&console.groupEnd&&console.groupEnd()};i.prototype.ExecJs=function(n){try{eval&&eval(n)}catch(t){console&&console.error&&console.error("Error executing Javascript: ",t)}};p=["portrait","landscape","portrait-primary","portrait-secondary","landscape-primary","landscape-secondary"];i.prototype.LockOrientation=function(n){if(n=Math.floor(n),!(n<0)&&!(n>=p.length)){this.runtime.autoLockOrientation=!1;var t=p[n];screen.orientation&&screen.orientation.lock?screen.orientation.lock(t):screen.lockOrientation?screen.lockOrientation(t):screen.webkitLockOrientation?screen.webkitLockOrientation(t):screen.mozLockOrientation?screen.mozLockOrientation(t):screen.msLockOrientation&&screen.msLockOrientation(t)}};i.prototype.UnlockOrientation=function(){this.runtime.autoLockOrientation=!1;screen.orientation&&screen.orientation.unlock?screen.orientation.unlock():screen.unlockOrientation?screen.unlockOrientation():screen.webkitUnlockOrientation?screen.webkitUnlockOrientation():screen.mozUnlockOrientation?screen.mozUnlockOrientation():screen.msUnlockOrientation&&screen.msUnlockOrientation()};u.acts=new i;n.prototype.URL=function(n){n.set_string(this.runtime.isDomFree?"":window.location.toString())};n.prototype.Protocol=function(n){n.set_string(this.runtime.isDomFree?"":window.location.protocol)};n.prototype.Domain=function(n){n.set_string(this.runtime.isDomFree?"":window.location.hostname)};n.prototype.PathName=function(n){n.set_string(this.runtime.isDomFree?"":window.location.pathname)};n.prototype.Hash=function(n){n.set_string(this.runtime.isDomFree?"":window.location.hash)};n.prototype.Referrer=function(n){n.set_string(this.runtime.isDomFree?"":document.referrer)};n.prototype.Title=function(n){n.set_string(this.runtime.isDomFree?"":document.title)};n.prototype.Name=function(n){n.set_string(this.runtime.isDomFree?"":navigator.appName)};n.prototype.Version=function(n){n.set_string(this.runtime.isDomFree?"":navigator.appVersion)};n.prototype.Language=function(n){navigator&&navigator.language?n.set_string(navigator.language):n.set_string("")};n.prototype.Platform=function(n){n.set_string(this.runtime.isDomFree?"":navigator.platform)};n.prototype.Product=function(n){navigator&&navigator.product?n.set_string(navigator.product):n.set_string("")};n.prototype.Vendor=function(n){navigator&&navigator.vendor?n.set_string(navigator.vendor):n.set_string("")};n.prototype.UserAgent=function(n){n.set_string(this.runtime.isDomFree?"":navigator.userAgent)};n.prototype.QueryString=function(n){n.set_string(this.runtime.isDomFree?"":window.location.search)};n.prototype.QueryParam=function(n,t){if(this.runtime.isDomFree){n.set_string("");return}var i=RegExp("[?&]"+t+"=([^&]*)").exec(window.location.search);i?n.set_string(decodeURIComponent(i[1].replace(/\+/g," "))):n.set_string("")};n.prototype.Bandwidth=function(n){var t=navigator.connection||navigator.mozConnection||navigator.webkitConnection;t?typeof t.bandwidth!="undefined"?n.set_float(t.bandwidth):typeof t.downlinkMax!="undefined"?n.set_float(t.downlinkMax):n.set_float(Number.POSITIVE_INFINITY):n.set_float(Number.POSITIVE_INFINITY)};n.prototype.ConnectionType=function(n){var t=navigator.connection||navigator.mozConnection||navigator.webkitConnection;t?n.set_string(t.type||"unknown"):n.set_string("unknown")};n.prototype.BatteryLevel=function(n){var t=navigator.battery||navigator.mozBattery||navigator.webkitBattery;t?n.set_float(t.level):(a(),r?n.set_float(r.level):n.set_float(1))};n.prototype.BatteryTimeLeft=function(n){var t=navigator.battery||navigator.mozBattery||navigator.webkitBattery;t?n.set_float(t.dischargingTime):(a(),r?n.set_float(r.dischargingTime):n.set_float(Number.POSITIVE_INFINITY))};n.prototype.ExecJS=function(n,t){if(!eval){n.set_any(0);return}var i=0;try{i=eval(t)}catch(r){console&&console.error&&console.error("Error executing Javascript: ",r)}typeof i=="number"?n.set_any(i):typeof i=="string"?n.set_any(i):typeof i=="boolean"?n.set_any(i?1:0):n.set_any(0)};n.prototype.ScreenWidth=function(n){n.set_int(screen.width)};n.prototype.ScreenHeight=function(n){n.set_int(screen.height)};n.prototype.DevicePixelRatio=function(n){n.set_float(this.runtime.devicePixelRatio)};n.prototype.WindowInnerWidth=function(n){n.set_int(window.innerWidth)};n.prototype.WindowInnerHeight=function(n){n.set_int(window.innerHeight)};n.prototype.WindowOuterWidth=function(n){n.set_int(window.outerWidth)};n.prototype.WindowOuterHeight=function(n){n.set_int(window.outerHeight)};u.exps=new n}();cr.plugins_.Dictionary=function(n){this.runtime=n},function(){function i(){}function t(){}function r(){}var n=cr.plugins_.Dictionary.prototype,f,u;n.Type=function(n){this.plugin=n;this.runtime=n.runtime};f=n.Type.prototype;f.onCreate=function(){};n.Instance=function(n){this.type=n;this.runtime=n.runtime};u=n.Instance.prototype;u.onCreate=function(){this.dictionary={};this.cur_key="";this.key_count=0};u.saveToJSON=function(){return this.dictionary};u.loadFromJSON=function(n){this.dictionary=n;this.key_count=0;for(var t in this.dictionary)this.dictionary.hasOwnProperty(t)&&this.key_count++};i.prototype.CompareValue=function(n,t,i){return cr.do_cmp(this.dictionary[n],t,i)};i.prototype.ForEachKey=function(){var n=this.runtime.getCurrentEventStack().current_event;for(var t in this.dictionary)this.dictionary.hasOwnProperty(t)&&(this.cur_key=t,this.runtime.pushCopySol(n.solModifiers),n.retrigger(),this.runtime.popSol(n.solModifiers));return this.cur_key="",!1};i.prototype.CompareCurrentValue=function(n,t){return cr.do_cmp(this.dictionary[this.cur_key],n,t)};i.prototype.HasKey=function(n){return this.dictionary.hasOwnProperty(n)};i.prototype.IsEmpty=function(){return this.key_count===0};n.cnds=new i;t.prototype.AddKey=function(n,t){this.dictionary.hasOwnProperty(n)||this.key_count++;this.dictionary[n]=t};t.prototype.SetKey=function(n,t){this.dictionary.hasOwnProperty(n)&&(this.dictionary[n]=t)};t.prototype.DeleteKey=function(n){this.dictionary.hasOwnProperty(n)&&(delete this.dictionary[n],this.key_count--)};t.prototype.Clear=function(){cr.wipe(this.dictionary);this.key_count=0};t.prototype.JSONLoad=function(n){var t,i;try{t=JSON.parse(n)}catch(r){return}if(t.c2dictionary){this.dictionary=t.data;this.key_count=0;for(i in this.dictionary)this.dictionary.hasOwnProperty(i)&&this.key_count++}};t.prototype.JSONDownload=function(n){var t=document.createElement("a"),u,i,r;typeof t.download=="undefined"?(u="data:text/html,"+encodeURIComponent("<p><a download='data.json' href=\"data:application/json,"+encodeURIComponent(JSON.stringify({c2dictionary:!0,data:this.dictionary}))+'">Download link<\/a><\/p>'),window.open(u)):(i=document.getElementsByTagName("body")[0],t.textContent=n,t.href="data:application/json,"+encodeURIComponent(JSON.stringify({c2dictionary:!0,data:this.dictionary})),t.download=n,i.appendChild(t),r=document.createEvent("MouseEvent"),r.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),t.dispatchEvent(r),i.removeChild(t))};n.acts=new t;r.prototype.Get=function(n,t){this.dictionary.hasOwnProperty(t)?n.set_any(this.dictionary[t]):n.set_int(0)};r.prototype.KeyCount=function(n){n.set_int(this.key_count)};r.prototype.CurrentKey=function(n){n.set_string(this.cur_key)};r.prototype.CurrentValue=function(n){this.dictionary.hasOwnProperty(this.cur_key)?n.set_any(this.dictionary[this.cur_key]):n.set_int(0)};r.prototype.AsJSON=function(n){n.set_string(JSON.stringify({c2dictionary:!0,data:this.dictionary}))};n.exps=new r}();cr.plugins_.Function=function(n){this.runtime=n},function(){function a(){this.name="";this.retVal=0;this.params=[]}function o(){return i++,i===n.length&&n.push(new a),n[i]}function r(){return i<0?null:n[i]}function v(){if(!n.length)return null;var t=i+1;return t>=n.length&&(t=n.length-1),n[t]}function s(){i--}function h(){}function f(){}function u(){}var t=cr.plugins_.Function.prototype,c;t.Type=function(n){this.plugin=n;this.runtime=n.runtime};c=t.Type.prototype;c.onCreate=function(){};t.Instance=function(n){this.type=n;this.runtime=n.runtime};var l=t.Instance.prototype,n=[],i=-1,e=!1;l.onCreate=function(){e=typeof cr_is_preview!="undefined";var n=this;window.c2_callFunction=function(t,i){var f,e,u,r=o();if(r.name=t.toLowerCase(),r.retVal=0,i)for(r.params.length=i.length,f=0,e=i.length;f<e;++f)u=i[f],r.params[f]=typeof u=="number"||typeof u=="string"?u:typeof u=="boolean"?u?1:0:0;else cr.clearArray(r.params);return n.runtime.trigger(cr.plugins_.Function.prototype.cnds.OnFunction,n,r.name),s(),r.retVal}};h.prototype.OnFunction=function(n){var t=r();return t?cr.equals_nocase(n,t.name):!1};h.prototype.CompareParam=function(n,t,i){var u=r();return u?(n=cr.floor(n),n<0||n>=u.params.length)?!1:cr.do_cmp(u.params[n],t,i):!1};t.cnds=new h;f.prototype.CallFunction=function(n,t){var i=o(),r;i.name=n.toLowerCase();i.retVal=0;cr.shallowAssignArray(i.params,t);r=this.runtime.trigger(cr.plugins_.Function.prototype.cnds.OnFunction,this,i.name);e&&!r;s()};f.prototype.SetReturnValue=function(n){var t=r();t&&(t.retVal=n)};f.prototype.CallExpression=function(){};t.acts=new f;u.prototype.ReturnValue=function(n){var t=v();t?n.set_any(t.retVal):n.set_int(0)};u.prototype.ParamCount=function(n){var t=r();t?n.set_int(t.params.length):n.set_int(0)};u.prototype.Param=function(n,t){t=cr.floor(t);var i=r();i?t>=0&&t<i.params.length?n.set_any(i.params[t]):n.set_int(0):n.set_int(0)};u.prototype.Call=function(n,t){var i=o(),r,u,f;for(i.name=t.toLowerCase(),i.retVal=0,cr.clearArray(i.params),r=2,u=arguments.length;r<u;r++)i.params.push(arguments[r]);f=this.runtime.trigger(cr.plugins_.Function.prototype.cnds.OnFunction,this,i.name);e&&!f;s();n.set_any(i.retVal)};t.exps=new u}();cr.plugins_.Keyboard=function(n){this.runtime=n},function(){function n(){}function e(){}function r(){}function o(n){n=Math.floor(n);switch(n){case 8:return"backspace";case 9:return"tab";case 13:return"enter";case 16:return"shift";case 17:return"control";case 18:return"alt";case 19:return"pause";case 20:return"capslock";case 27:return"esc";case 33:return"pageup";case 34:return"pagedown";case 35:return"end";case 36:return"home";case 37:return"←";case 38:return"↑";case 39:return"→";case 40:return"↓";case 45:return"insert";case 46:return"del";case 91:return"left window key";case 92:return"right window key";case 93:return"select";case 96:return"numpad 0";case 97:return"numpad 1";case 98:return"numpad 2";case 99:return"numpad 3";case 100:return"numpad 4";case 101:return"numpad 5";case 102:return"numpad 6";case 103:return"numpad 7";case 104:return"numpad 8";case 105:return"numpad 9";case 106:return"numpad *";case 107:return"numpad +";case 109:return"numpad -";case 110:return"numpad .";case 111:return"numpad /";case 112:return"F1";case 113:return"F2";case 114:return"F3";case 115:return"F4";case 116:return"F5";case 117:return"F6";case 118:return"F7";case 119:return"F8";case 120:return"F9";case 121:return"F10";case 122:return"F11";case 123:return"F12";case 144:return"numlock";case 145:return"scroll lock";case 186:return";";case 187:return"=";case 188:return",";case 189:return"-";case 190:return".";case 191:return"/";case 192:return"'";case 219:return"[";case 220:return"\\";case 221:return"]";case 222:return"#";case 223:return"`";default:return String.fromCharCode(n)}}var t=cr.plugins_.Keyboard.prototype,u,i,f;t.Type=function(n){this.plugin=n;this.runtime=n.runtime};u=t.Type.prototype;u.onCreate=function(){};t.Instance=function(n){this.type=n;this.runtime=n.runtime;this.keyMap=new Array(256);this.usedKeys=new Array(256);this.triggerKey=0};i=t.Instance.prototype;i.onCreate=function(){var n=this;this.runtime.isDomFree||(jQuery(document).keydown(function(t){n.onKeyDown(t)}),jQuery(document).keyup(function(t){n.onKeyUp(t)}))};f=[32,33,34,35,36,37,38,39,40,44];i.onKeyDown=function(n){var t=!1,i,r;if(window!=window.top&&f.indexOf(n.which)>-1&&(n.preventDefault(),t=!0,n.stopPropagation()),this.keyMap[n.which]){this.usedKeys[n.which]&&!t&&n.preventDefault();return}this.keyMap[n.which]=!0;this.triggerKey=n.which;this.runtime.isInUserInputEvent=!0;this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnAnyKey,this);i=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKey,this);r=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyCode,this);this.runtime.isInUserInputEvent=!1;(i||r)&&(this.usedKeys[n.which]=!0,t||n.preventDefault())};i.onKeyUp=function(n){this.keyMap[n.which]=!1;this.triggerKey=n.which;this.runtime.isInUserInputEvent=!0;this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnAnyKeyReleased,this);var t=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyReleased,this),i=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyCodeReleased,this);this.runtime.isInUserInputEvent=!1;(t||i||this.usedKeys[n.which])&&(this.usedKeys[n.which]=!0,n.preventDefault())};i.onWindowBlur=function(){for(var t,i,n=0;n<256;++n)this.keyMap[n]&&(this.keyMap[n]=!1,this.triggerKey=n,this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnAnyKeyReleased,this),t=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyReleased,this),i=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyCodeReleased,this),(t||i)&&(this.usedKeys[n]=!0))};i.saveToJSON=function(){return{triggerKey:this.triggerKey}};i.loadFromJSON=function(n){this.triggerKey=n.triggerKey};n.prototype.IsKeyDown=function(n){return this.keyMap[n]};n.prototype.OnKey=function(n){return n===this.triggerKey};n.prototype.OnAnyKey=function(){return!0};n.prototype.OnAnyKeyReleased=function(){return!0};n.prototype.OnKeyReleased=function(n){return n===this.triggerKey};n.prototype.IsKeyCodeDown=function(n){return(n=Math.floor(n),n<0||n>=this.keyMap.length)?!1:this.keyMap[n]};n.prototype.OnKeyCode=function(n){return n===this.triggerKey};n.prototype.OnKeyCodeReleased=function(n){return n===this.triggerKey};t.cnds=new n;t.acts=new e;r.prototype.LastKeyCode=function(n){n.set_int(this.triggerKey)};r.prototype.StringFromKeyCode=function(n,t){n.set_string(o(t))};t.exps=new r}();localForageInitFailed=!1;try{
/*!
    localForage -- Offline Storage, Improved
    Version 1.4.0
    https://mozilla.github.io/localForage
    (c) 2013-2015 Mozilla, Apache License 2.0
*/
!function(){var n,t,r,i;!function(){var u={},f={};n=function(n,t,i){u[n]={deps:t,callback:i}};i=r=t=function(n){function l(t){var i;if("."!==t.charAt(0))return t;for(var f=t.split("/"),r=n.split("/").slice(0,-1),u=0,e=f.length;e>u;u++)if(i=f[u],".."===i)r.pop();else{if("."===i)continue;r.push(i)}return r.join("/")}var c;if(i._eak_seen=u,f[n])return f[n];if(f[n]={},!u[n])throw new Error("Could not find module "+n);for(var s,h=u[n],e=h.deps,a=h.callback,o=[],r=0,v=e.length;v>r;r++)"exports"===e[r]?o.push(s={}):o.push(t(l(e[r])));return c=a.apply(this,o),f[n]=s||c}}();n("promise/all",["./utils","exports"],function(n,t){"use strict";function i(n){var t=this;if(!r(n))throw new TypeError("You must pass an array to all.");return new t(function(t,i){function h(n){return function(t){e(n,t)}}function e(n,i){o[n]=i;0==--s&&t(o)}var f,o=[],s=n.length,r;for(0===s&&t([]),r=0;r<n.length;r++)f=n[r],f&&u(f.then)?f.then(h(r),i):e(r,f)})}var r=n.isArray,u=n.isFunction;t.all=i});n("promise/asap",["exports"],function(n){"use strict";function e(){return function(){process.nextTick(i)}}function o(){var n=0,r=new f(i),t=document.createTextNode("");return r.observe(t,{characterData:!0}),function(){t.data=n=++n%2}}function s(){return function(){c.setTimeout(i,1)}}function i(){for(var n=0;n<t.length;n++){var i=t[n],r=i[0],u=i[1];r(u)}t=[]}function h(n,i){var u=t.push([n,i]);1===u&&r()}var r,u="undefined"!=typeof window?window:{},f=u.MutationObserver||u.WebKitMutationObserver,c="undefined"!=typeof global?global:void 0===this?window:this,t=[];r="undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?e():f?o():s();n.asap=h});n("promise/config",["exports"],function(n){"use strict";function i(n,i){return 2!==arguments.length?t[n]:void(t[n]=i)}var t={instrument:!1};n.config=t;n.configure=i});n("promise/polyfill",["./promise","./utils","exports"],function(n,t,i){"use strict";function r(){var n,t;n="undefined"!=typeof global?global:"undefined"!=typeof window&&window.document?window:self;t="Promise"in n&&"resolve"in n.Promise&&"reject"in n.Promise&&"all"in n.Promise&&"race"in n.Promise&&function(){var t;return new n.Promise(function(n){t=n}),f(t)}();t||(n.Promise=u)}var u=n.Promise,f=t.isFunction;i.polyfill=r});n("promise/promise",["./config","./utils","./all","./race","./resolve","./reject","./asap","exports"],function(n,t,i,r,u,f,e,o){"use strict";function s(n){if(!v(n))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof s))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._subscribers=[];nt(n,this)}function nt(n,t){function r(n){c(t,n)}function i(n){h(t,n)}try{n(r,i)}catch(u){i(u)}}function w(n,t,i,r){var u,e,f,o,s=v(i);if(s)try{u=i(r);f=!0}catch(l){o=!0;e=l}else u=r,f=!0;k(t,u)||(s&&f?c(t,u):o?h(t,e):n===y?c(t,u):n===p&&h(t,u))}function tt(n,t,i,r){var u=n._subscribers,f=u.length;u[f]=t;u[f+y]=i;u[f+p]=r}function b(n,t){for(var u,f,r=n._subscribers,e=n._detail,i=0;i<r.length;i+=3)u=r[i],f=r[i+t],w(t,u,f,e);n._subscribers=null}function k(n,t){var i,r=null;try{if(n===t)throw new TypeError("A promises callback cannot return that same promise.");if(ut(t)&&(r=t.then,v(r)))return r.call(t,function(r){return i?!0:(i=!0,void(t!==r?c(n,r):a(n,r)))},function(t){return i?!0:(i=!0,void h(n,t))}),!0}catch(u){return i?!0:(h(n,u),!0)}return!1}function c(n,t){n===t?a(n,t):k(n,t)||a(n,t)}function a(n,t){n._state===d&&(n._state=g,n._detail=t,l.async(it,n))}function h(n,t){n._state===d&&(n._state=g,n._detail=t,l.async(rt,n))}function it(n){b(n,n._state=y)}function rt(n){b(n,n._state=p)}var l=n.config,ut=(n.configure,t.objectOrFunction),v=t.isFunction,ft=(t.now,i.all),et=r.race,ot=u.resolve,st=f.reject,ht=e.asap;l.async=ht;var d=void 0,g=0,y=1,p=2;s.prototype={constructor:s,_state:void 0,_detail:void 0,_subscribers:void 0,then:function(n,t){var i=this,r=new this.constructor(function(){}),u;return this._state?(u=arguments,l.async(function(){w(i._state,r,u[i._state-1],i._detail)})):tt(this,r,n,t),r},"catch":function(n){return this.then(null,n)}};s.all=ft;s.race=et;s.resolve=ot;s.reject=st;o.Promise=s});n("promise/race",["./utils","exports"],function(n,t){"use strict";function i(n){var t=this;if(!r(n))throw new TypeError("You must pass an array to race.");return new t(function(t,i){for(var r,u=0;u<n.length;u++)r=n[u],r&&"function"==typeof r.then?r.then(t,i):t(r)})}var r=n.isArray;t.race=i});n("promise/reject",["exports"],function(n){"use strict";function t(n){var t=this;return new t(function(t,i){i(n)})}n.reject=t});n("promise/resolve",["exports"],function(n){"use strict";function t(n){if(n&&"object"==typeof n&&n.constructor===this)return n;var t=this;return new t(function(t){t(n)})}n.resolve=t});n("promise/utils",["exports"],function(n){"use strict";function i(n){return t(n)||"object"==typeof n&&null!==n}function t(n){return"function"==typeof n}function r(n){return"[object Array]"===Object.prototype.toString.call(n)}var u=Date.now||function(){return(new Date).getTime()};n.objectOrFunction=i;n.isFunction=t;n.isArray=r;n.now=u});t("promise/polyfill").polyfill()}(),function(n,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.localforage=t():n.localforage=t()}(this,function(){return function(n){function t(r){if(i[r])return i[r].exports;var u=i[r]={exports:{},id:r,loaded:!1};return n[r].call(u.exports,u,u.exports,t),u.loaded=!0,u.exports}var i={};return t.m=n,t.c=i,t.p="",t(0)}([function(n,t,i){"use strict";function r(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function");}t.__esModule=!0;var u=function(n){function c(n,t){n[t]=function(){var i=arguments;return n.ready().then(function(){return n[t].apply(n,i)})}}function u(){for(var n,t,i=1;i<arguments.length;i++)if(n=arguments[i],n)for(t in n)n.hasOwnProperty(t)&&(arguments[0][t]=h(n[t])?n[t].slice():n[t]);return arguments[0]}function o(n){for(var i in t)if(t.hasOwnProperty(i)&&t[i]===n)return!0;return!1}var f={},t={INDEXEDDB:"asyncStorage",LOCALSTORAGE:"localStorageWrapper",WEBSQL:"webSQLStorage"},l=[t.INDEXEDDB,t.WEBSQL,t.LOCALSTORAGE],e=["clear","getItem","iterate","key","keys","length","removeItem","setItem"],a={description:"",driver:l.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1},s=function(n){var i={};return i[t.INDEXEDDB]=!!function(){try{var t=t||n.indexedDB||n.webkitIndexedDB||n.mozIndexedDB||n.OIndexedDB||n.msIndexedDB;return"undefined"!=typeof n.openDatabase&&n.navigator&&n.navigator.userAgent&&/Safari/.test(n.navigator.userAgent)&&!/Chrome/.test(n.navigator.userAgent)?!1:t&&"function"==typeof t.open&&"undefined"!=typeof n.IDBKeyRange}catch(i){return!1}}(),i[t.WEBSQL]=!!function(){try{return n.openDatabase}catch(t){return!1}}(),i[t.LOCALSTORAGE]=!!function(){try{return n.localStorage&&"setItem"in n.localStorage&&n.localStorage.setItem}catch(t){return!1}}(),i}(n),h=Array.isArray||function(n){return"[object Array]"===Object.prototype.toString.call(n)},v=function(){function n(i){r(this,n);this.INDEXEDDB=t.INDEXEDDB;this.LOCALSTORAGE=t.LOCALSTORAGE;this.WEBSQL=t.WEBSQL;this._defaultConfig=u({},a);this._config=u({},this._defaultConfig,i);this._driverSet=null;this._initDriver=null;this._ready=!1;this._dbInfo=null;this._wrapLibraryMethodsWithReady();this.setDriver(this._config.driver)}return n.prototype.config=function(n){if("object"==typeof n){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in n)"storeName"===t&&(n[t]=n[t].replace(/\W/g,"_")),this._config[t]=n[t];return"driver"in n&&n.driver&&this.setDriver(this._config.driver),!0}return"string"==typeof n?this._config[n]:this._config},n.prototype.defineDriver=function(n,t,i){var r=new Promise(function(t,i){var h,r,u,c;try{var l=n._driver,a=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver"),v=new Error("Custom driver name already in use: "+n._driver);if(!n._driver)return void i(a);if(o(n._driver))return void i(v);for(h=e.concat("_initStorage"),r=0;r<h.length;r++)if(u=h[r],!u||!n[u]||"function"!=typeof n[u])return void i(a);c=Promise.resolve(!0);"_support"in n&&(c=n._support&&"function"==typeof n._support?n._support():Promise.resolve(!!n._support));c.then(function(i){s[l]=i;f[l]=n;t()},i)}catch(y){i(y)}});return r.then(t,i),r},n.prototype.driver=function(){return this._driver||null},n.prototype.getDriver=function(n,t,r){var u=this,e=function(){if(o(n))switch(n){case u.INDEXEDDB:return new Promise(function(n){n(i(1))});case u.LOCALSTORAGE:return new Promise(function(n){n(i(2))});case u.WEBSQL:return new Promise(function(n){n(i(4))})}else if(f[n])return Promise.resolve(f[n]);return Promise.reject(new Error("Driver not found."))}();return e.then(t,r),e},n.prototype.getSerializer=function(n){var t=new Promise(function(n){n(i(3))});return n&&"function"==typeof n&&t.then(function(t){n(t)}),t},n.prototype.ready=function(n){var t=this,i=t._driverSet.then(function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready});return i.then(n,n),i},n.prototype.setDriver=function(n,t,i){function u(){r._config.driver=r.driver()}function o(n){return function(){function i(){for(var f,e;t<n.length;)return f=n[t],t++,r._dbInfo=null,r._ready=null,r.getDriver(f).then(function(n){return r._extend(n),u(),r._ready=r._initStorage(r._config),r._ready})["catch"](i);return u(),e=new Error("No available storage method found."),r._driverSet=Promise.reject(e),r._driverSet}var t=0;return i()}}var r=this,f,e;return h(n)||(n=[n]),f=this._getSupportedDrivers(n),e=null!==this._driverSet?this._driverSet["catch"](function(){return Promise.resolve()}):Promise.resolve(),this._driverSet=e.then(function(){var n=f[0];return r._dbInfo=null,r._ready=null,r.getDriver(n).then(function(n){r._driver=n._driver;u();r._wrapLibraryMethodsWithReady();r._initDriver=o(f)})})["catch"](function(){u();var n=new Error("No available storage method found.");return r._driverSet=Promise.reject(n),r._driverSet}),this._driverSet.then(t,i),this._driverSet},n.prototype.supports=function(n){return!!s[n]},n.prototype._extend=function(n){u(this,n)},n.prototype._getSupportedDrivers=function(n){for(var i,r=[],t=0,u=n.length;u>t;t++)i=n[t],this.supports(i)&&r.push(i);return r},n.prototype._wrapLibraryMethodsWithReady=function(){for(var n=0;n<e.length;n++)c(this,e[n])},n.prototype.createInstance=function(t){return new n(t)},n}();return new v}("undefined"!=typeof window?window:self);t["default"]=u;n.exports=t["default"]},function(n,t){"use strict";t.__esModule=!0;var i=function(n){function e(t,i){t=t||[];i=i||{};try{return new Blob(t,i)}catch(u){if("TypeError"!==u.name)throw u;for(var e=n.BlobBuilder||n.MSBlobBuilder||n.MozBlobBuilder||n.WebKitBlobBuilder,f=new e,r=0;r<t.length;r+=1)f.append(t[r]);return f.getBlob(i.type)}}function l(n){for(var i=n.length,r=new ArrayBuffer(i),u=new Uint8Array(r),t=0;i>t;t++)u[t]=n.charCodeAt(t);return r}function a(n){return new Promise(function(t,i){var r=new XMLHttpRequest;r.open("GET",n);r.withCredentials=!0;r.responseType="arraybuffer";r.onreadystatechange=function(){if(4===r.readyState)return 200===r.status?t({response:r.response,type:r.getResponseHeader("Content-Type")}):void i({status:r.status,response:r.response})};r.send()})}function v(n){return new Promise(function(t,i){var f=e([""],{type:"image/png"}),u=n.transaction([r],"readwrite");u.objectStore(r).put(f,"key");u.oncomplete=function(){var f=n.transaction([r],"readwrite"),u=f.objectStore(r).get("key");u.onerror=i;u.onsuccess=function(n){var r=n.target.result,i=URL.createObjectURL(r);a(i).then(function(n){t(!(!n||"image/png"!==n.type))},function(){t(!1)}).then(function(){URL.revokeObjectURL(i)})}};u.onerror=u.onabort=i})["catch"](function(){return!1})}function y(n){return"boolean"==typeof f?Promise.resolve(f):v(n).then(function(n){return f=n})}function p(n){return new Promise(function(t,i){var r=new FileReader;r.onerror=i;r.onloadend=function(i){var r=btoa(i.target.result||"");t({__local_forage_encoded_blob:!0,data:r,type:n.type})};r.readAsBinaryString(n)})}function o(n){var t=l(atob(n.data));return e([t],{type:n.type})}function s(n){return n&&n.__local_forage_encoded_blob}function w(n){var t=this,r=t._initReady().then(function(){var n=i[t._dbInfo.name];if(n&&n.dbReady)return n.dbReady});return r.then(n,n),r}function b(n){var r=i[n.name],t={};t.promise=new Promise(function(n){t.resolve=n});r.deferredOperations.push(t);r.dbReady=r.dbReady?r.dbReady.then(function(){return t.promise}):t.promise}function k(n){var r=i[n.name],t=r.deferredOperations.pop();t&&t.resolve()}function d(n){function c(){return Promise.resolve()}var u=this,t={db:null},e,r,o,f,s,h;if(n)for(e in n)t[e]=n[e];for(i||(i={}),r=i[t.name],r||(r={forages:[],db:null,dbReady:null,deferredOperations:[]},i[t.name]=r),r.forages.push(u),u._initReady||(u._initReady=u.ready,u.ready=w),o=[],f=0;f<r.forages.length;f++)s=r.forages[f],s!==u&&o.push(s._initReady()["catch"](c));return h=r.forages.slice(0),Promise.all(o).then(function(){return t.db=r.db,g(t)}).then(function(n){return t.db=n,tt(t,u._defaultConfig.version)?nt(t):n}).then(function(n){var i,f;for(t.db=r.db=n,u._dbInfo=t,i=0;i<h.length;i++)f=h[i],f!==u&&(f._dbInfo.db=t.db,f._dbInfo.version=t.version)})}function g(n){return h(n,!1)}function nt(n){return h(n,!0)}function h(t,i){return new Promise(function(f,e){var s,o;if(t.db){if(!i)return f(t.db);b(t);t.db.close()}s=[t.name];i&&s.push(t.version);o=u.open.apply(u,s);i&&(o.onupgradeneeded=function(i){var u=o.result;try{u.createObjectStore(t.storeName);i.oldVersion<=1&&u.createObjectStore(r)}catch(f){if("ConstraintError"!==f.name)throw f;n.console.warn('The database "'+t.name+'" has been upgraded from version '+i.oldVersion+" to version "+i.newVersion+', but the storage "'+t.storeName+'" already exists.')}});o.onerror=function(){e(o.error)};o.onsuccess=function(){f(o.result);k(t)}})}function tt(t,i){var r;if(!t.db)return!0;var u=!t.db.objectStoreNames.contains(t.storeName),f=t.version<t.db.version,e=t.version>t.db.version;return(f&&(t.version!==i&&n.console.warn('The database "'+t.name+"\" can't be downgraded from version "+t.db.version+" to version "+t.version+"."),t.version=t.db.version),e||u)?(u&&(r=t.db.version+1,r>t.version&&(t.version=r)),!0):!1}function it(i,r){var f=this,u;return"string"!=typeof i&&(n.console.warn(i+" used as a key, but it is not a string."),i=String(i)),u=new Promise(function(n,t){f.ready().then(function(){var u=f._dbInfo,e=u.db.transaction(u.storeName,"readonly").objectStore(u.storeName),r=e.get(i);r.onsuccess=function(){var t=r.result;void 0===t&&(t=null);s(t)&&(t=o(t));n(t)};r.onerror=function(){t(r.error)}})["catch"](t)}),t(u,r),u}function rt(n,i){var r=this,u=new Promise(function(t,i){r.ready().then(function(){var f=r._dbInfo,e=f.db.transaction(f.storeName,"readonly").objectStore(f.storeName),u=e.openCursor(),h=1;u.onsuccess=function(){var r=u.result,i,f;r?(i=r.value,s(i)&&(i=o(i)),f=n(i,r.key,h++),void 0!==f?t(f):r["continue"]()):t()};u.onerror=function(){i(u.error)}})["catch"](i)});return t(u,i),u}function ut(i,r,u){var e=this,f;return"string"!=typeof i&&(n.console.warn(i+" used as a key, but it is not a string."),i=String(i)),f=new Promise(function(n,t){var u;e.ready().then(function(){return u=e._dbInfo,r instanceof Blob?y(u.db).then(function(n){return n?r:p(r)}):r}).then(function(r){var f=u.db.transaction(u.storeName,"readwrite"),o=f.objectStore(u.storeName),e;null===r&&(r=void 0);f.oncomplete=function(){void 0===r&&(r=null);n(r)};f.onabort=f.onerror=function(){var n=e.error?e.error:e.transaction.error;t(n)};e=o.put(r,i)})["catch"](t)}),t(f,u),f}function ft(i,r){var f=this,u;return"string"!=typeof i&&(n.console.warn(i+" used as a key, but it is not a string."),i=String(i)),u=new Promise(function(n,t){f.ready().then(function(){var e=f._dbInfo,r=e.db.transaction(e.storeName,"readwrite"),o=r.objectStore(e.storeName),u=o["delete"](i);r.oncomplete=function(){n()};r.onerror=function(){t(u.error)};r.onabort=function(){var n=u.error?u.error:u.transaction.error;t(n)}})["catch"](t)}),t(u,r),u}function et(n){var i=this,r=new Promise(function(n,t){i.ready().then(function(){var u=i._dbInfo,r=u.db.transaction(u.storeName,"readwrite"),e=r.objectStore(u.storeName),f=e.clear();r.oncomplete=function(){n()};r.onabort=r.onerror=function(){var n=f.error?f.error:f.transaction.error;t(n)}})["catch"](t)});return t(r,n),r}function ot(n){var i=this,r=new Promise(function(n,t){i.ready().then(function(){var u=i._dbInfo,f=u.db.transaction(u.storeName,"readonly").objectStore(u.storeName),r=f.count();r.onsuccess=function(){n(r.result)};r.onerror=function(){t(r.error)}})["catch"](t)});return t(r,n),r}function st(n,i){var r=this,u=new Promise(function(t,i){return 0>n?void t(null):void r.ready().then(function(){var f=r._dbInfo,o=f.db.transaction(f.storeName,"readonly").objectStore(f.storeName),e=!1,u=o.openCursor();u.onsuccess=function(){var i=u.result;return i?void(0===n?t(i.key):e?t(i.key):(e=!0,i.advance(n))):void t(null)};u.onerror=function(){i(u.error)}})["catch"](i)});return t(u,i),u}function ht(n){var i=this,r=new Promise(function(n,t){i.ready().then(function(){var u=i._dbInfo,e=u.db.transaction(u.storeName,"readonly").objectStore(u.storeName),r=e.openCursor(),f=[];r.onsuccess=function(){var t=r.result;return t?(f.push(t.key),void t["continue"]()):void n(f)};r.onerror=function(){t(r.error)}})["catch"](t)});return t(r,n),r}function t(n,t){t&&n.then(function(n){t(null,n)},function(n){t(n)})}var u=u||n.indexedDB||n.webkitIndexedDB||n.mozIndexedDB||n.OIndexedDB||n.msIndexedDB,f,i,r,c;if(u)return r="local-forage-detect-blob-support",c={_driver:"asyncStorage",_initStorage:d,iterate:rt,getItem:it,setItem:ut,removeItem:ft,clear:et,length:ot,key:st,keys:ht},c}("undefined"!=typeof window?window:self);t["default"]=i;n.exports=t["default"]},function(n,t,i){"use strict";t.__esModule=!0;var r=function(n){function u(n){var u=this,t={},r;if(n)for(r in n)t[r]=n[r];return t.keyPrefix=t.name+"/",t.storeName!==u._defaultConfig.storeName&&(t.keyPrefix+=t.storeName+"/"),u._dbInfo=t,new Promise(function(n){n(i(3))}).then(function(n){return t.serializer=n,Promise.resolve()})}function f(n){var i=this,u=i.ready().then(function(){for(var r,u=i._dbInfo.keyPrefix,n=t.length-1;n>=0;n--)r=t.key(n),0===r.indexOf(u)&&t.removeItem(r)});return r(u,n),u}function e(i,u){var e=this,f;return"string"!=typeof i&&(n.console.warn(i+" used as a key, but it is not a string."),i=String(i)),f=e.ready().then(function(){var r=e._dbInfo,n=t.getItem(r.keyPrefix+i);return n&&(n=r.serializer.deserialize(n)),n}),r(f,u),f}function o(n,i){var u=this,f=u.ready().then(function(){for(var r,i,e=u._dbInfo,o=e.keyPrefix,s=o.length,h=t.length,c=1,f=0;h>f;f++)if(r=t.key(f),0===r.indexOf(o)&&(i=t.getItem(r),i&&(i=e.serializer.deserialize(i)),i=n(i,r.substring(s),c++),void 0!==i))return i});return r(f,i),f}function s(n,i){var u=this,f=u.ready().then(function(){var i,r=u._dbInfo;try{i=t.key(n)}catch(f){i=null}return i&&(i=i.substring(r.keyPrefix.length)),i});return r(f,i),f}function h(n){var i=this,u=i.ready().then(function(){for(var r=i._dbInfo,f=t.length,u=[],n=0;f>n;n++)0===t.key(n).indexOf(r.keyPrefix)&&u.push(t.key(n).substring(r.keyPrefix.length));return u});return r(u,n),u}function c(n){var i=this,t=i.keys().then(function(n){return n.length});return r(t,n),t}function l(i,u){var e=this,f;return"string"!=typeof i&&(n.console.warn(i+" used as a key, but it is not a string."),i=String(i)),f=e.ready().then(function(){var n=e._dbInfo;t.removeItem(n.keyPrefix+i)}),r(f,u),f}function a(i,u,f){var o=this,e;return"string"!=typeof i&&(n.console.warn(i+" used as a key, but it is not a string."),i=String(i)),e=o.ready().then(function(){void 0===u&&(u=null);var n=u;return new Promise(function(r,f){var e=o._dbInfo;e.serializer.serialize(u,function(u,o){if(o)f(o);else try{t.setItem(e.keyPrefix+i,u);r(n)}catch(s){("QuotaExceededError"===s.name||"NS_ERROR_DOM_QUOTA_REACHED"===s.name)&&f(s);f(s)}})})}),r(e,f),e}function r(n,t){t&&n.then(function(n){t(null,n)},function(n){t(n)})}var t=null;try{if(!(n.localStorage&&"setItem"in n.localStorage))return;t=n.localStorage}catch(v){return}return{_driver:"localStorageWrapper",_initStorage:u,iterate:o,getItem:e,setItem:a,removeItem:l,clear:f,length:c,key:s,keys:h}}("undefined"!=typeof window?window:self);t["default"]=r;n.exports=t["default"]},function(n,t){"use strict";t.__esModule=!0;var i=function(n){function d(t,i){t=t||[];i=i||{};try{return new Blob(t,i)}catch(u){if("TypeError"!==u.name)throw u;for(var e=n.BlobBuilder||n.MSBlobBuilder||n.MozBlobBuilder||n.WebKitBlobBuilder,f=new e,r=0;r<t.length;r+=1)f.append(t[r]);return f.getBlob(i.type)}}function g(n,t){var o="",s,u,k;if(n&&(o=n.toString()),n&&("[object ArrayBuffer]"===n.toString()||n.buffer&&"[object ArrayBuffer]"===n.buffer.toString()))u=i,n instanceof ArrayBuffer?(s=n,u+=f):(s=n.buffer,"[object Int8Array]"===o?u+=h:"[object Uint8Array]"===o?u+=c:"[object Uint8ClampedArray]"===o?u+=l:"[object Int16Array]"===o?u+=a:"[object Uint16Array]"===o?u+=y:"[object Int32Array]"===o?u+=v:"[object Uint32Array]"===o?u+=p:"[object Float32Array]"===o?u+=w:"[object Float64Array]"===o?u+=b:t(new Error("Failed to get type for BinaryArray"))),t(u+r(s));else if("[object Blob]"===o)k=new FileReader,k.onload=function(){var u=tt+n.type+"~"+r(this.result);t(i+e+u)},k.readAsArrayBuffer(n);else try{t(JSON.stringify(n))}catch(d){console.error("Couldn't convert value into a JSON string: ",n);t(null,d)}}function nt(n){var tt,r,g,nt,t;if(n.substring(0,u)!==i)return JSON.parse(n);r=n.substring(k);g=n.substring(u,k);g===e&&s.test(r)&&(nt=r.match(s),tt=nt[1],r=r.substring(nt[0].length));t=o(r);switch(g){case f:return t;case e:return d([t],{type:tt});case h:return new Int8Array(t);case c:return new Uint8Array(t);case l:return new Uint8ClampedArray(t);case a:return new Int16Array(t);case y:return new Uint16Array(t);case v:return new Int32Array(t);case p:return new Uint32Array(t);case w:return new Float32Array(t);case b:return new Float64Array(t);default:throw new Error("Unkown type: "+g);}}function o(n){var i,h,u,f,c,e=.75*n.length,l=n.length,o=0,s,r;for("="===n[n.length-1]&&(e--,"="===n[n.length-2]&&e--),s=new ArrayBuffer(e),r=new Uint8Array(s),i=0;l>i;i+=4)h=t.indexOf(n[i]),u=t.indexOf(n[i+1]),f=t.indexOf(n[i+2]),c=t.indexOf(n[i+3]),r[o++]=h<<2|u>>4,r[o++]=(15&u)<<4|f>>2,r[o++]=(3&f)<<6|63&c;return s}function r(n){for(var u=new Uint8Array(n),i="",r=0;r<u.length;r+=3)i+=t[u[r]>>2],i+=t[(3&u[r])<<4|u[r+1]>>4],i+=t[(15&u[r+1])<<2|u[r+2]>>6],i+=t[63&u[r+2]];return u.length%3==2?i=i.substring(0,i.length-1)+"=":u.length%3==1&&(i=i.substring(0,i.length-2)+"=="),i}var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",tt="~~local_forage_type~",s=/^~~local_forage_type~([^~]+)~/,i="__lfsc__:",u=i.length,f="arbf",e="blob",h="si08",c="ui08",l="uic8",a="si16",v="si32",y="ur16",p="ui32",w="fl32",b="fl64",k=u+f.length;return{serialize:g,deserialize:nt,stringToBuffer:o,bufferToString:r}}("undefined"!=typeof window?window:self);t["default"]=i;n.exports=t["default"]},function(n,t,i){"use strict";t.__esModule=!0;var r=function(n){function u(n){var e=this,t={db:null},u,f;if(n)for(u in n)t[u]="string"!=typeof n[u]?n[u].toString():n[u];return f=new Promise(function(n,i){try{t.db=r(t.name,String(t.version),t.description,t.size)}catch(u){return i(u)}t.db.transaction(function(r){r.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],function(){e._dbInfo=t;n()},function(n,t){i(t)})})}),new Promise(function(n){n(i(3))}).then(function(n){return t.serializer=n,f})}function f(i,r){var f=this,u;return"string"!=typeof i&&(n.console.warn(i+" used as a key, but it is not a string."),i=String(i)),u=new Promise(function(n,t){f.ready().then(function(){var r=f._dbInfo;r.db.transaction(function(u){u.executeSql("SELECT * FROM "+r.storeName+" WHERE key = ? LIMIT 1",[i],function(t,i){var u=i.rows.length?i.rows.item(0).value:null;u&&(u=r.serializer.deserialize(u));n(u)},function(n,i){t(i)})})})["catch"](t)}),t(u,r),u}function e(n,i){var r=this,u=new Promise(function(t,i){r.ready().then(function(){var u=r._dbInfo;u.db.transaction(function(r){r.executeSql("SELECT * FROM "+u.storeName,[],function(i,r){for(var o,f,s=r.rows,h=s.length,e=0;h>e;e++)if(o=s.item(e),f=o.value,f&&(f=u.serializer.deserialize(f)),f=n(f,o.key,e+1),void 0!==f)return void t(f);t()},function(n,t){i(t)})})})["catch"](i)});return t(u,i),u}function o(i,r,u){var e=this,f;return"string"!=typeof i&&(n.console.warn(i+" used as a key, but it is not a string."),i=String(i)),f=new Promise(function(n,t){e.ready().then(function(){void 0===r&&(r=null);var f=r,u=e._dbInfo;u.serializer.serialize(r,function(r,e){e?t(e):u.db.transaction(function(e){e.executeSql("INSERT OR REPLACE INTO "+u.storeName+" (key, value) VALUES (?, ?)",[i,r],function(){n(f)},function(n,i){t(i)})},function(n){n.code===n.QUOTA_ERR&&t(n)})})})["catch"](t)}),t(f,u),f}function s(i,r){var f=this,u;return"string"!=typeof i&&(n.console.warn(i+" used as a key, but it is not a string."),i=String(i)),u=new Promise(function(n,t){f.ready().then(function(){var r=f._dbInfo;r.db.transaction(function(u){u.executeSql("DELETE FROM "+r.storeName+" WHERE key = ?",[i],function(){n()},function(n,i){t(i)})})})["catch"](t)}),t(u,r),u}function h(n){var i=this,r=new Promise(function(n,t){i.ready().then(function(){var r=i._dbInfo;r.db.transaction(function(i){i.executeSql("DELETE FROM "+r.storeName,[],function(){n()},function(n,i){t(i)})})})["catch"](t)});return t(r,n),r}function c(n){var i=this,r=new Promise(function(n,t){i.ready().then(function(){var r=i._dbInfo;r.db.transaction(function(i){i.executeSql("SELECT COUNT(key) as c FROM "+r.storeName,[],function(t,i){var r=i.rows.item(0).c;n(r)},function(n,i){t(i)})})})["catch"](t)});return t(r,n),r}function l(n,i){var r=this,u=new Promise(function(t,i){r.ready().then(function(){var u=r._dbInfo;u.db.transaction(function(r){r.executeSql("SELECT key FROM "+u.storeName+" WHERE id = ? LIMIT 1",[n+1],function(n,i){var r=i.rows.length?i.rows.item(0).key:null;t(r)},function(n,t){i(t)})})})["catch"](i)});return t(u,i),u}function a(n){var i=this,r=new Promise(function(n,t){i.ready().then(function(){var r=i._dbInfo;r.db.transaction(function(i){i.executeSql("SELECT key FROM "+r.storeName,[],function(t,i){for(var u=[],r=0;r<i.rows.length;r++)u.push(i.rows.item(r).key);n(u)},function(n,i){t(i)})})})["catch"](t)});return t(r,n),r}function t(n,t){t&&n.then(function(n){t(null,n)},function(n){t(n)})}var r=n.openDatabase;if(r)return{_driver:"webSQLStorage",_initStorage:u,iterate:e,getItem:f,setItem:o,removeItem:s,clear:h,length:c,key:l,keys:a}}("undefined"!=typeof window?window:self);t["default"]=r;n.exports=t["default"]}])})}catch(e){localForageInitFailed=!0}cr.plugins_.LocalStorage=function(n){this.runtime=n},function(){function s(n){return n?typeof n=="string"?n:typeof n.message=="string"?n.message:typeof n.name=="string"?n.name:typeof n.data=="string"?n.data:"unknown error":"unknown error"}function h(n,t){u=t;n.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,n)}function y(n){return r?n.substr(0,r.length)===r:!0}function w(n){return r?y(n)?n.substr(r.length):void 0:n}function n(){}function e(){}function c(){}var t="",i="",o=[],u="",r="",v=typeof is_scirra_arcade!="undefined",f,p,l,a;v&&(r="sa"+window.scirra_arcade_id+"_");f=cr.plugins_.LocalStorage.prototype;f.Type=function(n){this.plugin=n;this.runtime=n.runtime};p=f.Type.prototype;p.onCreate=function(){};f.Instance=function(n){this.type=n;this.runtime=n.runtime};l=f.Instance.prototype;l.onCreate=function(){this.pendingSets=0;this.pendingGets=0};l.onDestroy=function(){};l.saveToJSON=function(){return{}};l.loadFromJSON=function(){};a=!0;n.prototype.OnItemSet=function(n){return t===n};n.prototype.OnAnyItemSet=function(){return!0};n.prototype.OnItemGet=function(n){return t===n};n.prototype.OnAnyItemGet=function(){return!0};n.prototype.OnItemRemoved=function(n){return t===n};n.prototype.OnAnyItemRemoved=function(){return!0};n.prototype.OnCleared=function(){return!0};n.prototype.OnAllKeyNamesLoaded=function(){return!0};n.prototype.OnError=function(){return!0};n.prototype.OnItemExists=function(n){return t===n};n.prototype.OnItemMissing=function(n){return t===n};n.prototype.CompareKey=function(n,i){return cr.do_cmp(t,n,i)};n.prototype.CompareValue=function(n,t){return cr.do_cmp(i,n,t)};n.prototype.IsProcessingSets=function(){return this.pendingSets>0};n.prototype.IsProcessingGets=function(){return this.pendingGets>0};n.prototype.OnAllSetsComplete=function(){return!0};n.prototype.OnAllGetsComplete=function(){return!0};f.cnds=new n;e.prototype.SetItem=function(n,f){var o,e;if(localForageInitFailed){h(this,"storage failed to initialise - may be disabled in browser settings");return}o=r+n;this.pendingSets++;e=this;localforage.setItem(o,f,function(r,f){a=!0;e.pendingSets--;r?(u=s(r),e.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,e)):(t=n,i=f,e.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAnyItemSet,e),e.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnItemSet,e),t="",i="");e.pendingSets===0&&e.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAllSetsComplete,e)})};e.prototype.GetItem=function(n){var e,f;if(localForageInitFailed){h(this,"storage failed to initialise - may be disabled in browser settings");return}e=r+n;this.pendingGets++;f=this;localforage.getItem(e,function(r,e){f.pendingGets--;r?(u=s(r),f.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,f)):(t=n,i=e,(typeof i=="undefined"||i===null)&&(i=""),f.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAnyItemGet,f),f.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnItemGet,f),t="",i="");f.pendingGets===0&&f.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAllGetsComplete,f)})};e.prototype.CheckItemExists=function(n){if(localForageInitFailed){h(this,"storage failed to initialise - may be disabled in browser settings");return}var e=r+n,f=this;localforage.getItem(e,function(r,e){r?(u=s(r),f.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,f)):(t=n,e===null?(i="",f.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnItemMissing,f)):(i=e,f.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnItemExists,f)),t="",i="")})};e.prototype.RemoveItem=function(n){if(localForageInitFailed){h(this,"storage failed to initialise - may be disabled in browser settings");return}var e=r+n,f=this;localforage.removeItem(e,function(r){a=!0;r?(u=s(r),f.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,f)):(t=n,i="",f.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAnyItemRemoved,f),f.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnItemRemoved,f),t="")})};e.prototype.ClearStorage=function(){if(localForageInitFailed){h(this,"storage failed to initialise - may be disabled in browser settings");return}if(!v){var n=this;localforage.clear(function(r){a=!0;r?(u=s(r),n.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,n)):(t="",i="",cr.clearArray(o),n.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnCleared,n))})}};e.prototype.GetAllKeyNames=function(){if(localForageInitFailed){h(this,"storage failed to initialise - may be disabled in browser settings");return}var n=this;localforage.keys(function(t,i){var r,e,f;if(t)u=s(t),n.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,n);else{for(cr.clearArray(o),r=0,e=i.length;r<e;++r)(f=i[r],y(f))&&o.push(w(f));n.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAllKeyNamesLoaded,n)}})};f.acts=new e;c.prototype.ItemValue=function(n){n.set_any(i)};c.prototype.Key=function(n){n.set_string(t)};c.prototype.KeyCount=function(n){n.set_int(o.length)};c.prototype.KeyAt=function(n,t){if(t=Math.floor(t),t<0||t>=o.length){n.set_string("");return}n.set_string(o[t])};c.prototype.ErrorMessage=function(n){n.set_string(u)};f.exps=new c}();cr.plugins_.Rex_Hash=function(n){this.runtime=n},function(){function o(){}function n(){}function t(){}var u=cr.plugins_.Rex_Hash.prototype,c,i,h,l,f;u.Type=function(n){this.plugin=n;this.runtime=n.runtime};c=u.Type.prototype;c.onCreate=function(){};u.Instance=function(n){this.type=n;this.runtime=n.runtime};i=u.Instance.prototype;i.onCreate=function(){var n=this.properties[0];this.hashtable=n!=""?JSON.parse(n):{};this.currentEntry=this.hashtable;this.setIndent(this.properties[1]);this.exp_CurKey="";this.exp_CurValue=0;this.exp_Loopindex=0};i.cleanAll=function(){for(var n in this.hashtable)delete this.hashtable[n];this.currentEntry=this.hashtable};i.getEntry=function(n,t,i){var r=t||this.hashtable,u,e,f,o;if(n!==""&&n.length!==0)for(typeof n=="string"&&(n=n.split(".")),e=n.length,u=0;u<e;u++)f=n[u],(r[f]==null||typeof r[f]!="object")&&(o=u===e-1?i||{}:{},r[f]=o),r=r[f];return r};i.setCurrentEntry=function(n,t){this.currentEntry=this.getEntry(n,t)};i.setValue=function(n,t,i){if(n===""||n.length===0)t!==null&&typeof t=="object"&&(i==null?this.hashtable=t:i=t);else{i==null&&(i=this.hashtable);typeof n=="string"&&(n=n.split("."));var r=n.pop(),u=this.getEntry(n,i);u[r]=t}};i.getValue=function(n,t){if(t==null&&(t=this.hashtable),n==null||n===""||n.length===0)return t;typeof n=="string"&&(n=n.split("."));for(var f=n.length,u,r=t,i=0;i<f;i++)if(u=n[i],r.hasOwnProperty(u))r=r[u];else return;return r};i.removeKey=function(n){var u,i,t;if(n===""||n.length===0)this.cleanAll();else{if(typeof n=="string"&&(n=n.split(".")),u=this.getValue(n),u===undefined)return;if(i=n.pop(),t=this.getEntry(n),r(t)){if(i<0||i>=t.length)return;i===t.length-1?t.pop():i===0?t.shift():t.splice(i,1)}else delete t[i]}};i.setIndent=function(n){isNaN(n)?this.space=n:this.sapce=parseInt(n)};var s=function(n){if(n==null)return-1;if(typeof n=="number"||typeof n=="string")return 0;if(n.length!=null)return n.length;var i,t=0;for(i in n)t+=1;return t},e=function(n,t,i){return n===!0?1:n===!1?0:n==null?t!=null?t:0:typeof n=="object"?JSON.stringify(n,null,i):n},r=function(n){return n instanceof Array};i.saveToJSON=function(){return{d:this.hashtable}};i.loadFromJSON=function(n){this.hashtable=n.d};u.cnds=new o;o.prototype.ForEachItem=function(n){var i=this.getEntry(n),r=this.runtime.getCurrentEventStack(),t=r.current_event,u=r.isModifierAfterCnds(),n;this.exp_Loopindex=-1;for(n in i)u&&this.runtime.pushCopySol(t.solModifiers),this.exp_CurKey=n,this.exp_CurValue=i[n],this.exp_Loopindex++,t.retrigger(),u&&this.runtime.popSol(t.solModifiers);return this.exp_CurKey="",this.exp_CurValue=0,!1};o.prototype.KeyExists=function(n){if(n=="")return!1;var t=this.getValue(n);return t!==undefined};o.prototype.IsEmpty=function(n){var t=this.getEntry(n),i=s(t);return i<=0};u.acts=new n;n.prototype.SetValueByKeyString=function(n,t){n!==""&&this.setValue(n,t)};n.prototype.SetCurHashEntey=function(n){this.setCurrentEntry(n)};n.prototype.SetValueInCurHashEntey=function(n,t){n!==""&&this.setValue(n,t,this.currentEntry)};n.prototype.CleanAll=function(){this.cleanAll()};n.prototype.StringToHashTable=function(n){n!=""?this.hashtable=JSON.parse(n):this.cleanAll()};n.prototype.RemoveByKeyString=function(n){this.removeKey(n)};n.prototype.PickKeysToArray=function(n,t){var i,r,n;if(t){i=t.getFirstPicked();cr.plugins_.Arr.prototype.acts.SetSize.apply(i,[0,1,1]);r=this.getEntry(n);for(n in r)cr.plugins_.Arr.prototype.acts.Push.call(i,0,n,0)}};h=function(n,t){return n!==""&&(t=n+"."+t),t};n.prototype.MergeTwoHashTable=function(n,t){var c,f,e,o,l,s,i,a,u;if(n&&(c=n.getFirstPicked(),c!=null)){f=[];t===2&&(this.cleanAll(),t=0);switch(t){case 0:for(f.push({table:c.hashtable,key:""});f.length!==0;){e=f.shift();o=e.table;l=e.key;for(s in o)i=o[s],u=h(l,s),a=this.getValue(u),i===null||typeof i!="object"?this.setValue(u,i):(r(i)&&!r(a)&&this.setValue(u,[]),f.push({table:i,key:u}))}break;case 1:for(f.push({table:c.hashtable,key:""});f.length!==0;){e=f.shift();o=e.table;l=e.key;for(s in o)(i=o[s],u=h(l,s),a=this.getValue(u),a===undefined)&&(i==null||typeof i!="object"?this.setValue(u,i):(r(i)&&this.setValue(u,[]),f.push({table:i,key:u})))}}}};n.prototype.SetJSONByKeyString=function(n,t){t=JSON.parse(t);this.setValue(n,t)};n.prototype.AddToValueByKeyString=function(n,t){if(n!==""){n=n.split(".");var i=this.getValue(n)||0;this.setValue(n,i+t)}};l=function(n,t){var i=n.length,r,u,f;if(i!=0)while(--i)f=t==null?Math.random():t.random(),r=Math.floor(f*(i+1)),u=n[i],n[i]=n[r],n[r]=u};n.prototype.Shuffle=function(n){var t=this.getValue(n);r(t)&&l(t)};n.prototype.Sort=function(n,t,i){var f=this.getValue(n),u,e;r(f)&&(t=t===""?null:t.split("."),u=this,e=function(n,r){var f=t?u.getValue(t,n):n,e=t?u.getValue(t,r):r,o=i;i>=2&&(f=parseFloat(f),e=parseFloat(e),o-=2);switch(o){case 0:return f===e?0:f<e?1:-1;case 1:return f===e?0:f>e?1:-1}},f.sort(e))};n.prototype.PushJSON=function(t,i){i=JSON.parse(i);n.prototype.PushValue.call(this,t,i)};n.prototype.PushValue=function(n,t){var i=this.getEntry(n,null,[]);r(i)&&i.push(t)};n.prototype.InsertJSON=function(t,i,r){i=JSON.parse(i);n.prototype.InsertValue.call(this,t,i,r)};n.prototype.InsertValue=function(n,t,i){var u=this.getEntry(n,null,[]);r(u)&&u.splice(i,0,t)};n.prototype.SetIndent=function(n){this.setIndent(n)};u.exps=new t;t.prototype.Hash=function(n,t,i){t=t.split(".");var r=e(this.getValue(t),i,this.space);n.set_any(r)};t.prototype.At=t.prototype.Hash;f=[];t.prototype.AtKeys=function(n){var i,r,t,u;for(f.length=0,r=arguments.length,i=1;i<r;i++)t=arguments[i],typeof t=="string"&&t.indexOf(".")!==-1?f.push.apply(f,t.split(".")):f.push(t);u=e(this.getValue(f),null,this.space);f.length=0;n.set_any(u)};t.prototype.Entry=function(n,t){var i=e(this.currentEntry[t],null,this.space);n.set_any(i)};t.prototype.HashTableToString=function(n){var t=JSON.stringify(this.hashtable,null,this.space);n.set_string(t)};t.prototype.CurKey=function(n){n.set_string(this.exp_CurKey)};t.prototype.CurValue=function(n,t,i){var r=this.getValue(t,this.exp_CurValue);r=e(r,i,this.space);n.set_any(r)};t.prototype.ItemCnt=function(n,t){var i=s(this.getValue(t));n.set_int(i)};t.prototype.Keys2ItemCnt=function(n,t){var i=arguments.length>2?Array.prototype.slice.call(arguments,1):[t],r=s(this.getValue(i));n.set_int(r)};t.prototype.ToString=function(n){var i,t,r;if(arguments.length==1)i=this.hashtable;else for(r=arguments.length,i={},t=1;t<r;t=t+2)i[arguments[t]]=arguments[t+1];n.set_string(JSON.stringify(i,null,this.space))};t.prototype.AsJSON=t.prototype.HashTableToString;t.prototype.RandomKeyAt=function(n,t,i){var u,f=this.getValue(t),o,s;typeof f=="object"&&(o=r(f),o||(f=Object.keys(f)),s=f.length,s>0&&(u=Math.floor(Math.random()*s),o||(u=f[u])));u=e(u,i,this.space);n.set_any(u)};t.prototype.Loopindex=function(n){n.set_int(this.exp_Loopindex)};t.prototype.Pop=function(n,t,i){var r=this.getEntry(t),u;u=r==null?0:i==null||i===r.length-1?r.pop():r.splice(i,1);n.set_any(e(u,null,this.space))}}();cr.plugins_.Sprite=function(n){this.runtime=n},function(){function k(){var n,t;return this.datauri.length===0&&(n=document.createElement("canvas"),n.width=this.width,n.height=this.height,t=n.getContext("2d"),this.spritesheeted?t.drawImage(this.texture_img,this.offx,this.offy,this.width,this.height,0,0,this.width,this.height):t.drawImage(this.texture_img,0,0,this.width,this.height),this.datauri=n.toDataURL("image/png")),this.datauri}function t(){}function d(){return s.length?s.pop():[0,0,0]}function w(n){n[0]=0;n[1]=0;n[2]=0;s.push(n)}function a(n,t){return n<t?""+n+","+t:""+t+","+n}function g(n,t,i,r){var e=t.uid,o=i.uid,f=a(e,o),u;if(n.hasOwnProperty(f)){n[f][2]=r;return}u=d();u[0]=e;u[1]=o;u[2]=r;n[f]=u}function nt(n,t,i){var r=a(t.uid,i.uid);n.hasOwnProperty(r)&&(w(n[r]),delete n[r])}function tt(n,t){var u=t.uid,i,r;for(i in n)n.hasOwnProperty(i)&&(r=n[i],(r[0]===u||r[1]===u)&&(w(n[i]),delete n[i]))}function it(n,t,i){var r=a(t.uid,i.uid);return n.hasOwnProperty(r)?(h=n[r][2],!0):(h=-2,!1)}function b(n,t,i){if(!n)return!1;var s=t!==0||i!==0,h,c,a=!1,u,w,o,b=this.runtime.getCurrentCondition(),k=b.type,d=b.inverted,r=n.getCurrentSol(),g=this.runtime.getCurrentEventStack().current_event.orblock,f;for(r.select_all?(this.update_bbox(),p.copy(this.bbox),p.offset(t,i),this.runtime.getCollisionCandidates(this.layer,n,p,y),f=y):f=g?this.runtime.isCurrentConditionFirst()&&!r.else_instances.length&&r.instances.length?r.instances:r.else_instances:r.instances,e=n,v=k!==n&&!d,s&&(h=this.x,c=this.y,this.x+=t,this.y+=i,this.set_bbox_changed()),u=0,w=f.length;u<w;u++)if(o=f[u],this.runtime.testOverlap(this,o)){if(a=!0,d)break;k!==n&&l.add(o)}return s&&(this.x=h,this.y=c,this.set_bbox_changed()),cr.clearArray(y),a}function i(){}function r(){}var f=cr.plugins_.Sprite.prototype,u,o,n,s,h,c;f.Type=function(n){this.plugin=n;this.runtime=n.runtime};u=f.Type.prototype;u.onCreate=function(){if(!this.is_family){var f,s,e,h,r,t,i,n,o,u;for(this.all_frames=[],this.has_loaded_textures=!1,f=0,s=this.animations.length;f<s;f++){for(r=this.animations[f],i={},i.name=r[0],i.speed=r[1],i.loop=r[2],i.repeatcount=r[3],i.repeatto=r[4],i.pingpong=r[5],i.sid=r[6],i.frames=[],e=0,h=r[7].length;e<h;e++)t=r[7][e],n={},n.texture_file=t[0],n.texture_filesize=t[1],n.offx=t[2],n.offy=t[3],n.width=t[4],n.height=t[5],n.duration=t[6],n.hotspotX=t[7],n.hotspotY=t[8],n.image_points=t[9],n.poly_pts=t[10],n.pixelformat=t[11],n.spritesheeted=n.width!==0,n.datauri="",n.getDataUri=k,u={},u.left=0,u.top=0,u.right=1,u.bottom=1,n.sheetTex=u,n.webGL_texture=null,o=this.runtime.findWaitingTexture(t[0]),o?n.texture_img=o:(n.texture_img=new Image,n.texture_img.cr_src=t[0],n.texture_img.cr_filesize=t[1],n.texture_img.c2webGL_texture=null,this.runtime.waitForImageLoad(n.texture_img,t[0])),cr.seal(n),i.frames.push(n),this.all_frames.push(n);cr.seal(i);this.animations[f]=i}}};u.updateAllCurrentTexture=function(){for(var t,n=0,i=this.instances.length;n<i;n++)t=this.instances[n],t.curWebGLTexture=t.curFrame.webGL_texture};u.onLostWebGLContext=function(){if(!this.is_family){for(var t,n=0,i=this.all_frames.length;n<i;++n)t=this.all_frames[n],t.texture_img.c2webGL_texture=null,t.webGL_texture=null;this.has_loaded_textures=!1;this.updateAllCurrentTexture()}};u.onRestoreWebGLContext=function(){if(!this.is_family&&this.instances.length){for(var t,n=0,i=this.all_frames.length;n<i;++n)t=this.all_frames[n],t.webGL_texture=this.runtime.glwrap.loadTexture(t.texture_img,!1,this.runtime.linearSampling,t.pixelformat);this.updateAllCurrentTexture()}};u.loadTextures=function(){if(!this.is_family&&!this.has_loaded_textures&&this.runtime.glwrap){for(var t,n=0,i=this.all_frames.length;n<i;++n)t=this.all_frames[n],t.webGL_texture=this.runtime.glwrap.loadTexture(t.texture_img,!1,this.runtime.linearSampling,t.pixelformat);this.has_loaded_textures=!0}};u.unloadTextures=function(){if(!this.is_family&&!this.instances.length&&this.has_loaded_textures){for(var t,n=0,i=this.all_frames.length;n<i;++n)t=this.all_frames[n],this.runtime.glwrap.deleteTexture(t.webGL_texture),t.webGL_texture=null;this.has_loaded_textures=!1}};o=[];u.preloadCanvas2D=function(n){var t,r,i;for(cr.clearArray(o),t=0,r=this.all_frames.length;t<r;++t)(i=this.all_frames[t].texture_img,o.indexOf(i)===-1)&&(n.drawImage(i,0,0),o.push(i))};f.Instance=function(n){this.type=n;this.runtime=n.runtime;var t=this.type.animations[0].frames[0].poly_pts;this.recycled?this.collision_poly.set_pts(t):this.collision_poly=new cr.CollisionPoly(t)};n=f.Instance.prototype;n.onCreate=function(){var r,u,o,f,s,e,n,i,t;for(this.visible=this.properties[0]===0,this.isTicking=!1,this.inAnimTrigger=!1,this.collisionsEnabled=this.properties[3]!==0,this.cur_animation=this.getAnimationByName(this.properties[1])||this.type.animations[0],this.cur_frame=this.properties[2],this.cur_frame<0&&(this.cur_frame=0),this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1),r=this.cur_animation.frames[this.cur_frame],this.collision_poly.set_pts(r.poly_pts),this.hotspotX=r.hotspotX,this.hotspotY=r.hotspotY,this.cur_anim_speed=this.cur_animation.speed,this.cur_anim_repeatto=this.cur_animation.repeatto,this.type.animations.length===1&&this.type.animations[0].frames.length===1||this.cur_anim_speed===0||(this.runtime.tickMe(this),this.isTicking=!0),this.recycled?this.animTimer.reset():this.animTimer=new cr.KahanAdder,this.frameStart=this.getNowTime(),this.animPlaying=!0,this.animRepeats=0,this.animForwards=!0,this.animTriggerName="",this.changeAnimName="",this.changeAnimFrom=0,this.changeAnimFrame=-1,this.type.loadTextures(),u=0,o=this.type.animations.length;u<o;u++)for(e=this.type.animations[u],f=0,s=e.frames.length;f<s;f++)n=e.frames[f],n.width===0&&(n.width=n.texture_img.width,n.height=n.texture_img.height),n.spritesheeted&&(t=n.texture_img,i=n.sheetTex,i.left=n.offx/t.width,i.top=n.offy/t.height,i.right=(n.offx+n.width)/t.width,i.bottom=(n.offy+n.height)/t.height,n.offx===0&&n.offy===0&&n.width===t.width&&n.height===t.height&&(n.spritesheeted=!1));this.curFrame=this.cur_animation.frames[this.cur_frame];this.curWebGLTexture=this.curFrame.webGL_texture};n.saveToJSON=function(){var n={a:this.cur_animation.sid,f:this.cur_frame,cas:this.cur_anim_speed,fs:this.frameStart,ar:this.animRepeats,at:this.animTimer.sum,rt:this.cur_anim_repeatto};return this.animPlaying||(n.ap=this.animPlaying),this.animForwards||(n.af=this.animForwards),n};n.loadFromJSON=function(n){var t=this.getAnimationBySid(n.a);t&&(this.cur_animation=t);this.cur_frame=n.f;this.cur_frame<0&&(this.cur_frame=0);this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1);this.cur_anim_speed=n.cas;this.frameStart=n.fs;this.animRepeats=n.ar;this.animTimer.reset();this.animTimer.sum=n.at;this.animPlaying=n.hasOwnProperty("ap")?n.ap:!0;this.animForwards=n.hasOwnProperty("af")?n.af:!0;this.cur_anim_repeatto=n.hasOwnProperty("rt")?n.rt:this.cur_animation.repeatto;this.curFrame=this.cur_animation.frames[this.cur_frame];this.curWebGLTexture=this.curFrame.webGL_texture;this.collision_poly.set_pts(this.curFrame.poly_pts);this.hotspotX=this.curFrame.hotspotX;this.hotspotY=this.curFrame.hotspotY};n.animationFinish=function(n){this.cur_frame=n?0:this.cur_animation.frames.length-1;this.animPlaying=!1;this.animTriggerName=this.cur_animation.name;this.inAnimTrigger=!0;this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnAnyAnimFinished,this);this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnAnimFinished,this);this.inAnimTrigger=!1;this.animRepeats=0};n.getNowTime=function(){return this.animTimer.sum};n.tick=function(){this.animTimer.add(this.runtime.getDt(this));this.changeAnimName.length&&this.doChangeAnim();this.changeAnimFrame>=0&&this.doChangeAnimFrame();var t=this.getNowTime(),n=this.cur_animation,i=n.frames[this.cur_frame],r,u=i.duration/this.cur_anim_speed;this.animPlaying&&t>=this.frameStart+u&&(this.animForwards?this.cur_frame++:this.cur_frame--,this.frameStart+=u,this.cur_frame>=n.frames.length&&(n.pingpong?(this.animForwards=!1,this.cur_frame=n.frames.length-2):n.loop?this.cur_frame=this.cur_anim_repeatto:(this.animRepeats++,this.animRepeats>=n.repeatcount?this.animationFinish(!1):this.cur_frame=this.cur_anim_repeatto)),this.cur_frame<0&&(n.pingpong?(this.cur_frame=1,this.animForwards=!0,n.loop||(this.animRepeats++,this.animRepeats>=n.repeatcount&&this.animationFinish(!0))):n.loop?this.cur_frame=this.cur_anim_repeatto:(this.animRepeats++,this.animRepeats>=n.repeatcount?this.animationFinish(!0):this.cur_frame=this.cur_anim_repeatto)),this.cur_frame<0?this.cur_frame=0:this.cur_frame>=n.frames.length&&(this.cur_frame=n.frames.length-1),t>this.frameStart+n.frames[this.cur_frame].duration/this.cur_anim_speed&&(this.frameStart=t),r=n.frames[this.cur_frame],this.OnFrameChanged(i,r),this.runtime.redraw=!0)};n.getAnimationByName=function(n){for(var i,t=0,r=this.type.animations.length;t<r;t++)if(i=this.type.animations[t],cr.equals_nocase(i.name,n))return i;return null};n.getAnimationBySid=function(n){for(var i,t=0,r=this.type.animations.length;t<r;t++)if(i=this.type.animations[t],i.sid===n)return i;return null};n.doChangeAnim=function(){var t=this.cur_animation.frames[this.cur_frame],n=this.getAnimationByName(this.changeAnimName);(this.changeAnimName="",n)&&(cr.equals_nocase(n.name,this.cur_animation.name)&&this.animPlaying||(this.cur_animation=n,this.cur_anim_speed=n.speed,this.cur_anim_repeatto=n.repeatto,this.cur_frame<0&&(this.cur_frame=0),this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1),this.changeAnimFrom===1&&(this.cur_frame=0),this.animPlaying=!0,this.frameStart=this.getNowTime(),this.animForwards=!0,this.OnFrameChanged(t,this.cur_animation.frames[this.cur_frame]),this.runtime.redraw=!0))};n.doChangeAnimFrame=function(){var n=this.cur_animation.frames[this.cur_frame],t=this.cur_frame;this.cur_frame=cr.floor(this.changeAnimFrame);this.cur_frame<0&&(this.cur_frame=0);this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1);t!==this.cur_frame&&(this.OnFrameChanged(n,this.cur_animation.frames[this.cur_frame]),this.frameStart=this.getNowTime(),this.runtime.redraw=!0);this.changeAnimFrame=-1};n.OnFrameChanged=function(n,t){var u=n.width,f=n.height,e=t.width,o=t.height,i,s,r;for(u!=e&&(this.width*=e/u),f!=o&&(this.height*=o/f),this.hotspotX=t.hotspotX,this.hotspotY=t.hotspotY,this.collision_poly.set_pts(t.poly_pts),this.set_bbox_changed(),this.curFrame=t,this.curWebGLTexture=t.webGL_texture,i=0,s=this.behavior_insts.length;i<s;i++)if(r=this.behavior_insts[i],r.onSpriteFrameChanged)r.onSpriteFrameChanged(n,t);this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnFrameChanged,this)};n.draw=function(n){var o,s,h,c;n.globalAlpha=this.opacity;var t=this.curFrame,l=t.spritesheeted,e=t.texture_img,i=this.x,r=this.y,u=this.width,f=this.height;this.angle===0&&u>=0&&f>=0?(i-=this.hotspotX*u,r-=this.hotspotY*f,this.runtime.pixel_rounding&&(i=Math.round(i),r=Math.round(r)),l?n.drawImage(e,t.offx,t.offy,t.width,t.height,i,r,u,f):n.drawImage(e,i,r,u,f)):(this.runtime.pixel_rounding&&(i=Math.round(i),r=Math.round(r)),n.save(),o=u>0?1:-1,s=f>0?1:-1,n.translate(i,r),(o!==1||s!==1)&&n.scale(o,s),n.rotate(this.angle*o*s),h=0-this.hotspotX*cr.abs(u),c=0-this.hotspotY*cr.abs(f),l?n.drawImage(e,t.offx,t.offy,t.width,t.height,h,c,cr.abs(u),cr.abs(f)):n.drawImage(e,h,c,cr.abs(u),cr.abs(f)),n.restore())};n.drawGL_earlyZPass=function(n){this.drawGL(n)};n.drawGL=function(n){var u,t,i,r;n.setTexture(this.curWebGLTexture);n.setOpacity(this.opacity);u=this.curFrame;t=this.bquad;this.runtime.pixel_rounding?(i=Math.round(this.x)-this.x,r=Math.round(this.y)-this.y,u.spritesheeted?n.quadTex(t.tlx+i,t.tly+r,t.trx+i,t.try_+r,t.brx+i,t.bry+r,t.blx+i,t.bly+r,u.sheetTex):n.quad(t.tlx+i,t.tly+r,t.trx+i,t.try_+r,t.brx+i,t.bry+r,t.blx+i,t.bly+r)):u.spritesheeted?n.quadTex(t.tlx,t.tly,t.trx,t.try_,t.brx,t.bry,t.blx,t.bly,u.sheetTex):n.quad(t.tlx,t.tly,t.trx,t.try_,t.brx,t.bry,t.blx,t.bly)};n.getImagePointIndexByName=function(n){for(var i=this.curFrame,t=0,r=i.image_points.length;t<r;t++)if(cr.equals_nocase(n,i.image_points[t][0]))return t;return-1};n.getImagePoint=function(n,t){var f=this.curFrame,e=f.image_points,r,u,i;if(r=cr.is_string(n)?this.getImagePointIndexByName(n):n-1,r=cr.floor(r),r<0||r>=e.length)return t?this.x:this.y;u=(e[r][1]-f.hotspotX)*this.width;i=e[r][2];i=(i-f.hotspotY)*this.height;var o=Math.cos(this.angle),s=Math.sin(this.angle),h=u*o-i*s;return i=i*o+u*s,u=h,u+=this.x,i+=this.y,t?u:i};s=[];h=-2;c=[];t.prototype.OnCollision=function(n){if(!n)return!1;var r=this.runtime,u=r.getCurrentCondition(),o=u.type,e=null;u.extra.collmemory?e=u.extra.collmemory:(e={},u.extra.collmemory=e);u.extra.spriteCreatedDestroyCallback||(u.extra.spriteCreatedDestroyCallback=!0,r.addDestroyCallback(function(n){tt(u.extra.collmemory,n)}));for(var rt=o.getCurrentSol(),p=n.getCurrentSol(),w=rt.getObjects(),s,t,a,i,f,v,b=this.runtime.tickcount,ut=b-1,k,d,y=r.getCurrentEventStack().current_event,ft=y.orblock,l=0;l<w.length;l++){for(t=w[l],p.select_all?(t.update_bbox(),this.runtime.getCollisionCandidates(t.layer,n,t.bbox,c),s=c,this.runtime.addRegisteredCollisionCandidates(t,n,s)):s=p.getObjects(),a=0;a<s.length;a++)i=s[a],r.testOverlap(t,i)||r.checkRegisteredCollision(t,i)?(k=it(e,t,i),d=!k||h<ut,g(e,t,i,b),d&&(r.pushCopySol(y.solModifiers),f=o.getCurrentSol(),v=n.getCurrentSol(),f.select_all=!1,v.select_all=!1,o===n?(f.instances.length=2,f.instances[0]=t,f.instances[1]=i,o.applySolToContainer()):(f.instances.length=1,v.instances.length=1,f.instances[0]=t,v.instances[0]=i,o.applySolToContainer(),n.applySolToContainer()),y.retrigger(),r.popSol(y.solModifiers))):nt(e,t,i);cr.clearArray(c)}return!1};var e=null,l=new cr.ObjectSet,v=!1,y=[],p=new cr.rect(0,0,0,0);u.finish=function(n){var s;if(v){if(n){var o=this.runtime.getCurrentEventStack().current_event.orblock,i=e.getCurrentSol(),r=l.valuesRef(),t,u,f;if(i.select_all){for(i.select_all=!1,cr.clearArray(i.instances),t=0,u=r.length;t<u;++t)i.instances[t]=r[t];if(o)for(cr.clearArray(i.else_instances),t=0,u=e.instances.length;t<u;++t)f=e.instances[t],l.contains(f)||i.else_instances.push(f)}else if(o)for(s=i.instances.length,t=0,u=r.length;t<u;++t)i.instances[s+t]=r[t],cr.arrayFindRemove(i.else_instances,r[t]);else cr.shallowAssignArray(i.instances,r);e.applySolToContainer()}l.clear();v=!1}};t.prototype.IsOverlapping=function(n){return b.call(this,n,0,0)};t.prototype.IsOverlappingOffset=function(n,t,i){return b.call(this,n,t,i)};t.prototype.IsAnimPlaying=function(n){return this.changeAnimName.length?cr.equals_nocase(this.changeAnimName,n):cr.equals_nocase(this.cur_animation.name,n)};t.prototype.CompareFrame=function(n,t){return cr.do_cmp(this.cur_frame,n,t)};t.prototype.CompareAnimSpeed=function(n,t){var i=this.animForwards?this.cur_anim_speed:-this.cur_anim_speed;return cr.do_cmp(i,n,t)};t.prototype.OnAnimFinished=function(n){return cr.equals_nocase(this.animTriggerName,n)};t.prototype.OnAnyAnimFinished=function(){return!0};t.prototype.OnFrameChanged=function(){return!0};t.prototype.IsMirrored=function(){return this.width<0};t.prototype.IsFlipped=function(){return this.height<0};t.prototype.OnURLLoaded=function(){return!0};t.prototype.IsCollisionEnabled=function(){return this.collisionsEnabled};f.cnds=new t;i.prototype.Spawn=function(n,t,i){var r,f,o,e,s,h,u;if(n&&t&&(r=this.runtime.createInstance(n,t,this.getImagePoint(i,!0),this.getImagePoint(i,!1)),r)){if(typeof r.angle!="undefined"&&(r.angle=this.angle,r.set_bbox_changed()),this.runtime.isInOnDestroy++,this.runtime.trigger(Object.getPrototypeOf(n.plugin).cnds.OnCreated,r),r.is_contained)for(f=0,o=r.siblings.length;f<o;f++)e=r.siblings[f],this.runtime.trigger(Object.getPrototypeOf(e.type.plugin).cnds.OnCreated,e);if(this.runtime.isInOnDestroy--,s=this.runtime.getCurrentAction(),h=!1,(cr.is_undefined(s.extra.Spawn_LastExec)||s.extra.Spawn_LastExec<this.runtime.execcount)&&(h=!0,s.extra.Spawn_LastExec=this.runtime.execcount),n!=this.type&&(u=n.getCurrentSol(),u.select_all=!1,h?(cr.clearArray(u.instances),u.instances[0]=r):u.instances.push(r),r.is_contained))for(f=0,o=r.siblings.length;f<o;f++)e=r.siblings[f],u=e.type.getCurrentSol(),u.select_all=!1,h?(cr.clearArray(u.instances),u.instances[0]=e):u.instances.push(e)}};i.prototype.SetEffect=function(n){this.blend_mode=n;this.compositeOp=cr.effectToCompositeOp(n);cr.setGLBlend(this,n,this.runtime.gl);this.runtime.redraw=!0};i.prototype.StopAnim=function(){this.animPlaying=!1};i.prototype.StartAnim=function(n){this.animPlaying=!0;this.frameStart=this.getNowTime();n===1&&this.cur_frame!==0&&(this.changeAnimFrame=0,this.inAnimTrigger||this.doChangeAnimFrame());this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0)};i.prototype.SetAnim=function(n,t){this.changeAnimName=n;this.changeAnimFrom=t;this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0);this.inAnimTrigger||this.doChangeAnim()};i.prototype.SetAnimFrame=function(n){this.changeAnimFrame=n;this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0);this.inAnimTrigger||this.doChangeAnimFrame()};i.prototype.SetAnimSpeed=function(n){this.cur_anim_speed=cr.abs(n);this.animForwards=n>=0;this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0)};i.prototype.SetAnimRepeatToFrame=function(n){n=Math.floor(n);n<0&&(n=0);n>=this.cur_animation.frames.length&&(n=this.cur_animation.frames.length-1);this.cur_anim_repeatto=n};i.prototype.SetMirrored=function(n){var t=cr.abs(this.width)*(n===0?-1:1);this.width!==t&&(this.width=t,this.set_bbox_changed())};i.prototype.SetFlipped=function(n){var t=cr.abs(this.height)*(n===0?-1:1);this.height!==t&&(this.height=t,this.set_bbox_changed())};i.prototype.SetScale=function(n){var t=this.curFrame,u=this.width<0?-1:1,f=this.height<0?-1:1,i=t.width*n*u,r=t.height*n*f;(this.width!==i||this.height!==r)&&(this.width=i,this.height=r,this.set_bbox_changed())};i.prototype.LoadURL=function(n,t,i){var f=new Image,r=this,u=this.curFrame;f.onload=function(){if(u.texture_img.src===f.src){r.runtime.glwrap&&r.curFrame===u&&(r.curWebGLTexture=u.webGL_texture);t===0&&(r.width=f.width,r.height=f.height,r.set_bbox_changed());r.runtime.redraw=!0;r.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnURLLoaded,r);return}u.texture_img=f;u.offx=0;u.offy=0;u.width=f.width;u.height=f.height;u.spritesheeted=!1;u.datauri="";u.pixelformat=0;r.runtime.glwrap&&(u.webGL_texture&&r.runtime.glwrap.deleteTexture(u.webGL_texture),u.webGL_texture=r.runtime.glwrap.loadTexture(f,!1,r.runtime.linearSampling),r.curFrame===u&&(r.curWebGLTexture=u.webGL_texture),r.type.updateAllCurrentTexture());t===0&&(r.width=f.width,r.height=f.height,r.set_bbox_changed());r.runtime.redraw=!0;r.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnURLLoaded,r)};n.substr(0,5)!=="data:"&&i===0&&(f.crossOrigin="anonymous");this.runtime.setImageSrc(f,n)};i.prototype.SetCollisions=function(n){this.collisionsEnabled!==(n!==0)&&(this.collisionsEnabled=n!==0,this.collisionsEnabled?this.set_bbox_changed():(this.collcells.right>=this.collcells.left&&this.type.collision_grid.update(this,this.collcells,null),this.collcells.set(0,0,-1,-1)))};f.acts=new i;r.prototype.AnimationFrame=function(n){n.set_int(this.cur_frame)};r.prototype.AnimationFrameCount=function(n){n.set_int(this.cur_animation.frames.length)};r.prototype.AnimationName=function(n){n.set_string(this.cur_animation.name)};r.prototype.AnimationSpeed=function(n){n.set_float(this.animForwards?this.cur_anim_speed:-this.cur_anim_speed)};r.prototype.ImagePointX=function(n,t){n.set_float(this.getImagePoint(t,!0))};r.prototype.ImagePointY=function(n,t){n.set_float(this.getImagePoint(t,!1))};r.prototype.ImagePointCount=function(n){n.set_int(this.curFrame.image_points.length)};r.prototype.ImageWidth=function(n){n.set_float(this.curFrame.width)};r.prototype.ImageHeight=function(n){n.set_float(this.curFrame.height)};f.exps=new r}();jText="";cr.plugins_.SpriteFontPlus=function(n){this.runtime=n},function(){function v(n){return n.replace(/\s\s*$/,"")}function o(n,t){return n.length?n.pop():new t}function y(n,t){n.length<b&&n.push(t)}function p(n,t,i){var r,f,u;if(i){for(r=0,f=t.length;r<f;r++)y(n,t[r]);t.length=0}else for(u in t)Object.prototype.hasOwnProperty.call(t,u)&&(y(n,t[u]),delete t[u])}function s(n,t,i){var u=n.lines,r;i=v(i);t>=u.length&&u.push(k());r=u[t];r.text=i;r.width=n.measureWidth(i);n.textWidth=cr.max(n.textWidth,r.width)}function k(){return o(h,Object)}function g(n){y(h,n)}function c(n){p(h,n,!0)}function nt(n,t,i,r,u,f){n[t]===undefined&&(n[t]=o(l,Object));n[t].x=i;n[t].y=r;n[t].w=u;n[t].h=f}function tt(n){p(l,n,!1)}function it(n,t,i,r,u,f){n[t]===undefined&&(n[t]=o(a,cr.rect));n[t].left=i;n[t].top=r;n[t].right=u;n[t].bottom=f}function rt(n){p(a,n,!1)}function ut(n,t,i){var r;r=n.tlx*t-n.tly*i;n.tly=n.tly*t+n.tlx*i;n.tlx=r;r=n.trx*t-n.try_*i;n.try_=n.try_*t+n.trx*i;n.trx=r;r=n.blx*t-n.bly*i;n.bly=n.bly*t+n.blx*i;n.blx=r;r=n.brx*t-n.bry*i;n.bry=n.bry*t+n.brx*i;n.brx=r}function d(){}function u(){}function r(){}var i=cr.plugins_.SpriteFontPlus.prototype,e,t,b,h,l,a,f,w,n;i.onCreate=function(){};i.Type=function(n){this.plugin=n;this.runtime=n.runtime};e=i.Type.prototype;e.onCreate=function(){this.is_family||(this.texture_img=new Image,this.texture_img.idtkLoadDisposed=!0,this.texture_img.src=this.texture_file,this.runtime.wait_for_textures.push(this.texture_img),this.webGL_texture=null)};e.onLostWebGLContext=function(){this.is_family||(this.webGL_texture=null)};e.onRestoreWebGLContext=function(){if(!this.is_family&&this.instances.length){this.webGL_texture||(this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,!1,this.runtime.linearSampling,this.texture_pixelformat));for(var n=0,t=this.instances.length;n<t;n++)this.instances[n].webGL_texture=this.webGL_texture}};e.unloadTextures=function(){this.is_family||this.instances.length||!this.webGL_texture||(this.runtime.glwrap.deleteTexture(this.webGL_texture),this.webGL_texture=null)};e.preloadCanvas2D=function(n){n.drawImage(this.texture_img,0,0)};i.Instance=function(n){this.type=n;this.runtime=n.runtime};t=i.Instance.prototype;t.onDestroy=function(){c(this.lines);tt(this.clipList);rt(this.clipUV);cr.wipe(this.characterWidthList)};t.onCreate=function(){var t,u,n,r,f,i;this.texture_img=this.type.texture_img;this.characterWidth=this.properties[0];this.characterHeight=this.properties[1];this.characterSet=this.properties[2];this.text=this.properties[3];this.characterScale=this.properties[4];this.visible=this.properties[5]===0;this.halign=this.properties[6]/2;this.valign=this.properties[7]/2;this.wrapbyword=this.properties[9]===0;this.characterSpacing=this.properties[10];this.lineHeight=this.properties[11];this.textWidth=0;this.textHeight=0;this.charWidthJSON=this.properties[12];this.spaceWidth=this.properties[13];console.log(this.charWidthJSON);jText=this.charWidthJSON;this.recycled?(this.lines.length=0,cr.wipe(this.clipList),cr.wipe(this.clipUV),cr.wipe(this.characterWidthList)):(this.lines=[],this.clipList={},this.clipUV={},this.characterWidthList={});try{if(this.charWidthJSON)if(this.charWidthJSON.indexOf('""c2array""')!==-1)for(t=jQuery.parseJSON(this.charWidthJSON.replace(/""/g,'"')),u=t.size[1],n=0;n<u;n++)for(r=t.data[1][n][0],f=t.data[0][n][0],i=0;i<r.length;i++)this.characterWidthList[r.charAt(i)]=f;else for(t=jQuery.parseJSON(this.charWidthJSON),u=t.length,n=0;n<u;n++)for(r=t[n][1],f=t[n][0],i=0;i<r.length;i++)this.characterWidthList[r.charAt(i)]=f;this.spaceWidth!==-1&&(this.characterWidthList[" "]=this.spaceWidth)}catch(e){window.console&&window.console.log&&window.console.log("SpriteFont+ Failure: "+e)}this.text_changed=!0;this.lastwrapwidth=this.width;this.runtime.glwrap&&(this.type.webGL_texture||(this.type.webGL_texture=this.runtime.glwrap.loadTexture(this.type.texture_img,!1,this.runtime.linearSampling,this.type.texture_pixelformat)),this.webGL_texture=this.type.webGL_texture);this.SplitSheet()};t.saveToJSON=function(){var n={t:this.text,csc:this.characterScale,csp:this.characterSpacing,lh:this.lineHeight,tw:this.textWidth,th:this.textHeight,lrt:this.last_render_tick,cw:{}};for(var t in this.characterWidthList)n.cw[t]=this.characterWidthList[t];return n};t.loadFromJSON=function(n){this.text=n.t;this.characterScale=n.csc;this.characterSpacing=n.csp;this.lineHeight=n.lh;this.textWidth=n.tw;this.textHeight=n.th;this.last_render_tick=n.lrt;for(var t in n.cw)this.characterWidthList[t]=n.cw[t];this.text_changed=!0;this.lastwrapwidth=this.width};b=1e3;h=[];l=[];a=[];t.SplitSheet=function(){for(var e=this.texture_img,o=e.width,s=e.height,t=this.characterWidth,i=this.characterHeight,h=t/o,c=i/s,l=this.characterSet,r=Math.floor(o/t),v=Math.floor(s/i),n=0;n<l.length;n++){if(n>=r*v)break;var u=n%r,f=Math.floor(n/r),a=l.charAt(n);this.runtime.glwrap?it(this.clipUV,a,u*h,f*c,(u+1)*h,(f+1)*c):nt(this.clipList,a,u*t,f*i,t,i)}};f=[];i.TokeniseWords=function(n){f.length=0;for(var i="",r,t=0;t<n.length;)if(r=n.charAt(t),r==="\n")i.length&&(f.push(i),i=""),f.push("\n"),++t;else if(r===" "||r==="\t"||r==="-"){do i+=n.charAt(t),t++;while(t<n.length&&(n.charAt(t)===" "||n.charAt(t)==="\t"));f.push(i);i=""}else t<n.length&&(i+=r,t++);i.length&&f.push(i)};i.WordWrap=function(n){var i=n.text,t=n.lines,r,u,s;if(!i||!i.length){c(t);return}if(r=n.width,r<=2){c(t);return}var o=n.characterWidth,f=n.characterScale,e=n.characterSpacing;if(i.length*(o*f+e)-e<=r&&i.indexOf("\n")===-1&&(u=n.measureWidth(i),u<=r)){c(t);t.push(k());t[0].text=i;t[0].width=u;n.textWidth=u;n.textHeight=n.characterHeight*f+n.lineHeight;return}s=n.wrapbyword;this.WrapText(n);n.textHeight=t.length*(n.characterHeight*f+n.lineHeight)};i.WrapText=function(n){var c=n.wrapbyword,l=n.text,o=n.lines,y=n.width,u;c?(this.TokeniseWords(l),u=f):u=l;for(var t="",h,a,r=0,e=!1,i=0;i<u.length;i++){if(u[i]==="\n"){e===!0?e=!1:(s(n,r,t),r++);t="";continue}e=!1;h=t;t+=u[i];a=n.measureWidth(v(t));a>y&&(h===""?(s(n,r,t),t="",e=!0):(s(n,r,h),t=u[i]),r++,c||t!==" "||(t=""))}for(v(t).length&&(s(n,r,t),r++),i=r;i<o.length;i++)g(o[i]);o.length=r};t.measureWidth=function(n){for(var r=this.characterSpacing,u=n.length,t=0,i=0;i<u;i++)t+=this.getCharacterWidth(n.charAt(i))*this.characterScale+r;return t-(t>0?r:0)};t.getCharacterWidth=function(n){var t=this.characterWidthList;return t[n]!==undefined?t[n]:this.characterWidth};t.rebuildText=function(){(this.text_changed||this.width!==this.lastwrapwidth)&&(this.textWidth=0,this.textHeight=0,this.type.plugin.WordWrap(this),this.text_changed=!1,this.lastwrapwidth=this.width)};w=1e-5;t.draw=function(n){var k=this.texture_img,f,e,o,r,u,l,b,s,h,t;if(this.text!==""&&k!=null){if(this.rebuildText(),this.height<this.characterHeight*this.characterScale+this.lineHeight)return;n.globalAlpha=this.opacity;f=this.x;e=this.y;this.runtime.pixel_rounding&&(f=f+.5|0,e=e+.5|0);n.save();n.translate(f,e);n.rotate(this.angle);var d=this.halign,g=this.valign,i=this.characterScale,a=this.characterHeight*i,v=this.lineHeight,nt=this.characterSpacing,c=this.lines,tt=this.textHeight,y,it=g*cr.max(0,this.height-tt),rt=-(this.hotspotX*this.width),p=-(this.hotspotY*this.height);for(p+=it,r=p,u=0;u<c.length;u++){for(l=c[u].text,b=c[u].width,y=d*cr.max(0,this.width-b),o=rt+y,r+=v,s=0;s<l.length;s++){if(h=l.charAt(s),t=this.clipList[h],o+this.getCharacterWidth(h)*i>this.width+w)break;t!==undefined&&n.drawImage(this.texture_img,t.x,t.y,t.w,t.h,Math.round(o),Math.round(r),t.w*i,t.h*i);o+=this.getCharacterWidth(h)*i+nt}if(r+=a,r+a+v>this.height)break}n.restore()}};n=new cr.quad;t.drawGL=function(t){var f,c,it,o,s,l,a,v;if(t.setTexture(this.webGL_texture),t.setOpacity(this.opacity),this.text!==""){if(this.rebuildText(),this.height<this.characterHeight*this.characterScale+this.lineHeight)return;this.update_bbox();var y=this.bquad,p=0,b=0;this.runtime.pixel_rounding&&(p=(this.x+.5|0)-this.x,b=(this.y+.5|0)-this.y);var e=this.angle,rt=this.halign,ft=this.valign,u=this.characterScale,k=this.characterHeight*u,d=this.lineHeight,et=this.characterSpacing,h=this.lines,ot=this.textHeight,g,nt;e!==0&&(g=Math.cos(e),nt=Math.sin(e));var tt,st=ft*cr.max(0,this.height-ot),ht=y.tlx+p,ct=y.tly+b,i,r=st;for(f=0;f<h.length;f++){for(c=h[f].text,it=h[f].width,tt=rt*cr.max(0,this.width-it),i=tt,r+=d,o=0;o<c.length;o++){if(s=c.charAt(o),l=this.clipUV[s],i+this.getCharacterWidth(s)*u>this.width+w)break;l!==undefined&&(a=this.characterWidth*u,v=this.characterHeight*u,n.tlx=i,n.tly=r,n.trx=i+a,n.try_=r,n.blx=i,n.bly=r+v,n.brx=i+a,n.bry=r+v,e!==0&&ut(n,g,nt),n.offset(ht,ct),t.quadTex(n.tlx,n.tly,n.trx,n.try_,n.brx,n.bry,n.blx,n.bly,l));i+=this.getCharacterWidth(s)*u+et}if(r+=k,r+k+d>this.height)break}}};d.prototype.CompareText=function(n,t){return t?this.text==n:cr.equals_nocase(this.text,n)};i.cnds=new d;u.prototype.SetText=function(n){cr.is_number(n)&&n<1e9&&(n=Math.round(n*1e10)/1e10);var t=n.toString();this.text!==t&&(this.text=t,this.text_changed=!0,this.runtime.redraw=!0)};u.prototype.AppendText=function(n){cr.is_number(n)&&(n=Math.round(n*1e10)/1e10);var t=n.toString();t&&(this.text+=t,this.text_changed=!0,this.runtime.redraw=!0)};u.prototype.SetScale=function(n){n!==this.characterScale&&(this.characterScale=n,this.text_changed=!0,this.runtime.redraw=!0)};u.prototype.SetCharacterSpacing=function(n){n!==this.CharacterSpacing&&(this.characterSpacing=n,this.text_changed=!0,this.runtime.redraw=!0)};u.prototype.SetLineHeight=function(n){n!==this.lineHeight&&(this.lineHeight=n,this.text_changed=!0,this.runtime.redraw=!0)};t.SetCharWidth=function(n,t){var i=parseInt(t,10);this.characterWidthList[n]!==i&&(this.characterWidthList[n]=i,this.text_changed=!0,this.runtime.redraw=!0)};u.prototype.SetCharacterWidth=function(n,t){if(n!=="")for(var i=0;i<n.length;i++)this.SetCharWidth(n.charAt(i),t)};u.prototype.SetEffect=function(n){this.compositeOp=cr.effectToCompositeOp(n);cr.setGLBlend(this,n,this.runtime.gl);this.runtime.redraw=!0};i.acts=new u;r.prototype.CharacterWidth=function(n,t){n.set_int(this.getCharacterWidth(t))};r.prototype.CharacterHeight=function(n){n.set_int(this.characterHeight)};r.prototype.CharacterScale=function(n){n.set_float(this.characterScale)};r.prototype.CharacterSpacing=function(n){n.set_int(this.characterSpacing)};r.prototype.LineHeight=function(n){n.set_int(this.lineHeight)};r.prototype.Text=function(n){n.set_string(this.text)};r.prototype.TextWidth=function(n){this.rebuildText();n.set_float(this.textWidth)};r.prototype.TextHeight=function(n){this.rebuildText();n.set_float(this.textHeight)};i.exps=new r}();cr.plugins_.Spritefont2=function(n){this.runtime=n},function(){function v(n){return n.replace(/\s\s*$/,"")}function o(n,t){return n.length?n.pop():new t}function y(n,t){n.length<b&&n.push(t)}function p(n,t,i){var r,f,u;if(i){for(r=0,f=t.length;r<f;r++)y(n,t[r]);cr.clearArray(t)}else for(u in t)Object.prototype.hasOwnProperty.call(t,u)&&(y(n,t[u]),delete t[u])}function s(n,t,i){var u=n.lines,r;i=v(i);t>=u.length&&u.push(k());r=u[t];r.text=i;r.width=n.measureWidth(i);n.textWidth=cr.max(n.textWidth,r.width)}function k(){return o(h,Object)}function g(n){y(h,n)}function c(n){p(h,n,!0)}function nt(n,t,i,r,u,f){n[t]===undefined&&(n[t]=o(l,Object));n[t].x=i;n[t].y=r;n[t].w=u;n[t].h=f}function tt(n){p(l,n,!1)}function it(n,t,i,r,u,f){n[t]===undefined&&(n[t]=o(a,cr.rect));n[t].left=i;n[t].top=r;n[t].right=u;n[t].bottom=f}function rt(n){p(a,n,!1)}function ut(n,t,i){var r;r=n.tlx*t-n.tly*i;n.tly=n.tly*t+n.tlx*i;n.tlx=r;r=n.trx*t-n.try_*i;n.try_=n.try_*t+n.trx*i;n.trx=r;r=n.blx*t-n.bly*i;n.bly=n.bly*t+n.blx*i;n.blx=r;r=n.brx*t-n.bry*i;n.bry=n.bry*t+n.brx*i;n.brx=r}function d(){}function r(){}function u(){}var i=cr.plugins_.Spritefont2.prototype,e,t,b,h,l,a,f,w,n;i.onCreate=function(){};i.Type=function(n){this.plugin=n;this.runtime=n.runtime};e=i.Type.prototype;e.onCreate=function(){this.is_family||(this.texture_img=new Image,this.runtime.waitForImageLoad(this.texture_img,this.texture_file),this.webGL_texture=null)};e.onLostWebGLContext=function(){this.is_family||(this.webGL_texture=null)};e.onRestoreWebGLContext=function(){if(!this.is_family&&this.instances.length){this.webGL_texture||(this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,!1,this.runtime.linearSampling,this.texture_pixelformat));for(var n=0,t=this.instances.length;n<t;n++)this.instances[n].webGL_texture=this.webGL_texture}};e.unloadTextures=function(){this.is_family||this.instances.length||!this.webGL_texture||(this.runtime.glwrap.deleteTexture(this.webGL_texture),this.webGL_texture=null)};e.preloadCanvas2D=function(n){n.drawImage(this.texture_img,0,0)};i.Instance=function(n){this.type=n;this.runtime=n.runtime};t=i.Instance.prototype;t.onDestroy=function(){c(this.lines);tt(this.clipList);rt(this.clipUV);cr.wipe(this.characterWidthList)};t.onCreate=function(){this.texture_img=this.type.texture_img;this.characterWidth=this.properties[0];this.characterHeight=this.properties[1];this.characterSet=this.properties[2];this.text=this.properties[3];this.characterScale=this.properties[4];this.visible=this.properties[5]===0;this.halign=this.properties[6]/2;this.valign=this.properties[7]/2;this.wrapbyword=this.properties[9]===0;this.characterSpacing=this.properties[10];this.lineHeight=this.properties[11];this.textWidth=0;this.textHeight=0;this.recycled?(cr.clearArray(this.lines),cr.wipe(this.clipList),cr.wipe(this.clipUV),cr.wipe(this.characterWidthList)):(this.lines=[],this.clipList={},this.clipUV={},this.characterWidthList={});this.text_changed=!0;this.lastwrapwidth=this.width;this.runtime.glwrap&&(this.type.webGL_texture||(this.type.webGL_texture=this.runtime.glwrap.loadTexture(this.type.texture_img,!1,this.runtime.linearSampling,this.type.texture_pixelformat)),this.webGL_texture=this.type.webGL_texture);this.SplitSheet()};t.saveToJSON=function(){var n={t:this.text,csc:this.characterScale,csp:this.characterSpacing,lh:this.lineHeight,tw:this.textWidth,th:this.textHeight,lrt:this.last_render_tick,ha:this.halign,va:this.valign,cw:{}};for(var t in this.characterWidthList)n.cw[t]=this.characterWidthList[t];return n};t.loadFromJSON=function(n){this.text=n.t;this.characterScale=n.csc;this.characterSpacing=n.csp;this.lineHeight=n.lh;this.textWidth=n.tw;this.textHeight=n.th;this.last_render_tick=n.lrt;n.hasOwnProperty("ha")&&(this.halign=n.ha);n.hasOwnProperty("va")&&(this.valign=n.va);for(var t in n.cw)this.characterWidthList[t]=n.cw[t];this.text_changed=!0;this.lastwrapwidth=this.width};b=1e3;h=[];l=[];a=[];t.SplitSheet=function(){for(var e=this.texture_img,o=e.width,s=e.height,t=this.characterWidth,i=this.characterHeight,h=t/o,c=i/s,l=this.characterSet,r=Math.floor(o/t),v=Math.floor(s/i),n=0;n<l.length;n++){if(n>=r*v)break;var u=n%r,f=Math.floor(n/r),a=l.charAt(n);this.runtime.glwrap?it(this.clipUV,a,u*h,f*c,(u+1)*h,(f+1)*c):nt(this.clipList,a,u*t,f*i,t,i)}};f=[];i.TokeniseWords=function(n){cr.clearArray(f);for(var i="",r,t=0;t<n.length;)if(r=n.charAt(t),r==="\n")i.length&&(f.push(i),i=""),f.push("\n"),++t;else if(r===" "||r==="\t"||r==="-"){do i+=n.charAt(t),t++;while(t<n.length&&(n.charAt(t)===" "||n.charAt(t)==="\t"));f.push(i);i=""}else t<n.length&&(i+=r,t++);i.length&&f.push(i)};i.WordWrap=function(n){var i=n.text,t=n.lines,r,u,s;if(!i||!i.length){c(t);return}if(r=n.width,r<=2){c(t);return}var o=n.characterWidth,f=n.characterScale,e=n.characterSpacing;if(i.length*(o*f+e)-e<=r&&i.indexOf("\n")===-1&&(u=n.measureWidth(i),u<=r)){c(t);t.push(k());t[0].text=i;t[0].width=u;n.textWidth=u;n.textHeight=n.characterHeight*f+n.lineHeight;return}s=n.wrapbyword;this.WrapText(n);n.textHeight=t.length*(n.characterHeight*f+n.lineHeight)};i.WrapText=function(n){var c=n.wrapbyword,l=n.text,o=n.lines,y=n.width,u;c?(this.TokeniseWords(l),u=f):u=l;for(var t="",h,a,r=0,e=!1,i=0;i<u.length;i++){if(u[i]==="\n"){e===!0?e=!1:(s(n,r,t),r++);t="";continue}e=!1;h=t;t+=u[i];a=n.measureWidth(v(t));a>y&&(h===""?(s(n,r,t),t="",e=!0):(s(n,r,h),t=u[i]),r++,c||t!==" "||(t=""))}for(v(t).length&&(s(n,r,t),r++),i=r;i<o.length;i++)g(o[i]);o.length=r};t.measureWidth=function(n){for(var r=this.characterSpacing,u=n.length,t=0,i=0;i<u;i++)t+=this.getCharacterWidth(n.charAt(i))*this.characterScale+r;return t-(t>0?r:0)};t.getCharacterWidth=function(n){var t=this.characterWidthList;return t[n]!==undefined?t[n]:this.characterWidth};t.rebuildText=function(){(this.text_changed||this.width!==this.lastwrapwidth)&&(this.textWidth=0,this.textHeight=0,this.type.plugin.WordWrap(this),this.text_changed=!1,this.lastwrapwidth=this.width)};w=1e-5;t.draw=function(n){var it=this.texture_img,f,e,u,i,l,a,h,b,tt,v,k,r;if(this.text!==""&&it!=null){if(this.rebuildText(),this.height<this.characterHeight*this.characterScale+this.lineHeight)return;n.globalAlpha=this.opacity;f=this.x;e=this.y;this.runtime.pixel_rounding&&(f=Math.round(f),e=Math.round(e));var rt=this.layer.viewLeft,ut=this.layer.viewTop,ft=this.layer.viewRight,et=this.layer.viewBottom;n.save();n.translate(f,e);n.rotate(this.angle);var o=this.angle,ot=this.halign,st=this.valign,t=this.characterScale,c=this.characterHeight*t,d=this.lineHeight,y=this.characterSpacing,p=this.lines,ht=this.textHeight,s,g,ct=st*cr.max(0,this.height-ht),lt=-(this.hotspotX*this.width),nt=-(this.hotspotY*this.height);for(nt+=ct,i=nt,h=0;h<p.length;h++){if(b=p[h].text,tt=p[h].width,g=ot*cr.max(0,this.width-tt),u=lt+g,i+=d,o===0&&e+i+c<ut){i+=c;continue}for(v=0;v<b.length;v++){if(k=b.charAt(v),s=this.getCharacterWidth(k),r=this.clipList[k],o===0&&f+u+s*t+y<rt){u+=s*t+y;continue}if(u+s*t>this.width+w)break;if(r!==undefined&&(l=u,a=i,o===0&&t===1&&(l=Math.round(l),a=Math.round(a)),n.drawImage(this.texture_img,r.x,r.y,r.w,r.h,l,a,r.w*t,r.h*t)),u+=s*t+y,o===0&&f+u>ft)break}if(i+=c,o===0&&(i+c+d>this.height||e+i>et))break}n.restore()}};n=new cr.quad;t.drawGL=function(t){var h,b,ht,l,k,d,g,nt;if((t.setTexture(this.webGL_texture),t.setOpacity(this.opacity),this.text)&&(this.rebuildText(),!(this.height<this.characterHeight*this.characterScale+this.lineHeight))){this.update_bbox();var tt=this.bquad,it=0,rt=0;this.runtime.pixel_rounding&&(it=Math.round(this.x)-this.x,rt=Math.round(this.y)-this.y);var ct=this.layer.viewLeft,lt=this.layer.viewTop,at=this.layer.viewRight,vt=this.layer.viewBottom,i=this.angle,yt=this.halign,pt=this.valign,r=this.characterScale,c=this.characterHeight*r,ft=this.lineHeight,a=this.characterSpacing,v=this.lines,wt=this.textHeight,s,et,ot;i!==0&&(et=Math.cos(i),ot=Math.sin(i));var st,bt=pt*cr.max(0,this.height-wt),y=tt.tlx+it,p=tt.tly+rt,u,f=bt,e,o;for(h=0;h<v.length;h++){if(b=v[h].text,ht=v[h].width,st=yt*cr.max(0,this.width-ht),u=st,f+=ft,i===0&&p+f+c<lt){f+=c;continue}for(l=0;l<b.length;l++){if(k=b.charAt(l),s=this.getCharacterWidth(k),d=this.clipUV[k],i===0&&y+u+s*r+a<ct){u+=s*r+a;continue}if(u+s*r>this.width+w)break;if(d!==undefined&&(g=this.characterWidth*r,nt=this.characterHeight*r,e=u,o=f,i===0&&r===1&&(e=Math.round(e),o=Math.round(o)),n.tlx=e,n.tly=o,n.trx=e+g,n.try_=o,n.blx=e,n.bly=o+nt,n.brx=e+g,n.bry=o+nt,i!==0&&ut(n,et,ot),n.offset(y,p),t.quadTex(n.tlx,n.tly,n.trx,n.try_,n.brx,n.bry,n.blx,n.bly,d)),u+=s*r+a,i===0&&y+u>at)break}if(f+=c,i===0&&(f+c+ft>this.height||p+f>vt))break}}};d.prototype.CompareText=function(n,t){return t?this.text==n:cr.equals_nocase(this.text,n)};i.cnds=new d;r.prototype.SetText=function(n){cr.is_number(n)&&n<1e9&&(n=Math.round(n*1e10)/1e10);var t=n.toString();this.text!==t&&(this.text=t,this.text_changed=!0,this.runtime.redraw=!0)};r.prototype.AppendText=function(n){cr.is_number(n)&&(n=Math.round(n*1e10)/1e10);var t=n.toString();t&&(this.text+=t,this.text_changed=!0,this.runtime.redraw=!0)};r.prototype.SetScale=function(n){n!==this.characterScale&&(this.characterScale=n,this.text_changed=!0,this.runtime.redraw=!0)};r.prototype.SetCharacterSpacing=function(n){n!==this.CharacterSpacing&&(this.characterSpacing=n,this.text_changed=!0,this.runtime.redraw=!0)};r.prototype.SetLineHeight=function(n){n!==this.lineHeight&&(this.lineHeight=n,this.text_changed=!0,this.runtime.redraw=!0)};t.SetCharWidth=function(n,t){var i=parseInt(t,10);this.characterWidthList[n]!==i&&(this.characterWidthList[n]=i,this.text_changed=!0,this.runtime.redraw=!0)};r.prototype.SetCharacterWidth=function(n,t){if(n!=="")for(var i=0;i<n.length;i++)this.SetCharWidth(n.charAt(i),t)};r.prototype.SetEffect=function(n){this.blend_mode=n;this.compositeOp=cr.effectToCompositeOp(n);cr.setGLBlend(this,n,this.runtime.gl);this.runtime.redraw=!0};r.prototype.SetHAlign=function(n){this.halign=n/2;this.text_changed=!0;this.runtime.redraw=!0};r.prototype.SetVAlign=function(n){this.valign=n/2;this.text_changed=!0;this.runtime.redraw=!0};i.acts=new r;u.prototype.CharacterWidth=function(n,t){n.set_int(this.getCharacterWidth(t))};u.prototype.CharacterHeight=function(n){n.set_int(this.characterHeight)};u.prototype.CharacterScale=function(n){n.set_float(this.characterScale)};u.prototype.CharacterSpacing=function(n){n.set_int(this.characterSpacing)};u.prototype.LineHeight=function(n){n.set_int(this.lineHeight)};u.prototype.Text=function(n){n.set_string(this.text)};u.prototype.TextWidth=function(n){this.rebuildText();n.set_float(this.textWidth)};u.prototype.TextHeight=function(n){this.rebuildText();n.set_float(this.textHeight)};i.exps=new u}();cr.plugins_.Text=function(n){this.runtime=n},function(){function e(){return f.length?f.pop():{}}function l(n){f.push(n)}function h(n){for(var t=0,i=n.length;t<i;t++)l(n[t]);cr.clearArray(n)}function c(n){return!n.length||n.charAt(n.length-1)!==" "?n:n.substring(0,n.length-1)}function a(){}function i(){}function u(){}var n=cr.plugins_.Text.prototype,o,t,s,r,f;n.onCreate=function(){n.acts.SetWidth=function(n){this.width!==n&&(this.width=n,this.text_changed=!0,this.set_bbox_changed())}};n.Type=function(n){this.plugin=n;this.runtime=n.runtime};o=n.Type.prototype;o.onCreate=function(){};o.onLostWebGLContext=function(){if(!this.is_family)for(var t,n=0,i=this.instances.length;n<i;n++)t=this.instances[n],t.mycanvas=null,t.myctx=null,t.mytex=null};n.Instance=function(n){this.type=n;this.runtime=n.runtime;this.recycled?cr.clearArray(this.lines):this.lines=[];this.text_changed=!0};t=n.Instance.prototype;s={};t.onCreate=function(){this.text=this.properties[0];this.visible=this.properties[1]===0;this.font=this.properties[2];this.color=this.properties[3];this.halign=this.properties[4];this.valign=this.properties[5];this.wrapbyword=this.properties[7]===0;this.lastwidth=this.width;this.lastwrapwidth=this.width;this.lastheight=this.height;this.line_height_offset=this.properties[8];this.facename="";this.fontstyle="";this.ptSize=0;this.textWidth=0;this.textHeight=0;this.parseFont();this.mycanvas=null;this.myctx=null;this.mytex=null;this.need_text_redraw=!1;this.last_render_tick=this.runtime.tickcount;this.recycled?this.rcTex.set(0,0,1,1):this.rcTex=new cr.rect(0,0,1,1);this.runtime.glwrap&&this.runtime.tickMe(this)};t.parseFont=function(){for(var t=this.font.split(" "),n=0;n<t.length;n++)if(t[n].substr(t[n].length-2,2)==="pt"){for(this.ptSize=parseInt(t[n].substr(0,t[n].length-2)),this.pxHeight=Math.ceil(this.ptSize/72*96)+4,n>0&&(this.fontstyle=t[n-1]),this.facename=t[n+1],n=n+2;n<t.length;n++)this.facename+=" "+t[n];break}};t.saveToJSON=function(){return{t:this.text,f:this.font,c:this.color,ha:this.halign,va:this.valign,wr:this.wrapbyword,lho:this.line_height_offset,fn:this.facename,fs:this.fontstyle,ps:this.ptSize,pxh:this.pxHeight,tw:this.textWidth,th:this.textHeight,lrt:this.last_render_tick}};t.loadFromJSON=function(n){this.text=n.t;this.font=n.f;this.color=n.c;this.halign=n.ha;this.valign=n.va;this.wrapbyword=n.wr;this.line_height_offset=n.lho;this.facename=n.fn;this.fontstyle=n.fs;this.ptSize=n.ps;this.pxHeight=n.pxh;this.textWidth=n.tw;this.textHeight=n.th;this.last_render_tick=n.lrt;this.text_changed=!0;this.lastwidth=this.width;this.lastwrapwidth=this.width;this.lastheight=this.height};t.tick=function(){var n,t;this.runtime.glwrap&&this.mytex&&this.runtime.tickcount-this.last_render_tick>=300&&(n=this.layer,this.update_bbox(),t=this.bbox,(t.right<n.viewLeft||t.bottom<n.viewTop||t.left>n.viewRight||t.top>n.viewBottom)&&(this.runtime.glwrap.deleteTexture(this.mytex),this.mytex=null,this.myctx=null,this.mycanvas=null))};t.onDestroy=function(){this.myctx=null;this.mycanvas=null;this.runtime.glwrap&&this.mytex&&this.runtime.glwrap.deleteTexture(this.mytex);this.mytex=null};t.updateFont=function(){this.font=this.fontstyle+" "+this.ptSize.toString()+"pt "+this.facename;this.text_changed=!0;this.runtime.redraw=!0};t.draw=function(n,t){var e,r,i,s,u,o,f;for(n.font=this.font,n.textBaseline="top",n.fillStyle=this.color,n.globalAlpha=t?1:this.opacity,e=1,t&&(e=Math.abs(this.layer.getScale()),n.save(),n.scale(e,e)),(this.text_changed||this.width!==this.lastwrapwidth)&&(this.type.plugin.WordWrap(this.text,this.lines,n,this.width,this.wrapbyword),this.text_changed=!1,this.lastwrapwidth=this.width),this.update_bbox(),r=t?0:this.bquad.tlx,i=t?0:this.bquad.tly,this.runtime.pixel_rounding&&(r=r+.5|0,i=i+.5|0),this.angle===0||t||(n.save(),n.translate(r,i),n.rotate(this.angle),r=0,i=0),s=i+this.height,u=this.pxHeight,u+=this.line_height_offset,this.valign===1?i+=Math.max(this.height/2-this.lines.length*u/2,0):this.valign===2&&(i+=Math.max(this.height-this.lines.length*u-2,0)),f=0;f<this.lines.length;f++)if(o=r,this.halign===1?o=r+(this.width-this.lines[f].width)/2:this.halign===2&&(o=r+(this.width-this.lines[f].width)),n.fillText(this.lines[f].text,o,i),i+=u,i>=s-u)break;(this.angle!==0||t)&&n.restore();this.last_render_tick=this.runtime.tickcount};t.drawGL=function(n){var h,o,s;if(!(this.width<1)&&!(this.height<1)){h=this.text_changed||this.need_text_redraw;this.need_text_redraw=!1;var c=this.layer.getScale(),d=this.layer.getAngle(),e=this.rcTex,g=c*this.width,nt=c*this.height,v=Math.ceil(g),y=Math.ceil(nt),i=Math.abs(v),r=Math.abs(y),tt=this.runtime.draw_width/2,it=this.runtime.draw_height/2;this.myctx||(this.mycanvas=document.createElement("canvas"),this.mycanvas.width=i,this.mycanvas.height=r,this.lastwidth=i,this.lastheight=r,h=!0,this.myctx=this.mycanvas.getContext("2d"));(i!==this.lastwidth||r!==this.lastheight)&&(this.mycanvas.width=i,this.mycanvas.height=r,this.mytex&&(n.deleteTexture(this.mytex),this.mytex=null),h=!0);h&&(this.myctx.clearRect(0,0,i,r),this.draw(this.myctx,!0),this.mytex||(this.mytex=n.createEmptyTexture(i,r,this.runtime.linearSampling,this.runtime.isMobile)),n.videoToTexture(this.mycanvas,this.mytex,this.runtime.isMobile));this.lastwidth=i;this.lastheight=r;n.setTexture(this.mytex);n.setOpacity(this.opacity);n.resetModelView();n.translate(-tt,-it);n.updateModelView();var t=this.bquad,u=this.layer.layerToCanvas(t.tlx,t.tly,!0,!0),f=this.layer.layerToCanvas(t.tlx,t.tly,!1,!0),l=this.layer.layerToCanvas(t.trx,t.try_,!0,!0),p=this.layer.layerToCanvas(t.trx,t.try_,!1,!0),w=this.layer.layerToCanvas(t.brx,t.bry,!0,!0),a=this.layer.layerToCanvas(t.brx,t.bry,!1,!0),b=this.layer.layerToCanvas(t.blx,t.bly,!0,!0),k=this.layer.layerToCanvas(t.blx,t.bly,!1,!0);(this.runtime.pixel_rounding||this.angle===0&&d===0)&&(o=(u+.5|0)-u,s=(f+.5|0)-f,u+=o,f+=s,l+=o,p+=s,w+=o,a+=s,b+=o,k+=s);this.angle===0&&d===0?(l=u+v,p=f,w=l,a=f+y,b=u,k=a,e.right=1,e.bottom=1):(e.right=g/v,e.bottom=nt/y);n.quadTex(u,f,l,p,w,a,b,k,e);n.resetModelView();n.scale(c,c);n.rotateZ(-this.layer.getAngle());n.translate((this.layer.viewLeft+this.layer.viewRight)/-2,(this.layer.viewTop+this.layer.viewBottom)/-2);n.updateModelView();this.last_render_tick=this.runtime.tickcount}};r=[];n.TokeniseWords=function(n){cr.clearArray(r);for(var i="",u,t=0;t<n.length;)if(u=n.charAt(t),u==="\n")i.length&&(r.push(i),i=""),r.push("\n"),++t;else if(u===" "||u==="\t"||u==="-"){do i+=n.charAt(t),t++;while(t<n.length&&(n.charAt(t)===" "||n.charAt(t)==="\t"));r.push(i);i=""}else t<n.length&&(i+=u,t++);i.length&&r.push(i)};f=[];n.WordWrap=function(n,t,i,r,u){if(!n||!n.length){h(t);return}if(r<=2){h(t);return}if(n.length<=100&&n.indexOf("\n")===-1){var f=i.measureText(n).width;if(f<=r){h(t);t.push(e());t[0].text=n;t[0].width=f;return}}this.WrapText(n,t,i,r,u)};n.WrapText=function(n,t,i,u,f){var v,o,y,p,h,s,a;for(f?(this.TokeniseWords(n),v=r):v=n,o="",s=0,h=0;h<v.length;h++){if(v[h]==="\n"){s>=t.length&&t.push(e());o=c(o);a=t[s];a.text=o;a.width=i.measureText(o).width;s++;o="";continue}y=o;o+=v[h];p=i.measureText(o).width;p>=u&&(s>=t.length&&t.push(e()),y=c(y),a=t[s],a.text=y,a.width=i.measureText(y).width,s++,o=v[h],f||o!==" "||(o=""))}for(o.length&&(s>=t.length&&t.push(e()),o=c(o),a=t[s],a.text=o,a.width=i.measureText(o).width,s++),h=s;h<t.length;h++)l(t[h]);t.length=s};a.prototype.CompareText=function(n,t){return t?this.text==n:cr.equals_nocase(this.text,n)};n.cnds=new a;i.prototype.SetText=function(n){cr.is_number(n)&&n<1e9&&(n=Math.round(n*1e10)/1e10);var t=n.toString();this.text!==t&&(this.text=t,this.text_changed=!0,this.runtime.redraw=!0)};i.prototype.AppendText=function(n){cr.is_number(n)&&(n=Math.round(n*1e10)/1e10);var t=n.toString();t&&(this.text+=t,this.text_changed=!0,this.runtime.redraw=!0)};i.prototype.SetFontFace=function(n,t){var i="";switch(t){case 1:i="bold";break;case 2:i="italic";break;case 3:i="bold italic"}(n!==this.facename||i!==this.fontstyle)&&(this.facename=n,this.fontstyle=i,this.updateFont())};i.prototype.SetFontSize=function(n){this.ptSize!==n&&(this.ptSize=n,this.pxHeight=Math.ceil(this.ptSize/72*96)+4,this.updateFont())};i.prototype.SetFontColor=function(n){var t="rgb("+cr.GetRValue(n).toString()+","+cr.GetGValue(n).toString()+","+cr.GetBValue(n).toString()+")";t!==this.color&&(this.color=t,this.need_text_redraw=!0,this.runtime.redraw=!0)};i.prototype.SetWebFont=function(n,t){var f,r,e,u,i;if(this.runtime.isDomFree){cr.logexport("[Construct 2] Text plugin: 'Set web font' not supported on this platform - the action has been ignored");return}if(f=this,r=function(){f.runtime.redraw=!0;f.text_changed=!0},s.hasOwnProperty(t)){if(e="'"+n+"'",this.facename===e)return;for(this.facename=e,this.updateFont(),i=1;i<10;i++)setTimeout(r,i*100),setTimeout(r,i*1e3);return}for(u=document.createElement("link"),u.href=t,u.rel="stylesheet",u.type="text/css",u.onload=r,document.getElementsByTagName("head")[0].appendChild(u),s[t]=!0,this.facename="'"+n+"'",this.updateFont(),i=1;i<10;i++)setTimeout(r,i*100),setTimeout(r,i*1e3)};i.prototype.SetEffect=function(n){this.blend_mode=n;this.compositeOp=cr.effectToCompositeOp(n);cr.setGLBlend(this,n,this.runtime.gl);this.runtime.redraw=!0};n.acts=new i;u.prototype.Text=function(n){n.set_string(this.text)};u.prototype.FaceName=function(n){n.set_string(this.facename)};u.prototype.FaceSize=function(n){n.set_int(this.ptSize)};u.prototype.TextWidth=function(n){for(var i=0,r,t=0,u=this.lines.length;t<u;t++)r=this.lines[t].width,i<r&&(i=r);n.set_int(i)};u.prototype.TextHeight=function(n){n.set_int(this.lines.length*(this.pxHeight+this.line_height_offset)-this.line_height_offset)};n.exps=new u}();cr.plugins_.TiledBg=function(n){this.runtime=n},function(){function f(){}function r(){}function u(){}var n=cr.plugins_.TiledBg.prototype,t,i;n.Type=function(n){this.plugin=n;this.runtime=n.runtime};t=n.Type.prototype;t.onCreate=function(){this.is_family||(this.texture_img=new Image,this.texture_img.cr_filesize=this.texture_filesize,this.runtime.waitForImageLoad(this.texture_img,this.texture_file),this.pattern=null,this.webGL_texture=null)};t.onLostWebGLContext=function(){this.is_family||(this.webGL_texture=null)};t.onRestoreWebGLContext=function(){if(!this.is_family&&this.instances.length){this.webGL_texture||(this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,!0,this.runtime.linearSampling,this.texture_pixelformat));for(var n=0,t=this.instances.length;n<t;n++)this.instances[n].webGL_texture=this.webGL_texture}};t.loadTextures=function(){this.is_family||this.webGL_texture||!this.runtime.glwrap||(this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,!0,this.runtime.linearSampling,this.texture_pixelformat))};t.unloadTextures=function(){this.is_family||this.instances.length||!this.webGL_texture||(this.runtime.glwrap.deleteTexture(this.webGL_texture),this.webGL_texture=null)};t.preloadCanvas2D=function(n){n.drawImage(this.texture_img,0,0)};n.Instance=function(n){this.type=n;this.runtime=n.runtime};i=n.Instance.prototype;i.onCreate=function(){this.visible=this.properties[0]===0;this.rcTex=new cr.rect(0,0,0,0);this.has_own_texture=!1;this.texture_img=this.type.texture_img;this.runtime.glwrap?(this.type.loadTextures(),this.webGL_texture=this.type.webGL_texture):(this.type.pattern||(this.type.pattern=this.runtime.ctx.createPattern(this.type.texture_img,"repeat")),this.pattern=this.type.pattern)};i.afterLoad=function(){this.has_own_texture=!1;this.texture_img=this.type.texture_img};i.onDestroy=function(){this.runtime.glwrap&&this.has_own_texture&&this.webGL_texture&&(this.runtime.glwrap.deleteTexture(this.webGL_texture),this.webGL_texture=null)};i.draw=function(n){var t,i;n.globalAlpha=this.opacity;n.save();n.fillStyle=this.pattern;t=this.x;i=this.y;this.runtime.pixel_rounding&&(t=Math.round(t),i=Math.round(i));var f=-(this.hotspotX*this.width),e=-(this.hotspotY*this.height),r=f%this.texture_img.width,u=e%this.texture_img.height;r<0&&(r+=this.texture_img.width);u<0&&(u+=this.texture_img.height);n.translate(t,i);n.rotate(this.angle);n.translate(r,u);n.fillRect(f-r,e-u,this.width,this.height);n.restore()};i.drawGL_earlyZPass=function(n){this.drawGL(n)};i.drawGL=function(n){var i,t,r,u;n.setTexture(this.webGL_texture);n.setOpacity(this.opacity);i=this.rcTex;i.right=this.width/this.texture_img.width;i.bottom=this.height/this.texture_img.height;t=this.bquad;this.runtime.pixel_rounding?(r=Math.round(this.x)-this.x,u=Math.round(this.y)-this.y,n.quadTex(t.tlx+r,t.tly+u,t.trx+r,t.try_+u,t.brx+r,t.bry+u,t.blx+r,t.bly+u,i)):n.quadTex(t.tlx,t.tly,t.trx,t.try_,t.brx,t.bry,t.blx,t.bly,i)};f.prototype.OnURLLoaded=function(){return!0};n.cnds=new f;r.prototype.SetEffect=function(n){this.blend_mode=n;this.compositeOp=cr.effectToCompositeOp(n);cr.setGLBlend(this,n,this.runtime.gl);this.runtime.redraw=!0};r.prototype.LoadURL=function(n,t){var r=new Image,i=this;r.onload=function(){i.texture_img=r;i.runtime.glwrap?(i.has_own_texture&&i.webGL_texture&&i.runtime.glwrap.deleteTexture(i.webGL_texture),i.webGL_texture=i.runtime.glwrap.loadTexture(r,!0,i.runtime.linearSampling)):i.pattern=i.runtime.ctx.createPattern(r,"repeat");i.has_own_texture=!0;i.runtime.redraw=!0;i.runtime.trigger(cr.plugins_.TiledBg.prototype.cnds.OnURLLoaded,i)};n.substr(0,5)!=="data:"&&t===0&&(r.crossOrigin="anonymous");this.runtime.setImageSrc(r,n)};n.acts=new r;u.prototype.ImageWidth=function(n){n.set_float(this.texture_img.width)};u.prototype.ImageHeight=function(n){n.set_float(this.texture_img.height)};n.exps=new u}();cr.plugins_.Touch=function(n){this.runtime=n},function(){function rt(n){s=n.x;h=n.y;c=n.z}function k(n,t,i,r){var u;return u=f.length?f.pop():new e,u.init(n,t,i,r),u}function d(n){f.length<100&&f.push(n)}function e(){this.starttime=0;this.time=0;this.lasttime=0;this.startx=0;this.starty=0;this.x=0;this.y=0;this.lastx=0;this.lasty=0;this.id=0;this.startindex=0;this.triggeredHold=!1;this.tooFarForHold=!1}function p(n){return n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents||n.originalEvent&&n.originalEvent.sourceCapabilities&&n.originalEvent.sourceCapabilities.firesTouchEvents}function t(){}function n(){}var r=cr.plugins_.Touch.prototype,w,i,u,b,f,et,o;r.Type=function(n){this.plugin=n;this.runtime=n.runtime};w=r.Type.prototype;w.onCreate=function(){};r.Instance=function(n){this.type=n;this.runtime=n.runtime;this.touches=[];this.mouseDown=!1};i=r.Instance.prototype;u={left:0,top:0};i.findTouch=function(n){for(var t=0,i=this.touches.length;t<i;t++)if(this.touches[t].id===n)return t;return-1};var nt=0,tt=0,it=0;var s=0,h=0,c=0;b=null;f=[];var l=15,ut=500,g=333,ft=25;e.prototype.init=function(n,t,i,r){var u=cr.performance_now();this.time=u;this.lasttime=u;this.starttime=u;this.startx=n;this.starty=t;this.x=n;this.y=t;this.lastx=n;this.lasty=t;this.width=0;this.height=0;this.pressure=0;this.id=i;this.startindex=r;this.triggeredHold=!1;this.tooFarForHold=!1};e.prototype.update=function(n,t,i,r,u,f){this.lasttime=this.time;this.time=n;this.lastx=this.x;this.lasty=this.y;this.x=t;this.y=i;this.width=r;this.height=u;this.pressure=f;!this.tooFarForHold&&cr.distanceTo(this.startx,this.starty,this.x,this.y)>=l&&(this.tooFarForHold=!0)};e.prototype.maybeTriggerHold=function(n,t){if(!this.triggeredHold){var i=cr.performance_now();i-this.starttime>=ut&&!this.tooFarForHold&&cr.distanceTo(this.startx,this.starty,this.x,this.y)<l&&(this.triggeredHold=!0,n.trigger_index=this.startindex,n.trigger_id=this.id,n.getTouchIndex=t,n.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnHoldGesture,n),n.curTouchX=this.x,n.curTouchY=this.y,n.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnHoldGestureObject,n),n.getTouchIndex=0)}};var a=-1e3,v=-1e3,y=-1e4;e.prototype.maybeTriggerTap=function(n,t){if(!this.triggeredHold){var i=cr.performance_now();i-this.starttime<=g&&!this.tooFarForHold&&cr.distanceTo(this.startx,this.starty,this.x,this.y)<l&&(n.trigger_index=this.startindex,n.trigger_id=this.id,n.getTouchIndex=t,i-y<=g*2&&cr.distanceTo(a,v,this.x,this.y)<ft?(n.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnDoubleTapGesture,n),n.curTouchX=this.x,n.curTouchY=this.y,n.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnDoubleTapGestureObject,n),a=-1e3,v=-1e3,y=-1e4):(n.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTapGesture,n),n.curTouchX=this.x,n.curTouchY=this.y,n.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTapGestureObject,n),a=this.x,v=this.y,y=i),n.getTouchIndex=0)}};i.onCreate=function(){var t,i,n,r;if(b=this,this.isWindows8=!!(typeof c2isWindows8!="undefined"&&window.c2isWindows8),this.orient_alpha=0,this.orient_beta=0,this.orient_gamma=0,this.acc_g_x=0,this.acc_g_y=0,this.acc_g_z=0,this.acc_x=0,this.acc_y=0,this.acc_z=0,this.curTouchX=0,this.curTouchY=0,this.trigger_index=0,this.trigger_id=0,this.getTouchIndex=0,this.useMouseInput=this.properties[0]!==0,t=this.runtime.fullscreen_mode>0?document:this.runtime.canvas,i=document,this.runtime.isDirectCanvas?i=t=window.Canvas:this.runtime.isCocoonJs&&(i=t=window),n=this,typeof PointerEvent!="undefined"?(t.addEventListener("pointerdown",function(t){n.onPointerStart(t)},!1),t.addEventListener("pointermove",function(t){n.onPointerMove(t)},!1),i.addEventListener("pointerup",function(t){n.onPointerEnd(t,!1)},!1),i.addEventListener("pointercancel",function(t){n.onPointerEnd(t,!0)},!1),this.runtime.canvas&&(this.runtime.canvas.addEventListener("MSGestureHold",function(n){n.preventDefault()},!1),document.addEventListener("MSGestureHold",function(n){n.preventDefault()},!1),this.runtime.canvas.addEventListener("gesturehold",function(n){n.preventDefault()},!1),document.addEventListener("gesturehold",function(n){n.preventDefault()},!1))):window.navigator.msPointerEnabled?(t.addEventListener("MSPointerDown",function(t){n.onPointerStart(t)},!1),t.addEventListener("MSPointerMove",function(t){n.onPointerMove(t)},!1),i.addEventListener("MSPointerUp",function(t){n.onPointerEnd(t,!1)},!1),i.addEventListener("MSPointerCancel",function(t){n.onPointerEnd(t,!0)},!1),this.runtime.canvas&&(this.runtime.canvas.addEventListener("MSGestureHold",function(n){n.preventDefault()},!1),document.addEventListener("MSGestureHold",function(n){n.preventDefault()},!1))):(t.addEventListener("touchstart",function(t){n.onTouchStart(t)},!1),t.addEventListener("touchmove",function(t){n.onTouchMove(t)},!1),i.addEventListener("touchend",function(t){n.onTouchEnd(t,!1)},!1),i.addEventListener("touchcancel",function(t){n.onTouchEnd(t,!0)},!1)),this.isWindows8){var f=function(t){var i=t.reading;n.acc_x=i.accelerationX;n.acc_y=i.accelerationY;n.acc_z=i.accelerationZ},e=function(t){var i=t.reading;n.orient_alpha=i.yawDegrees;n.orient_beta=i.pitchDegrees;n.orient_gamma=i.rollDegrees},u=Windows.Devices.Sensors.Accelerometer.getDefault();u&&(u.reportInterval=Math.max(u.minimumReportInterval,16),u.addEventListener("readingchanged",f));r=Windows.Devices.Sensors.Inclinometer.getDefault();r&&(r.reportInterval=Math.max(r.minimumReportInterval,16),r.addEventListener("readingchanged",e));document.addEventListener("visibilitychange",function(){document.hidden||document.msHidden?(u&&u.removeEventListener("readingchanged",f),r&&r.removeEventListener("readingchanged",e)):(u&&u.addEventListener("readingchanged",f),r&&r.addEventListener("readingchanged",e))},!1)}else window.addEventListener("deviceorientation",function(t){n.orient_alpha=t.alpha||0;n.orient_beta=t.beta||0;n.orient_gamma=t.gamma||0},!1),window.addEventListener("devicemotion",function(t){t.accelerationIncludingGravity&&(n.acc_g_x=t.accelerationIncludingGravity.x||0,n.acc_g_y=t.accelerationIncludingGravity.y||0,n.acc_g_z=t.accelerationIncludingGravity.z||0);t.acceleration&&(n.acc_x=t.acceleration.x||0,n.acc_y=t.acceleration.y||0,n.acc_z=t.acceleration.z||0)},!1);this.useMouseInput&&!this.runtime.isDomFree&&(jQuery(document).mousemove(function(t){n.onMouseMove(t)}),jQuery(document).mousedown(function(t){n.onMouseDown(t)}),jQuery(document).mouseup(function(t){n.onMouseUp(t)}));!this.runtime.isiOS&&this.runtime.isCordova&&navigator.accelerometer&&navigator.accelerometer.watchAcceleration&&navigator.accelerometer.watchAcceleration(rt,null,{frequency:40});this.runtime.tick2Me(this)};i.onPointerMove=function(n){var t,i,r,f;if(n.pointerType!==n.MSPOINTER_TYPE_MOUSE&&n.pointerType!=="mouse"&&(n.preventDefault&&n.preventDefault(),t=this.findTouch(n.pointerId),i=cr.performance_now(),t>=0)){if(r=this.runtime.isDomFree?u:jQuery(this.runtime.canvas).offset(),f=this.touches[t],i-f.time<2)return;f.update(i,n.pageX-r.left,n.pageY-r.top,n.width||0,n.height||0,n.pressure||0)}};i.onPointerStart=function(n){if(n.pointerType!==n.MSPOINTER_TYPE_MOUSE&&n.pointerType!=="mouse"){n.preventDefault&&cr.isCanvasInputEvent(n)&&n.preventDefault();var t=this.runtime.isDomFree?u:jQuery(this.runtime.canvas).offset(),i=n.pageX-t.left,r=n.pageY-t.top,f=cr.performance_now();this.trigger_index=this.touches.length;this.trigger_id=n.pointerId;this.touches.push(k(i,r,n.pointerId,this.trigger_index));this.runtime.isInUserInputEvent=!0;this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchStart,this);this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchStart,this);this.curTouchX=i;this.curTouchY=r;this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchObject,this);this.runtime.isInUserInputEvent=!1}};i.onPointerEnd=function(n,t){if(n.pointerType!==n.MSPOINTER_TYPE_MOUSE&&n.pointerType!=="mouse"){n.preventDefault&&cr.isCanvasInputEvent(n)&&n.preventDefault();var i=this.findTouch(n.pointerId);this.trigger_index=i>=0?this.touches[i].startindex:-1;this.trigger_id=i>=0?this.touches[i].id:-1;this.runtime.isInUserInputEvent=!0;this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchEnd,this);this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchEnd,this);i>=0&&(t||this.touches[i].maybeTriggerTap(this,i),d(this.touches[i]),this.touches.splice(i,1));this.runtime.isInUserInputEvent=!1}};i.onTouchMove=function(n){var r,i,s,t,f,e,o;for(n.preventDefault&&n.preventDefault(),r=cr.performance_now(),i=0,s=n.changedTouches.length;i<s;i++)if(t=n.changedTouches[i],e=this.findTouch(t.identifier),e>=0){if(o=this.runtime.isDomFree?u:jQuery(this.runtime.canvas).offset(),f=this.touches[e],r-f.time<2)continue;var h=(t.radiusX||t.webkitRadiusX||t.mozRadiusX||t.msRadiusX||0)*2,c=(t.radiusY||t.webkitRadiusY||t.mozRadiusY||t.msRadiusY||0)*2,l=t.force||t.webkitForce||t.mozForce||t.msForce||0;f.update(r,t.pageX-o.left,t.pageY-o.top,h,c,l)}};i.onTouchStart=function(n){var r,h,i,o,t,s,f,e;for(n.preventDefault&&cr.isCanvasInputEvent(n)&&n.preventDefault(),r=this.runtime.isDomFree?u:jQuery(this.runtime.canvas).offset(),h=cr.performance_now(),this.runtime.isInUserInputEvent=!0,i=0,o=n.changedTouches.length;i<o;i++)(t=n.changedTouches[i],s=this.findTouch(t.identifier),s===-1)&&(f=t.pageX-r.left,e=t.pageY-r.top,this.trigger_index=this.touches.length,this.trigger_id=t.identifier,this.touches.push(k(f,e,t.identifier,this.trigger_index)),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchStart,this),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchStart,this),this.curTouchX=f,this.curTouchY=e,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchObject,this));this.runtime.isInUserInputEvent=!1};i.onTouchEnd=function(n,t){n.preventDefault&&cr.isCanvasInputEvent(n)&&n.preventDefault();this.runtime.isInUserInputEvent=!0;for(var f,i,r=0,u=n.changedTouches.length;r<u;r++)f=n.changedTouches[r],i=this.findTouch(f.identifier),i>=0&&(this.trigger_index=this.touches[i].startindex,this.trigger_id=this.touches[i].id,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchEnd,this),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchEnd,this),t||this.touches[i].maybeTriggerTap(this,i),d(this.touches[i]),this.touches.splice(i,1));this.runtime.isInUserInputEvent=!1};i.getAlpha=function(){return this.runtime.isCordova&&this.orient_alpha===0&&c!==0?c*90:this.orient_alpha};i.getBeta=function(){return this.runtime.isCordova&&this.orient_beta===0&&h!==0?h*90:this.orient_beta};i.getGamma=function(){return this.runtime.isCordova&&this.orient_gamma===0&&s!==0?s*90:this.orient_gamma};et=function(){};i.onMouseDown=function(n){if(!p(n)){var t={pageX:n.pageX,pageY:n.pageY,identifier:0},i={changedTouches:[t]};this.onTouchStart(i);this.mouseDown=!0}};i.onMouseMove=function(n){if(this.mouseDown&&!p(n)){var t={pageX:n.pageX,pageY:n.pageY,identifier:0},i={changedTouches:[t]};this.onTouchMove(i)}};i.onMouseUp=function(n){if(n.preventDefault&&this.runtime.had_a_click&&!this.runtime.isMobile&&n.preventDefault(),this.runtime.had_a_click=!0,!p(n)){var t={pageX:n.pageX,pageY:n.pageY,identifier:0},i={changedTouches:[t]};this.onTouchEnd(i);this.mouseDown=!1}};i.tick2=function(){for(var t,r=cr.performance_now(),n=0,i=this.touches.length;n<i;++n)t=this.touches[n],t.time<=r-50&&(t.lasttime=r),t.maybeTriggerHold(this,n)};t.prototype.OnTouchStart=function(){return!0};t.prototype.OnTouchEnd=function(){return!0};t.prototype.IsInTouch=function(){return this.touches.length};t.prototype.OnTouchObject=function(n){return n?this.runtime.testAndSelectCanvasPointOverlap(n,this.curTouchX,this.curTouchY,!1):!1};o=[];t.prototype.IsTouchingObject=function(n){var r,e,s,h,u,c,f,l,t,i;if(!n)return!1;for(r=n.getCurrentSol(),e=r.getObjects(),u=0,c=e.length;u<c;u++)for(t=e[u],t.update_bbox(),f=0,l=this.touches.length;f<l;f++)if(i=this.touches[f],s=t.layer.canvasToLayer(i.x,i.y,!0),h=t.layer.canvasToLayer(i.x,i.y,!1),t.contains_pt(s,h)){o.push(t);break}return o.length?(r.select_all=!1,cr.shallowAssignArray(r.instances,o),n.applySolToContainer(),cr.clearArray(o),!0):!1};t.prototype.CompareTouchSpeed=function(n,t,i){if(n=Math.floor(n),n<0||n>=this.touches.length)return!1;var r=this.touches[n],e=cr.distanceTo(r.x,r.y,r.lastx,r.lasty),u=(r.time-r.lasttime)/1e3,f=0;return u>0&&(f=e/u),cr.do_cmp(f,t,i)};t.prototype.OrientationSupported=function(){return typeof DeviceOrientationEvent!="undefined"};t.prototype.MotionSupported=function(){return typeof DeviceMotionEvent!="undefined"};t.prototype.CompareOrientation=function(n,t,i){var r=0;return r=n===0?this.getAlpha():n===1?this.getBeta():this.getGamma(),cr.do_cmp(r,t,i)};t.prototype.CompareAcceleration=function(n,t,i){var r=0;return n===0?r=this.acc_g_x:n===1?r=this.acc_g_y:n===2?r=this.acc_g_z:n===3?r=this.acc_x:n===4?r=this.acc_y:n===5&&(r=this.acc_z),cr.do_cmp(r,t,i)};t.prototype.OnNthTouchStart=function(n){return n=Math.floor(n),n===this.trigger_index};t.prototype.OnNthTouchEnd=function(n){return n=Math.floor(n),n===this.trigger_index};t.prototype.HasNthTouch=function(n){return n=Math.floor(n),this.touches.length>=n+1};t.prototype.OnHoldGesture=function(){return!0};t.prototype.OnTapGesture=function(){return!0};t.prototype.OnDoubleTapGesture=function(){return!0};t.prototype.OnHoldGestureObject=function(n){return n?this.runtime.testAndSelectCanvasPointOverlap(n,this.curTouchX,this.curTouchY,!1):!1};t.prototype.OnTapGestureObject=function(n){return n?this.runtime.testAndSelectCanvasPointOverlap(n,this.curTouchX,this.curTouchY,!1):!1};t.prototype.OnDoubleTapGestureObject=function(n){return n?this.runtime.testAndSelectCanvasPointOverlap(n,this.curTouchX,this.curTouchY,!1):!1};r.cnds=new t;n.prototype.TouchCount=function(n){n.set_int(this.touches.length)};n.prototype.X=function(n,t){var r=this.getTouchIndex,i,u,f,e,o;if(r<0||r>=this.touches.length){n.set_float(0);return}cr.is_undefined(t)?(i=this.runtime.getLayerByNumber(0),u=i.scale,f=i.zoomRate,e=i.parallaxX,o=i.angle,i.scale=1,i.zoomRate=1,i.parallaxX=1,i.angle=0,n.set_float(i.canvasToLayer(this.touches[r].x,this.touches[r].y,!0)),i.scale=u,i.zoomRate=f,i.parallaxX=e,i.angle=o):(i=cr.is_number(t)?this.runtime.getLayerByNumber(t):this.runtime.getLayerByName(t),i?n.set_float(i.canvasToLayer(this.touches[r].x,this.touches[r].y,!0)):n.set_float(0))};n.prototype.XAt=function(n,t,i){if(t=Math.floor(t),t<0||t>=this.touches.length){n.set_float(0);return}var r,u,f,e,o;cr.is_undefined(i)?(r=this.runtime.getLayerByNumber(0),u=r.scale,f=r.zoomRate,e=r.parallaxX,o=r.angle,r.scale=1,r.zoomRate=1,r.parallaxX=1,r.angle=0,n.set_float(r.canvasToLayer(this.touches[t].x,this.touches[t].y,!0)),r.scale=u,r.zoomRate=f,r.parallaxX=e,r.angle=o):(r=cr.is_number(i)?this.runtime.getLayerByNumber(i):this.runtime.getLayerByName(i),r?n.set_float(r.canvasToLayer(this.touches[t].x,this.touches[t].y,!0)):n.set_float(0))};n.prototype.XForID=function(n,t,i){var f=this.findTouch(t),u,r,e,o,s,h;if(f<0){n.set_float(0);return}u=this.touches[f];cr.is_undefined(i)?(r=this.runtime.getLayerByNumber(0),e=r.scale,o=r.zoomRate,s=r.parallaxX,h=r.angle,r.scale=1,r.zoomRate=1,r.parallaxX=1,r.angle=0,n.set_float(r.canvasToLayer(u.x,u.y,!0)),r.scale=e,r.zoomRate=o,r.parallaxX=s,r.angle=h):(r=cr.is_number(i)?this.runtime.getLayerByNumber(i):this.runtime.getLayerByName(i),r?n.set_float(r.canvasToLayer(u.x,u.y,!0)):n.set_float(0))};n.prototype.Y=function(n,t){var r=this.getTouchIndex,i,u,f,e,o;if(r<0||r>=this.touches.length){n.set_float(0);return}cr.is_undefined(t)?(i=this.runtime.getLayerByNumber(0),u=i.scale,f=i.zoomRate,e=i.parallaxY,o=i.angle,i.scale=1,i.zoomRate=1,i.parallaxY=1,i.angle=0,n.set_float(i.canvasToLayer(this.touches[r].x,this.touches[r].y,!1)),i.scale=u,i.zoomRate=f,i.parallaxY=e,i.angle=o):(i=cr.is_number(t)?this.runtime.getLayerByNumber(t):this.runtime.getLayerByName(t),i?n.set_float(i.canvasToLayer(this.touches[r].x,this.touches[r].y,!1)):n.set_float(0))};n.prototype.YAt=function(n,t,i){if(t=Math.floor(t),t<0||t>=this.touches.length){n.set_float(0);return}var r,u,f,e,o;cr.is_undefined(i)?(r=this.runtime.getLayerByNumber(0),u=r.scale,f=r.zoomRate,e=r.parallaxY,o=r.angle,r.scale=1,r.zoomRate=1,r.parallaxY=1,r.angle=0,n.set_float(r.canvasToLayer(this.touches[t].x,this.touches[t].y,!1)),r.scale=u,r.zoomRate=f,r.parallaxY=e,r.angle=o):(r=cr.is_number(i)?this.runtime.getLayerByNumber(i):this.runtime.getLayerByName(i),r?n.set_float(r.canvasToLayer(this.touches[t].x,this.touches[t].y,!1)):n.set_float(0))};n.prototype.YForID=function(n,t,i){var f=this.findTouch(t),u,r,e,o,s,h;if(f<0){n.set_float(0);return}u=this.touches[f];cr.is_undefined(i)?(r=this.runtime.getLayerByNumber(0),e=r.scale,o=r.zoomRate,s=r.parallaxY,h=r.angle,r.scale=1,r.zoomRate=1,r.parallaxY=1,r.angle=0,n.set_float(r.canvasToLayer(u.x,u.y,!1)),r.scale=e,r.zoomRate=o,r.parallaxY=s,r.angle=h):(r=cr.is_number(i)?this.runtime.getLayerByNumber(i):this.runtime.getLayerByName(i),r?n.set_float(r.canvasToLayer(u.x,u.y,!1)):n.set_float(0))};n.prototype.AbsoluteX=function(n){this.touches.length?n.set_float(this.touches[0].x):n.set_float(0)};n.prototype.AbsoluteXAt=function(n,t){if(t=Math.floor(t),t<0||t>=this.touches.length){n.set_float(0);return}n.set_float(this.touches[t].x)};n.prototype.AbsoluteXForID=function(n,t){var i=this.findTouch(t),r;if(i<0){n.set_float(0);return}r=this.touches[i];n.set_float(r.x)};n.prototype.AbsoluteY=function(n){this.touches.length?n.set_float(this.touches[0].y):n.set_float(0)};n.prototype.AbsoluteYAt=function(n,t){if(t=Math.floor(t),t<0||t>=this.touches.length){n.set_float(0);return}n.set_float(this.touches[t].y)};n.prototype.AbsoluteYForID=function(n,t){var i=this.findTouch(t),r;if(i<0){n.set_float(0);return}r=this.touches[i];n.set_float(r.y)};n.prototype.SpeedAt=function(n,t){if(t=Math.floor(t),t<0||t>=this.touches.length){n.set_float(0);return}var i=this.touches[t],u=cr.distanceTo(i.x,i.y,i.lastx,i.lasty),r=(i.time-i.lasttime)/1e3;r<=0?n.set_float(0):n.set_float(u/r)};n.prototype.SpeedForID=function(n,t){var r=this.findTouch(t);if(r<0){n.set_float(0);return}var i=this.touches[r],f=cr.distanceTo(i.x,i.y,i.lastx,i.lasty),u=(i.time-i.lasttime)/1e3;u<=0?n.set_float(0):n.set_float(f/u)};n.prototype.AngleAt=function(n,t){if(t=Math.floor(t),t<0||t>=this.touches.length){n.set_float(0);return}var i=this.touches[t];n.set_float(cr.to_degrees(cr.angleTo(i.lastx,i.lasty,i.x,i.y)))};n.prototype.AngleForID=function(n,t){var r=this.findTouch(t),i;if(r<0){n.set_float(0);return}i=this.touches[r];n.set_float(cr.to_degrees(cr.angleTo(i.lastx,i.lasty,i.x,i.y)))};n.prototype.Alpha=function(n){n.set_float(this.getAlpha())};n.prototype.Beta=function(n){n.set_float(this.getBeta())};n.prototype.Gamma=function(n){n.set_float(this.getGamma())};n.prototype.AccelerationXWithG=function(n){n.set_float(this.acc_g_x)};n.prototype.AccelerationYWithG=function(n){n.set_float(this.acc_g_y)};n.prototype.AccelerationZWithG=function(n){n.set_float(this.acc_g_z)};n.prototype.AccelerationX=function(n){n.set_float(this.acc_x)};n.prototype.AccelerationY=function(n){n.set_float(this.acc_y)};n.prototype.AccelerationZ=function(n){n.set_float(this.acc_z)};n.prototype.TouchIndex=function(n){n.set_int(this.trigger_index)};n.prototype.TouchID=function(n){n.set_float(this.trigger_id)};n.prototype.WidthForID=function(n,t){var i=this.findTouch(t),r;if(i<0){n.set_float(0);return}r=this.touches[i];n.set_float(r.width)};n.prototype.HeightForID=function(n,t){var i=this.findTouch(t),r;if(i<0){n.set_float(0);return}r=this.touches[i];n.set_float(r.height)};n.prototype.PressureForID=function(n,t){var i=this.findTouch(t),r;if(i<0){n.set_float(0);return}r=this.touches[i];n.set_float(r.pressure)};r.exps=new n}();cr.plugins_.WebStorage=function(n){this.runtime=n},function(){function u(){}function f(){}function r(){}var e=cr.plugins_.WebStorage.prototype,o,n;e.Type=function(n){this.plugin=n;this.runtime=n.runtime};o=e.Type.prototype;o.onCreate=function(){};e.Instance=function(n){this.type=n;this.runtime=n.runtime};var s=e.Instance.prototype,t="",i=typeof is_scirra_arcade!="undefined";i&&(t="arcade"+window.scirra_arcade_id);n=!1;try{localStorage.getItem("test");n=!0}catch(h){n=!1}s.onCreate=function(){n||cr.logexport("[Construct 2] Webstorage plugin: local storage is not supported on this platform.")};u.prototype.LocalStorageEnabled=function(){return n};u.prototype.SessionStorageEnabled=function(){return n};u.prototype.LocalStorageExists=function(i){return n?localStorage.getItem(t+i)!=null:!1};u.prototype.SessionStorageExists=function(i){return n?sessionStorage.getItem(t+i)!=null:!1};u.prototype.OnQuotaExceeded=function(){return!0};u.prototype.CompareKeyText=function(i,r,u){if(!n)return!1;var f=localStorage.getItem(t+i)||"";return u?f==r:cr.equals_nocase(f,r)};u.prototype.CompareKeyNumber=function(i,r,u){if(!n)return!1;var f=localStorage.getItem(t+i)||"";return cr.do_cmp(parseFloat(f),r,u)};e.cnds=new u;f.prototype.StoreLocal=function(i,r){if(n)try{localStorage.setItem(t+i,r)}catch(u){this.runtime.trigger(cr.plugins_.WebStorage.prototype.cnds.OnQuotaExceeded,this)}};f.prototype.StoreSession=function(i,r){if(n)try{sessionStorage.setItem(t+i,r)}catch(u){this.runtime.trigger(cr.plugins_.WebStorage.prototype.cnds.OnQuotaExceeded,this)}};f.prototype.RemoveLocal=function(i){n&&localStorage.removeItem(t+i)};f.prototype.RemoveSession=function(i){n&&sessionStorage.removeItem(t+i)};f.prototype.ClearLocal=function(){n&&(i||localStorage.clear())};f.prototype.ClearSession=function(){n&&(i||sessionStorage.clear())};f.prototype.JSONLoad=function(r,u){var o,f,e;if(n){try{o=JSON.parse(r)}catch(s){return}if(o.c2dictionary){f=o.data;u!==0||i||localStorage.clear();for(e in f)if(f.hasOwnProperty(e))try{localStorage.setItem(t+e,f[e])}catch(s){this.runtime.trigger(cr.plugins_.WebStorage.prototype.cnds.OnQuotaExceeded,this);return}}}};e.acts=new f;r.prototype.LocalValue=function(i,r){if(!n){i.set_string("");return}i.set_string(localStorage.getItem(t+r)||"")};r.prototype.SessionValue=function(i,r){if(!n){i.set_string("");return}i.set_string(sessionStorage.getItem(t+r)||"")};r.prototype.LocalCount=function(t){if(!n){t.set_int(0);return}t.set_int(i?0:localStorage.length)};r.prototype.SessionCount=function(t){if(!n){t.set_int(0);return}t.set_int(i?0:sessionStorage.length)};r.prototype.LocalAt=function(t,r){i||!n?t.set_string(""):t.set_string(localStorage.getItem(localStorage.key(r))||"")};r.prototype.SessionAt=function(t,r){i||!n?t.set_string(""):t.set_string(sessionStorage.getItem(sessionStorage.key(r))||"")};r.prototype.LocalKeyAt=function(t,r){i||!n?t.set_string(""):t.set_string(localStorage.key(r)||"")};r.prototype.SessionKeyAt=function(t,r){i||!n?t.set_string(""):t.set_string(sessionStorage.key(r)||"")};r.prototype.AsJSON=function(r){if(!n){r.set_string("");return}for(var e={},u,f=0,o=localStorage.length;f<o;f++)u=localStorage.key(f),i?u.substr(0,t.length)===t&&(e[u.substr(t.length)]=localStorage.getItem(u)):e[u]=localStorage.getItem(u);r.set_string(JSON.stringify({c2dictionary:!0,data:e}))};e.exps=new r}();cr.behaviors.Anchor=function(n){this.runtime=n},function(){function u(){}function r(){}function f(){}var n=cr.behaviors.Anchor.prototype,i,t;n.Type=function(n,t){this.behavior=n;this.objtype=t;this.runtime=n.runtime};i=n.Type.prototype;i.onCreate=function(){};n.Instance=function(n,t){this.type=n;this.behavior=n.behavior;this.inst=t;this.runtime=n.runtime};t=n.Instance.prototype;t.onCreate=function(){this.anch_left=this.properties[0];this.anch_top=this.properties[1];this.anch_right=this.properties[2];this.anch_bottom=this.properties[3];this.inst.update_bbox();this.xleft=this.inst.bbox.left;this.ytop=this.inst.bbox.top;this.xright=this.runtime.original_width-this.inst.bbox.left;this.ybottom=this.runtime.original_height-this.inst.bbox.top;this.rdiff=this.runtime.original_width-this.inst.bbox.right;this.bdiff=this.runtime.original_height-this.inst.bbox.bottom;this.enabled=this.properties[4]!==0};t.saveToJSON=function(){return{xleft:this.xleft,ytop:this.ytop,xright:this.xright,ybottom:this.ybottom,rdiff:this.rdiff,bdiff:this.bdiff,enabled:this.enabled}};t.loadFromJSON=function(n){this.xleft=n.xleft;this.ytop=n.ytop;this.xright=n.xright;this.ybottom=n.ybottom;this.rdiff=n.rdiff;this.bdiff=n.bdiff;this.enabled=n.enabled};t.tick=function(){if(this.enabled){var t,i=this.inst.layer,n=this.inst,r=this.inst.bbox;this.anch_left===0?(n.update_bbox(),t=i.viewLeft+this.xleft-r.left,t!==0&&(n.x+=t,n.set_bbox_changed())):this.anch_left===1&&(n.update_bbox(),t=i.viewRight-this.xright-r.left,t!==0&&(n.x+=t,n.set_bbox_changed()));this.anch_top===0?(n.update_bbox(),t=i.viewTop+this.ytop-r.top,t!==0&&(n.y+=t,n.set_bbox_changed())):this.anch_top===1&&(n.update_bbox(),t=i.viewBottom-this.ybottom-r.top,t!==0&&(n.y+=t,n.set_bbox_changed()));this.anch_right===1&&(n.update_bbox(),t=i.viewRight-this.rdiff-r.right,t!==0&&(n.width+=t,n.width<0&&(n.width=0),n.set_bbox_changed()));this.anch_bottom===1&&(n.update_bbox(),t=i.viewBottom-this.bdiff-r.bottom,t!==0&&(n.height+=t,n.height<0&&(n.height=0),n.set_bbox_changed()))}};n.cnds=new u;r.prototype.SetEnabled=function(n){this.enabled&&n===0?this.enabled=!1:this.enabled||n===0||(this.inst.update_bbox(),this.xleft=this.inst.bbox.left,this.ytop=this.inst.bbox.top,this.xright=this.runtime.original_width-this.inst.bbox.left,this.ybottom=this.runtime.original_height-this.inst.bbox.top,this.rdiff=this.runtime.original_width-this.inst.bbox.right,this.bdiff=this.runtime.original_height-this.inst.bbox.bottom,this.enabled=!0)};n.acts=new r;n.exps=new f}();cr.behaviors.Pin=function(n){this.runtime=n},function(){function u(){}function i(){}function f(){}var t=cr.behaviors.Pin.prototype,r,n;t.Type=function(n,t){this.behavior=n;this.objtype=t;this.runtime=n.runtime};r=t.Type.prototype;r.onCreate=function(){};t.Instance=function(n,t){this.type=n;this.behavior=n.behavior;this.inst=t;this.runtime=n.runtime};n=t.Instance.prototype;n.onCreate=function(){this.pinObject=null;this.pinObjectUid=-1;this.pinAngle=0;this.pinDist=0;this.myStartAngle=0;this.theirStartAngle=0;this.lastKnownAngle=0;this.mode=0;var n=this;this.recycled||(this.myDestroyCallback=function(t){n.onInstanceDestroyed(t)});this.runtime.addDestroyCallback(this.myDestroyCallback)};n.saveToJSON=function(){return{uid:this.pinObject?this.pinObject.uid:-1,pa:this.pinAngle,pd:this.pinDist,msa:this.myStartAngle,tsa:this.theirStartAngle,lka:this.lastKnownAngle,m:this.mode}};n.loadFromJSON=function(n){this.pinObjectUid=n.uid;this.pinAngle=n.pa;this.pinDist=n.pd;this.myStartAngle=n.msa;this.theirStartAngle=n.tsa;this.lastKnownAngle=n.lka;this.mode=n.m};n.afterLoad=function(){this.pinObject=this.pinObjectUid===-1?null:this.runtime.getObjectByUID(this.pinObjectUid);this.pinObjectUid=-1};n.onInstanceDestroyed=function(n){this.pinObject==n&&(this.pinObject=null)};n.onDestroy=function(){this.pinObject=null;this.runtime.removeDestroyCallback(this.myDestroyCallback)};n.tick=function(){};n.tick2=function(){var n,t,r,u,i;this.pinObject&&(this.lastKnownAngle!==this.inst.angle&&(this.myStartAngle=cr.clamp_angle(this.myStartAngle+(this.inst.angle-this.lastKnownAngle))),n=this.inst.x,t=this.inst.y,this.mode===3||this.mode===4?(r=cr.distanceTo(this.inst.x,this.inst.y,this.pinObject.x,this.pinObject.y),(r>this.pinDist||this.mode===4&&r<this.pinDist)&&(u=cr.angleTo(this.pinObject.x,this.pinObject.y,this.inst.x,this.inst.y),n=this.pinObject.x+Math.cos(u)*this.pinDist,t=this.pinObject.y+Math.sin(u)*this.pinDist)):(n=this.pinObject.x+Math.cos(this.pinObject.angle+this.pinAngle)*this.pinDist,t=this.pinObject.y+Math.sin(this.pinObject.angle+this.pinAngle)*this.pinDist),i=cr.clamp_angle(this.myStartAngle+(this.pinObject.angle-this.theirStartAngle)),this.lastKnownAngle=i,(this.mode===0||this.mode===1||this.mode===3||this.mode===4)&&(this.inst.x!==n||this.inst.y!==t)&&(this.inst.x=n,this.inst.y=t,this.inst.set_bbox_changed()),(this.mode===0||this.mode===2)&&this.inst.angle!==i&&(this.inst.angle=i,this.inst.set_bbox_changed()))};u.prototype.IsPinned=function(){return!!this.pinObject};t.cnds=new u;i.prototype.Pin=function(n,t){if(n){var i=n.getFirstPicked(this.inst);i&&(this.pinObject=i,this.pinAngle=cr.angleTo(i.x,i.y,this.inst.x,this.inst.y)-i.angle,this.pinDist=cr.distanceTo(i.x,i.y,this.inst.x,this.inst.y),this.myStartAngle=this.inst.angle,this.lastKnownAngle=this.inst.angle,this.theirStartAngle=i.angle,this.mode=t)}};i.prototype.Unpin=function(){this.pinObject=null};t.acts=new i;f.prototype.PinnedUID=function(n){n.set_int(this.pinObject?this.pinObject.uid:-1)};t.exps=new f}();var easeOutBounceArray=[],easeInElasticArray=[],easeOutElasticArray=[],easeInOutElasticArray=[],easeInCircle=[],easeOutCircle=[],easeInOutCircle=[],easeInBack=[],easeOutBack=[],easeInOutBack=[],litetween_precision=1e4,updateLimit=0;(function(){for(var s=1,f=0,i=1,r=0,e=0,o=0,n=0,t=0,u=0;u<=litetween_precision;u++)n=u/litetween_precision,r=(n/=s)<1/2.75?i*7.5625*n*n+f:n<2/2.75?i*(7.5625*(n-=1.5/2.75)*n+.75)+f:n<2.5/2.75?i*(7.5625*(n-=2.25/2.75)*n+.9375)+f:i*(7.5625*(n-=2.625/2.75)*n+.984375)+f,easeOutBounceArray[u]=r,n=u/litetween_precision,e=0,o=0,n==0&&(r=f),(n/=s)==1&&(r=f+i),o==0&&(o=s*.3),e==0||e<Math.abs(i)?(e=i,t=o/4):t=o/(2*Math.PI)*Math.asin(i/e),r=-(e*Math.pow(2,10*(n-=1))*Math.sin((n*s-t)*2*Math.PI/o))+f,easeInElasticArray[u]=r,n=u/litetween_precision,e=0,o=0,n==0&&(r=f),(n/=s)==1&&(r=f+i),o==0&&(o=s*.3),e==0||e<Math.abs(i)?(e=i,t=o/4):t=o/(2*Math.PI)*Math.asin(i/e),r=e*Math.pow(2,-10*n)*Math.sin((n*s-t)*2*Math.PI/o)+i+f,easeOutElasticArray[u]=r,n=u/litetween_precision,e=0,o=0,n==0&&(r=f),(n/=s/2)==2&&(r=f+i),o==0&&(o=s*.3*1.5),e==0||e<Math.abs(i)?(e=i,t=o/4):t=o/(2*Math.PI)*Math.asin(i/e),r=n<1?-.5*e*Math.pow(2,10*(n-=1))*Math.sin((n*s-t)*2*Math.PI/o)+f:e*Math.pow(2,-10*(n-=1))*Math.sin((n*s-t)*2*Math.PI/o)*.5+i+f,easeInOutElasticArray[u]=r,n=u/litetween_precision,easeInCircle[u]=-(Math.sqrt(1-n*n)-1),n=u/litetween_precision,easeOutCircle[u]=Math.sqrt(1-(n-1)*(n-1)),n=u/litetween_precision,r=(n/=s/2)<1?-i/2*(Math.sqrt(1-n*n)-1)+f:i/2*(Math.sqrt(1-(n-=2)*n)+1)+f,easeInOutCircle[u]=r,n=u/litetween_precision,t=0,t==0&&(t=1.70158),r=i*(n/=s)*n*((t+1)*n-t)+f,easeInBack[u]=r,n=u/litetween_precision,t=0,t==0&&(t=1.70158),r=i*((n=n/s-1)*n*((t+1)*n+t)+1)+f,easeOutBack[u]=r,n=u/litetween_precision,t=0,t==0&&(t=1.70158),r=(n/=s/2)<1?i/2*n*n*(((t*=1.525)+1)*n-t)+f:i/2*((n-=2)*n*(((t*=1.525)+1)*n+t)+2)+f,easeInOutBack[u]=r})();TweenObject=function(){return function(n,t,i,r,u,f,e){this.name=n;this.value=0;this.setInitial(r);this.setTarget(u);this.easefunc=i;this.tweened=t;this.duration=f;this.progress=0;this.state=0;this.onStart=!1;this.onEnd=!1;this.onReverseStart=!1;this.onReverseEnd=!1;this.lastKnownValue=0;this.lastKnownValue2=0;this.enforce=e;this.pingpong=1;this.flipEase=!1;this.easingparam=[];this.lastState=1;for(var o=0;o<28;o++)this.easingparam[o]={},this.easingparam[o].a=0,this.easingparam[o].p=0,this.easingparam[o].t=0,this.easingparam[o].s=0,this.easingparam[o].optimized=!0}}(),function(){TweenObject.prototype={};TweenObject.prototype.flipTarget=function(){var n=this.initialparam1,t=this.initialparam2;this.initialparam1=this.targetparam1;this.initialparam2=this.targetparam2;this.targetparam1=n;this.targetparam2=t;this.lastKnownValue=0;this.lastKnownValue2=0};TweenObject.prototype.setInitial=function(n){this.initialparam1=parseFloat(n.split(",")[0]);this.initialparam2=parseFloat(n.split(",")[1]);this.lastKnownValue=0;this.lastKnownValue2=0};TweenObject.prototype.setTarget=function(n){this.targetparam1=parseFloat(n.split(",")[0]);this.targetparam2=parseFloat(n.split(",")[1]);isNaN(this.targetparam2)&&(this.targetparam2=this.targetparam1)};TweenObject.prototype.OnTick=function(n){var t;return this.state===0?-1:(this.state===1&&(this.progress+=n),this.state===2&&(this.progress-=n),this.state===3&&(this.state=0),(this.state===4||this.state===6)&&(this.progress+=n*this.pingpong),this.state===5&&(this.progress+=n*this.pingpong),this.progress<0?(this.progress=0,this.state===4?this.pingpong=1:this.state===6?(this.pingpong=1,this.flipEase=!1):this.state=0,this.onReverseEnd=!0,0):this.progress>this.duration?(this.progress=this.duration,this.state===4?this.pingpong=-1:this.state===6?(this.pingpong=-1,this.flipEase=!0):this.state===5?this.progress=0:this.state=0,this.onEnd=!0,1):this.flipEase?easeFunc(this.easefunc,this.duration-this.progress,0,1,this.duration,this.flipEase,this.easingparam[this.easefunc]):easeFunc(this.easefunc,this.progress,0,1,this.duration,this.flipEase,this.easingparam[this.easefunc]))}}();cr.behaviors.lunarray_LiteTween=function(n){this.runtime=n},function(){var i=cr.behaviors.lunarray_LiteTween.prototype,f,t,r,n,u;i.Type=function(n,t){this.behavior=n;this.objtype=t;this.runtime=n.runtime};f=i.Type.prototype;f.onCreate=function(){};i.Instance=function(n,t){this.type=n;this.behavior=n.behavior;this.inst=t;this.runtime=n.runtime;this.i=0};t=i.Instance.prototype;t.onCreate=function(){this.playmode=this.properties[0];this.active=this.playmode==1||this.playmode==2||this.playmode==3||this.playmode==4;this.tweened=this.properties[1];this.easing=this.properties[2];this.target=this.properties[3];this.targetmode=this.properties[4];this.useCurrent=!1;this.targetmode===1&&(this.target="relative("+this.target+")");this.duration=this.properties[5];this.enforce=this.properties[6]===1;this.value=0;this.tween_list={};this.addToTweenList("default",this.tweened,this.easing,"current",this.target,this.duration,this.enforce);this.properties[0]===1&&this.startTween(0);this.properties[0]===2&&this.startTween(2);this.properties[0]===3&&this.startTween(3);this.properties[0]===4&&this.startTween(4)};t.parseCurrent=function(n,t){var i,f,e,r,u;if(t===undefined&&(t="current"),i=trim(t),t=trim(t),f=this.value,t==="current")switch(n){case 0:i=this.inst.x+","+this.inst.y;break;case 1:i=this.inst.width+","+this.inst.height;break;case 2:i=this.inst.width+","+this.inst.height;break;case 3:i=this.inst.width+","+this.inst.height;break;case 4:i=cr.to_degrees(this.inst.angle)+","+cr.to_degrees(this.inst.angle);break;case 5:i=this.inst.opacity*100+","+this.inst.opacity*100;break;case 6:i=f+","+f;break;case 7:i=this.inst.x+","+this.inst.y;break;case 8:i=this.inst.x+","+this.inst.y;break;case 9:i=this.inst.curFrame!==undefined?this.inst.width/this.inst.curFrame.width+","+this.inst.height/this.inst.curFrame.height:"1,1"}if(t.substring(0,8)==="relative"){e=t.match(/\((.*?)\)/);e&&(r=parseFloat(e[1].split(",")[0]),u=parseFloat(e[1].split(",")[1]));isNaN(r)&&(r=0);isNaN(u)&&(u=0);switch(n){case 0:i=this.inst.x+r+","+(this.inst.y+u);break;case 1:i=this.inst.width+r+","+(this.inst.height+u);break;case 2:i=this.inst.width+r+","+(this.inst.height+u);break;case 3:i=this.inst.width+r+","+(this.inst.height+u);break;case 4:i=cr.to_degrees(this.inst.angle)+r+","+(cr.to_degrees(this.inst.angle)+u);break;case 5:i=this.inst.opacity*100+r+","+(this.inst.opacity*100+u);break;case 6:i=f+r+","+f+r;break;case 7:i=this.inst.x+r+","+this.inst.y;break;case 8:i=this.inst.x+","+(this.inst.y+r);break;case 9:i=r+","+u}}return i};t.addToTweenList=function(n,t,i,r,u,f,e){r=this.parseCurrent(t,r);u=this.parseCurrent(t,u);this.tween_list[n]!==undefined&&delete this.tween_list[n];this.tween_list[n]=new TweenObject(n,t,i,r,u,f,e);this.tween_list[n].dt=0};t.saveToJSON=function(){var n=JSON.stringify(this.tween_list["default"]);return{playmode:this.playmode,active:this.active,tweened:this.tweened,easing:this.easing,target:this.target,targetmode:this.targetmode,useCurrent:this.useCurrent,duration:this.duration,enforce:this.enforce,value:this.value,tweenlist:JSON.stringify(this.tween_list["default"])}};TweenObject.Load=function(n,t,i,r,u,f,e,o){var s=new TweenObject(t,i,r,u,f,e,o);for(var h in n)s[h]=n[h];return s};t.loadFromJSON=function(n){var t=JSON.parse(n.tweenlist),i=TweenObject.Load(t,t.name,t.tweened,t.easefunc,t.initialparam1+","+t.initialparam2,t.targetparam1+","+t.targetparam2,t.duration,t.enforce);this.tween_list["default"]=i;this.playmode=n.playmode;this.active=n.active;this.movement=n.tweened;this.easing=n.easing;this.target=n.target;this.targetmode=n.targetmode;this.useCurrent=n.useCurrent;this.duration=n.duration;this.enforce=n.enforce;this.value=n.value};t.setProgressTo=function(n){var i,t,r;n>1&&(n=1);n<0&&(n=0);for(i in this.tween_list)t=this.tween_list[i],t.lastKnownValue=0,t.lastKnownValue2=0,t.state=3,t.progress=n*t.duration,r=t.OnTick(0),this.updateTween(t,r)};t.startTween=function(n){var i,t,r,u;for(i in this.tween_list)t=this.tween_list[i],this.useCurrent&&(r=this.parseCurrent(t.tweened,"current"),u=this.parseCurrent(t.tweened,this.target),t.setInitial(r),t.setTarget(u)),n===0&&(t.progress=1e-6,t.lastKnownValue=0,t.lastKnownValue2=0,t.onStart=!0,t.state=1),n===1&&(t.state=t.lastState),(n===2||n===4)&&(t.progress=1e-6,t.lastKnownValue=0,t.lastKnownValue2=0,t.onStart=!0,n==2&&(t.state=4),n==4&&(t.state=6)),n===3&&(t.progress=1e-6,t.lastKnownValue=0,t.lastKnownValue2=0,t.onStart=!0,t.state=5)};t.stopTween=function(n){var i,t,r;for(i in this.tween_list)t=this.tween_list[i],t.state!=3&&t.state!=0&&(t.lastState=t.state),n===1&&(t.progress=0),n===2&&(t.progress=t.duration),t.state=3,r=t.OnTick(0),this.updateTween(t,r)};t.reverseTween=function(n){var i,t;for(i in this.tween_list)t=this.tween_list[i],n===1&&(t.progress=t.duration,t.lastKnownValue=0,t.lastKnownValue2=0,t.onReverseStart=!0),t.state=2};t.updateTween=function(n,t){var u,i,r;n.tweened===0?n.enforce?(this.inst.x=n.initialparam1+(n.targetparam1-n.initialparam1)*t,this.inst.y=n.initialparam2+(n.targetparam2-n.initialparam2)*t):(this.inst.x+=(n.targetparam1-n.initialparam1)*t-n.lastKnownValue,this.inst.y+=(n.targetparam2-n.initialparam2)*t-n.lastKnownValue2,n.lastKnownValue=(n.targetparam1-n.initialparam1)*t,n.lastKnownValue2=(n.targetparam2-n.initialparam2)*t):n.tweened===1?n.enforce?(this.inst.width=n.initialparam1+(n.targetparam1-n.initialparam1)*t,this.inst.height=n.initialparam2+(n.targetparam2-n.initialparam2)*t):(this.inst.width+=(n.targetparam1-n.initialparam1)*t-n.lastKnownValue,this.inst.height+=(n.targetparam2-n.initialparam2)*t-n.lastKnownValue2,n.lastKnownValue=(n.targetparam1-n.initialparam1)*t,n.lastKnownValue2=(n.targetparam2-n.initialparam2)*t):n.tweened===2?n.enforce?this.inst.width=n.initialparam1+(n.targetparam1-n.initialparam1)*t:(this.inst.width+=(n.targetparam1-n.initialparam1)*t-n.lastKnownValue,n.lastKnownValue=(n.targetparam1-n.initialparam1)*t):n.tweened===3?n.enforce?this.inst.height=n.initialparam2+(n.targetparam2-n.initialparam2)*t:(this.inst.height+=(n.targetparam2-n.initialparam2)*t-n.lastKnownValue2,n.lastKnownValue2=(n.targetparam2-n.initialparam2)*t):n.tweened===4?n.enforce?(u=n.initialparam1+(n.targetparam1-n.initialparam1)*t,this.inst.angle=cr.clamp_angle(cr.to_radians(u))):(u=(n.targetparam1-n.initialparam1)*t-n.lastKnownValue,this.inst.angle=cr.clamp_angle(this.inst.angle+cr.to_radians(u)),n.lastKnownValue=(n.targetparam1-n.initialparam1)*t):n.tweened===5?n.enforce?this.inst.opacity=(n.initialparam1+(n.targetparam1-n.initialparam1)*t)/100:(this.inst.opacity+=((n.targetparam1-n.initialparam1)*t-n.lastKnownValue)/100,n.lastKnownValue=(n.targetparam1-n.initialparam1)*t):n.tweened===6?n.enforce?this.value=n.initialparam1+(n.targetparam1-n.initialparam1)*t:(this.value+=(n.targetparam1-n.initialparam1)*t-n.lastKnownValue,n.lastKnownValue=(n.targetparam1-n.initialparam1)*t):n.tweened===7?n.enforce?this.inst.x=n.initialparam1+(n.targetparam1-n.initialparam1)*t:(this.inst.x+=(n.targetparam1-n.initialparam1)*t-n.lastKnownValue,n.lastKnownValue=(n.targetparam1-n.initialparam1)*t):n.tweened===8?n.enforce?this.inst.y=n.initialparam2+(n.targetparam2-n.initialparam2)*t:(this.inst.y+=(n.targetparam2-n.initialparam2)*t-n.lastKnownValue2,n.lastKnownValue2=(n.targetparam2-n.initialparam2)*t):n.tweened===9&&(i=n.initialparam1+(n.targetparam1-n.initialparam1)*t,r=n.initialparam2+(n.targetparam2-n.initialparam2)*t,this.inst.width<0&&(i=n.initialparam1+(n.targetparam1+n.initialparam1)*-t),this.inst.height<0&&(r=n.initialparam2+(n.targetparam2+n.initialparam2)*-t),n.enforce?(this.inst.width=this.inst.curFrame.width*i,this.inst.height=this.inst.curFrame.height*r):(this.inst.width<0?(this.inst.width=i*(this.inst.width/(-1+n.lastKnownValue)),n.lastKnownValue=i+1):(this.inst.width=i*(this.inst.width/(1+n.lastKnownValue)),n.lastKnownValue=i-1),this.inst.height<0?(this.inst.height=r*(this.inst.height/(-1+n.lastKnownValue2)),n.lastKnownValue2=r+1):(this.inst.height=r*(this.inst.height/(1+n.lastKnownValue2)),n.lastKnownValue2=r-1)));this.inst.set_bbox_changed()};t.tick=function(){var i=this.runtime.getDt(this.inst),n=this.tween_list["default"],t;n.state!==0&&(n.onStart&&(this.runtime.trigger(cr.behaviors.lunarray_LiteTween.prototype.cnds.OnStart,this.inst),n.onStart=!1),n.onReverseStart&&(this.runtime.trigger(cr.behaviors.lunarray_LiteTween.prototype.cnds.OnReverseStart,this.inst),n.onReverseStart=!1),this.active=n.state==1||n.state==2||n.state==4||n.state==5||n.state==6,t=n.OnTick(i),this.updateTween(n,t),n.onEnd&&(this.runtime.trigger(cr.behaviors.lunarray_LiteTween.prototype.cnds.OnEnd,this.inst),n.onEnd=!1),n.onReverseEnd&&(this.runtime.trigger(cr.behaviors.lunarray_LiteTween.prototype.cnds.OnReverseEnd,this.inst),n.onReverseEnd=!1))};i.cnds={};r=i.cnds;r.IsActive=function(){return this.tween_list["default"].state!==0};r.IsReversing=function(){return this.tween_list["default"].state==2};r.CompareProgress=function(n,t){var i=this.tween_list["default"];return cr.do_cmp(i.progress/i.duration,n,t)};r.OnThreshold=function(n,t){var r=this.tween_list["default"],i;return this.threshold=cr.do_cmp(r.progress/r.duration,n,t),i=this.oldthreshold!=this.threshold&&this.threshold,i&&(this.oldthreshold=this.threshold),i};r.OnStart=function(){return this.tween_list["default"]===undefined?!1:this.tween_list["default"].onStart};r.OnReverseStart=function(){return this.tween_list["default"]===undefined?!1:this.tween_list["default"].onReverseStart};r.OnEnd=function(){return this.tween_list["default"]===undefined?!1:this.tween_list["default"].onEnd};r.OnReverseEnd=function(){return this.tween_list["default"]===undefined?!1:this.tween_list["default"].onReverseEnd};i.acts={};n=i.acts;n.Start=function(n,t){this.threshold=!1;this.oldthreshold=!1;this.useCurrent=t==1;this.startTween(n)};n.Stop=function(n){this.stopTween(n)};n.Reverse=function(n){this.threshold=!1;this.oldthreshold=!1;this.reverseTween(n)};n.ProgressTo=function(n){this.setProgressTo(n)};n.SetDuration=function(n){isNaN(n)||n<0||this.tween_list["default"]!==undefined&&(this.tween_list["default"].duration=n)};n.SetEnforce=function(n){this.tween_list["default"]!==undefined&&(this.tween_list["default"].enforce=n===1)};n.SetInitial=function(n){if(this.tween_list["default"]!==undefined){var t=this.parseCurrent(this.tween_list["default"].tweened,n);this.tween_list["default"].setInitial(t)}};n.SetTarget=function(n,t,i){var f,e,r,u,o,s;if(this.tween_list["default"]!==undefined&&!isNaN(i)){if(f=this.tween_list["default"],e=i+"",this.targetmode=t,r="",u="",t===1){this.target="relative("+e+")";switch(n){case 0:r=this.inst.x+i;u=f.targetparam2;break;case 1:r=f.targetparam1;u=this.inst.y+i;break;case 2:r=""+cr.to_degrees(this.inst.angle+cr.to_radians(i));u=r;break;case 3:r=""+this.inst.opacity*100+i;u=r;break;case 4:r=this.inst.width+i;u=f.targetparam2;break;case 5:r=f.targetparam1;u=this.inst.height+i;break;case 6:r=i;u=i}e=r+","+u}else{switch(n){case 0:r=i;u=f.targetparam2;break;case 1:r=f.targetparam1;u=i;break;case 2:r=i;u=i;break;case 3:r=i;u=i;break;case 4:r=i;u=f.targetparam2;break;case 5:r=f.targetparam1;u=i;break;case 6:r=i;u=i}e=r+","+u;this.target=e}o=this.parseCurrent(this.tween_list["default"].tweened,"current");s=this.parseCurrent(this.tween_list["default"].tweened,e);f.setInitial(o);f.setTarget(s)}};n.SetTweenedProperty=function(n){this.tween_list["default"]!==undefined&&(this.tween_list["default"].tweened=n)};n.SetEasing=function(n){this.tween_list["default"]!==undefined&&(this.tween_list["default"].easefunc=n)};n.SetEasingParam=function(n,t,i,r,u){this.tween_list["default"]!==undefined&&(this.tween_list["default"].easingparam[n].optimized=!1,this.tween_list["default"].easingparam[n].a=t,this.tween_list["default"].easingparam[n].p=i,this.tween_list["default"].easingparam[n].t=r,this.tween_list["default"].easingparam[n].s=u)};n.ResetEasingParam=function(){this.tween_list["default"]!==undefined&&(this.tween_list["default"].optimized=!0)};n.SetValue=function(n){var t=this.tween_list["default"];this.value=n;t.tweened===6&&t.setInitial(this.parseCurrent(t.tweened,"current"))};n.SetParameter=function(n,t,i,r,u){if(this.tween_list["default"]===undefined)this.addToTweenList("default",n,t,initial,i,r,u,0);else{var f=this.tween_list["default"];f.tweened=n;f.easefunc=t;f.setInitial(this.parseCurrent(n,"current"));f.setTarget(this.parseCurrent(n,i));f.duration=r;f.enforce=u===1}};i.exps={};u=i.exps;u.State=function(n){var t="N/A";switch(this.tween_list["default"].state){case 0:t="paused";break;case 1:t="playing";break;case 2:t="reversing";break;case 3:t="seeking"}n.set_string(t)};u.Progress=function(n){var t=this.tween_list["default"].progress/this.tween_list["default"].duration;n.set_float(t)};u.Duration=function(n){n.set_float(this.tween_list["default"].duration)};u.Target=function(n){var t=this.tween_list["default"],i="N/A";switch(t.tweened){case 0:i=t.targetparam1;break;case 1:i=t.targetparam2;break;case 2:i=t.targetparam1;break;case 3:i=t.targetparam1;break;case 4:i=t.targetparam1;break;case 5:i=t.targetparam2;break;case 6:i=t.targetparam1}n.set_float(i)};u.Value=function(n){var t=this.value;n.set_float(t)};u.Tween=function(n,t,i,r,u){var f=r>1?1:r,e=easeFunc(u,f<0?0:f,0,1,1,!1,!1);n.set_float(t+e*(i-t))}}();cr.behaviors.solid=function(n){this.runtime=n},function(){function r(){}function u(){}var n=cr.behaviors.solid.prototype,i,t;n.Type=function(n,t){this.behavior=n;this.objtype=t;this.runtime=n.runtime};i=n.Type.prototype;i.onCreate=function(){};n.Instance=function(n,t){this.type=n;this.behavior=n.behavior;this.inst=t;this.runtime=n.runtime};t=n.Instance.prototype;t.onCreate=function(){this.inst.extra.solidEnabled=this.properties[0]!==0};t.tick=function(){};r.prototype.IsEnabled=function(){return this.inst.extra.solidEnabled};n.cnds=new r;u.prototype.SetEnabled=function(n){this.inst.extra.solidEnabled=!!n};n.acts=new u}();cr.getObjectRefTable=function(){return[cr.plugins_.AJAX,cr.plugins_.Arr,cr.plugins_.Audio,cr.plugins_.Browser,cr.plugins_.BTG_Audio_IOS,cr.plugins_.Function,cr.plugins_.Keyboard,cr.plugins_.Dictionary,cr.plugins_.LocalStorage,cr.plugins_.Rex_Hash,cr.plugins_.WebStorage,cr.plugins_.SpriteFontPlus,cr.plugins_.Touch,cr.plugins_.Sprite,cr.plugins_.Spritefont2,cr.plugins_.Text,cr.plugins_.TiledBg,cr.behaviors.Anchor,cr.behaviors.lunarray_LiteTween,cr.behaviors.Pin,cr.behaviors.solid,cr.system_object.prototype.cnds.IsGroupActive,cr.plugins_.Touch.prototype.cnds.OnTouchEnd,cr.plugins_.Sprite.prototype.acts.SetAnimFrame,cr.system_object.prototype.cnds.PickAll,cr.system_object.prototype.cnds.ForEach,cr.plugins_.Touch.prototype.cnds.IsTouchingObject,cr.plugins_.Sprite.prototype.cnds.CompareInstanceVar,cr.plugins_.Sprite.prototype.cnds.IsVisible,cr.system_object.prototype.cnds.Compare,cr.plugins_.TiledBg.prototype.exps.Count,cr.plugins_.Sprite.prototype.exps.ZIndex,cr.plugins_.TiledBg.prototype.exps.ZIndex,cr.plugins_.Sprite.prototype.exps.LayerNumber,cr.plugins_.TiledBg.prototype.exps.LayerNumber,cr.plugins_.Sprite.prototype.exps.Opacity,cr.plugins_.Sprite.prototype.acts.SetInstanceVar,cr.system_object.prototype.cnds.Else,cr.plugins_.Function.prototype.acts.CallFunction,cr.plugins_.Touch.prototype.cnds.OnTouchObject,cr.system_object.prototype.acts.SetVar,cr.system_object.prototype.exps.max,cr.plugins_.Sprite.prototype.exps.UID,cr.plugins_.Sprite.prototype.cnds.PickByUID,cr.system_object.prototype.cnds.OnLayoutStart,cr.plugins_.Sprite.prototype.acts.StopAnim,cr.plugins_.Function.prototype.cnds.OnFunction,cr.system_object.prototype.cnds.EveryTick,cr.plugins_.Function.prototype.exps.Param,cr.plugins_.Function.prototype.acts.SetReturnValue,cr.plugins_.Sprite.prototype.acts.SetVisible,cr.plugins_.WebStorage.prototype.cnds.LocalStorageExists,cr.system_object.prototype.exps.int,cr.plugins_.WebStorage.prototype.exps.LocalValue,cr.system_object.prototype.cnds.IsMobile,cr.system_object.prototype.cnds.IsOnPlatform,cr.plugins_.BTG_Audio_IOS.prototype.acts.SetMuted,cr.plugins_.Audio.prototype.acts.SetSilent,cr.plugins_.Audio.prototype.acts.StopAll,cr.system_object.prototype.exps.time,cr.plugins_.Audio.prototype.acts.Play,cr.plugins_.Browser.prototype.cnds.OnPageHidden,cr.plugins_.Browser.prototype.cnds.OnPageVisible,cr.plugins_.BTG_Audio_IOS.prototype.acts.Play,cr.plugins_.Browser.prototype.exps.ExecJS,cr.system_object.prototype.cnds.TriggerOnce,cr.system_object.prototype.acts.SetTimescale,cr.plugins_.Sprite.prototype.acts.Destroy,cr.plugins_.TiledBg.prototype.acts.Destroy,cr.system_object.prototype.exps.timescale,cr.system_object.prototype.acts.CreateObject,cr.plugins_.TiledBg.prototype.acts.SetWidth,cr.plugins_.TiledBg.prototype.acts.SetHeight,cr.plugins_.LocalStorage.prototype.acts.GetAllKeyNames,cr.plugins_.LocalStorage.prototype.cnds.OnAllKeyNamesLoaded,cr.plugins_.LocalStorage.prototype.exps.KeyCount,cr.system_object.prototype.cnds.For,cr.plugins_.LocalStorage.prototype.exps.KeyAt,cr.system_object.prototype.exps.loopindex,cr.plugins_.LocalStorage.prototype.acts.GetItem,cr.plugins_.LocalStorage.prototype.acts.SetItem,cr.plugins_.LocalStorage.prototype.cnds.OnAnyItemGet,cr.plugins_.Dictionary.prototype.acts.SetKey,cr.plugins_.LocalStorage.prototype.exps.Key,cr.plugins_.LocalStorage.prototype.exps.ItemValue,cr.plugins_.LocalStorage.prototype.cnds.OnAnyItemSet,cr.plugins_.LocalStorage.prototype.cnds.OnItemGet,cr.plugins_.Dictionary.prototype.exps.Get,cr.system_object.prototype.exps.str,cr.plugins_.WebStorage.prototype.acts.StoreLocal,cr.system_object.prototype.cnds.CompareVar,cr.plugins_.Sprite.prototype.exps.X,cr.plugins_.Sprite.prototype.exps.Y,cr.plugins_.Sprite.prototype.exps.Count,cr.plugins_.Sprite.prototype.cnds.CompareFrame,cr.system_object.prototype.acts.SetGroupActive,cr.plugins_.Browser.prototype.exps.QueryParam,cr.plugins_.Browser.prototype.acts.ConsoleLog,cr.plugins_.Browser.prototype.acts.ExecJs,cr.system_object.prototype.exps.tokenat,cr.plugins_.Browser.prototype.exps.URL,cr.plugins_.Rex_Hash.prototype.acts.CleanAll,cr.plugins_.Rex_Hash.prototype.acts.SetValueByKeyString,cr.plugins_.Rex_Hash.prototype.exps.AsJSON,cr.plugins_.AJAX.prototype.acts.SetHeader,cr.plugins_.AJAX.prototype.acts.SetTimeout,cr.plugins_.AJAX.prototype.acts.Post,cr.plugins_.AJAX.prototype.cnds.OnComplete,cr.plugins_.AJAX.prototype.exps.LastData,cr.plugins_.Rex_Hash.prototype.acts.StringToHashTable,cr.plugins_.Browser.prototype.acts.GoToURL,cr.plugins_.Rex_Hash.prototype.exps.At,cr.plugins_.AJAX.prototype.cnds.OnAnyError,cr.system_object.prototype.acts.AddVar,cr.system_object.prototype.exps.dt,cr.system_object.prototype.exps.floor,cr.plugins_.Sprite.prototype.acts.SetOpacity,cr.plugins_.SpriteFontPlus.prototype.acts.SetText,cr.plugins_.SpriteFontPlus.prototype.acts.SetVisible,cr.system_object.prototype.acts.GoToLayout,cr.system_object.prototype.acts.Wait,cr.plugins_.BTG_Audio_IOS.prototype.acts.Stop,cr.system_object.prototype.acts.GoToLayoutByName,cr.plugins_.BTG_Audio_IOS.prototype.acts.Load,cr.system_object.prototype.exps.loadingprogress,cr.plugins_.Spritefont2.prototype.acts.SetText,cr.system_object.prototype.exps.round,cr.plugins_.Spritefont2.prototype.acts.SetX,cr.system_object.prototype.exps.scrollx,cr.plugins_.Sprite.prototype.acts.SetX,cr.system_object.prototype.exps.viewportbottom,cr.system_object.prototype.exps.viewportright,cr.plugins_.Arr.prototype.acts.SetSize,cr.system_object.prototype.exps.min,cr.behaviors.Anchor.prototype.acts.SetEnabled,cr.plugins_.Sprite.prototype.acts.SetPos,cr.behaviors.lunarray_LiteTween.prototype.acts.SetParameter,cr.behaviors.lunarray_LiteTween.prototype.acts.Start,cr.plugins_.Sprite.prototype.acts.MoveToLayer,cr.plugins_.Sprite.prototype.acts.MoveToTop,cr.system_object.prototype.cnds.PickByEvaluate,cr.plugins_.Sprite.prototype.cnds.PickTopBottom,cr.plugins_.Arr.prototype.acts.SetXY,cr.plugins_.Sprite.prototype.cnds.PickDistance,cr.system_object.prototype.exps.sqrt,cr.system_object.prototype.exps.atan,cr.plugins_.Arr.prototype.cnds.CompareXY,cr.plugins_.Arr.prototype.exps.At,cr.plugins_.Sprite.prototype.cnds.OnCreated,cr.plugins_.Sprite.prototype.cnds.CompareX,cr.plugins_.Arr.prototype.acts.Push,cr.system_object.prototype.cnds.ForEachOrdered,cr.plugins_.Sprite.prototype.acts.SetAnimSpeed,cr.system_object.prototype.exps.distance,cr.plugins_.Sprite.prototype.acts.SetAngle,cr.system_object.prototype.exps.angle,cr.plugins_.Sprite.prototype.acts.SetY,cr.plugins_.Function.prototype.exps.Call,cr.plugins_.Arr.prototype.exps.IndexOf,cr.system_object.prototype.exps.abs,cr.system_object.prototype.exps.cos,cr.system_object.prototype.exps.sin,cr.system_object.prototype.exps.clamp,cr.plugins_.Arr.prototype.exps.Width,cr.plugins_.Touch.prototype.exps.X,cr.plugins_.Touch.prototype.exps.Y,cr.plugins_.Sprite.prototype.exps.Angle,cr.plugins_.Sprite.prototype.exps.Height,cr.behaviors.Pin.prototype.exps.PinnedUID,cr.system_object.prototype.exps.random,cr.plugins_.SpriteFontPlus.prototype.acts.Destroy,cr.system_object.prototype.exps.viewportleft,cr.plugins_.Sprite.prototype.acts.SetSize,cr.behaviors.Pin.prototype.acts.Pin,cr.plugins_.SpriteFontPlus.prototype.exps.LayerNumber,cr.plugins_.SpriteFontPlus.prototype.exps.X,cr.plugins_.SpriteFontPlus.prototype.exps.Y,cr.plugins_.Sprite.prototype.cnds.PickInstVarHiLow,cr.system_object.prototype.cnds.While,cr.plugins_.Arr.prototype.acts.Insert,cr.system_object.prototype.acts.StopLoop,cr.plugins_.Arr.prototype.acts.SetX,cr.plugins_.Sprite.prototype.cnds.OnAnyAnimFinished,cr.plugins_.Sprite.prototype.cnds.OnDestroyed,cr.plugins_.Sprite.prototype.acts.SetScale,cr.plugins_.SpriteFontPlus.prototype.acts.SetScale,cr.system_object.prototype.cnds.PickOverlappingPoint]}